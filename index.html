<script>
// Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† (Ù…Ø¹ Ø¯Ø¹Ù… await)
async function saveToLocalStorage(key, value) {
    try {
        localStorage.setItem(key, JSON.stringify(value));
        // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„ÙˆØ¬ Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ø±ØºØ¨Øª
        // console.log(`âœ… ØªÙ… Ø­ÙØ¸ ${key} ÙÙŠ localStorage`);
        return true;
    } catch (e) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage:', e);
        return false;
    }
}
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© (ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù†ØµÙˆØµ)
function toEnglishDigits(str) {
    if (typeof str !== 'string') str = String(str);
    return str.replace(/[Ù -Ù©]/g, d => '0123456789'['Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d)]);
}
// âœ… Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯ - Ù…Ø¶ØºÙˆØ· Ù„ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© A4 (Ù…Ø¶Ù…ÙˆÙ† 100%)
function generateInstallmentPaymentReceipt({debt, paidInstallment, storeSettings}) {
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const customerName = debt.customer_name || '';
    const customerPhone = debt.customer_phone || '';
    const storeName = storeSettings?.storeName || storeSettings?.store_name || 'Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨';
    const storeAddress = storeSettings?.storeAddress || storeSettings?.store_address || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ©';
    const storePhone = storeSettings?.storePhone || storeSettings?.store_phone || '07803092185';
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚Ø³Ø·
    const paidMonth = paidInstallment.month;
    const paidAmount = paidInstallment.paid_amount || paidInstallment.amount;
    const paidDate = paidInstallment.paid_date ? new Date(paidInstallment.paid_date) : new Date();
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    const dateStr = toEnglishDigits(paidDate.toLocaleDateString('ar-IQ'));
    const timeStr = toEnglishDigits(paidDate.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit' }));
    
    // Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    const allInstallments = debt.installments || [];
    const remainingInstallments = allInstallments.filter(inst => inst.status !== 'paid');
    const paidInstallments = allInstallments.filter(inst => inst.status === 'paid');
    const remainingMonths = remainingInstallments.length;
    const remainingAmount = remainingInstallments.reduce((sum, inst) => sum + (inst.amount || 0), 0);
    const totalPaidAmount = debt.paid_amount || 0;
    const totalAmount = debt.total_amount || debt.final_total || 0;
    const totalMonths = debt.installment_months || allInstallments.length;
    const paidMonthsCount = paidInstallments.length;
    
    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    const invoiceId = debt.invoice_id || debt.debt_id || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    
    // Ø¥ØµÙ„Ø§Ø­: Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø©
    let products = [];
    if (Array.isArray(debt.products) && debt.products.length > 0) {
        products = debt.products;
    } else if (Array.isArray(debt.items) && debt.items.length > 0) {
        products = debt.items;
    } else if (typeof debt.items === 'string') {
        try {
            products = JSON.parse(debt.items);
        } catch (e) {
            console.error('ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', e);
            products = [];
        }
    }
    
    const hasProducts = products.length > 0;
    const paymentPercentage = totalAmount > 0 ? ((totalPaidAmount / totalAmount) * 100).toFixed(0) : 0;
    const receiptNumber = `${invoiceId}-${paidMonth}`;
    const nextInstallment = remainingInstallments[0];

    let html = `<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Cairo', sans-serif;
    font-size: 9px;
    line-height: 1.3;
    background: #f4f6fa;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
}
.a4-sheet {
    width: 297mm;
    height: 210mm;
    max-width: 100vw;
    max-height: 100vh;
    margin: 0 auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 0 20px #0001;
    padding: 12px 16px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    box-sizing: border-box;
}
.a4-grid {
    display: grid;
    grid-template-columns: 2fr 1.5fr 2fr;
    grid-template-rows: 1fr 1fr 1fr;
    gap: 12px 16px;
    height: 100%;
}
.a4-header {
    grid-column: 1 / 4;
    text-align: center;
    background: linear-gradient(90deg, #667eea 0%, #38ef7d 100%);
    color: #fff;
    padding: 8px 0 6px 0;
    border-radius: 8px;
    margin-bottom: 8px;
}
.a4-header h1 {
    font-size: 1.3rem;
    margin-bottom: 0.3rem;
    letter-spacing: 0.5px;
}
.a4-header .info {
    font-size: 0.8rem;
    font-weight: 500;
}
.a4-box {
    background: #f8fafc;
    border-radius: 6px;
    box-shadow: 0 1px 4px #0001;
    padding: 8px 10px;
    border: 1px solid #e0e7ef;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    min-height: 80px;
}
.a4-box-title {
    font-weight: 700;
    font-size: 0.8rem;
    margin-bottom: 4px;
    color: #667eea;
}
.a4-box-value {
    font-weight: 900;
    font-size: 1rem;
    color: #22223b;
    margin-bottom: 3px;
}
.a4-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.7rem;
    margin-top: 4px;
}
.a4-table th, .a4-table td {
    border: 1px solid #e0e7ef;
    padding: 4px 3px;
    text-align: center;
}
.a4-table th {
    background: #667eea;
    color: #fff;
    font-weight: 700;
    font-size: 0.65rem;
}
.a4-progress {
    width: 100%;
    height: 12px;
    background: #e9ecef;
    border-radius: 6px;
    overflow: hidden;
    margin-top: 4px;
}
.a4-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #38ef7d 0%, #667eea 100%);
    border-radius: 6px;
}
.a4-footer {
    grid-column: 1 / 4;
    text-align: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    padding: 6px 0 4px 0;
    border-radius: 8px;
    font-size: 0.75rem;
    margin-top: 8px;
}
@media print {
    body { margin: 0; }
    .a4-sheet { margin: 0; box-shadow: none; border-radius: 0; }
}
</style>
</head>
<body>
<div class="a4-sheet">
    <div class="a4-header">
        ${storeSettings?.store_logo ? `<div style="text-align:center;margin-bottom:6px;"><img src="${storeSettings.store_logo}" alt="Logo" style="max-width:60px;max-height:60px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.2);" onerror="this.style.display='none'" /></div>` : ''}
        <h1>Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø·</h1>
        <div class="info"><strong>${storeName}</strong> â€¢ ${storeAddress} â€¢ ${storePhone}</div>
    </div>
    <div class="a4-grid">
        <div class="a4-box" style="grid-row: 1; grid-column: 1;">
            <div class="a4-box-title">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
            <div style="font-size:0.75rem;"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${customerName}</div>
            ${customerPhone ? `<div><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${customerPhone}</div>` : ''}
            <div><b>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</b> ${toEnglishDigits(invoiceId)}</div>
        </div>
        <div class="a4-box" style="grid-row: 1; grid-column: 2;">
            <div class="a4-box-title">ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„</div>
            <div class="a4-box-value">${toEnglishDigits(receiptNumber)}</div>
            <div><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${dateStr}</div>
            <div><b>Ø§Ù„ÙˆÙ‚Øª:</b> ${timeStr}</div>
        </div>
        <div class="a4-box" style="grid-row: 1; grid-column: 3;">
            <div class="a4-box-title">ğŸ’° Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯</div>
            <div><b>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø·:</b> ${toEnglishDigits(paidMonth)} Ù…Ù† ${toEnglishDigits(totalMonths)}</div>
            <div><b>Ø§Ù„Ù…Ø¨Ù„Øº:</b> <span style="color:#11998e;font-weight:900;">${toEnglishDigits(paidAmount.toLocaleString('en'))} Ø¯.Ø¹</span></div>
        </div>
        <div class="a4-box" style="grid-row: 2; grid-column: 1;">
            <div class="a4-box-title">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙŠÙ†</div>
            <div><b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙ†:</b> ${toEnglishDigits(totalAmount.toLocaleString('en'))} Ø¯.Ø¹</div>
            <div><b>Ø§Ù„Ù…Ø³Ø¯Ø¯:</b> <span style="color:#047857;">${toEnglishDigits(totalPaidAmount.toLocaleString('en'))} Ø¯.Ø¹ (${toEnglishDigits(paidMonthsCount)} Ù‚Ø³Ø·)</span></div>
            <div><b>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</b> <span style="color:#dc2626;">${toEnglishDigits(remainingAmount.toLocaleString('en'))} Ø¯.Ø¹ (${toEnglishDigits(remainingMonths)} Ù‚Ø³Ø·)</span></div>
            <div style="margin-top:8px;"><b>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:</b> <span style="color:#667eea;font-weight:900;">${toEnglishDigits(paymentPercentage)}%</span></div>
            <div class="a4-progress"><div class="a4-progress-bar" style="width:${paymentPercentage}%;"></div></div>
        </div>
        <div class="a4-box" style="grid-row: 2; grid-column: 2;">
            <div class="a4-box-title">ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                ${hasProducts ? `<div style="max-height:90px;overflow-y:auto;"><table class="a4-table" style="font-size:0.8rem;"><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr>${products.map(p => `<tr><td style=\"text-align:right;\">${p.name || p.product_name}</td><td>${toEnglishDigits(p.quantity || 1)}</td><td>${toEnglishDigits((p.price || 0).toLocaleString('en'))}</td></tr>`).join('')}</table></div>` : '<div style="color:#aaa;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>'}
        </div>
        <div class="a4-box" style="grid-row: 2; grid-column: 3;">
            <div class="a4-box-title">ğŸ“… Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
            ${remainingMonths > 0 ? `<table class="a4-table"><tr><th>Ø§Ù„Ù‚Ø³Ø·</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th></tr>${remainingInstallments.slice(0, 4).map(inst => {const dueDate = inst.due_date ? new Date(inst.due_date).toLocaleDateString('ar-IQ', {month:'numeric',day:'numeric'}) : '-';return `<tr><td>${toEnglishDigits(inst.month)}</td><td>${toEnglishDigits(inst.amount.toLocaleString('en'))}</td><td>${toEnglishDigits(dueDate)}</td></tr>`;}).join('')}${remainingMonths > 4 ? `<tr><td colspan="3" style="color:#1e40af;font-weight:600;">+ ${toEnglishDigits(remainingMonths - 4)} Ù‚Ø³Ø· Ø¥Ø¶Ø§ÙÙŠ</td></tr>` : ''}</table>` : '<div style="color:#047857;font-weight:700;">ØªÙ… Ø³Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·!</div>'}
        </div>
        <div class="a4-box" style="grid-row: 3; grid-column: 1 / 4;">
            <div class="a4-box-title">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
            <ul style="margin:0 0 0 18px;padding:0;font-size:1rem;">
                <li>Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥ÙŠØµØ§Ù„ ÙƒØ¥Ø«Ø¨Ø§Øª Ù„Ù„Ø¯ÙØ¹</li>
                ${nextInstallment ? `<li>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…: <strong>${toEnglishDigits(nextInstallment.amount.toLocaleString('en'))} Ø¯.Ø¹</strong> ${nextInstallment.due_date ? `Ø¨ØªØ§Ø±ÙŠØ® ${toEnglishDigits(new Date(nextInstallment.due_date).toLocaleDateString('ar-IQ'))}` : ''}</li>` : ''}
                <li>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: ${storePhone}</li>
            </ul>
        </div>
    </div>
    <div class="a4-footer">
        <div style="font-weight:700;margin-bottom:2px;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… ğŸ™</div>
        <div>Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ Ø¨Ø±Ùˆ - Digital Creativity Â© ${new Date().getFullYear()}</div>
    </div>
</div>
</body>
</html>`;
    
    return html;
}
</script>
<!doctype html>
<html lang="ar" dir="rtl">
<!-- Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ© - Digital Creativity -->
<script>
// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±" ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
function showPage(page) {
    console.log('ğŸ“„ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©:', page);
    
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    document.querySelectorAll('.section').forEach(section => {
        section.style.display = 'none';
    });

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });

    // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† page Ù‡Ùˆ 'reports'
    if (page === 'reports') {
        const reportsSection = document.getElementById('reportsSection');
        if (reportsSection) {
            reportsSection.style.display = 'block';
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ù†Ø´Ø· Ù„Ø²Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
            const reportsNavBtn = document.querySelector('.nav-item .nav-link .fa-chart-bar')?.parentElement?.parentElement;
            if (reportsNavBtn) {
                reportsNavBtn.classList.add('active');
            }
        }
    } else {
        // Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
        const pageSection = document.getElementById(page + 'Section');
        if (pageSection) {
            pageSection.style.display = 'block';
        }
    }
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©
    if (window.securityManager) {
        setTimeout(() => {
            window.securityManager.applyPermissionsToElements();
        }, 100);
    }
}

// Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
function openSystemManagement() {
    console.log('ğŸ”§ ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');
    showModal('systemManagementModal');
    updateSystemStatus();
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
async function updateSystemStatus() {
    try {
        const uid = localStorage.getItem('app_uid');
        const version = localStorage.getItem('app_version') || '1.0.0';
        
        document.getElementById('systemStatusUID').textContent = uid || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        document.getElementById('systemStatusVersion').textContent = version;
        
        if (window.authFix) {
            const accountCheck = await window.authFix.checkCurrentAccount();
            const statusElem = document.getElementById('systemStatusAccount');
            if (accountCheck.hasAccount && accountCheck.isValid) {
                statusElem.textContent = 'âœ… ØµØ§Ù„Ø­';
                statusElem.style.color = '#10b981';
            } else if (accountCheck.hasAccount && !accountCheck.isValid) {
                statusElem.textContent = 'âš ï¸ ØºÙŠØ± ØµØ§Ù„Ø­';
                statusElem.style.color = '#f59e0b';
            } else {
                statusElem.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨';
                statusElem.style.color = '#6b7280';
            }
        }
        
        const firebaseElem = document.getElementById('systemStatusFirebase');
        if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
            firebaseElem.textContent = 'âœ… Ù…ØªØµÙ„';
            firebaseElem.style.color = '#10b981';
        } else {
            firebaseElem.textContent = 'âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„';
            firebaseElem.style.color = '#ef4444';
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
    }
}

// Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
async function systemCheckAccount() {
    const logDiv = document.getElementById('systemConsoleLog');
    logDiv.innerHTML += '<div style="color:#3b82f6">â³ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨...</div>';
    
    try {
        const result = await window.authFix.checkCurrentAccount();
        if (result.hasAccount && result.isValid) {
            logDiv.innerHTML += '<div style="color:#10b981">âœ… Ø§Ù„Ø­Ø³Ø§Ø¨ ØµØ§Ù„Ø­ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­</div>';
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } else if (result.hasAccount && !result.isValid) {
            logDiv.innerHTML += `<div style="color:#f59e0b">âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­: ${result.reason}</div>`;
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } else {
            logDiv.innerHTML += '<div style="color:#6b7280">â„¹ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø­ÙÙˆØ¸</div>';
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        updateSystemStatus();
    } catch (error) {
        logDiv.innerHTML += `<div style="color:#ef4444">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    logDiv.scrollTop = logDiv.scrollHeight;
}

async function systemFixRegistration() {
    const logDiv = document.getElementById('systemConsoleLog');
    logDiv.innerHTML += '<div style="color:#3b82f6">â³ Ø¬Ø§Ø±ÙŠ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</div>';
    
    try {
        const result = await window.authFix.attemptRegistrationFix();
        if (result.success) {
            logDiv.innerHTML += `<div style="color:#10b981">âœ… ${result.message}</div>`;
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } else {
            logDiv.innerHTML += `<div style="color:#ef4444">âŒ ÙØ´Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­: ${result.error}</div>`;
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        updateSystemStatus();
    } catch (error) {
        logDiv.innerHTML += `<div style="color:#ef4444">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    logDiv.scrollTop = logDiv.scrollHeight;
}

async function systemSoftReset() {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ÙÙŠÙØ©ØŸ\n\nØ³ÙŠØªÙ… Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.')) {
        return;
    }
    
    const logDiv = document.getElementById('systemConsoleLog');
    logDiv.innerHTML += '<div style="color:#f59e0b">â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ÙÙŠÙØ©...</div>';
    
    try {
        const result = await window.systemReset.softReset();
        if (result.success) {
            logDiv.innerHTML += '<div style="color:#10b981">âœ… ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­</div>';
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            setTimeout(() => window.location.reload(), 2000);
        } else {
            logDiv.innerHTML += `<div style="color:#ef4444">âŒ ÙØ´Ù„Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†: ${result.error}</div>`;
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
    } catch (error) {
        logDiv.innerHTML += `<div style="color:#ef4444">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    logDiv.scrollTop = logDiv.scrollHeight;
}

async function systemFullReset() {
    if (!confirm('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒØ§Ù…Ù„Ø©\n\nØ³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
        return;
    }
    
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ 100%ØŸ\n\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
        return;
    }
    
    const logDiv = document.getElementById('systemConsoleLog');
    logDiv.innerHTML += '<div style="color:#ef4444">â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø©...</div>';
    
    try {
        const result = await window.systemReset.fullReset(true);
        if (result.success) {
            logDiv.innerHTML += '<div style="color:#10b981">âœ… ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø©</div>';
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
    } catch (error) {
        logDiv.innerHTML += `<div style="color:#ef4444">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    logDiv.scrollTop = logDiv.scrollHeight;
}

async function systemClearInvalidData() {
    const logDiv = document.getElementById('systemConsoleLog');
    logDiv.innerHTML += '<div style="color:#3b82f6">â³ Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©...</div>';
    
    try {
        const cleared = await window.authFix.clearInvalidAccount();
        if (cleared) {
            logDiv.innerHTML += '<div style="color:#10b981">âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©</div>';
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } else {
            logDiv.innerHTML += '<div style="color:#6b7280">â„¹ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©</div>';
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        updateSystemStatus();
    } catch (error) {
        logDiv.innerHTML += `<div style="color:#ef4444">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    logDiv.scrollTop = logDiv.scrollHeight;
}

async function systemExportBackup(type = 'full') {
    const logDiv = document.getElementById('systemConsoleLog');
    logDiv.innerHTML += '<div style="color:#3b82f6">â³ Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...</div>';
    try {
        await window.systemReset.exportBackup(type);
        logDiv.innerHTML += '<div style="color:#10b981">âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­</div>';
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    } catch (error) {
        logDiv.innerHTML += `<div style="color:#ef4444">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    logDiv.scrollTop = logDiv.scrollHeight;
}

(function() {
    console.log('ğŸ”§ ØªØ·Ø¨ÙŠÙ‚ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ©...');
    // Ø­ÙØ¸ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
    const originalPrintInvoiceHtml = window.electronAPI?.printInvoiceHtml;
    if (originalPrintInvoiceHtml) {
        // ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
        window.electronAPI.printInvoiceHtml = function(html, options = {}) {
            // Ø¥Ø¬Ø¨Ø§Ø± silent: true Ø¯Ø§Ø¦Ù…Ø§Ù‹
            const forcedOptions = {
                ...options,
                silent: true  // âš¡ Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ© Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©
            };
            console.log('âœ… Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ© Ù…ÙØ¹Ù‘Ù„Ø©:', forcedOptions);
            // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
            return originalPrintInvoiceHtml(html, forcedOptions);
        };
        console.log('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ© Ø¨Ù†Ø¬Ø§Ø­!');
    } else {
        console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ electronAPI.printInvoiceHtml');
    }
    // ØªØ¬Ø§ÙˆØ² Ø£ÙŠ Ø¯ÙˆØ§Ù„ Ø·Ø¨Ø§Ø¹Ø© Ø£Ø®Ø±Ù‰
    if (window.thermalPrinter?.print) {
        const originalThermalPrint = window.thermalPrinter.print;
        window.thermalPrinter.print = function(html, options = {}) {
            return originalThermalPrint(html, { ...options, silent: true });
        };
    }
    if (window.a4Printer?.print) {
        const originalA4Print = window.a4Printer.print;
        window.a4Printer.print = function(html, options = {}) {
            return originalA4Print(html, { ...options, silent: true });
        };
    }
    // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ©
    window.forceSilentPrint = function(html, options = {}) {
        if (window.electronAPI && window.electronAPI.printInvoiceHtml) {
            window.electronAPI.printInvoiceHtml(html, {
                ...options,
                silent: true,
                printBackground: true
            });
        } else {
            console.error('âŒ electronAPI ØºÙŠØ± Ù…ØªØ§Ø­');
        }
    };
    console.log('ğŸ‰ Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ© Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!');
})();

// Ø¯Ø§Ù„Ø© Ù„Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
window.clearInvoiceCache = function () {
    if (window.invoiceData) {
        window.invoiceData = null;
    }
    if (window.lastPrintedInvoice) {
        window.lastPrintedInvoice = null;
    }
};

// Ø¯Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¢Ù…Ù†Ø© ØªØ¶Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹
window.safePrintInvoice = function (html, options = {}) {
    window.clearInvoiceCache();
    window.forceSilentPrint(html, options);
};
window.testSilentPrint = function() {
    const testHtml = `
<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial;
            padding: 20px;
            text-align: center;
        }
        h1 {
            color: #2196F3;
        }
    </style>
    
    <!-- CSS Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
    <style>
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
    .action-buttons {
        display: flex;
        gap: 5px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .btn-icon {
        padding: 6px 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    .btn-icon:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .btn-icon.btn-info {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
    }
    
    .btn-icon.btn-primary {
        background: linear-gradient(135deg, #6366f1, #4f46e5);
        color: white;
    }
    
    .btn-icon.btn-warning {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
    }
    
    .btn-icon.btn-danger {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }
    
    .btn-icon.btn-success {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }
    
    /* ØµÙÙˆÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¯ÙŠÙ† */
    #debtProductsContainer {
        margin: 1rem 0;
    }
    
    #debtProductsTable input.form-input {
        width: 100%;
        padding: 8px;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    .modal-content {
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from {
            transform: translateY(-50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
    .table th, .table td {
        padding: 12px;
        vertical-align: middle;
    }
    
    /* Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    .export-btn {
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
    .stat-card {
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ */
    .expense-tab-btn {
        transition: all 0.3s ease;
    }
    
    .expense-tab-btn:hover {
        transform: translateY(-2px);
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
    .form-input:focus, .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn {
        transition: all 0.3s ease;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .card {
        transition: box-shadow 0.3s ease;
    }
    
    .card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .btn-icon {
            width: 100%;
        }
    }
    </style>
</head>
<body>
    <h1>âœ… Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ©</h1>
    <p>Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø©ØŒ ÙØ§Ù„Ø¥ØµÙ„Ø§Ø­ ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!</p>
    <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleString('ar-IQ')}</p>
</body>
</html>
    `;
    console.log('ğŸ§ª Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ©...');
    window.forceSilentPrint(testHtml);
};

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ–¨ï¸  Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ© v2.0.1         â•‘
â•‘   Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ - ÙƒØ±Ø§Ø± Ø§Ù„Ø³Ø¹Ø¨Ø±ÙŠ      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª:
  â€¢ Ø¥Ù„ØºØ§Ø¡ Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
  â€¢ Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹
  â€¢ Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±

ğŸ“ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Console:
  â€¢ testSilentPrint()      - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
  â€¢ forceSilentPrint(html) - Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ© Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ©

ğŸ”§ Ù„Ù„Ø¯Ø¹Ù…: info@digital-creativity.iq
`);
</script>
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
  <!-- SheetJS for Excel support -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

<!-- jsPDF for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  
 <!-- âœ… Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="./firebase-config.js"></script>
<script src="./firebase-config-fixed.js"></script>


  <!-- Firebase Initialization Check - Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ø£ÙƒØ«Ø± ØµØ¨Ø±Ø§Ù‹ -->
  <script>
(function() {
    'use strict';
    
    console.log('ğŸ” ÙØ­Øµ ØªÙ‡ÙŠØ¦Ø© Firebase...');
    
    // ÙˆØ¸ÙŠÙØ© Ø§Ù„ÙØ­Øµ Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
    function checkFirebaseInit() {
        return new Promise((resolve, reject) => {
            let attempts = 0;
            const maxAttempts = 50; // Ø²ÙŠØ§Ø¯Ø© Ø¥Ù„Ù‰ 50 Ù…Ø­Ø§ÙˆÙ„Ø© = 10 Ø«ÙˆØ§Ù†Ù
            
            const checkInterval = setInterval(() => {
                attempts++;
                
                // ÙØ­Øµ Firebase
                if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                    // ÙØ­Øµ database
                    if (window.database && typeof window.database.ref === 'function') {
                        clearInterval(checkInterval);
                        console.log('âœ… Firebase Ø¬Ø§Ù‡Ø² ÙˆØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­');
                        console.log('ğŸ“Š Firebase Apps:', firebase.apps.length);
                        console.log('ğŸ”— Database Ù…ØªØµÙ„:', !!window.database);
                        resolve(true);
                        return;
                    }
                    
                    // Ø¥Ø°Ø§ Firebase Ù…ÙˆØ¬ÙˆØ¯ Ù„ÙƒÙ† database ØºÙŠØ± Ù…Ø¹Ø±Ù‘Ù
                    if (!window.database) {
                        try {
                            window.database = firebase.database();
                            console.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© database Ø¨Ù†Ø¬Ø§Ø­');
                        } catch (error) {
                            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© database:', error);
                        }
                    }
                }
                
                // Ø±Ø³Ø§Ø¦Ù„ ØªÙ‚Ø¯Ù… ÙƒÙ„ 10 Ù…Ø­Ø§ÙˆÙ„Ø§Øª
                if (attempts % 10 === 0 && attempts < maxAttempts) {
                    console.log(`â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±... (Ù…Ø­Ø§ÙˆÙ„Ø© ${attempts}/${maxAttempts})`);
                }
                
                // Ø¥Ø°Ø§ ÙˆØµÙ„Ù†Ø§ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª
                if (attempts >= maxAttempts) {
                    clearInterval(checkInterval);
                    console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹');
                    console.log('â„¹ï¸ Ø³ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©');
                    // Ù†Ø­Ù„Ù‘Ù‡Ø§ Ø¨Ø¯ÙˆÙ† reject Ù„ÙƒÙŠ Ù„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø¹Ø¬Ø©
                    resolve(false); // âœ… ØªØºÙŠÙŠØ± Ù…Ù† reject Ø¥Ù„Ù‰ resolve(false)
                }
            }, 200); // ÙØ­Øµ ÙƒÙ„ 200ms
        });
    }
    
    // ØªÙ†ÙÙŠØ° Ø§Ù„ÙØ­Øµ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const isReady = await checkFirebaseInit();
            
            if (isReady) {
                console.log('ğŸ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
            } else {
                console.log('âš ï¸ Firebase Ù„Ù… ÙŠØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ø¨Ø¹Ø¯ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©');
                // Ù„Ø§ ØªØ¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ ÙÙ‚Ø· Ø³Ø¬Ù„ ÙÙŠ Console
            }
            
        } catch (error) {
            // Ù‡Ø°Ø§ Ù„Ù† ÙŠØ­Ø¯Ø« Ø§Ù„Ø¢Ù† Ù„Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… resolve Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† reject
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
        }
    });
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¹Ø¯ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª
    window.checkFirebaseConnection = async function() {
        if (!window.database) {
            console.error('âŒ database ØºÙŠØ± Ù…Ø¹Ø±Ù‘Ù');
            return false;
        }
        
        try {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„
            await database.ref('.info/connected').once('value');
            console.log('âœ… Firebase Ù…ØªØµÙ„');
            return true;
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
            return false;
        }
    };
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹
    window.retryFirebaseInit = async function() {
        console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‡ÙŠØ¦Ø© Firebase...');
        
        try {
            if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                if (!window.database) {
                    window.database = firebase.database();
                    console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Database');
                }
                
                if (!window.firestore) {
                    window.firestore = firebase.firestore();
                    console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firestore');
                }
                
                console.log('âœ… ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­');
                return true;
            } else {
                console.error('âŒ Firebase SDK ØºÙŠØ± Ù…Ø­Ù…Ù‘Ù„');
                return false;
            }
        } catch (error) {
            console.error('âŒ ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©:', error);
            return false;
        }
    };
    
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Firebase Initialization Check');
})();
  </script>
  
  <script src="./_sdk/data_sdk.js"></script>
  <script src="./_sdk/element_sdk.js"></script>
  
  <!-- System Reset SDK - Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø´Ø§Ù…Ù„ -->
  <script>
/**
 * System Reset SDK - Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
 * ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª
 * Digital Creativity Company - Ø§Ù„Ù…Ø·ÙˆØ±: ÙƒØ±Ø§Ø±
 */
(function() {
    'use strict';
    const RESET_KEY = 'app_reset_token';
    const VERSION_KEY = 'app_version';
    const CURRENT_VERSION = '1.0.0';
    class SystemReset {
        constructor() { this.resetInProgress = false; }
        async validateStoredData() {
            try {
                const uid = localStorage.getItem('app_uid');
                const secret = localStorage.getItem('app_secret');
                const version = localStorage.getItem(VERSION_KEY);
                if (version !== CURRENT_VERSION) {
                    console.log('âš ï¸ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªØºÙŠØ±ØŒ ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†');
                    return { isValid: false, reason: 'version_mismatch', message: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©' };
                }
                if (uid && secret) {
                    try {
                        if (typeof database !== 'undefined') {
                            const snap = await database.ref(`users/${uid}`).once('value');
                            if (!snap.exists()) {
                                console.log('âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Firebase');
                                return { isValid: false, reason: 'user_not_found', message: 'Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' };
                            }
                            const userData = snap.val();
                            if (userData.profile && userData.profile.secret !== secret) {
                                console.log('âš ï¸ Secret Key ØºÙŠØ± ØµØ­ÙŠØ­');
                                return { isValid: false, reason: 'invalid_secret', message: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­Ø©' };
                            }
                            console.log('âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØµØ§Ù„Ø­Ø©');
                            return { isValid: true };
                        }
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase:', error);
                        return { isValid: false, reason: 'firebase_error', message: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª' };
                    }
                }
                return { isValid: false, reason: 'no_data', message: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©' };
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return { isValid: false, reason: 'validation_error', message: error.message };
            }
        }
        async clearAllLocalData(keepVersion = false) {
            if (this.resetInProgress) {
                console.log('âš ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ø§Ù„ÙØ¹Ù„');
                return { success: false, error: 'reset_in_progress' };
            }
            this.resetInProgress = true;
            const cleared = [];
            try {
                console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©...');
                try {
                    const keysToKeep = keepVersion ? [VERSION_KEY] : [];
                    const savedData = {};
                    keysToKeep.forEach(key => {
                        const value = localStorage.getItem(key);
                        if (value) savedData[key] = value;
                    });
                    localStorage.clear();
                    keysToKeep.forEach(key => {
                        if (savedData[key]) localStorage.setItem(key, savedData[key]);
                    });
                    cleared.push('localStorage');
                    console.log('âœ… ØªÙ… Ù…Ø³Ø­ localStorage');
                } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ localStorage:', error); }
                try {
                    const databases = await indexedDB.databases();
                    for (const db of databases) {
                        await new Promise((resolve, reject) => {
                            const request = indexedDB.deleteDatabase(db.name);
                            request.onsuccess = () => { console.log(`âœ… ØªÙ… Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${db.name}`); resolve(); };
                            request.onerror = () => reject(request.error);
                            request.onblocked = () => { console.warn(`âš ï¸ Ù…Ø³Ø­ ${db.name} Ù…Ø­Ø¸ÙˆØ±`); resolve(); };
                        });
                    }
                    cleared.push('IndexedDB');
                    console.log('âœ… ØªÙ… Ù…Ø³Ø­ IndexedDB');
                } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ IndexedDB:', error); }
                try {
                    sessionStorage.clear();
                    cleared.push('sessionStorage');
                    console.log('âœ… ØªÙ… Ù…Ø³Ø­ sessionStorage');
                } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ sessionStorage:', error); }
                try {
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(cacheNames.map(cacheName => caches.delete(cacheName)));
                        cleared.push('caches');
                        console.log('âœ… ØªÙ… Ù…Ø³Ø­ Cache Storage');
                    }
                } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Cache:', error); }
                try {
                    if (window.elementSdk && typeof window.elementSdk.clearConfig === 'function') {
                        await window.elementSdk.clearConfig();
                        cleared.push('elementSdk');
                        console.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Element SDK');
                    }
                    if (window.dataSdk && typeof window.dataSdk.clearAllData === 'function') {
                        await window.dataSdk.clearAllData();
                        cleared.push('dataSdk');
                        console.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Data SDK');
                    }
                } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† SDKs:', error); }
                console.log('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                console.log('ğŸ“Š Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªÙ… Ù…Ø³Ø­Ù‡Ø§:', cleared);
                return { success: true, cleared };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return { success: false, error: error.message };
            } finally { this.resetInProgress = false; }
        }
        async fullReset(reloadPage = true) {
            try {
                console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø©...');
                const result = await this.clearAllLocalData(false);
                if (!result.success) throw new Error('ÙØ´Ù„ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
                console.log('âœ… ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
                if (reloadPage) {
                    console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
                    setTimeout(() => { window.location.reload(); }, 500);
                }
                return { success: true, message: 'ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­' };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø©:', error);
                return { success: false, error: error.message };
            }
        }
        async softReset() {
            try {
                console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ÙÙŠÙØ©...');
                const settingsToKeep = {
                    theme: localStorage.getItem('currentTheme'),
                    language: localStorage.getItem('app_language'),
                    storeSettings: localStorage.getItem('storeSettings'),
                    systemSettings: localStorage.getItem('systemSettings')
                };
                await this.clearAllLocalData(true);
                Object.keys(settingsToKeep).forEach(key => {
                    if (settingsToKeep[key]) localStorage.setItem(key, settingsToKeep[key]);
                });
                console.log('âœ… ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ÙÙŠÙØ© Ø¨Ù†Ø¬Ø§Ø­');
                return { success: true, message: 'ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ÙÙŠÙØ©:', error);
                return { success: false, error: error.message };
            }
        }
        async autoCheck() {
            try {
                console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                const savedVersion = localStorage.getItem(VERSION_KEY);
                if (!savedVersion) {
                    localStorage.setItem(VERSION_KEY, CURRENT_VERSION);
                    console.log('âœ… Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„ - ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥ØµØ¯Ø§Ø±');
                    return { needsReset: false, reason: 'first_run' };
                }
                if (savedVersion !== CURRENT_VERSION) {
                    console.log('âš ï¸ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¥ØµØ¯Ø§Ø± Ù…Ø®ØªÙ„Ù');
                    return { needsReset: true, reason: 'version_changed' };
                }
                const validation = await this.validateStoredData();
                if (!validation.isValid && validation.reason !== 'no_data') {
                    console.log('âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©');
                    return { needsReset: true, reason: validation.reason, validation };
                }
                console.log('âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§ÙƒØªÙ…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                return { needsReset: false, validation };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error);
                return { needsReset: false, error: error.message };
            }
        }
        async exportBackup(type = 'full') {
            try {
                const backup = {
                    timestamp: Date.now(),
                    date: new Date().toISOString(),
                    version: CURRENT_VERSION,
                    localStorage: {},
                    indexedDB: {},
                    elementConfig: null
                };
                // Always export localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    backup.localStorage[key] = localStorage.getItem(key);
                }
                // Export elementSdk config
                if (window.elementSdk && typeof window.elementSdk.getConfig === 'function') {
                    backup.elementConfig = window.elementSdk.getConfig();
                }
                // Export IndexedDB data
                if (window.dataSdk && typeof window.dataSdk.getAll === 'function') {
                    const allData = window.dataSdk.getAll();
                    if (type === 'full') {
                        backup.indexedDB.all = allData;
                    } else if (type === 'selective') {
                        // Only products, invoices, debts, payments
                        backup.indexedDB.products = allData.filter(item => item.type === 'product');
                        backup.indexedDB.invoices = allData.filter(item => item.type === 'invoice');
                        backup.indexedDB.debts = allData.filter(item => item.type === 'debt');
                        backup.indexedDB.payments = allData.filter(item => item.type === 'payment');
                    }
                }
                const dataStr = JSON.stringify(backup, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `app-backup-${type}-${Date.now()}.json`;
                link.click();
                URL.revokeObjectURL(url);
                console.log('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                throw error;
            }
        }
    }
    window.systemReset = new SystemReset();
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            const checkResult = await window.systemReset.autoCheck();
            if (checkResult.needsReset) {
                console.log('âš ï¸ ÙŠØ­ØªØ§Ø¬ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†:', checkResult.reason);
                const shouldReset = confirm(`ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.\n\nØ§Ù„Ø³Ø¨Ø¨: ${checkResult.validation?.message || checkResult.reason}\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ`);
                if (shouldReset) await window.systemReset.fullReset(true);
            }
        } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', error); }
    });
    console.log('âœ… System Reset SDK ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­');
})();
  </script>
  
  <!-- Authentication Fix SDK - Ø¥ØµÙ„Ø§Ø­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
  <script>
/**
 * Authentication Fix - Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
 * Digital Creativity Company - Ø§Ù„Ù…Ø·ÙˆØ±: ÙƒØ±Ø§Ø±
 */
(function() {
    'use strict';
    class AuthFix {
        constructor() { this.registrationAttempts = 0; this.maxAttempts = 3; }
        async checkCurrentAccount() {
            try {
                const uid = localStorage.getItem('app_uid');
                const secret = localStorage.getItem('app_secret');
                if (!uid || !secret) {
                    console.log('â„¹ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø­ÙÙˆØ¸');
                    return { hasAccount: false, isValid: false };
                }
                if (typeof database !== 'undefined') {
                    try {
                        const snap = await database.ref(`users/${uid}`).once('value');
                        if (!snap.exists()) {
                            console.log('âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Firebase');
                            return { hasAccount: true, isValid: false, uid, reason: 'not_found_in_firebase' };
                        }
                        const userData = snap.val();
                        if (userData.profile && userData.profile.secret !== secret) {
                            console.log('âš ï¸ Secret Key ØºÙŠØ± ØµØ­ÙŠØ­');
                            return { hasAccount: true, isValid: false, uid, reason: 'invalid_secret' };
                        }
                        console.log('âœ… Ø§Ù„Ø­Ø³Ø§Ø¨ ØµØ§Ù„Ø­');
                        return { hasAccount: true, isValid: true, uid, userData };
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase:', error);
                        return { hasAccount: true, isValid: false, uid, reason: 'firebase_error', error: error.message };
                    }
                }
                return { hasAccount: true, isValid: false, uid };
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
                return { hasAccount: false, isValid: false, error: error.message };
            }
        }
        async clearInvalidAccount() {
            try {
                console.log('ğŸ”„ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­...');
                localStorage.removeItem('app_uid');
                localStorage.removeItem('app_secret');
                localStorage.removeItem('user_id');
                if (window.currentUser) window.currentUser = null;
                console.log('âœ… ØªÙ… Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­');
                return true;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
                return false;
            }
        }
        async createNewAccount(userData) {
            try {
                const { fullName, phone, address, storeName, lat, lng } = userData;
                if (!fullName || !phone || !address || !storeName) {
                    return { success: false, error: 'missing_data', message: 'ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©' };
                }
                const accountCheck = await this.checkCurrentAccount();
                if (accountCheck.hasAccount && accountCheck.isValid) {
                    return { success: false, error: 'account_exists', message: 'ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ ØµØ§Ù„Ø­ Ø¨Ø§Ù„ÙØ¹Ù„' };
                }
                if (accountCheck.hasAccount && !accountCheck.isValid) {
                    console.log('âš ï¸ Ø­Ø³Ø§Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­ Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³ÙŠØªÙ… Ù…Ø³Ø­Ù‡');
                    await this.clearInvalidAccount();
                }
                console.log('ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯...');
                if (typeof database === 'undefined') {
                    return { success: false, error: 'firebase_not_ready', message: 'Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø©' };
                }
                const newUserRef = database.ref('users').push();
                const uid = newUserRef.key;
                const secret = this.generateRandomKey(10);
                const appSettingsSnap = await database.ref('appSettings/trialDays').once('value');
                const trialDays = appSettingsSnap.exists() ? Number(appSettingsSnap.val()) : 30;
                const createdAt = Date.now();
                const trialUntil = createdAt + (trialDays * 24 * 60 * 60 * 1000);
                const userObj = {
                    profile: {
                        uid, secret, fullName, phone, address, storeName,
                        lat: lat || null, lng: lng || null, createdAt,
                        deviceInfo: {
                            platform: navigator.platform || '',
                            userAgent: navigator.userAgent || '',
                            appVersion: localStorage.getItem('app_version') || '1.0.0'
                        }
                    },
                    trialUntil, subscription: null, status: 'active', createdBy: 'web_app'
                };
                await database.ref(`users/${uid}`).set(userObj);
                localStorage.setItem('app_uid', uid);
                localStorage.setItem('app_secret', secret);
                if (typeof window !== 'undefined') {
                    window.currentUser = userObj;
                    window.currentUser.uid = uid;
                }
                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                console.log('ğŸ“ UID:', uid);
                return { success: true, uid, secret, trialDays, userData: userObj, message: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­' };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
                this.registrationAttempts++;
                return { success: false, error: 'creation_failed', message: error.message, attempts: this.registrationAttempts };
            }
        }
        async attemptRegistrationFix() {
            try {
                console.log('ğŸ”§ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„...');
                const accountCheck = await this.checkCurrentAccount();
                console.log('ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:', accountCheck);
                if (accountCheck.hasAccount && !accountCheck.isValid) {
                    console.log('ğŸ”„ Ù…Ø³Ø­ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­...');
                    await this.clearInvalidAccount();
                    return { success: true, action: 'cleared_invalid_account', message: 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯' };
                }
                if (accountCheck.hasAccount && accountCheck.isValid) {
                    return { success: true, action: 'account_valid', message: 'Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ ØµØ§Ù„Ø­', userData: accountCheck.userData };
                }
                return { success: true, action: 'ready_for_registration', message: 'Ø¬Ø§Ù‡Ø² Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯' };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
                return { success: false, error: error.message };
            }
        }
        generateRandomKey(length = 10) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        async canRegister() {
            try {
                const accountCheck = await this.checkCurrentAccount();
                if (accountCheck.hasAccount && accountCheck.isValid) {
                    return { canRegister: false, reason: 'valid_account_exists', message: 'ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ ØµØ§Ù„Ø­ Ø¨Ø§Ù„ÙØ¹Ù„' };
                }
                if (accountCheck.hasAccount && !accountCheck.isValid) {
                    await this.clearInvalidAccount();
                }
                return { canRegister: true, message: 'ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯' };
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
                return { canRegister: false, reason: 'check_failed', message: error.message };
            }
        }
    }
    window.authFix = new AuthFix();
    window.createUserAccount_original = window.createUserAccount;
    window.createUserAccount = async function(formData) {
        try {
            console.log('ğŸ” Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ createUserAccount Ø§Ù„Ù…Ø­Ø³Ù‘Ù†...');
            const canRegisterCheck = await window.authFix.canRegister();
            if (!canRegisterCheck.canRegister) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            const result = await window.authFix.createNewAccount(formData);
            if (result.success) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                if (typeof showModal === 'function' && typeof document !== 'undefined') {
                    const form = document.getElementById('userDetailsForm');
                    if (form) form.style.display = 'none';
                    showModal('userInfoModal');
                    const uidElem = document.getElementById('userUID');
                    const secretElem = document.getElementById('userSecret');
                    const trialElem = document.getElementById('trialDaysDisplay');
                    if (uidElem) uidElem.textContent = result.uid;
                    if (secretElem) secretElem.textContent = result.secret;
                    if (trialElem) trialElem.textContent = result.trialDays;
                }
                return result;
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                if (result.attempts >= 2) {
                    console.log('ğŸ”§ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©...');
                    const fixResult = await window.authFix.attemptRegistrationFix();
                    if (fixResult.success && fixResult.action === 'cleared_invalid_account') {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    }
                }
                return result;
            }
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ createUserAccount:', error);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return { success: false, error: error.message };
        }
    };
    window.addEventListener('DOMContentLoaded', async () => {
        try {
            console.log('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...');
            const accountCheck = await window.authFix.checkCurrentAccount();
            if (accountCheck.hasAccount && !accountCheck.isValid) {
                console.log('âš ï¸ ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø­Ø³Ø§Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­');
                const shouldClear = confirm('ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­Ø©.\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ØŸ');
                if (shouldClear) {
                    await window.authFix.clearInvalidAccount();
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            }
        } catch (error) { console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:', error); }
    });
    console.log('âœ… Authentication Fix ØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ø¨Ù†Ø¬Ø§Ø­');
})();
  </script>
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <!-- ØªØ­Ø³ÙŠÙ†Ø§Øª CSS Ù„Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<link rel="stylesheet" href="./enhanced-modals.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"><!-- Animate.css -->

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <!-- SheetJS for Excel support -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <style>
        :root {
            /* Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
            --font-size-xs: 13px;
            --font-size-sm: 15px;
            --font-size-base: 16px;
            --font-size-md: 18px;
            --font-size-lg: 20px;
            --font-size-xl: 24px;
            --font-size-2xl: 28px;
            --font-size-3xl: 32px;
            
            /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - Ù…Ø­Ø³Ù‘Ù†Ø© */
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #ec4899;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            
            /* Ø§Ù„Ø®Ù„ÙÙŠØ§Øª - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-card: #1a1a1a;
            --bg-hover: #252525;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            
            /* Ø§Ù„Ù†ØµÙˆØµ - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --text-primary: #e8e8e8;
            --text-secondary: #b8b8b8;
            --text-tertiary: #8a8a8a;
            --text-dark: #1e293b;
            --text-muted: #6a6a6a;
            
            /* Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            --border-color: #2a2a2a;
            --border-light: #e2e8f0;
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --border-radius-lg: 24px;
            
            /* Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª - Ù…Ø­Ø³Ù‘Ù†Ø© */
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            --secondary-gradient: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            
            /* Ø§Ù„Ø¸Ù„Ø§Ù„ - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.5);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.6);
            --shadow-lg: 0 8px 25px rgba(0,0,0,0.7);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.8);
            --shadow-colored: 0 10px 40px -10px rgba(99, 102, 241, 0.5);
            
            /* Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„Ø«ÙŠÙ… Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --theme-bg-primary: var(--bg-primary);
            --theme-bg-secondary: var(--bg-secondary);
            --theme-bg-card: var(--bg-card);
            --theme-bg-hover: var(--bg-hover);
            --theme-text-primary: var(--text-primary);
            --theme-text-secondary: var(--text-secondary);
            --theme-text-tertiary: var(--text-tertiary);
            --theme-border: var(--border-color);
            --theme-shadow: var(--shadow-md);
        }

        /* Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ - Ù…Ø­Ø³Ù‘Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        [data-theme="light"] {
            /* Ø§Ù„Ø®Ù„ÙÙŠØ§Øª - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
            --theme-bg-primary: #f5f5f0;
            --theme-bg-secondary: #fafaf8;
            --theme-bg-card: #ffffff;
            --theme-bg-hover: #ececea;
            
            /* Ø§Ù„Ù†ØµÙˆØµ - Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ - Ø£ØºÙ…Ù‚ ÙˆØ£ÙˆØ¶Ø­ */
            --theme-text-primary: #000000;
            --theme-text-secondary: #1a1a1a;
            --theme-text-tertiary: #333333;
            
            /* Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            --theme-border: #d8d8d8;
            
            /* Ø§Ù„Ø¸Ù„Ø§Ù„ - Ù…Ø­Ø³Ù‘Ù†Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.12);
            --shadow-colored: 0 10px 40px -10px rgba(99, 102, 241, 0.25);
            --theme-shadow: var(--shadow-md);
            
            /* Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØµØµØ© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
            --light-accent: #eef2ff;
            --light-success: #ecfdf5;
            --light-warning: #fffbeb;
            --light-danger: #fef2f2;
            --light-info: #eff6ff;
        }

        /* ğŸ”µ Ø«ÙŠÙ… Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† - Blue Dark */
        [data-theme="blue-dark"] {
            --theme-bg-primary: #0a1628;
            --theme-bg-secondary: #0f1c30;
            --theme-bg-card: #152238;
            --theme-bg-hover: #1a2945;
            
            --theme-text-primary: #e1f0ff;
            --theme-text-secondary: #a8c5e0;
            --theme-text-tertiary: #7a9ec2;
            
            --theme-border: #1e3a5f;
            --shadow-colored: 0 10px 40px -10px rgba(59, 130, 246, 0.5);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.6);
            
            --primary-color: #3b82f6;
            --secondary-color: #2563eb;
        }

        /* ğŸ’š Ø«ÙŠÙ… Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† - Green Dark */
        [data-theme="green-dark"] {
            --theme-bg-primary: #0a1f0f;
            --theme-bg-secondary: #0e2817;
            --theme-bg-card: #14321f;
            --theme-bg-hover: #1a4028;
            
            --theme-text-primary: #d1fae5;
            --theme-text-secondary: #a7d9c0;
            --theme-text-tertiary: #7db89a;
            
            --theme-border: #1e5438;
            --shadow-colored: 0 10px 40px -10px rgba(16, 185, 129, 0.5);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.6);
            
            --primary-color: #10b981;
            --secondary-color: #059669;
        }

        /* ğŸ§¡ Ø«ÙŠÙ… Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¯Ø§ÙƒÙ† - Orange Dark */
        [data-theme="orange-dark"] {
            --theme-bg-primary: #1f1208;
            --theme-bg-secondary: #2a1810;
            --theme-bg-card: #351e18;
            --theme-bg-hover: #402520;
            
            --theme-text-primary: #ffe4d1;
            --theme-text-secondary: #d9b8a7;
            --theme-text-tertiary: #b3927d;
            
            --theme-border: #543428;
            --shadow-colored: 0 10px 40px -10px rgba(249, 115, 22, 0.5);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.6);
            
            --primary-color: #f97316;
            --secondary-color: #ea580c;
        }

        /* ğŸ’œ Ø«ÙŠÙ… Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¯Ø§ÙƒÙ† - Purple Dark */
        [data-theme="purple-dark"] {
            --theme-bg-primary: #1a0a28;
            --theme-bg-secondary: #240f35;
            --theme-bg-card: #2e1542;
            --theme-bg-hover: #381a50;
            
            --theme-text-primary: #f0d1ff;
            --theme-text-secondary: #c9a8e0;
            --theme-text-tertiary: #a37dc2;
            
            --theme-border: #4a2563;
            --shadow-colored: 0 10px 40px -10px rgba(168, 85, 247, 0.5);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.6);
            
            --primary-color: #a855f7;
            --secondary-color: #9333ea;
        }

        /* â¤ï¸ Ø«ÙŠÙ… Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† - Red Dark */
        [data-theme="red-dark"] {
            --theme-bg-primary: #280a0a;
            --theme-bg-secondary: #350f0f;
            --theme-bg-card: #421515;
            --theme-bg-hover: #501a1a;
            
            --theme-text-primary: #ffd1d1;
            --theme-text-secondary: #e0a8a8;
            --theme-text-tertiary: #c27d7d;
            
            --theme-border: #632525;
            --shadow-colored: 0 10px 40px -10px rgba(239, 68, 68, 0.5);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.6);
            
            --primary-color: #ef4444;
            --secondary-color: #dc2626;
        }

        /* ğŸ©µ Ø«ÙŠÙ… Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­ - Cyan Light */
        [data-theme="cyan-light"] {
            --theme-bg-primary: #e0f7fa;
            --theme-bg-secondary: #f0fbfc;
            --theme-bg-card: #ffffff;
            --theme-bg-hover: #d0f3f7;
            
            --theme-text-primary: #0e2933;
            --theme-text-secondary: #1a4d5f;
            --theme-text-tertiary: #26718b;
            
            --theme-border: #b0dce5;
            --shadow-colored: 0 10px 40px -10px rgba(6, 182, 212, 0.3);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.08);
            
            --primary-color: #06b6d4;
            --secondary-color: #0891b2;
        }

        /* ğŸŸ¡ Ø«ÙŠÙ… Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ - Gold Light */
        [data-theme="gold-light"] {
            --theme-bg-primary: #fffbea;
            --theme-bg-secondary: #fffef5;
            --theme-bg-card: #ffffff;
            --theme-bg-hover: #fff8d6;
            
            --theme-text-primary: #2a2008;
            --theme-text-secondary: #4d3810;
            --theme-text-tertiary: #705018;
            
            --theme-border: #e8d89b;
            --shadow-colored: 0 10px 40px -10px rgba(245, 158, 11, 0.3);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.08);
            
            --primary-color: #f59e0b;
            --secondary-color: #d97706;
        }

        /* ğŸŒ¸ Ø«ÙŠÙ… ÙˆØ±Ø¯ÙŠ ÙØ§ØªØ­ - Pink Light */
        [data-theme="pink-light"] {
            --theme-bg-primary: #fce7f3;
            --theme-bg-secondary: #fef1f7;
            --theme-bg-card: #ffffff;
            --theme-bg-hover: #fad1e8;
            
            --theme-text-primary: #2d081f;
            --theme-text-secondary: #501030;
            --theme-text-tertiary: #731842;
            
            --theme-border: #f5c0dd;
            --shadow-colored: 0 10px 40px -10px rgba(236, 72, 153, 0.3);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.08);
            
            --primary-color: #ec4899;
            --secondary-color: #db2777;
        }

        /* ğŸŸ¢ Ø«ÙŠÙ… Ø£Ø®Ø¶Ø± Ø²ÙŠØªÙˆÙ†ÙŠ - Olive */
        [data-theme="olive"] {
            --theme-bg-primary: #1a1f0a;
            --theme-bg-secondary: #242a0f;
            --theme-bg-card: #2e3515;
            --theme-bg-hover: #38401a;
            
            --theme-text-primary: #e8f0d1;
            --theme-text-secondary: #c9d9a8;
            --theme-text-tertiary: #aac27d;
            
            --theme-border: #4a5425;
            --shadow-colored: 0 10px 40px -10px rgba(132, 204, 22, 0.5);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.6);
            
            --primary-color: #84cc16;
            --secondary-color: #65a30d;
        }

        /* ğŸ”´ Ø«ÙŠÙ… Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† Ù…Ù„ÙƒÙŠ - Royal Blue */
        [data-theme="royal-blue"] {
            --theme-bg-primary: #0c1445;
            --theme-bg-secondary: #111b5f;
            --theme-bg-card: #162270;
            --theme-bg-hover: #1b2880;
            
            --theme-text-primary: #d6e4ff;
            --theme-text-secondary: #a8c0e8;
            --theme-text-tertiary: #7a9cd1;
            
            --theme-border: #2438a8;
            --shadow-colored: 0 10px 40px -10px rgba(37, 99, 235, 0.6);
            --theme-shadow: 0 4px 12px rgba(0,0,0,0.7);
            
            --primary-color: #2563eb;
            --secondary-color: #1d4ed8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            font-size: var(--font-size-base);
            background: var(--theme-bg-primary);
            color: var(--theme-text-primary);
            height: 100vh; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ØªÙ…Ø§Ù…Ø§Ù‹ */
            transition: all 0.3s ease;
        }

        html {
            height: 100vh;
            overflow: hidden;
            scroll-behavior: smooth; /* ØªÙ…Ø±ÙŠØ± Ù†Ø§Ø¹Ù… */
        }

        /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--theme-bg-primary);
            transition: all 0.3s ease;
        }

        .animated-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            opacity: 0.7;
        }

        [data-theme="light"] .animated-bg::before {
            opacity: 0.1;
        }
        
        /* ØªØ­Ø³ÙŠÙ† ÙˆØ¶ÙˆØ­ Ø§Ù„Ù†ØµÙˆØµ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
        [data-theme="light"] body,
        [data-theme="light"] .nav-text,
        [data-theme="light"] .btn,
        [data-theme="light"] .stat-label,
        [data-theme="light"] .form-label,
        [data-theme="light"] .modal-title,
        [data-theme="light"] h1,
        [data-theme="light"] h2,
        [data-theme="light"] h3,
        [data-theme="light"] h4,
        [data-theme="light"] h5,
        [data-theme="light"] h6 {
            font-weight: 600 !important;
            color: var(--theme-text-primary) !important;
        }
        
        [data-theme="light"] .stat-value,
        [data-theme="light"] .quick-stat-value {
            font-weight: 800 !important;
            color: #000000 !important;
        }

        [data-theme="light"] .custom-titlebar {
            background: rgba(250, 250, 248, 0.98);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(25px);
        }

        [data-theme="light"] .titlebar-clock {
            background: rgba(102, 126, 234, 0.08);
            border: 1px solid rgba(102, 126, 234, 0.2);
            color: #000000;
            font-weight: 700;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(1deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        /* ØªØµÙ…ÙŠÙ… Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ù„ÙƒÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
        }

        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        *::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin: 4px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        *::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, 
                #667eea 0%, 
                #764ba2 40%,
                #f093fb 70%,
                #667eea 100%);
            border-radius: 12px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                0 0 6px rgba(102, 126, 234, 0.4),
                inset 0 0 6px rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, 
                #f093fb 0%, 
                #764ba2 40%,
                #667eea 70%,
                #f093fb 100%);
            box-shadow: 
                0 0 16px rgba(102, 126, 234, 0.9),
                inset 0 0 8px rgba(255, 255, 255, 0.3);
            border-width: 1px;
            transform: scaleX(1.1);
        }

        *::-webkit-scrollbar-thumb:active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 
                0 0 20px rgba(102, 126, 234, 1),
                inset 0 0 10px rgba(255, 255, 255, 0.4);
        }

        *::-webkit-scrollbar-corner {
            background: transparent;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø³Ù„Ø³ */
        * {
            scroll-behavior: smooth;
        }

        /* ØªØ£Ø«ÙŠØ± Ù†Ø¨Ø¶ Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        @keyframes scrollbarPulse {
            0%, 100% {
                box-shadow: 0 0 6px rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 0 12px rgba(102, 126, 234, 0.8);
            }
        }

        /* ØªØ£Ø«ÙŠØ± ØªÙˆÙ‡Ø¬ Ù…ØªØ­Ø±Ùƒ Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        @keyframes scrollbarGlow {
            0% {
                box-shadow: 
                    0 0 6px rgba(102, 126, 234, 0.4),
                    0 0 12px rgba(102, 126, 234, 0.2);
            }
            50% {
                box-shadow: 
                    0 0 12px rgba(102, 126, 234, 0.6),
                    0 0 20px rgba(102, 126, 234, 0.4);
            }
            100% {
                box-shadow: 
                    0 0 6px rgba(102, 126, 234, 0.4),
                    0 0 12px rgba(102, 126, 234, 0.2);
            }
        }

        /* ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙˆÙ‡Ø¬ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù†Ø´Ø· */
        *::-webkit-scrollbar-thumb:hover {
            animation: scrollbarGlow 2s ease-in-out infinite;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØµØµ */
        .custom-titlebar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: var(--theme-bg-secondary);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10000;
            -webkit-app-region: drag;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            direction: ltr;
        }

        .titlebar-left {
            display: flex;
            align-items: center;
            gap: 15px;
            -webkit-app-region: no-drag;
            min-width: 250px;
        }

        .titlebar-controls {
            display: flex;
            gap: 10px;
        }

        .titlebar-btn {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .titlebar-btn i {
            z-index: 1;
            font-size: var(--font-size-sm);
        }

        .titlebar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .titlebar-btn:active {
            transform: translateY(0);
        }

        .titlebar-btn.close {
            background: linear-gradient(135deg, #ff5f57 0%, #ff3b30 100%);
        }

        .titlebar-btn.close:hover {
            background: linear-gradient(135deg, #ff3b30 0%, #e62117 100%);
            box-shadow: 0 4px 14px rgba(255, 59, 48, 0.7);
        }

        .titlebar-btn.minimize {
            background: linear-gradient(135deg, #ffbd2e 0%, #ffaa00 100%);
        }

        .titlebar-btn.minimize:hover {
            background: linear-gradient(135deg, #ffaa00 0%, #ff9500 100%);
            box-shadow: 0 4px 14px rgba(255, 170, 0, 0.7);
        }

        .titlebar-btn.maximize {
            background: linear-gradient(135deg, #28ca42 0%, #00d844 100%);
        }

        .titlebar-btn.maximize:hover {
            background: linear-gradient(135deg, #00d844 0%, #00c73c 100%);
            box-shadow: 0 4px 14px rgba(0, 216, 68, 0.7);
        }

        .titlebar-center {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
            justify-content: center;
        }

        .titlebar-logo {
            width: 24px;
            height: 24px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-sm);
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .titlebar-title {
            font-size: var(--font-size-base);
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            user-select: none;
            white-space: nowrap;
        }

        .titlebar-right {
            display: flex;
            align-items: center;
            gap: 12px;
            -webkit-app-region: no-drag;
            min-width: 250px;
            justify-content: flex-end;
        }

        .titlebar-clock {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: var(--theme-bg-primary);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'Cairo', monospace;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .titlebar-clock i {
            color: var(--primary-color);
        }

        .titlebar-refresh {
            padding: 6px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .titlebar-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }

        .titlebar-refresh:active {
            transform: translateY(0);
        }

        .titlebar-refresh i {
            transition: transform 0.6s ease;
        }

        .titlebar-refresh:hover i {
            transform: rotate(360deg);
        }


        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .welcome-overlay.fade-out {
            animation: fadeOut 0.3s ease;
            opacity: 0;
        }

        .welcome-card {
            background: var(--theme-bg-primary);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 90%;
            overflow: hidden;
            animation: slideUp 0.4s ease;
            border: 1px solid var(--theme-border-color);
        }

        .welcome-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            text-align: center;
        }

        .welcome-header h2 {
            color: white;
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .welcome-body {
            padding: 30px;
            text-align: center;
        }

        .welcome-body > p {
            color: var(--theme-text-primary);
            font-size: 1.1rem;
            margin-bottom: 25px;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .welcome-feature {
            background: var(--theme-bg-secondary);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--theme-border-color);
            transition: all 0.3s ease;
        }

        .welcome-feature:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
            border-color: var(--primary-color);
        }

        .welcome-feature span {
            font-size: 2rem;
            display: block;
            margin-bottom: 8px;
        }

        .welcome-feature p {
            color: var(--theme-text-primary);
            font-size: 0.9rem;
            margin: 0;
            font-weight: 500;
        }

        .welcome-note {
            background: var(--info-color);
            background: linear-gradient(135deg, var(--info-color), var(--primary-color));
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            margin: 20px 0 10px 0 !important;
        }

        .welcome-hint {
            color: var(--theme-text-secondary);
            font-size: 0.85rem;
            margin: 5px 0 0 0 !important;
        }

        .welcome-footer {
            padding: 20px 30px 30px;
            text-align: center;
        }

        .welcome-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .welcome-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(102, 126, 234, 0.6);
        }

        .welcome-btn:active {
            transform: translateY(0);
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© - Ù…Ø®ÙÙŠ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† ÙÙŠ top-bar */
        .quick-stats-bar {
            display: none;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ - Ù…Ø¯Ù…Ø¬Ø© Ø¬Ø¯Ø§Ù‹ */
        .top-bar-stats .quick-stat-card {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.75rem;
            background: linear-gradient(135deg, 
                var(--theme-bg-card) 0%, 
                rgba(102, 126, 234, 0.02) 100%);
            border-radius: 8px;
            border: 1px solid var(--theme-border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            flex-shrink: 0;
            min-width: auto;
        }

        .quick-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.1) 0%, 
                rgba(118, 75, 162, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .quick-stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, 
                rgba(255, 255, 255, 0.1) 0%, 
                transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .quick-stat-card:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 6px 16px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .quick-stat-card:hover::before {
            opacity: 1;
        }

        .quick-stat-card:hover::after {
            opacity: 1;
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .top-bar-stats .quick-stat-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: white;
            flex-shrink: 0;
            position: relative;
            z-index: 2;
            box-shadow: 
                0 3px 8px rgba(0, 0, 0, 0.12),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .quick-stat-icon::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: inherit;
            border-radius: inherit;
            filter: blur(8px);
            opacity: 0.6;
            z-index: -1;
        }

        .top-bar-stats .quick-stat-card:hover .quick-stat-icon {
            transform: scale(1.08) rotate(3deg);
            box-shadow: 
                0 5px 12px rgba(0, 0, 0, 0.2),
                inset 0 2px 0 rgba(255, 255, 255, 0.3);
        }

        .products-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8b5cf6 100%);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .value-icon {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .debts-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            box-shadow: 0 6px 16px rgba(245, 158, 11, 0.4);
        }

        .debtors-icon {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        .debt-value-icon {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 50%, #be185d 100%);
            box-shadow: 0 6px 16px rgba(236, 72, 153, 0.4);
        }

        .quick-stat-info {
            flex: 1;
            position: relative;
            z-index: 2;
        }

        .top-bar-stats .quick-stat-label {
            font-size: var(--font-size-xs);
            color: var(--theme-text-secondary);
            margin-bottom: 0.15rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .top-bar-stats .quick-stat-card:hover .quick-stat-label {
            color: var(--primary-color);
        }

        .top-bar-stats .quick-stat-value {
            font-size: var(--font-size-md);
            font-weight: 700;
            background: linear-gradient(135deg, 
                var(--theme-text-primary) 0%, 
                var(--primary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
        }

        .top-bar-stats .quick-stat-card:hover .quick-stat-value {
            transform: scale(1.05);
            filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.2));
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© - ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar-stats .digital-clock-card {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1b4e 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            padding: 0.4rem 0.75rem;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 3px 12px rgba(0, 0, 0, 0.15),
                inset 0 0 20px rgba(102, 126, 234, 0.1);
            flex-shrink: 0;
            min-width: auto;
        }

        .digital-clock-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 50%, rgba(102, 126, 234, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 70% 50%, rgba(118, 75, 162, 0.2) 0%, transparent 50%);
            animation: clockPulse 6s ease-in-out infinite;
        }

        .digital-clock-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, 
                transparent 30%, 
                rgba(255, 255, 255, 0.03) 50%, 
                transparent 70%);
            animation: shine 3s linear infinite;
        }

        @keyframes clockPulse {
            0%, 100% {
                transform: scale(1) rotate(0deg);
                opacity: 0.4;
            }
            50% {
                transform: scale(1.2) rotate(5deg);
                opacity: 0.7;
            }
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }

        .digital-clock {
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .clock-time {
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ffffff 0%, #a8b3ff 50%, #ffffff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.1em;
            text-shadow: 
                0 0 10px rgba(168, 179, 255, 0.3);
            margin-bottom: 0.3rem;
            filter: drop-shadow(0 2px 6px rgba(102, 126, 234, 0.4));
            position: relative;
        }

        .clock-time::before {
            content: attr(data-time);
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: blur(8px);
            opacity: 0.5;
            z-index: -1;
        }

        @keyframes clockGlow {
            0%, 100% {
                filter: drop-shadow(0 4px 12px rgba(102, 126, 234, 0.5));
            }
            50% {
                filter: drop-shadow(0 6px 20px rgba(102, 126, 234, 0.8));
            }
        }

        .clock-date {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            flex-wrap: nowrap;
        }

        .clock-date span {
            padding: 0.2rem 0.6rem;
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.2) 0%, 
                rgba(118, 75, 162, 0.2) 100%);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(168, 179, 255, 0.3);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* ØªØµØºÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar-stats .clock-time {
            font-size: 1.05rem;
            margin-bottom: 0.2rem;
            letter-spacing: 0.08em;
        }

        .top-bar-stats .clock-date {
            gap: 0.35rem;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .clock-date span::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            transition: left 0.6s ease;
        }

        .clock-date span:hover::before {
            left: 100%;
        }

        .clock-date span:hover {
            background: linear-gradient(135deg, 
                rgba(102, 126, 234, 0.4) 0%, 
                rgba(118, 75, 162, 0.4) 100%);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 6px 20px rgba(102, 126, 234, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border-color: rgba(168, 179, 255, 0.5);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .clock-date span:active {
            transform: translateY(-1px) scale(1.02);
        }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© */
        .cart-header {
            position: relative;
        }

        .cart-badge-info {
            display: flex;
            gap: 0.8rem;
            margin-right: auto;
        }

        .cart-mini-stat {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            background: var(--primary-color);
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
        }

        .cart-mini-stat.total-price {
            background: var(--success-color);
        }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 1400px) {
            .digital-clock-card {
                grid-column: span 1;
            }
            
            .clock-time {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .quick-stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .digital-clock-card {
                grid-column: span 2;
            }
        }

        /* Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
            padding-top: 40px;
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            width: 280px;
            background: var(--theme-bg-secondary);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: none;
            position: relative;
            z-index: 100;
            transform: translateX(0);
            padding-top: 0;
        }

        .sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar.collapsed .nav-icon {
            margin-left: 0;
        }

        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .logo p,
        .sidebar.collapsed .nav-section-title {
            opacity: 0;
            transform: translateX(-20px);
        }

        .sidebar.collapsed .logo h1 {
            font-size: 1rem;
        }

        /* Ø±Ø£Ø³ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ - Ù…Ø®ÙÙŠ */
        .sidebar-header {
            display: none;
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ */
        .nav-menu {
            flex: 1;
            padding: 2rem 0 1.5rem;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .nav-menu::-webkit-scrollbar {
            width: 6px;
        }

        .nav-menu::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin: 8px 0;
        }

        .nav-menu::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .nav-menu::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            box-shadow: 0 0 8px var(--primary-color);
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0 1.5rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--theme-text-secondary);
            transition: all 0.3s ease;
        }

        .nav-item {
            margin: 0.25rem 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.25rem;
            color: var(--theme-text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        .nav-link:hover::before,
        .nav-link.active::before {
            left: 0;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--text-primary);
            transform: translateX(8px);
            box-shadow: var(--shadow-md);
        }

        .sidebar.collapsed .nav-link:hover,
        .sidebar.collapsed .nav-link.active {
            transform: translateX(0) scale(1.1);
        }

        .nav-icon {
            width: 20px;
            margin-left: 1rem;
            font-size: var(--font-size-lg);
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .nav-link:hover .nav-icon {
            transform: scale(1.1);
        }

        .nav-text {
            font-weight: 500;
            font-size: var(--font-size-base);
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        /* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ */
        .sidebar-toggle {
            position: absolute;
            top: 15px;
            left: -20px;
            background: var(--theme-bg-secondary);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--theme-text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            z-index: 101;
        }

        .sidebar-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }
        
        [data-theme="light"] .sidebar-toggle {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }
        
        [data-theme="light"] .sidebar-toggle:hover {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar {
            background: var(--theme-bg-secondary);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 0.75rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 50;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex-shrink: 0;
        }

        .top-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-shrink: 0;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-bar-stats {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex: 1;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(102, 126, 234, 0.5) transparent;
            padding: 0.25rem 0;
        }

        .top-bar-stats::-webkit-scrollbar {
            height: 4px;
        }

        .top-bar-stats::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .top-bar-stats::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        /* Ù…ÙØªØ§Ø­ Ø§Ù„Ø«ÙŠÙ… */
        .theme-toggle {
            background: var(--theme-bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--theme-text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-box {
            position: relative;
        }

        .search-input {
            background: var(--theme-bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 0.75rem 1rem 0.75rem 3rem;
            color: var(--theme-text-primary);
            font-size: 0.875rem;
            width: 300px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--theme-text-secondary);
        }


        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª */
        .page-content {
            flex: 1;
            padding: 1.5rem 2rem;
            background: var(--theme-bg-primary);
            height: calc(100vh - 80px);
            position: relative;
        }
        
        /* Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ ÙÙ‚Ø· - Ø¨Ø¯ÙˆÙ† ØªÙ…Ø±ÙŠØ± */
        .page-content:has(#pos.active) {
            overflow: hidden;
        }
        
        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø§Øª - Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± */
        .page-content:not(:has(#pos.active)) {
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* ØªØ®ØµÙŠØµ scrollbar Ù„Ù€ page-content */
        .page-content::-webkit-scrollbar {
            width: 12px;
        }

        .page-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .page-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
        }

        .page-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #764ba2 0%, #f093fb 100%);
        }

        .page {
            display: none !important;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth; /* ØªÙ…Ø±ÙŠØ± Ù†Ø§Ø¹Ù… */
        }

        .page.active {
            display: block !important;
            animation: fadeInUp 0.5s ease-out;
        }
        
        /* ØµÙØ­Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙˆØ¯ Ø¹Ø±Ø¶ */
        .page:not(#pos) .section-header {
            margin-bottom: 1.5rem;
        }
        
        /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .page:not(#pos) > div[style*="max-width"] {
            max-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* ØªØ®ØµÙŠØµ scrollbar Ù„Ù„ØµÙØ­Ø§Øª */
        .page::-webkit-scrollbar {
            width: 10px;
        }

        .page::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .page::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .page::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #764ba2 0%, #f093fb 100%);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ */
        .pos-layout {
            display: grid;
            grid-template-columns: 1fr 550px; /* ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø³Ù„Ø© Ù…Ù† 400px Ø¥Ù„Ù‰ 550px */
            gap: 1.5rem;
            height: 100%; /* Ø§Ø±ØªÙØ§Ø¹ ÙƒØ§Ù…Ù„ Ø«Ø§Ø¨Øª */
            align-items: stretch; /* ØªÙ…Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        }

        .products-section {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1rem;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
            height: 100%; /* Ø§Ø±ØªÙØ§Ø¹ ÙƒØ§Ù…Ù„ */
            display: flex;
            flex-direction: column;
            max-height: 100%; /* Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            gap: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--theme-text-primary);
        }
        
        /* Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ */
        .pos-search-box {
            position: relative;
            flex: 1;
            max-width: 350px;
        }
        
        .pos-search-box i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--theme-text-secondary);
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 1;
        }
        
        .pos-search-input {
            width: 100%;
            background: var(--theme-bg-secondary);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            color: var(--theme-text-primary);
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Cairo', sans-serif;
        }
        
        .pos-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            background: var(--theme-bg-card);
        }
        
        .pos-search-input::placeholder {
            color: var(--theme-text-secondary);
            opacity: 0.7;
        }
        
        [data-theme="light"] .pos-search-input {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            color: #1a202c;
        }
        
        [data-theme="light"] .pos-search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: #ffffff;
        }
        
        [data-theme="light"] .pos-search-box i {
            color: #718096;
        }
        
        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .pos-search-box {
                max-width: 100%;
            }
        }

        /* ÙÙ„Ø§ØªØ± Ø§Ù„ÙØ¦Ø§Øª */
        .category-filters {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .category-btn {
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 0.5rem 1rem;
            color: var(--theme-text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-btn:hover,
        .category-btn.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
            flex: 1;
            overflow-y: auto; /* scrollbar Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø· */
            overflow-x: hidden;
            padding-right: 0.5rem;
            max-height: 100%; /* Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
        }

        .products-grid::-webkit-scrollbar {
            width: 12px;
        }

        .products-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin: 10px 0;
        }

        .products-grid::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, 
                #667eea 0%, 
                #764ba2 50%, 
                #f093fb 100%);
            border-radius: 12px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                0 0 8px rgba(102, 126, 234, 0.5),
                inset 0 0 6px rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .products-grid::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, 
                #f093fb 0%, 
                #764ba2 50%, 
                #667eea 100%);
            box-shadow: 
                0 0 16px rgba(102, 126, 234, 0.9),
                inset 0 0 8px rgba(255, 255, 255, 0.3);
            transform: scaleX(1.15);
        }

        .products-grid::-webkit-scrollbar-thumb:active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 0 20px rgba(102, 126, 234, 1);
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ */
        .product-card {
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-height: 180px;
            justify-content: center;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: -1;
        }

        .product-card:hover::before {
            left: 0;
            opacity: 0.1;
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }

        .product-icon {
            font-size: 2.5rem;
            flex-shrink: 0;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .product-name {
            font-weight: 600;
            color: var(--theme-text-primary);
            font-size: 0.9rem;
            line-height: 1.3;
            flex-shrink: 0;
        }

        .product-price {
            color: var(--success-color);
            font-size: 1rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .product-stock {
            font-size: 0.75rem;
            color: var(--theme-text-secondary);
            flex-shrink: 0;
        }

        /* Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª */
        .cart-section {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1rem;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            gap: 0.75rem; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± */
            position: relative;
            height: 100%; /* Ø§Ø±ØªÙØ§Ø¹ ÙƒØ§Ù…Ù„ Ø«Ø§Ø¨Øª */
            max-height: 100%; /* Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ */
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
        .cart-section:not(:hover)::after {
            background: linear-gradient(
                180deg,
                transparent 0%,
                rgba(99, 102, 241, 0.03) 50%,
                transparent 100%
            );
        }

        /* Ù…Ø¤Ø´Ø± Ù„Ù„ØªÙØ§Ø¹Ù„ */
        .cart-section::before {
            content: 'ğŸ‘† Ù…Ø±Ø± Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹';
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.95), rgba(139, 92, 246, 0.95));
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.72rem;
            opacity: 0.9;
            transition: all 0.4s ease;
            pointer-events: none;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            animation: pulseHint 2s ease-in-out infinite;
            z-index: 2;
        }

        /* Ù…Ø¤Ø´Ø± Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .cart-section::after {
            content: 'â¬‡ï¸ Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª';
            position: absolute;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(16, 185, 129, 0.9));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            opacity: 0;
            transition: all 0.4s ease;
            pointer-events: none;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
            z-index: 2;
            white-space: nowrap;
        }

        /* Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ÙŠÙƒÙˆÙ† hover */
        .cart-section:not(:hover)::after {
            opacity: 0.9;
            animation: slideUpDown 2s ease-in-out infinite;
        }

        @keyframes slideUpDown {
            0%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            50% {
                transform: translateX(-50%) translateY(5px);
            }
        }

        @keyframes pulseHint {
            0%, 100% {
                transform: scale(1);
                opacity: 0.9;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        .cart-section:hover::before {
            opacity: 0;
            transform: scale(0.8) translateY(-10px);
        }

        .cart-section:hover::after {
            opacity: 0;
            transform: scale(0.8) translateY(10px);
        }

        /* Ø¥Ø¸Ù‡Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù… - Ø¨Ø¯ÙˆÙ† Ø¥Ø®ÙØ§Ø¡ */
        .cart-section .cart-header,
        .cart-section .remove-btn,
        .cart-section .quantity-controls,
        .cart-section .cart-summary,
        .cart-section .checkout-btn,
        .cart-section .cart-actions {
            opacity: 1;
            pointer-events: all;
            transition: all 0.3s ease;
        }

        /* ØªØ£Ø«ÙŠØ± Ø®ÙÙŠÙ Ø¹Ù†Ø¯ hover */
        .cart-section:hover .cart-header,
        .cart-section:hover .remove-btn,
        .cart-section:hover .quantity-controls,
        .cart-section:hover .cart-summary,
        .cart-section:hover .checkout-btn,
        .cart-section:hover .cart-actions {
            opacity: 1;
            pointer-events: all;
        }

        /* Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
        .cart-section .cart-count {
            opacity: 1 !important;
            pointer-events: all !important;
        }

        .cart-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0; /* Ù„Ø§ ØªØªÙ‚Ù„Øµ */
        }

        .cart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--theme-text-primary);
        }

        .cart-count {
            background: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .cart-items {
            flex: 1 1 auto; /* ØªØ£Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© ÙˆÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø§Ù„ØªÙ‚Ù„Øµ */
            overflow-y: auto; /* scrollbar Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø· */
            overflow-x: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
            margin-bottom: 0;
            transition: all 0.3s ease;
            padding-right: 8px;
            position: relative;
            scroll-behavior: smooth;
            /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø´Ø¨ÙƒØ© Ù…Ù† Ø¹Ù…ÙˆØ¯ÙŠÙ† Ø¨Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ */
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            align-content: start;
            width: 100%; /* Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ù„Ù„Ø­Ø§ÙˆÙŠØ© */
            min-height: 0; /* Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙ‚Ù„Øµ */
            max-height: 100%; /* Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© */
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø¦Ù… Ø§Ù„Ø¸Ù‡ÙˆØ± Ù…Ø¹ ØªØ£Ø«ÙŠØ± hover */
        .cart-items::-webkit-scrollbar {
            width: 10px;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù„ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .cart-items::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(to bottom, 
                var(--theme-bg-card) 0%, 
                transparent 100%);
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .cart-items::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(to top, 
                var(--theme-bg-card) 0%, 
                transparent 100%);
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¸Ù„Ø§Ù„ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„ØªÙ…Ø±ÙŠØ± */
        .cart-items.has-scroll::before,
        .cart-items.has-scroll::after {
            opacity: 1;
        }

        /* ØªØµÙ…ÙŠÙ… Scrollbar Ø¬Ù…ÙŠÙ„ ÙˆØ¹ØµØ±ÙŠ */
        .cart-items::-webkit-scrollbar {
            width: 10px;
        }

        .cart-items::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin: 8px 0;
            box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
        }

        .cart-items::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            border-radius: 12px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 0 6px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
        }

        .cart-items::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #f093fb 0%, #764ba2 50%, #667eea 100%);
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.8);
            transform: scaleX(1.2);
        }

        .cart-items::-webkit-scrollbar-thumb:active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 0 16px rgba(102, 126, 234, 1);
        }

        /* ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø³Ù„Ø© Ø¹Ù†Ø¯ hover */
        .cart-section:hover {
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.3);
            border-color: var(--primary-color);
            transform: scale(1.02);
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .cart-section:not(:hover) {
            animation: subtleGlow 3s ease-in-out infinite;
        }

        @keyframes subtleGlow {
            0%, 100% {
                box-shadow: var(--shadow-md);
            }
            50% {
                box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);
            }
        }

        /* Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¸Ø§Ù‡Ø±Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
        .cart-section .cart-items {
            opacity: 1 !important;
        }

        .cart-section .cart-item {
            opacity: 1 !important;
        }

        .cart-empty {
            text-align: center;
            color: var(--theme-text-secondary);
            padding: 2rem 1rem;
            opacity: 1 !important;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            grid-column: 1 / -1; /* ØªÙ…ØªØ¯ Ø¹Ø¨Ø± ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        }

        .cart-empty i {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            opacity: 0.5;
        }

        .cart-item {
            background: var(--theme-bg-secondary);
            border-radius: var(--border-radius);
            padding: 0.6rem;
            margin-bottom: 0;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column; /* Ø¹Ù…ÙˆØ¯ÙŠ Ù„Ù„Ù…Ø­ØªÙˆÙ‰ */
            align-items: stretch;
            gap: 6px;
            opacity: 0.95;
            min-height: auto;
            width: 100%; /* Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù…ÙˆØ¯ */
            box-sizing: border-box;
        }

        /* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹ÙŠØ¯Ø§Ù‹ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ø¶Ø­Ø© */
        .cart-section:not(:hover) .cart-item {
            opacity: 1; /* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ø¶Ø­Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
            transform: scale(1);
            transition: all 0.4s ease;
            filter: none;
        }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®ÙŠØ±Ø© ØªÙƒÙˆÙ† Ø£ÙˆØ¶Ø­ ÙˆØ£ÙƒØ¨Ø± */
        .cart-section:not(:hover) .cart-item:last-child {
            opacity: 1 !important;
            transform: scale(1) !important;
            filter: none !important;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        .cart-section:not(:hover) .cart-item:nth-last-child(2) {
            opacity: 1;
            transform: scale(1);
            filter: none;
        }

        .cart-section:not(:hover) .cart-item:nth-last-child(3) {
            opacity: 1;
            transform: scale(1);
            filter: none;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙˆØ¶ÙˆØ­ Ø¹Ù†Ø¯ hover - ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¶Ø­Ø© */
        .cart-section:hover .cart-item {
            opacity: 1 !important;
            transform: scale(1) !important;
            filter: none !important;
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù†ØªØ¬ */
        .cart-item::before {
            content: 'ğŸ“¦';
            font-size: 1.5rem;
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-radius: 8px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
            flex-shrink: 0;
            margin-bottom: 4px;
        }

        .cart-section:hover .cart-item::before {
            transform: scale(1.03);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        /* Ø­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
        .cart-section:not(:hover) .cart-item::before {
            animation: iconFloat 3s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-3px) rotate(-3deg);
            }
        }

        /* ØªØºÙŠÙŠØ± Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ */
        .cart-item[data-category="laptops"]::before {
            content: 'ğŸ’»';
        }

        .cart-item[data-category="phones"]::before {
            content: 'ğŸ“±';
        }

        .cart-item[data-category="accessories"]::before {
            content: 'ğŸ§';
        }

        /* ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .cart-item-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            width: 100%;
        }

        /* Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¸Ø§Ù‡Ø±Ø§Ù‹ Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
        .cart-item .item-info {
            opacity: 1 !important;
            width: 100%;
            text-align: center;
        }

        .cart-item .item-info h4 {
            opacity: 1 !important;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--theme-text-primary);
            margin-bottom: 0.15rem;
            display: block;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        /* Ø´Ø§Ø±Ø© Ø§Ù„ÙƒÙ…ÙŠØ© - Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¸Ø§Ù‡Ø±Ø© */
        .cart-item .item-info h4::after {
            content: attr(data-quantity) 'x';
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 700;
            margin-right: 4px;
            display: inline-block;
        }

        /* Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙØ±Ø¯ÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
        .cart-section:not(:hover) .item-price {
            opacity: 1;
            height: auto;
            margin: 0;
            overflow: visible;
        }

        .cart-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .item-header {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 0.5rem;
            width: 100%;
        }

        .item-info h4 {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--theme-text-primary);
            margin-bottom: 0.15rem;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-price {
            font-size: 0.75rem;
            color: var(--success-color);
            font-weight: 500;
            text-align: center;
        }

        .remove-btn {
            background: var(--danger-gradient);
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            top: 4px;
            left: 4px;
            font-size: 0.7rem;
        }

        .remove-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 4px;
        }

        .qty-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--theme-bg-card);
            border-radius: var(--border-radius-lg);
            padding: 0.3rem 0.5rem;
        }

        .qty-btn {
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .qty-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .quantity {
            font-weight: 600;
            color: var(--theme-text-primary);
            min-width: 25px;
            text-align: center;
            font-size: 0.85rem;
        }

        .item-total {
            font-weight: 700;
            color: var(--success-color);
            font-size: 0.75rem;
            text-align: center;
            margin-top: 4px;
        }

        /* Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø© */
        .cart-summary {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 0.75rem;
            flex-shrink: 0; /* Ù„Ø§ ØªØªÙ‚Ù„Øµ - ØªØ¨Ù‚Ù‰ Ø«Ø§Ø¨ØªØ© */
            overflow: visible; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¸Ù‡ÙˆØ± ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        }

        .discount-section {
            margin-bottom: 0.5rem;
        }

        .discount-input {
            width: 100%;
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 0.5rem;
            color: var(--theme-text-primary);
            font-size: 0.875rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .discount-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--theme-text-primary);
        }

        .summary-row.total {
            font-size: 1rem;
            font-weight: 700;
            color: var(--theme-text-primary);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        .summary-value {
            font-weight: 600;
        }

        /* Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ */
        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin: 0.75rem 0;
        }

        .payment-btn {
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 0.6rem;
            color: var(--theme-text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .payment-btn i {
            font-size: 1.2rem;
        }

        .payment-btn:hover,
        .payment-btn.selected {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¯ÙØ¹ */
        .payment-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .payment-action-btn {
            background: var(--theme-bg-secondary);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: var(--border-radius);
            padding: 1rem 0.75rem;
            color: var(--theme-text-primary);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .payment-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .payment-action-btn:hover:not(:disabled)::before {
            opacity: 1;
        }

        .payment-action-btn i {
            font-size: 1.5rem;
        }

        .payment-action-btn.cash-btn {
            border-color: rgba(34, 197, 94, 0.4);
        }

        .payment-action-btn.cash-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-color: #22c55e;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4);
        }

        .payment-action-btn.installment-btn {
            border-color: rgba(99, 102, 241, 0.4);
        }

        .payment-action-btn.installment-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            border-color: #6366f1;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .payment-action-btn:disabled {
            background: var(--theme-bg-secondary);
            color: var(--theme-text-secondary);
            cursor: not-allowed;
            opacity: 0.5;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .payment-action-btn:disabled::before {
            display: none;
        }

        /* Ø²Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù‚Ø¯ÙŠÙ… - Ù„Ù„ØªÙˆØ§ÙÙ‚ */
        .checkout-btn {
            width: 100%;
            background: var(--success-gradient);
            border: none;
            border-radius: var(--border-radius);
            padding: 0.75rem;
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .checkout-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .checkout-btn:disabled {
            background: var(--theme-bg-secondary);
            color: var(--theme-text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-card {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.5s ease forwards;
            opacity: 0;
        }
        
        .settings-card:nth-child(1) { animation-delay: 0.1s; }
        .settings-card:nth-child(2) { animation-delay: 0.2s; }
        .settings-card:nth-child(3) { animation-delay: 0.3s; }
        .settings-card:nth-child(4) { animation-delay: 0.4s; }
        .settings-card:nth-child(5) { animation-delay: 0.5s; }
        .settings-card:nth-child(6) { animation-delay: 0.6s; }

        .settings-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-gradient);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .settings-card:hover {
            transform: translateX(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .settings-card:hover::before {
            transform: scaleY(1);
        }

        .settings-card-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .settings-card:hover .settings-card-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .settings-card-icon.store-icon {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(16, 185, 129, 0.2));
            color: #22c55e;
        }

        .settings-card-icon.system-icon {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            color: #6366f1;
        }

        .settings-card-icon.backup-icon {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.2));
            color: #3b82f6;
        }

        .settings-card-icon.printing-icon {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(147, 51, 234, 0.2));
            color: #a855f7;
        }

        .settings-card-icon.security-icon {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2));
            color: #ef4444;
        }

        .settings-card-content {
            flex: 1;
        }

        .settings-card-content h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--theme-text-primary);
        }

        .settings-card-content p {
            font-size: 0.9rem;
            color: var(--theme-text-secondary);
            line-height: 1.5;
        }

        .settings-card-arrow {
            color: var(--theme-text-secondary);
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .settings-card:hover .settings-card-arrow {
            transform: translateX(-5px);
            color: var(--primary-color);
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØµØºØ±Ø© */
        .info-mini-card {
            background: var(--theme-bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 2px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideInFromRight 0.5s ease forwards;
            opacity: 0;
        }
        
        .info-mini-card:nth-child(1) { animation-delay: 0.1s; }
        .info-mini-card:nth-child(2) { animation-delay: 0.2s; }
        .info-mini-card:nth-child(3) { animation-delay: 0.3s; }
        .info-mini-card:nth-child(4) { animation-delay: 0.4s; }

        .info-mini-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .info-mini-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.1);
        }

        .info-mini-card:hover::before {
            transform: scaleX(1);
        }

        .info-mini-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .info-mini-content {
            flex: 1;
        }

        .info-mini-label {
            font-size: 0.85rem;
            color: var(--theme-text-secondary);
            margin-bottom: 0.3rem;
        }

        .info-mini-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--theme-text-primary);
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stat-overview-card {
            background: var(--theme-bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease forwards;
            opacity: 0;
        }
        
        .stat-overview-card:nth-child(1) { animation-delay: 0.2s; }
        .stat-overview-card:nth-child(2) { animation-delay: 0.3s; }
        .stat-overview-card:nth-child(3) { animation-delay: 0.4s; }
        .stat-overview-card:nth-child(4) { animation-delay: 0.5s; }

        .stat-overview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.1);
        }

        .stat-overview-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 2px solid rgba(255,255,255,0.05);
        }

        .stat-overview-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .stat-overview-header h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--theme-text-primary);
            margin: 0;
        }

        .stat-overview-body {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stat-overview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .stat-overview-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .stat-overview-item span {
            font-size: 0.9rem;
            color: var(--theme-text-secondary);
        }

        .stat-overview-item strong {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--theme-text-primary);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        .quick-action-btn {
            padding: 1.2rem 1.5rem;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.5s ease forwards;
            opacity: 0;
        }
        
        .quick-action-btn:nth-child(1) { animation-delay: 0.6s; }
        .quick-action-btn:nth-child(2) { animation-delay: 0.7s; }
        .quick-action-btn:nth-child(3) { animation-delay: 0.8s; }
        .quick-action-btn:nth-child(4) { animation-delay: 0.9s; }

        .quick-action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .quick-action-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .quick-action-btn:active {
            transform: translateY(-1px);
        }

        .quick-action-btn i {
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
        }

        .quick-action-btn span {
            position: relative;
            z-index: 1;
        }

        /* Ø¹Ù†ÙˆØ§Ù† ÙØ±Ø¹ÙŠ Ù„Ù„Ù‚Ø³Ù… */
        .section-subtitle {
            font-size: 0.95rem;
            color: var(--theme-text-secondary);
            margin-top: 0.5rem;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        .table-container {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius-lg);
            overflow: auto;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Ù„Ù„ØµÙØ­Ø§Øª ØºÙŠØ± POS - Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ */
        .page:not(#pos) .table-container {
            max-height: none;
        }
        
        /* Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ - Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
        #pos .table-container {
            max-height: 600px;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØµÙØ­Ø§Øª - Ø¨ÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø±Ø¶ */
        .settings-full-width {
            width: 100%;
            padding: 0;
        }
        
        .settings-content-wrapper {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .settings-section {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .settings-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .settings-section h3 {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--theme-text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        /* Ø´Ø¨ÙƒØ© responsive Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .settings-content-wrapper {
                padding: 1.5rem;
            }
            
            .page-content {
                padding: 1rem;
            }
            
            .section-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .pos-search-box {
                max-width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØµÙØ­Ø§Øª */
        .page:not(#pos) {
            padding-bottom: 2rem;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
        @media (max-width: 1200px) {
            .table-container {
                overflow-x: auto;
            }
        }

        .table-container::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        .table-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }

        .table-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, 
                #667eea 0%, 
                #764ba2 50%, 
                #f093fb 100%);
            border-radius: 12px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
        }

        .table-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, 
                #f093fb 0%, 
                #764ba2 50%, 
                #667eea 100%);
            box-shadow: 0 0 16px rgba(102, 126, 234, 0.9);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--primary-gradient);
            color: white;
            padding: 1rem;
            text-align: right;
            font-weight: 600;
            font-size: var(--font-size-base);
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: var(--font-size-base);
            color: var(--theme-text-primary);
        }

        .table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-size: var(--font-size-base);
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--theme-bg-secondary);
            color: var(--theme-text-secondary);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn-secondary:hover {
            background: var(--theme-bg-card);
            color: var(--theme-text-primary);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
        }

        .action-btn {
            padding: 0.5rem;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            margin: 0 0.25rem;
        }

        .edit-btn {
            background: var(--warning-gradient);
            color: white;
        }

        .delete-btn {
            background: var(--danger-gradient);
            color: white;
        }

        .view-btn {
            background: var(--primary-gradient);
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-md);
        }

        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--theme-bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary-gradient);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--theme-text-primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--theme-text-secondary);
            font-size: var(--font-size-base);
            font-weight: 500;
        }

        /* ğŸ’° Ø£Ù†Ù…Ø§Ø· ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ */
        .expense-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--theme-border);
        }

        .expense-tab-btn {
            flex: 1;
            padding: 1.2rem 2rem;
            background: var(--theme-bg-secondary);
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--theme-text-secondary);
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
        }

        .expense-tab-btn:hover {
            background: var(--theme-bg-hover);
            color: var(--theme-text-primary);
        }

        .expense-tab-btn.active {
            background: var(--theme-bg-card);
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }

        .expense-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .expense-tab-content.active {
            display: block;
        }

        /* ÙÙ„Ø§ØªØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
        .reports-filters {
            display: flex;
            gap: 2rem;
            padding: 1.5rem;
            background: var(--theme-bg-secondary);
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .filter-group label {
            color: var(--theme-text-primary);
            font-weight: 600;
            white-space: nowrap;
        }

        .filter-group select,
        .filter-group input[type="date"] {
            padding: 0.7rem 1rem;
            background: var(--theme-bg-card);
            border: 1px solid var(--theme-border);
            border-radius: var(--border-radius-sm);
            color: var(--theme-text-primary);
            font-size: var(--font-size-base);
            min-width: 150px;
        }

        .filter-group select:focus,
        .filter-group input[type="date"]:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* ÙƒØ±ÙˆØª Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ */
        .expense-type-card {
            background: var(--theme-bg-card);
            border: 1px solid var(--theme-border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .expense-type-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .expense-type-icon {
            font-size: 2rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-gradient);
            color: white;
            border-radius: 50%;
        }

        .expense-type-info h4 {
            color: var(--theme-text-primary);
            margin-bottom: 0.3rem;
            font-size: var(--font-size-md);
        }

        .expense-type-info p {
            color: var(--theme-text-tertiary);
            font-size: var(--font-size-sm);
        }

        /* Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ */
        .expense-row-highlight {
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
        }

        .expense-amount-cell {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .expense-amount-positive {
            color: var(--success-color);
        }

        .expense-amount-negative {
            color: var(--danger-color);
        }

        /* Ø´Ø§Ø±Ø© Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ */
        .expense-type-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .expense-type-rent {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
        }

        .expense-type-utilities {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .expense-type-salary {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .expense-type-maintenance {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .expense-type-other {
            background: rgba(107, 114, 128, 0.2);
            color: #6b7280;
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ */
        .expense-icon-rent::before { content: 'ğŸ '; margin-left: 5px; }
        .expense-icon-utilities::before { content: 'âš¡'; margin-left: 5px; }
        .expense-icon-salary::before { content: 'ğŸ’°'; margin-left: 5px; }
        .expense-icon-maintenance::before { content: 'ğŸ”§'; margin-left: 5px; }
        .expense-icon-other::before { content: 'ğŸ“'; margin-left: 5px; }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--theme-bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.3s ease;
        }

        .modal-content::-webkit-scrollbar {
            width: 10px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin: 8px 0;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, 
                #667eea 0%, 
                #764ba2 50%, 
                #f093fb 100%);
            border-radius: 12px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, 
                #f093fb 0%, 
                #764ba2 50%, 
                #667eea 100%);
            box-shadow: 0 0 16px rgba(102, 126, 234, 0.9);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* Ø¬Ø¹Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙÙŠ ÙˆØ³Ø· Ø§Ù„ØµÙØ­Ø© Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ ÙˆØ£ÙÙ‚ÙŠØ§Ù‹ */
        .modal.active {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            margin: 0 auto;
            top: auto;
            left: auto;
            right: auto;
            bottom: auto;
            position: relative;
            transform: none;
            /* Ù„Ù…Ù†Ø¹ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø´Ø§Ø´Ø© */
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--theme-text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--theme-text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: var(--danger-gradient);
            color: white;
        }

        /* ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„ */
        .activation-tab {
            transition: all 0.3s ease;
        }

        /* Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--theme-text-primary);
            font-size: var(--font-size-base);
        }

        .form-input, .form-select {
            width: 100%;
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            color: var(--theme-text-primary);
            font-size: var(--font-size-base);
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        .form-range {
            width: 100%;
            height: 6px;
            background: var(--theme-bg-secondary);
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
            transition: all 0.2s ease;
        }

        .form-range::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.6);
        }

        .form-range::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
            transition: all 0.2s ease;
        }

        .form-range::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.6);
        }

        .form-control {
            width: 100%;
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            color: var(--theme-text-primary);
            font-size: 0.875rem;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
            resize: vertical;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„Ø®Ø·Ø£ */
        .success-message {
            background: var(--success-gradient);
            color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 1rem;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .error-message {
            background: var(--danger-gradient);
            color: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            margin-bottom: 1rem;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ */
        .export-import-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .export-btn, .import-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .export-btn {
            background: var(--success-gradient);
            color: white;
        }

        .import-btn {
            background: var(--warning-gradient);
            color: white;
        }

        .export-btn:hover, .import-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ÙØ¦Ø§Øª */
        .category-icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .category-icon-btn {
            background: var(--theme-bg-secondary);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.5rem;
        }

        .category-icon-btn:hover,
        .category-icon-btn.selected {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        /* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· */
        .installment-form {
            background: var(--theme-bg-secondary);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-top: 2rem;
            display: none;
            border: 2px solid rgba(102, 126, 234, 0.2);
            animation: slideInUp 0.4s ease;
        }
        
        /* Ø®ÙŠØ§Ø±Ø§Øª Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ */
        .payment-options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding: 1.5rem 0;
        }
        
        .payment-option-card {
            background: var(--theme-bg-secondary);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: var(--border-radius-lg);
            padding: 2.5rem 2rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .payment-option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }
        
        .payment-option-card:hover::before {
            opacity: 0.1;
        }
        
        .payment-option-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-color);
        }
        
        .payment-option-card.cash-payment:hover {
            border-color: var(--success-color);
        }
        
        .payment-option-card.installment-payment:hover {
            border-color: var(--warning-color);
        }
        
        .payment-option-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }
        
        .payment-option-card.cash-payment .payment-option-icon {
            background: var(--success-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .payment-option-card.installment-payment .payment-option-icon {
            background: var(--warning-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .payment-option-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--theme-text-primary);
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }
        
        .payment-option-description {
            font-size: 0.9rem;
            color: var(--theme-text-secondary);
            position: relative;
            z-index: 1;
        }
        
        /* Ø±Ø£Ø³ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· */
        .installment-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        .installment-header i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .installment-header h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--theme-text-primary);
            margin: 0;
        }
        
        /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .form-section {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ */
        .search-customer-wrapper {
            position: relative;
        }
        
        .customer-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--theme-bg-card);
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            margin-top: 0.5rem;
        }
        
        .customer-search-results.active {
            display: block;
        }
        
        .customer-search-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .customer-search-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .customer-search-item:last-child {
            border-bottom: none;
        }
        
        .customer-search-name {
            font-weight: 600;
            color: var(--theme-text-primary);
            font-size: var(--font-size-base);
        }
        
        .customer-search-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: var(--font-size-sm);
            color: var(--theme-text-secondary);
        }
        
        .customer-search-info i {
            color: var(--primary-color);
        }
        
        .customer-search-debt {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: var(--font-size-sm);
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .customer-search-empty {
            padding: 1.5rem;
            text-align: center;
            color: var(--theme-text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .form-hint {
            display: block;
            margin-top: 0.5rem;
            font-size: var(--font-size-sm);
            color: var(--theme-text-secondary);
        }
        
        .form-hint i {
            margin-left: 0.25rem;
        }
        
        .section-title i {
            font-size: 1.1rem;
        }
        
        .form-grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .form-hint {
            display: block;
            font-size: 0.75rem;
            color: var(--theme-text-secondary);
            margin-top: 0.35rem;
            font-style: italic;
        }
        
        .required {
            color: var(--danger-color);
            margin-right: 0.25rem;
        }
        
        /* Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· */
        .installment-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }
        
        .summary-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--theme-text-primary);
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        .summary-title i {
            font-size: 1.3rem;
            color: var(--primary-color);
        }
        
        .summary-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .summary-row .summary-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            color: var(--theme-text-secondary);
        }
        
        .summary-row .summary-label i {
            width: 20px;
            text-align: center;
        }
        
        .summary-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            margin: 0.5rem 0;
        }
        
        .summary-row.total-row {
            background: rgba(102, 126, 234, 0.15);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-top: 0.5rem;
        }
        
        .summary-row.total-row .summary-label {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--theme-text-primary);
        }
        
        .summary-row.total-row .summary-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--primary-color);
        }
        
        .summary-row.monthly-row {
            background: var(--success-gradient);
            padding: 1rem;
            border-radius: var(--border-radius);
            color: white;
        }
        
        .summary-row.monthly-row .summary-label {
            font-size: 1rem;
            font-weight: 600;
            color: white;
        }
        
        .summary-row.monthly-row .summary-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
        }
        
        .summary-value.highlight {
            animation: pulse 2s infinite;
        }

        .installment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ */
        [data-theme="light"] .payment-option-card {
            background: #ffffff;
            border: 2px solid #e2e8f0;
        }
        
        [data-theme="light"] .payment-option-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        [data-theme="light"] .form-section {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
        }
        
        [data-theme="light"] .installment-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
            border: 2px solid rgba(102, 126, 234, 0.2);
        }
        
        @media (max-width: 768px) {
            .payment-options-container {
                grid-template-columns: 1fr;
            }
            
            .form-grid-2,
            .form-grid-3 {
                grid-template-columns: 1fr;
            }
        }

        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 1200px) {
            .pos-layout {
                grid-template-columns: 1fr 350px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                transform: translateX(-100%);
                position: fixed;
                z-index: 100;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: block;
            }

            .pos-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .search-input {
                width: 200px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        @keyframes slideInLeft {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        @keyframes slideOutLeft {
            from { transform: translateX(0); }
            to { transform: translateX(-100%); }
        }

        .sidebar.animating-in {
            animation: slideInLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar.animating-out {
            animation: slideOutLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .text-success { color: var(--success-color); }
        .text-warning { color: var(--warning-color); }
        .text-danger { color: var(--danger-color); }
        .text-muted { color: var(--theme-text-secondary); }

        .bg-success { background: var(--success-gradient); }
        .bg-warning { background: var(--warning-gradient); }
        .bg-danger { background: var(--danger-gradient); }

        .border-success { border-color: var(--success-color); }
        .border-warning { border-color: var(--warning-color); }
        .border-danger { border-color: var(--danger-color); }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ */
        .barcode-section {
            display: flex;
            gap: 0.5rem;
            align-items: end;
        }

        .barcode-input {
            flex: 1;
        }

        .generate-barcode-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .generate-barcode-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: var(--theme-text-secondary);
        }

        .detail-value {
            font-weight: 500;
            color: var(--theme-text-primary);
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ± */
        .filters-section {
            background: var(--theme-bg-card);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠÙ† */
        .debt-status {
            padding: 0.25rem 0.75rem;
            border-radius: var(--border-radius-lg);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .debt-status.active {
            background: var(--success-gradient);
            color: white;
        }

        .debt-status.overdue {
            background: var(--danger-gradient);
            color: white;
        }

        .debt-status.paid {
            background: var(--theme-bg-secondary);
            color: var(--theme-text-secondary);
        }
        
        /* Ø´Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© */
        .merge-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: var(--border-radius);
            font-size: 0.7rem;
            font-weight: 600;
            margin-right: 0.5rem;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        
        .merge-badge i {
            font-size: 0.65rem;
        }
        
        /* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--theme-bg-card);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: var(--border-radius-lg);
            margin-top: 0.75rem;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            z-index: 1000;
            display: none;
            backdrop-filter: blur(20px);
        }
        
        .search-results.active {
            display: block;
            animation: searchResultsAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes searchResultsAppear {
            from {
                opacity: 0;
                transform: translateY(-15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .search-results::-webkit-scrollbar {
            width: 8px;
        }
        
        .search-results::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin: 8px 0;
        }
        
        .search-results::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .search-results::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            box-shadow: 0 0 10px var(--primary-color);
        }
        
        .search-category {
            padding: 1rem 1.25rem 0.75rem;
            border-bottom: 2px solid rgba(255,255,255,0.05);
            background: rgba(102, 126, 234, 0.03);
        }
        
        .search-category:last-child {
            border-bottom: none;
        }
        
        .search-category-title {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .search-category-title i {
            font-size: 1rem;
        }
        
        .search-category-title .count {
            background: var(--primary-gradient);
            color: white;
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-right: 0.25rem;
        }
        
        .search-result-item {
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            position: relative;
            overflow: hidden;
        }
        
        .search-result-item::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: var(--primary-gradient);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .search-result-item:hover::before {
            transform: scaleY(1);
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
            transform: translateX(-4px);
            padding-right: 1.5rem;
        }
        
        .search-result-icon {
            width: 48px;
            height: 48px;
            min-width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-gradient);
            border-radius: var(--border-radius);
            color: white;
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .search-result-item:hover .search-result-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        .search-result-info {
            flex: 1;
            min-width: 0;
        }
        
        .search-result-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--theme-text-primary);
            margin-bottom: 0.35rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease;
        }
        
        .search-result-item:hover .search-result-title {
            color: var(--primary-color);
        }
        
        .search-result-subtitle {
            font-size: 0.8rem;
            color: var(--theme-text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            transition: color 0.3s ease;
        }
        
        .search-result-subtitle span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .search-result-item:hover .search-result-subtitle {
            color: var(--theme-text-primary);
        }
        
        .search-result-badge {
            background: var(--theme-bg-secondary);
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--theme-text-secondary);
            white-space: nowrap;
        }
        
        .search-result-item:hover .search-result-badge {
            background: rgba(255,255,255,0.1);
            color: var(--primary-color);
        }
        
        .search-empty {
            padding: 3rem 2rem;
            text-align: center;
            color: var(--theme-text-secondary);
        }
        
        .search-empty i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
            color: var(--primary-color);
        }
        
        .search-empty p {
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .search-header {
            padding: 1rem 1.25rem;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            background: var(--primary-gradient);
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .search-header i {
            margin-left: 0.5rem;
        }
        
        .search-total {
            background: rgba(255,255,255,0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ */
        [data-theme="light"] .search-results {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        
        [data-theme="light"] .search-category {
            background: #f7fafc;
        }
        
        [data-theme="light"] .search-result-item:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.03) 100%);
        }
        
        [data-theme="light"] .search-result-item:hover .search-result-title {
            color: var(--primary-color);
        }
        
        [data-theme="light"] .search-result-badge {
            background: #edf2f7;
            color: #4a5568;
        }
        
        [data-theme="light"] .search-result-item:hover .search-result-badge {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-color);
        }
        
        .search-box {
            position: relative;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø«ÙŠÙ… Ø§Ù„ÙØ§ØªØ­ */
        [data-theme="light"] .form-input,
        [data-theme="light"] .form-select {
            background: #ffffff;
            border: 2px solid #cbd5e0;
            color: #000000;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .form-input:focus,
        [data-theme="light"] .form-select:focus {
            border-color: var(--primary-color);
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .form-input::placeholder {
            color: #718096;
            font-weight: 500;
        }
        
        [data-theme="light"] .form-label {
            color: #1a202c;
            font-weight: 700;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
        }
        
        [data-theme="light"] textarea.form-input {
            border: 2px solid #cbd5e0;
            background: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] textarea.form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        [data-theme="light"] .stat-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-md);
        }
        
        [data-theme="light"] .stat-card .stat-label {
            color: #000000;
            font-weight: 700;
        }
        
        [data-theme="light"] .stat-card .stat-value {
            color: #000000;
            font-weight: 800;
        }
        
        [data-theme="light"] .product-card {
            background: #ffffff;
            border: 1px solid #d8d8d8;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }
        
        [data-theme="light"] .product-card .product-name,
        [data-theme="light"] .product-card .product-price,
        [data-theme="light"] .product-card .product-info {
            color: #000000;
            font-weight: 700;
        }
        
        [data-theme="light"] .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        [data-theme="light"] .sidebar {
            background: #fafaf8;
            border-left: 1px solid #d8d8d8;
            box-shadow: -4px 0 12px rgba(0,0,0,0.06);
        }
        
        [data-theme="light"] .nav-btn {
            color: #4a4a4a;
        }
        
        [data-theme="light"] .nav-btn:hover {
            background: #ececea;
            color: var(--primary-color);
        }
        
        [data-theme="light"] .nav-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
        }
        
        [data-theme="light"] .top-bar {
            background: rgba(250, 250, 248, 0.95);
            border-bottom: 1px solid rgba(0,0,0,0.08);
            backdrop-filter: blur(25px);
        }
        
        [data-theme="light"] .modal-content {
            background: #ffffff;
            border: 1px solid #d8d8d8;
            box-shadow: var(--shadow-xl);
        }
        
        [data-theme="light"] .table {
            background: #ffffff;
        }
        
        [data-theme="light"] .table thead {
            background: #f5f5f0;
            border-bottom: 2px solid #d8d8d8;
        }
        
        [data-theme="light"] .table th {
            color: #000000;
            font-weight: 700;
        }
        
        [data-theme="light"] .table td {
            color: #1a1a1a;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
        }
        
        [data-theme="light"] .table tbody tr:hover {
            background: #f7fafc;
        }
        
        [data-theme="light"] .cart-item {
            background: #ffffff;
            border: 1px solid #e2e8f0;
        }
        
        [data-theme="light"] .cart-item:hover {
            background: #f7fafc;
            border-color: var(--primary-color);
        }
        
        [data-theme="light"] .search-input {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            color: #1a202c;
        }
        
        [data-theme="light"] .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        
        [data-theme="light"] .category-btn {
            background: #ffffff;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        [data-theme="light"] .category-btn:hover {
            background: #edf2f7;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        [data-theme="light"] .category-btn.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-color: transparent;
        }
        
        [data-theme="light"] .action-btn {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        
        [data-theme="light"] .action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: scale(1.1);
        }
        
        [data-theme="light"] .action-btn.delete-btn:hover {
            background: #fc8181;
            border-color: #fc8181;
        }
        
        [data-theme="light"] .summary-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-md);
        }
        
        [data-theme="light"] .summary-row {
            color: #4a5568;
            border-bottom: 1px solid #e2e8f0;
        }
        
        [data-theme="light"] .summary-row.total {
            color: var(--primary-color);
            font-weight: bold;
            border-top: 2px solid var(--primary-color);
        }
        
        [data-theme="light"] .category-icon-btn {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            color: #4a5568;
        }
        
        [data-theme="light"] .category-icon-btn:hover {
            background: #edf2f7;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        [data-theme="light"] .category-icon-btn.selected {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-color: transparent;
        }
        
        [data-theme="light"] .toast {
            background: #ffffff;
            color: #1a202c;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-lg);
        }
        
        [data-theme="light"] .toast.success {
            background: #f0fff4;
            border-color: #9ae6b4;
            color: #22543d;
        }
        
        [data-theme="light"] .toast.error {
            background: #fff5f5;
            border-color: #fc8181;
            color: #742a2a;
        }
        
        [data-theme="light"] .toast.info {
            background: #ebf8ff;
            border-color: #90cdf4;
            color: #2c5282;
        }
        
        [data-theme="light"] .export-btn {
            background: #ffffff;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }
        
        [data-theme="light"] .export-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        [data-theme="light"] .debt-status.paid {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        [data-theme="light"] select option {
            background: #ffffff;
            color: #1a202c;
        }
        
        [data-theme="light"] textarea {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            color: #1a202c;
        }
        
        [data-theme="light"] textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† */
        .card {
            background: var(--theme-bg-card);
            border: 1px solid var(--theme-border);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--theme-shadow);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        [data-theme="light"] .card {
            background: var(--theme-bg-card);
            border: 1px solid var(--theme-border);
            box-shadow: var(--theme-shadow);
        }
        
        [data-theme="light"] .card:hover {
            box-shadow: 0 12px 35px rgba(15, 23, 42, 0.12);
        }
        
        .installment-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .installment-status.paid {
            background: #d4edda;
            color: #155724;
        }
        
        .installment-status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .installment-status.overdue {
            background: #f8d7da;
            color: #721c24;
        }
        
        .payment-btn {
            background: var(--success-gradient);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        
        .payment-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(67, 233, 123, 0.4);
        }
        
        .payment-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¶ØºÙˆØ· */
        body.compact-mode .pos-layout {
            gap: 1rem;
        }

        body.compact-mode .products-section,
        body.compact-mode .cart-section {
            padding: 1rem;
        }

        body.compact-mode .section-header {
            margin-bottom: 1rem;
        }

        body.compact-mode .product-card {
            padding: 0.75rem;
        }

        body.compact-mode .cart-item {
            padding: 0.75rem;
        }

        body.compact-mode .stat-card {
            padding: 1rem;
        }

        /* ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        body.no-animations * {
            animation: none !important;
            transition: none !important;
        }

        body.no-animations .page.active {
            animation: none !important;
        }

        /* Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ§Øª */
        body.rtl {
            direction: rtl;
        }

        body.ltr {
            direction: ltr;
        }

        body.ltr .sidebar {
            left: 0;
            right: auto;
        }

        body.ltr .main-content {
            margin-left: 280px;
            margin-right: 0;
        }

        body.ltr .pos-layout {
            grid-template-columns: 1fr 400px;
        }

        body.ltr .cart-section {
            border-right: none;
            border-left: 1px solid var(--border-color);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ù†ØªÙ‚ÙŠØ§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        input[type="color"] {
            cursor: pointer;
            border: 2px solid var(--border-color) !important;
            transition: all 0.3s ease;
        }

        input[type="color"]:hover {
            border-color: var(--primary-color) !important;
            transform: scale(1.05);
        }

        input[type="color"]:focus {
            outline: none;
            border-color: var(--primary-color) !important;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
        .btn-primary {
            background: var(--primary-gradient) !important;
        }

        .btn-success {
            background: var(--success-gradient) !important;
        }

        .btn-warning {
            background: var(--warning-gradient) !important;
        }

        .btn-danger {
            background: var(--danger-gradient) !important;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-card-icon.store-icon {
            background: linear-gradient(135deg, var(--success-color) 0%, rgba(34, 197, 94, 0.2) 100%);
        }

        .settings-card-icon.system-icon {
            background: linear-gradient(135deg, var(--primary-color) 0%, rgba(99, 102, 241, 0.2) 100%);
        }

        .settings-card-icon.backup-icon {
            background: linear-gradient(135deg, var(--info-color) 0%, rgba(59, 130, 246, 0.2) 100%);
        }

        .settings-card-icon.printing-icon {
            background: linear-gradient(135deg, var(--secondary-color) 0%, rgba(168, 85, 247, 0.2) 100%);
        }

        .settings-card-icon.security-icon {
            background: linear-gradient(135deg, var(--danger-color) 0%, rgba(239, 68, 68, 0.2) 100%);
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
        .stat-card {
            border-top: 3px solid var(--primary-color);
        }

        .product-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.15);
        }

        .toast.success {
            background: linear-gradient(135deg, var(--success-color) 0%, rgba(16, 185, 129, 0.9) 100%);
        }

        .toast.error {
            background: linear-gradient(135deg, var(--danger-color) 0%, rgba(239, 68, 68, 0.9) 100%);
        }

        .toast.warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, rgba(245, 158, 11, 0.9) 100%);
        }

        .toast.info {
            background: linear-gradient(135deg, var(--info-color) 0%, rgba(59, 130, 246, 0.9) 100%);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø«ÙŠÙ…Ø§Øª */
        .theme-preview-btn {
            width: 100%;
            height: 60px;
            border: none;
            border-radius: 12px;
            font-size: 1.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-preview-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .theme-preview-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø«ÙŠÙ…Ø§Øª */
        #themeSelect {
            background: var(--theme-bg-card);
            color: var(--theme-text-primary);
            border: 2px solid var(--theme-border);
            font-weight: 500;
        }

        #themeSelect:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        #themeSelect optgroup {
            background: var(--theme-bg-secondary);
            color: var(--theme-text-primary);
            font-weight: bold;
            padding: 0.5rem;
        }

        #themeSelect option {
            background: var(--theme-bg-card);
            color: var(--theme-text-primary);
            padding: 0.5rem;
        }

        /* ============================================
           Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù† - Digital Creativity
           ============================================ */

        /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .login-container {
            background: var(--theme-bg-card);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.4s ease;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: var(--primary-gradient);
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .login-logo i {
            font-size: 36px;
            color: white;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--theme-text-primary);
            margin-bottom: 8px;
        }

        .login-subtitle {
            font-size: 16px;
            color: var(--theme-text-secondary);
        }

        .login-form {
            margin-top: 30px;
        }

        .login-input-group {
            margin-bottom: 20px;
        }

        .login-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--theme-text-primary);
            font-size: 14px;
        }

        .login-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--theme-border);
            border-radius: 12px;
            font-size: 16px;
            background: var(--theme-bg-secondary);
            color: var(--theme-text-primary);
            transition: all 0.3s;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .login-button {
            width: 100%;
            padding: 14px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù…Ø§Ù† */
        .security-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .security-panel.active {
            display: flex;
        }

        .security-content {
            background: var(--theme-bg-card);
            border-radius: 20px;
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            max-height: 800px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            animation: slideUp 0.4s ease;
        }

        .security-header {
            padding: 25px 30px;
            background: var(--primary-gradient);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .security-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .security-close {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .security-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .security-tabs {
            display: flex;
            gap: 8px;
            padding: 20px 30px 0;
            background: var(--theme-bg-secondary);
            border-bottom: 2px solid var(--theme-border);
        }

        .security-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--theme-text-secondary);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px 12px 0 0;
            transition: all 0.3s;
        }

        .security-tab:hover {
            background: var(--theme-bg-hover);
            color: var(--theme-text-primary);
        }

        .security-tab.active {
            background: var(--theme-bg-card);
            color: var(--primary-color);
        }

        .security-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: var(--theme-bg-secondary);
        }

        .security-section {
            background: var(--theme-bg-card);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--theme-border);
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--theme-text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .users-table thead {
            background: var(--theme-bg-secondary);
        }

        .users-table th {
            padding: 14px 12px;
            text-align: right;
            font-weight: 600;
            color: var(--theme-text-primary);
            font-size: 14px;
            border-bottom: 2px solid var(--theme-border);
        }

        .users-table td {
            padding: 14px 12px;
            text-align: right;
            color: var(--theme-text-secondary);
            border-bottom: 1px solid var(--theme-border);
        }

        .users-table tr:hover {
            background: var(--theme-bg-hover);
        }

        .user-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-admin {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .badge-user {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .status-active {
            color: var(--success-color);
            font-weight: 600;
        }

        .status-inactive {
            color: var(--danger-color);
            font-weight: 600;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-left: 6px;
            transition: all 0.2s;
        }

        .btn-edit {
            background: var(--info-color);
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-delete {
            background: var(--danger-color);
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .btn-add-user {
            background: var(--success-gradient);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-add-user:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .permission-card {
            background: var(--theme-bg-secondary);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--theme-border);
        }

        .permission-card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--theme-text-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--theme-border);
        }

        .permission-item:last-child {
            border-bottom: none;
        }

        .permission-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        .permission-label {
            font-size: 14px;
            color: var(--theme-text-secondary);
            cursor: pointer;
            flex: 1;
        }

        /* Modal Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .user-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }

        .user-modal.active {
            display: flex;
        }

        .user-modal-content {
            background: var(--theme-bg-card);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: slideUp 0.3s ease;
        }

        .user-modal-header {
            padding: 25px 30px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 20px 20px 0 0;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .user-modal-title {
            font-size: 22px;
            font-weight: 700;
        }

        .user-modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--theme-text-primary);
            font-size: 14px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--theme-border);
            border-radius: 12px;
            font-size: 15px;
            background: var(--theme-bg-secondary);
            color: var(--theme-text-primary);
            transition: all 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--theme-border);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: var(--theme-bg-secondary);
            border: 2px solid var(--theme-border);
            border-radius: 12px;
            color: var(--theme-text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: var(--theme-bg-hover);
        }

        .btn-primary {
            padding: 12px 24px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª responsive */
        @media (max-width: 768px) {
            .security-content {
                width: 100%;
                height: 100%;
                max-height: none;
                border-radius: 0;
            }

            .permissions-grid {
                grid-template-columns: 1fr;
            }

            .users-table {
                font-size: 13px;
            }

            .users-table th,
            .users-table td {
                padding: 10px 8px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <!-- ØªØ­Ø³ÙŠÙ† Ø®Ø·ÙˆØ· Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙˆØ§Ù„Ø³Ù„Ø© -->
  <style>
  /* Ø¬Ø¹Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ù†ØµÙˆØµ Ù…ØªÙˆØ³Ø·Ø© ÙˆÙˆØ§Ø¶Ø­Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„ØµÙØ­Ø§Øª */
  body, html, table, th, td, input, select, button, label, .form-control, .modal, .cart, .product-card, .details-section, .detail-row, .info-row, .product-header, .product-name, .product-category, .product-actions, .empty-state {
      font-size: 1.08em !important;
      font-weight: 600 !important;
      letter-spacing: 0.2px;
  }

  /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¹Ù†Ø§ØµØ± */
  .table td, .table th, .product-card .info-value, .cart .item-qty, .cart .item-price, .detail-value, .stock, .price {
      font-size: 1.18em !important;
      font-weight: 800 !important;
  }

  /* ØªÙƒØ¨ÙŠØ± Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„ØµÙØ­Ø§Øª */
  h1, h2, h3, h4, h5, h6, .modal-title, .page-title {
      font-size: 2em !important;
      font-weight: 900 !important;
  }

  /* ØªØ­Ø³ÙŠÙ† Ø®Ø·ÙˆØ· Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
  .sidebar, .sidebar-menu, .sidebar .menu-item, .sidebar .menu-link {
      font-size: 1.22em !important;
      font-weight: 800 !important;
      letter-spacing: 0.5px;
  }

  /* ØªÙƒØ¨ÙŠØ± Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ */
  .nav-menu {
      font-size: 1.25rem !important; /* Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
      font-family: 'Tajawal', 'Cairo', 'Segoe UI', Arial, sans-serif !important;
  }
  .nav-section-title {
      font-size: 1.35rem !important;
      font-weight: bold !important;
      margin-bottom: 0.5em !important;
      letter-spacing: 0.5px;
  }
  .nav-item {
      margin-bottom: 0.25em !important;
  }
  .nav-link {
      font-size: 1.18rem !important;
      font-weight: 500 !important;
      display: flex;
      align-items: center;
      gap: 0.5em;
      padding: 0.5em 0.75em !important;
      border-radius: 8px !important;
      transition: background 0.2s;
  }
  .nav-link.active,
  .nav-link:hover {
      background: #f3f4f6 !important;
      color: #0f172a !important;
  }
  .nav-icon {
      font-size: 1.5em !important;
      min-width: 1.5em;
      text-align: center;
  }
  .nav-text {
      font-size: 1.15em !important;
      font-weight: 500 !important;
  }
  /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ */
  #securityNavItem .nav-link,
  #logoutNavItem .nav-link {
      font-size: 1.18rem !important;
      font-weight: 600 !important;
  }

  /* ØªØ­Ø³ÙŠÙ† Ø®Ø·ÙˆØ· Ø§Ù„Ø³Ù„Ø© */
  .cart, .cart-list, .cart-item, .cart .item-name, .cart .item-qty, .cart .item-price {
      font-size: 1.08em !important;
      font-weight: 600 !important;
      letter-spacing: 0.2px;
  }
  </style>
  <!-- ØªÙƒØ¨ÙŠØ± Ø¹Ù†Ø§ØµØ± Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ (top-bar-stats) -->
  <style>
  /* ØªÙƒØ¨ÙŠØ± Ø¹Ù†Ø§ØµØ± Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ (top-bar-stats) */
  .top-bar-stats, .top-bar-stats .quick-stat-card {
      min-height: 70px;
  }
  .top-bar-stats .quick-stat-card {
      padding: 0.7em 1.2em !important;
      border-radius: 12px !important;
      margin: 0 0.3em !important;
      display: flex;
      align-items: center;
      gap: 1em;
  }

  /* --- ØªØ®ØµÙŠØµ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù„Ø© --- */
.cart-items {
  display: grid !important;
  grid-template-columns: repeat(2, 1fr) !important;
  gap: 0.7em 0.5em !important;
}
.cart-item {
  min-width: 0;
  max-width: 100%;
  font-size: 0.97rem !important;
  padding: 0.45em 0.5em !important;
  margin-bottom: 0.3em !important;
}
.cart-item .item-header h4,
.cart-item .item-info h4 {
  font-size: 1em !important;
}
.cart-item .item-price,
.cart-item .item-total {
  font-size: 0.98em !important;
}
.cart-item .quantity-controls {
  font-size: 0.97em !important;
}
/* --- ØªÙƒØ¨ÙŠØ± Ù†ØµÙˆØµ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ ÙˆØ§Ù„Ø®ØµÙ… ÙˆØ§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø¯ÙŠÙ†Ø§Ø± --- */
.cart-summary .summary-row span:first-child {
  font-size: 1.18em !important;
  font-weight: 600 !important;
}
.cart-summary .summary-value {
  font-size: 1.25em !important;
  font-weight: bold !important;
  color: #0d9488 !important;
  letter-spacing: 0.5px;
}
.cart-summary .total .summary-value {
  font-size: 1.35em !important;
  color: #d97706 !important;
}
.cart-summary .total span:first-child {
  font-size: 1.22em !important;
  color: #d97706 !important;
}
.cart-summary .summary-value {
  direction: ltr;
  unicode-bidi: embed;
}
  .top-bar-stats .quick-stat-icon {
      font-size: 2.1em !important;
      width: 2.2em;
      height: 2.2em;
      display: flex;
      align-items: center;
      justify-content: center;
  }
  .top-bar-stats .quick-stat-label {
      font-size: 1.18em !important;
      font-weight: 800 !important;
      letter-spacing: 0.2px;
  }
  .top-bar-stats .quick-stat-value {
      font-size: 1.35em !important;
      font-weight: 900 !important;
      margin-top: 0.1em;
  }
  /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© */
  .top-bar-stats .digital-clock-card {
      min-width: 170px;
      padding: 0.7em 1.2em !important;
  }
  .top-bar-stats .digital-clock .clock-time {
      font-size: 1.45em !important;
      font-weight: 900 !important;
      letter-spacing: 0.2px;
  }
  .top-bar-stats .digital-clock .clock-date {
      font-size: 1.08em !important;
      font-weight: 700 !important;
  }
  </style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body data-theme="dark">
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØµØµ -->
  <div class="custom-titlebar">
   <div class="titlebar-left">
    <div class="titlebar-controls">
    <button class="titlebar-btn close" title="Ø¥ØºÙ„Ø§Ù‚" onclick="window.electronAPI.windowClose()">
     <i class="fas fa-times"></i>
    </button>
    <button class="titlebar-btn maximize" title="ØªÙƒØ¨ÙŠØ±">
     <i class="fas fa-window-maximize"></i>
    </button>
    <button class="titlebar-btn minimize" title="ØªØµØºÙŠØ±" onclick="window.electronAPI.windowMinimize()">
     <i class="fas fa-window-minimize"></i>
    </button>
    </div>
    <button class="titlebar-refresh" onclick="refreshApp()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©">
     <i class="fas fa-sync-alt"></i>
     <span>ØªØ­Ø¯ÙŠØ«</span>
    </button>
    <button class="titlebar-refresh" onclick="toggleThemeQuick()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø±" style="margin-right: 0.5rem;">
     <i class="fas fa-palette"></i>
     <span>Ø§Ù„Ø«ÙŠÙ…</span>
    </button>
   </div>
   
   <div class="titlebar-center">
    <div class="titlebar-logo">ğŸ’¼</div>
    <span class="titlebar-title">Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ</span>
    <div class="titlebar-clock">
     <i class="fas fa-clock"></i>
     <span id="titlebarClock">00:00:00</span>
    </div>
   </div>
   
    <div class="titlebar-right">
    </div>
  </div>
  
  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
  <div id="appLoader" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--theme-bg-primary);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 99999;
    transition: opacity 0.5s ease;
  ">
    <div style="text-align: center;">
      <div style="
        width: 80px;
        height: 80px;
        border: 4px solid rgba(99, 102, 241, 0.3);
        border-top: 4px solid #6366f1;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      "></div>
      <h2 style="color: var(--theme-text-primary); margin-bottom: 10px;">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...</h2>
      <p id="loaderStatus" style="color: var(--theme-text-secondary); font-size: 14px;">ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
    </div>
  </div>
  
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  
  <div class="animated-bg"></div>
  <div class="app-container"><!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
   <nav class="sidebar" id="sidebar"><button class="sidebar-toggle" id="sidebarToggle"> <i class="fas fa-angle-double-right"></i> </button>
        <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·) -->
        <div id="sidebarSearchBoxWrapper" style="display:none; padding: 10px 16px 0 16px;">
            <div class="search-box" style="margin-bottom: 10px;">
                <input type="text" class="search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…..." id="sidebarSearchInput" onkeyup="filterSidebarNavItems()">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>
    <div class="nav-menu">
     <div class="nav-section">
    <div class="nav-section-title">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
    <div class="nav-item" id="posNavItem"><a class="nav-link active" onclick="showPage('pos')"> <i class="fas fa-cash-register nav-icon"></i> <span class="nav-text">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</span> </a></div>
    <div class="nav-item" id="invoicesNavItem"><a class="nav-link" onclick="showPage('invoices')"> <i class="fas fa-receipt nav-icon"></i> <span class="nav-text">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span> </a></div>
    <div class="nav-item" id="receiptsManagementNavItem"><a class="nav-link" onclick="showPage('receiptsManagement')"> <i class="fas fa-file-invoice-dollar nav-icon"></i> <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª</span> </a></div>
     </div>
     <div class="nav-section">
    <div class="nav-section-title">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
    <div class="nav-item" id="productsNavItem"><a class="nav-link" onclick="showPage('products')"> <i class="fas fa-boxes nav-icon"></i> <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span> </a></div>
    <div class="nav-item" id="inventoryNavItem"><a class="nav-link" onclick="showPage('inventory')"> <i class="fas fa-warehouse nav-icon"></i> <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†</span> </a></div>
     </div>
     <div class="nav-section">
    <div class="nav-section-title">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
    <div class="nav-item" id="debtsNavItem"><a class="nav-link" onclick="showPage('debts')"> <i class="fas fa-credit-card nav-icon"></i> <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†</span> </a></div>
    <div class="nav-item" id="paymentsNavItem"><a class="nav-link" onclick="showPage('payments')"> <i class="fas fa-hand-holding-usd nav-icon"></i> <span class="nav-text">Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª</span> </a></div>
    <div class="nav-item" id="expensesNavItem"><a class="nav-link" onclick="showPage('expenses')"> <i class="fas fa-money-bill-wave nav-icon"></i> <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</span> </a></div>
     </div>
        <div class="nav-item" id="reportsNavItem"><a class="nav-link" onclick="window.reportsManager && window.reportsManager.openReportsModal ? window.reportsManager.openReportsModal() : alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±')"> <i class="fas fa-chart-bar nav-icon"></i> <span class="nav-text">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span> </a></div>
     <div class="nav-section">
    <div class="nav-section-title">Ø§Ù„Ù†Ø¸Ø§Ù…</div>
    <div class="nav-item" id="printerNavItem"><a class="nav-link" onclick="showPage('printer')"> <i class="fas fa-print nav-icon"></i> <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</span> </a></div>
    <div class="nav-item" id="settingsNavItem"><a class="nav-link" onclick="showPage('settings')"> <i class="fas fa-cog nav-icon"></i> <span class="nav-text">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</span> </a></div>
    <!-- <div class="nav-item" id="systemManagementNavItem">
        <a class="nav-link" onclick="openSystemManagement()" style="cursor: pointer;">
            <i class="fas fa-tools nav-icon" style="color:#f59e0b"></i>
            <span class="nav-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­</span>
        </a>
    </div> -->
     </div>
            <div class="nav-item" id="securityNavItem" style="display:none">
                <a class="nav-link" onclick="window.securityManager && window.securityManager.openSecurityPanel ? window.securityManager.openSecurityPanel() : alert('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ©')">
                    <i class="fas fa-shield-alt nav-icon" style="color:#ef4444"></i>
                    <span class="nav-text">Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</span>
                </a>
            </div>
            <div class="nav-item" id="logoutNavItem" style="display:none">
                <a class="nav-link" onclick="window.securityManager && window.securityManager.logout ? window.securityManager.logout() : alert('ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬')">
                    <i class="fas fa-sign-out-alt nav-icon" style="color:#ef4444"></i>
                    <span class="nav-text">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                </a>
            </div>
    <script>
    // Ø¯Ø§Ù„Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
    window.applyPermissionVisibility = function() {
        const map = [
            {id: 'posNavItem', perm: 'sales_view'},
            {id: 'invoicesNavItem', perm: 'sales_view'},
            {id: 'productsNavItem', perm: 'products_view'},
            {id: 'inventoryNavItem', perm: 'inventory_view'},
            {id: 'debtsNavItem', perm: 'debts_view'},
            {id: 'paymentsNavItem', perm: 'debts_view'},
            {id: 'expensesNavItem', perm: 'settings_view'},
            {id: 'reportsNavItem', perm: 'reports_view'},
            {id: 'printerNavItem', perm: 'settings_view'},
            {id: 'settingsNavItem', perm: 'settings_view'}
        ];
        if (!window.securityManager) return;
        // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø­Ø³Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        map.forEach(item => {
            const el = document.getElementById(item.id);
            if (el) {
                if (window.securityManager.hasPermission(item.perm)) {
                    el.style.display = '';
                } else {
                    el.style.display = 'none';
                }
            }
        });
        // Ø²Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙŠØªÙ… Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‡Ù…Ø§ Ù…Ù† updateSidebarButtons

        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙ‚Ø· (ÙˆÙ„ÙŠØ³ Ø§Ù„Ø£Ø¯Ù…Ù†/Ø§Ù„Ù…Ø¯ÙŠØ±)
        const searchBoxWrapper = document.getElementById('sidebarSearchBoxWrapper');
        if (searchBoxWrapper) {
            const user = window.securityManager.currentUser;
            if (user && user.role && user.role !== 'admin' && user.role !== 'manager') {
                searchBoxWrapper.style.display = '';
            } else {
                searchBoxWrapper.style.display = 'none';
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø®ÙØ§Ø¡
                const input = document.getElementById('sidebarSearchInput');
                if (input) input.value = '';
                if (typeof filterSidebarNavItems === 'function') filterSidebarNavItems();
            }
        }
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        if (typeof filterSidebarNavItems === 'function') filterSidebarNavItems();
    };
        // Ø¯Ø§Ù„Ø© ÙÙ„ØªØ±Ø© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø«
        window.filterSidebarNavItems = function() {
            const input = document.getElementById('sidebarSearchInput');
            const filter = input ? input.value.trim() : '';
            const navItems = document.querySelectorAll('.nav-menu .nav-item');
            if (!input || !navItems) return;
            navItems.forEach(item => {
                // ØªØ¬Ø§Ù‡Ù„ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ù…Ø§ÙŠØ©/ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                if (item.id === 'securityNavItem' || item.id === 'logoutNavItem') return;
                // ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±
                let perm = null;
                switch(item.id) {
                    case 'posNavItem': perm = 'sales_view'; break;
                    case 'invoicesNavItem': perm = 'sales_view'; break;
                    case 'productsNavItem': perm = 'products_view'; break;
                    case 'inventoryNavItem': perm = 'inventory_view'; break;
                    case 'debtsNavItem': perm = 'debts_view'; break;
                    case 'paymentsNavItem': perm = 'debts_view'; break;
                    case 'expensesNavItem': perm = 'settings_view'; break;
                    case 'reportsNavItem': perm = 'reports_view'; break;
                    case 'printerNavItem': perm = 'settings_view'; break;
                    case 'settingsNavItem': perm = 'settings_view'; break;
                }
                const hasPerm = perm ? (window.securityManager && window.securityManager.hasPermission(perm)) : true;
                const text = item.innerText || '';
                if (hasPerm && (!filter || text.includes(filter))) {
                    item.style.display = '';
                } else {
                    item.style.display = 'none';
                }
            });
        };
    // Ø§Ø³ØªØ¯Ø¹Ù Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„Ø®Ø±ÙˆØ¬
    if (window.securityManager) {
        const origLogin = window.securityManager.handleLogin;
        window.securityManager.handleLogin = function() {
            const res = origLogin.apply(this, arguments);
            window.applyPermissionVisibility();
            return res;
        };
        const origLogout = window.securityManager.logout;
        window.securityManager.logout = function() {
            const res = origLogout.apply(this, arguments);
            window.applyPermissionVisibility();
            return res;
        };
        window.addEventListener('DOMContentLoaded', window.applyPermissionVisibility);
    }
    </script>
    </div>
   </nav><!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
   <main class="main-content"><!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <div class="top-bar">
     <h1 class="page-title" id="currentPageTitle">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h1>
     
     <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
     <div class="top-bar-stats">
        <!-- Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© -->
        <div class="quick-stat-card digital-clock-card">
          <div class="digital-clock">
            <div class="clock-time" id="digitalClockTime">00:44:03</div>
            <div class="clock-date">
              <span id="digitalClockDay">Ø§Ù„Ø®Ù…ÙŠØ³</span>
              <span id="digitalClockDate">7 Ù†ÙˆÙÙ…Ø¨Ø± 2025</span>
            </div>
          </div>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="quick-stat-card">
          <div class="quick-stat-icon products-icon">
            <i class="fas fa-boxes"></i>
          </div>
          <div class="quick-stat-info">
            <div class="quick-stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
            <div class="quick-stat-value" id="quickTotalProducts">28</div>
          </div>
        </div>
        
        <div class="quick-stat-card">
          <div class="quick-stat-icon value-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="quick-stat-info">
            <div class="quick-stat-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
            <div class="quick-stat-value" id="quickTotalValue">223,830 Ø¯</div>
          </div>
        </div>
        
        <div class="quick-stat-card">
          <div class="quick-stat-icon debts-icon">
            <i class="fas fa-file-invoice-dollar"></i>
          </div>
          <div class="quick-stat-info">
            <div class="quick-stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†</div>
            <div class="quick-stat-value" id="quickDebtsCount">0</div>
          </div>
        </div>
        
        <div class="quick-stat-card">
          <div class="quick-stat-icon debtors-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="quick-stat-info">
            <div class="quick-stat-label">Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†</div>
            <div class="quick-stat-value" id="quickDebtorsCount">0</div>
          </div>
        </div>
        
        <div class="quick-stat-card">
          <div class="quick-stat-icon debt-value-icon">
            <i class="fas fa-hand-holding-usd"></i>
          </div>
          <div class="quick-stat-info">
            <div class="quick-stat-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†</div>
            <div class="quick-stat-value" id="quickDebtsValue">0 Ø¯ÙŠÙ†Ø§Ø±</div>
          </div>
        </div>
     </div>
     
         <div class="top-actions">
            <div class="search-box">
                    <input type="text" class="search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…..." id="globalSearchInput" onkeyup="handleGlobalSearch(event)"> 
                    <i class="fas fa-search search-icon"></i>
                    <div id="searchResults" class="search-results"></div>
            </div>
            <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()"> <i class="fas fa-moon"></i> </button>
         </div>
    </div><!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª -->
    <div class="page-content"><!-- ØµÙØ­Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
     <div id="pos" class="page active">
      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
      <div class="pos-layout">
       <div class="products-section">
        <div class="section-header">
         <div class="section-title"><i class="fas fa-shopping-bag"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
         </div>
         <div class="pos-search-box">
             <i class="fas fa-search"></i>
             <input type="text" id="posSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="filterPOSProducts()">
         </div>
        </div>
        <div class="category-filters" id="categoryFilters">
         <div class="category-btn active" data-category="all"><i class="fas fa-th-large"></i> Ø§Ù„ÙƒÙ„
         </div>
        </div>
        <div class="products-grid" id="productsGrid"><!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
       </div>
       <div class="cart-section">
        <div class="success-message" id="successMessage"><i class="fas fa-check-circle"></i> ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰
        </div>
        
        <!-- âœ… Ø²Ø± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… -->
        <button class="btn btn-info" onclick="showTodaySalesReport()" style="width:100%;margin-bottom:0.8rem;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;padding:0.7rem;font-size:0.95rem;font-weight:700;">
          <i class="fas fa-file-invoice-dollar"></i> 
          <span>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
          <i class="fas fa-chart-line" style="margin-left:0.5rem;"></i>
        </button>
        
        <div class="cart-header">
          <i class="fas fa-shopping-cart"></i> 
          <span class="cart-title">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</span>
          <div class="cart-badge-info">
            <div class="cart-mini-stat">
              <i class="fas fa-boxes"></i>
              <span id="cartItemsCount">0</span>
            </div>
            <div class="cart-mini-stat total-price">
              <i class="fas fa-dollar-sign"></i>
              <span id="cartTotalPrice">0</span>
            </div>
          </div>
        </div>
        <div class="cart-items" id="cartItems">
         <div class="cart-empty"><i class="fas fa-shopping-cart"></i>
          <p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p><small>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§</small>
         </div>
        </div>
        <div class="cart-summary">
         <div class="discount-section"><input type="number" class="discount-input" id="discountInput" placeholder="Ø®ØµÙ… (%)">
         </div>
         <div class="summary-row"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span> <span class="summary-value" id="subtotal">0 Ø¯ÙŠÙ†Ø§Ø±</span>
         </div>
         <div class="summary-row"><span>Ø§Ù„Ø®ØµÙ…:</span> <span class="summary-value" id="discountAmount">0 Ø¯ÙŠÙ†Ø§Ø±</span>
         </div>
         <div class="summary-row"><span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (<span id="taxRate">0</span>%):</span> <span class="summary-value" id="taxAmount">0 Ø¯ÙŠÙ†Ø§Ø±</span>
         </div>
         <div class="summary-row total"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> <span class="summary-value" id="finalTotal">0 Ø¯ÙŠÙ†Ø§Ø±</span>
         </div>
         <div class="payment-actions">
          <button class="payment-action-btn cash-btn" id="cashPaymentBtn" disabled>
            <i class="fas fa-money-bill-wave"></i>
            <span>Ø¯ÙØ¹ Ù†Ù‚Ø¯ÙŠ</span>
          </button>
          <button class="payment-action-btn installment-btn" id="installmentPaymentBtn" disabled>
            <i class="fas fa-calendar-alt"></i>
            <span>Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</span>
          </button>
         </div>
        </div>
       </div>
      </div>
     </div><!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
     <div id="products" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-boxes"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="productsSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª..." onkeyup="filterProducts()">
       </div>
       <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
        <div class="export-import-buttons">
            <button class="export-btn" onclick="if(window.securityManager.checkPermission('products_export')) exportData('products', 'json')" data-permission="products_export"> <i class="fas fa-download"></i> JSON </button> 
            <button class="export-btn" onclick="if(window.securityManager.checkPermission('products_export')) exportData('products', 'excel')" data-permission="products_export"> <i class="fas fa-file-excel"></i> Excel </button> 
            <button class="export-btn" onclick="if(window.securityManager.checkPermission('products_export')) exportData('products', 'pdf')" data-permission="products_export"> <i class="fas fa-file-pdf"></i> PDF </button> 
            <input type="file" id="importProductsFile" accept=".json,.xlsx,.csv" style="display: none;" onchange="if(window.securityManager.checkPermission('products_import')) importData('products')"> 
            <button class="import-btn" onclick="if(window.securityManager.checkPermission('products_import')) document.getElementById('importProductsFile').click()" data-permission="products_import"> <i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ </button>
        </div>
        <button class="btn btn-secondary" onclick="if(window.securityManager.checkPermission('products_add_category')) showAddCategoryModal()" data-permission="products_add_category"> <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ </button> 
        <button class="btn btn-primary" onclick="if(window.securityManager.checkPermission('products_add')) showAddProductModal()" data-permission="products_add"> <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ </button>
       </div>
      </div>
      
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-boxes"></i>
        </div>
        <div class="stat-value" id="totalProducts">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-value" id="totalValue">
         0
        </div>
        <div class="stat-label">
         Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-value" id="lowStockItems">
         0
        </div>
        <div class="stat-label">
         Ù…Ù†ØªØ¬Ø§Øª Ù‚Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-tags"></i>
        </div>
        <div class="stat-value" id="totalCategories">
         0
        </div>
        <div class="stat-label">
         Ø¹Ø¯Ø¯ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        </div>
       </div>
      </div>
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-barcode"></i> Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
          <th><i class="fas fa-tag"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th><i class="fas fa-layer-group"></i> Ø§Ù„ØªØµÙ†ÙŠÙ</th>
          <th><i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
          <th><i class="fas fa-coins"></i> Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©</th>
          <th><i class="fas fa-warehouse"></i> Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th>
          <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="productsTableBody"><!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </tbody>
       </table>
      </div>
     </div><!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù† -->
     <div id="inventory" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-warehouse"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="inventorySearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†..." onkeyup="filterInventory()">
       </div>
       <div class="export-import-buttons">
           <button class="export-btn" onclick="printInventoryReport()"> <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© </button>
           <button class="export-btn" onclick="exportData('inventory', 'json')"> <i class="fas fa-download"></i> JSON </button> 
           <button class="export-btn" onclick="exportData('inventory', 'excel')"> <i class="fas fa-file-excel"></i> Excel </button> 
           <button class="export-btn" onclick="exportData('inventory', 'pdf')"> <i class="fas fa-file-pdf"></i> PDF </button> 
           <input type="file" id="importInventoryFile" accept=".json,.xlsx,.csv" style="display: none;" onchange="importData('inventory')"> 
           <button class="import-btn" onclick="document.getElementById('importInventoryFile').click()"> <i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ </button>
       </div>
      </div>
      
      <div class="filters-section" style="margin-bottom: 1.5rem;">
       <div class="filters-grid">
        <div class="form-group"><label class="form-label">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</label> <select class="form-select" id="inventoryCategory"> <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option> </select>
        </div>
        <div class="form-group"><label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label> <select class="form-select" id="stockStatus"> <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option> <option value="in-stock">Ù…ØªÙˆÙØ±</option> <option value="low-stock">Ù…Ø®Ø²ÙˆÙ† Ù‚Ù„ÙŠÙ„</option> <option value="out-of-stock">Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</option> </select>
        </div>
       </div>
      </div>
      <div class="stats-grid">
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-value" id="totalProfit">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-chart-pie"></i>
        </div>
        <div class="stat-value" id="totalCost">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-balance-scale"></i>
        </div>
        <div class="stat-value" id="profitMargin">
         0%
        </div>
        <div class="stat-label">
         Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­
        </div>
       </div>
      </div>
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-tag"></i> Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th><i class="fas fa-layer-group"></i> Ø§Ù„ØªØµÙ†ÙŠÙ</th>
          <th><i class="fas fa-warehouse"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th><i class="fas fa-coins"></i> Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
          <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th>
          <th><i class="fas fa-chart-line"></i> Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
          <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="inventoryTableBody"><!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù† Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </tbody>
       </table>
      </div>
     </div><!-- ØµÙØ­Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
     <div id="invoices" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-receipt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="invoicesSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±..." onkeyup="filterInvoices()">
       </div>
       <div class="export-import-buttons">
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('reports_export')) exportData('invoices', 'json')" data-permission="reports_export"> <i class="fas fa-download"></i> JSON </button> 
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('reports_export')) exportData('invoices', 'excel')" data-permission="reports_export"> <i class="fas fa-file-excel"></i> Excel </button> 
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('reports_export')) exportData('invoices', 'pdf')" data-permission="reports_export"> <i class="fas fa-file-pdf"></i> PDF </button> 
           <input type="file" id="importInvoicesFile" accept=".json,.xlsx,.csv" style="display: none;" onchange="importData('invoices')"> 
           <button class="import-btn" onclick="document.getElementById('importInvoicesFile').click()" data-permission="settings_restore" style="display: none;"> <i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ </button>
       </div>
      </div>
      
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-receipt"></i>
        </div>
        <div class="stat-value" id="totalInvoices">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-value" id="totalSales">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-calendar-day"></i>
        </div>
        <div class="stat-value" id="todaySales">
         0
        </div>
        <div class="stat-label">
         Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
        </div>
       </div>
      </div>
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
          <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th><i class="fas fa-user"></i> Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th><i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
          <th><i class="fas fa-user-tag"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="invoicesTableBody"><!-- Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </tbody>
       </table>
      </div>
     </div><!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† -->
     
     <!-- âœ… ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª -->
     <div id="receiptsManagement" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-file-invoice-dollar"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="receiptsSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª..." onkeyup="filterReceipts()">
       </div>
       <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
        <div class="export-import-buttons">
            <button class="export-btn" onclick="exportData('receipts', 'json')"> <i class="fas fa-download"></i> JSON </button> 
            <button class="export-btn" onclick="exportData('receipts', 'excel')"> <i class="fas fa-file-excel"></i> Excel </button> 
            <button class="export-btn" onclick="exportData('receipts', 'pdf')"> <i class="fas fa-file-pdf"></i> PDF </button> 
        </div>
        <select id="receiptsDateFilter" class="filter-select" onchange="filterReceipts()">
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</option>
          <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
          <option value="yesterday">Ø§Ù„Ø£Ù…Ø³</option>
          <option value="thisWeek">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
          <option value="thisMonth">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
          <option value="custom">ØªØ§Ø±ÙŠØ® Ù…Ø®ØµØµ</option>
        </select>
        <select id="receiptsTypeFilter" class="filter-select" onchange="filterReceipts()">
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
          <option value="Ù†Ù‚Ø¯ÙŠ">Ù†Ù‚Ø¯ÙŠ</option>
          <option value="Ø£Ù‚Ø³Ø§Ø·">Ø£Ù‚Ø³Ø§Ø·</option>
        </select>
        <select id="receiptsUserFilter" class="filter-select" onchange="filterReceipts()">
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>
        </select>
        <button class="btn btn-primary" onclick="mergeReceipts()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
          <i class="fas fa-compress-alt"></i> Ø¯Ù…Ø¬ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…
        </button>
       </div>
      </div>
      
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i class="fas fa-file-invoice"></i>
        </div>
        <div class="stat-value" id="totalReceipts">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);"><i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="stat-value" id="totalCashReceipts">
         0
        </div>
        <div class="stat-label">
         Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠ
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-value" id="totalInstallmentReceipts">
         0
        </div>
        <div class="stat-label">
         Ù…Ø¨ÙŠØ¹Ø§Øª Ø£Ù‚Ø³Ø§Ø·
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #FA8BFF 0%, #2BD2FF 90%, #2BFF88 100%);"><i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-value" id="totalReceiptsAmount">
         0
        </div>
        <div class="stat-label">
         Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        </div>
       </div>
      </div>
      
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ø¥ÙŠØµØ§Ù„</th>
          <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th><i class="fas fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª</th>
          <th><i class="fas fa-user"></i> Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th><i class="fas fa-credit-card"></i> Ø§Ù„Ù†ÙˆØ¹</th>
          <th><i class="fas fa-user-tag"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th><i class="fas fa-layer-group"></i> Ù…Ø¯Ù…Ø¬</th>
          <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="receiptsTableBody"><!-- Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </tbody>
       </table>
      </div>
     </div>
     
     <div id="debts" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-credit-card"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="debtsSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†..." onkeyup="filterDebts()">
       </div>
       <div class="export-import-buttons">
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('debts_export')) exportData('debts', 'json')" data-permission="debts_export"> <i class="fas fa-download"></i> JSON </button> 
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('debts_export')) exportData('debts', 'excel')" data-permission="debts_export"> <i class="fas fa-file-excel"></i> Excel </button> 
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('debts_export')) exportData('debts', 'pdf')" data-permission="debts_export"> <i class="fas fa-file-pdf"></i> PDF </button> 
           <input type="file" id="importDebtsFile" accept=".json,.xlsx,.csv" style="display: none;" onchange="importData('debts')"> 
           <button class="import-btn" onclick="document.getElementById('importDebtsFile').click()" data-permission="settings_restore" style="display: none;"> <i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ </button>
       </div>
       <button class="btn btn-primary" onclick="showAddManualDebtModal()" style="margin-right: 1rem;"> <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ </button>
      </div>
      
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card" onclick="filterDebtsByStatus('all')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†">
        <div class="stat-icon"><i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="stat-value" id="totalDebts">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†
        </div>
       </div>
       <div class="stat-card" onclick="filterDebtsByStatus('active')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ø´Ø·Ø©">
        <div class="stat-icon"><i class="fas fa-users"></i>
        </div>
        <div class="stat-value" id="debtCustomers">
         0
        </div>
        <div class="stat-label">
         Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        </div>
       </div>
       <div class="stat-card" onclick="filterDebtsByStatus('overdue')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©">
        <div class="stat-icon"><i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-value" id="overdueDebts">
         0
        </div>
        <div class="stat-label">
         Ø¯ÙŠÙˆÙ† Ù…ØªØ£Ø®Ø±Ø©
        </div>
       </div>
       <div class="stat-card" onclick="filterDebtsByStatus('paid')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©">
        <div class="stat-icon"><i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-value" id="paidDebts">
         0
        </div>
        <div class="stat-label">
         Ø¯ÙŠÙˆÙ† Ù…Ø³Ø¯Ø¯Ø©
        </div>
       </div>
      </div>
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
          <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
          <th><i class="fas fa-calendar-alt"></i> Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</th>
          <th><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
          <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="debtsTableBody"><!-- Ø§Ù„Ø¯ÙŠÙˆÙ† Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </tbody>
       </table>
      </div>
     </div><!-- ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
     <div id="debtDetailsPage" class="page">
      <div class="section-header">
       <div class="section-title">
        <button class="btn btn-secondary" onclick="navigateTo('debts')" style="margin-left: 10px;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
        </button>
        <i class="fas fa-user-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø¯ÙŠÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„
       </div>
      </div>
      
      <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
      <div class="stats-grid" id="debtCustomerInfo">
       <!-- Ø³ØªØ¸Ù‡Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‡Ù†Ø§ -->
      </div>
      
      <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙŠÙ† -->
      <div class="stat-card" id="debtSummaryCard" style="margin: 20px 0; padding: 30px;">
       <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙŠÙ† -->
      </div>
      
      <!-- Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© -->
      <div class="card" style="margin: 20px 0;">
       <h3 style="margin-bottom: 20px; color: var(--primary-color);"><i class="fas fa-file-invoice"></i> Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</h3>
       <div id="debtInvoiceDetails">
        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
       </div>
      </div>
      
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØ© -->
      <div class="card" style="margin: 20px 0;">
       <h3 style="margin-bottom: 20px; color: var(--primary-color);"><i class="fas fa-calendar-alt"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
       <div class="table-container">
        <table class="table">
         <thead>
          <tr>
           <th><i class="fas fa-hashtag"></i> Ø§Ù„Ø´Ù‡Ø±</th>
           <th><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
           <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
           <th><i class="fas fa-check-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
           <th><i class="fas fa-calendar-check"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>
           <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
         </thead>
         <tbody id="installmentsTableBody">
          <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
         </tbody>
        </table>
       </div>
      </div>
      
      <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª -->
      <div class="card" style="margin: 20px 0;">
       <h3 style="margin-bottom: 20px; color: var(--primary-color);"><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª</h3>
       <div class="table-container">
        <table class="table">
         <thead>
          <tr>
           <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
           <th><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…Ø¨Ù„Øº</th>
           <th><i class="fas fa-hashtag"></i> Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø³Ø¯Ø¯</th>
           <th><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          </tr>
         </thead>
         <tbody id="paymentsHistoryBody">
          <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
     
     <!-- ğŸ’µ ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© -->
     <div id="payments" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-hand-holding-usd"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="paymentsSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª..." onkeyup="filterPayments()">
       </div>
       <div class="export-import-buttons">
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('debts_export')) exportPaymentsAsJSON()" data-permission="debts_export"> <i class="fas fa-download"></i> JSON </button> 
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('debts_export')) exportPaymentsAsExcel()" data-permission="debts_export"> <i class="fas fa-file-excel"></i> Excel </button> 
           <button class="export-btn" onclick="if(window.securityManager.checkPermission('debts_export')) exportPaymentsAsPDF()" data-permission="debts_export"> <i class="fas fa-file-pdf"></i> PDF </button> 
       </div>
       <button class="btn btn-primary" onclick="refreshPaymentsPage()" style="margin-right: 1rem;"> <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª </button>
      </div>
      
      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card" onclick="filterPaymentsByStatus('all')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª">
        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i class="fas fa-list"></i></div>
        <div class="stat-value" id="totalPaymentsCount">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</div>
       </div>
       <div class="stat-card" onclick="filterPaymentsByStatus('paid')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©">
        <div class="stat-icon" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);"><i class="fas fa-check-circle"></i></div>
        <div class="stat-value" id="paidPaymentsCount">0</div>
        <div class="stat-label">Ø£Ù‚Ø³Ø§Ø· Ù…Ø³Ø¯Ø¯Ø©</div>
       </div>
       <div class="stat-card" onclick="filterPaymentsByStatus('overdue')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©">
        <div class="stat-icon" style="background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="stat-value" id="overduePaymentsCount">0</div>
        <div class="stat-label">Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ£Ø®Ø±Ø©</div>
       </div>
       <div class="stat-card" onclick="filterPaymentsByStatus('upcoming')" style="cursor: pointer;" title="Ø¹Ø±Ø¶ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><i class="fas fa-clock"></i></div>
        <div class="stat-value" id="upcomingPaymentsCount">0</div>
        <div class="stat-label">Ø£Ù‚Ø³Ø§Ø· Ù‚Ø§Ø¯Ù…Ø©</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"><i class="fas fa-money-bill-wave"></i></div>
        <div class="stat-value" id="totalPaidAmount">0 Ø¯</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø¯Ø¯</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"><i class="fas fa-hourglass-half"></i></div>
        <div class="stat-value" id="totalRemainingAmount">0 Ø¯</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
       </div>
      </div>
      
      <!-- ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø© -->
      <div class="filter-section" style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px solid var(--theme-border-color);">
       <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <i class="fas fa-filter" style="color: var(--primary-color); font-size: 1.2rem;"></i>
        <h3 style="margin: 0; color: var(--text-primary); font-size: 1.1rem; font-weight: 600;">Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
       </div>
       
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† -->
        <div class="form-group">
         <label for="paymentsDateFrom" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
          <i class="fas fa-calendar-alt" style="color: var(--primary-color);"></i>
          <span>Ù…Ù† ØªØ§Ø±ÙŠØ®</span>
         </label>
         <input type="date" id="paymentsDateFrom" class="form-control" onchange="applyPaymentsFilters()">
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ -->
        <div class="form-group">
         <label for="paymentsDateTo" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
          <i class="fas fa-calendar-alt" style="color: var(--primary-color);"></i>
          <span>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</span>
         </label>
         <input type="date" id="paymentsDateTo" class="form-control" onchange="applyPaymentsFilters()">
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="form-group">
         <label for="paymentsStatusFilter" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
          <i class="fas fa-tasks" style="color: var(--primary-color);"></i>
          <span>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯</span>
         </label>
         <select id="paymentsStatusFilter" class="form-control" onchange="applyPaymentsFilters()">
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="paid">Ù…Ø³Ø¯Ø¯</option>
          <option value="overdue">Ù…ØªØ£Ø®Ø±</option>
          <option value="upcoming">Ù‚Ø§Ø¯Ù…</option>
          <option value="pending">Ù…Ø¹Ù„Ù‚</option>
         </select>
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ±ØªÙŠØ¨ -->
        <div class="form-group">
         <label for="paymentsSortFilter" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
          <i class="fas fa-sort" style="color: var(--primary-color);"></i>
          <span>ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨</span>
         </label>
         <select id="paymentsSortFilter" class="form-control" onchange="applyPaymentsFilters()">
          <option value="date_desc">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
          <option value="date_asc">Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹</option>
          <option value="amount_desc">Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£ÙˆÙ„Ø§Ù‹)</option>
          <option value="amount_asc">Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø£Ù‚Ù„ Ø£ÙˆÙ„Ø§Ù‹)</option>
          <option value="customer_asc">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø£-ÙŠ)</option>
          <option value="customer_desc">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (ÙŠ-Ø£)</option>
         </select>
        </div>
       </div>
       
       <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
       <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© -->
        <button class="btn btn-secondary" onclick="resetPaymentsFilters()">
         <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
        </button>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
        <button class="btn btn-info" onclick="exportPaymentsReport()">
         <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
        </button>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
        <div class="dropdown" style="position: relative; display: inline-block;">
         <button class="btn btn-primary" onclick="togglePrintMenu()" style="display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-print"></i> Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
          <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
         </button>
         <div id="printMenuDropdown" style="display: none; position: absolute; background: var(--theme-bg-primary); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 250px; z-index: 1000; margin-top: 5px;">
          <div style="padding: 8px 0;">
           <button onclick="printCompletePaymentsReport(); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-file-invoice" style="width: 20px; color: #667eea;"></i>
            <span>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ù…Ù„</span>
           </button>
           
           <div style="height: 1px; background: var(--border-color); margin: 5px 0;"></div>
           
           <button onclick="printPaymentsStat('total'); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-list-ol" style="width: 20px; color: #667eea;"></i>
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</span>
           </button>
           
           <button onclick="printPaymentsStat('paid'); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-check-circle" style="width: 20px; color: #10b981;"></i>
            <span>Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</span>
           </button>
           
           <button onclick="printPaymentsStat('overdue'); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-exclamation-triangle" style="width: 20px; color: #ef4444;"></i>
            <span>Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</span>
           </button>
           
           <button onclick="printPaymentsStat('upcoming'); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-clock" style="width: 20px; color: #f59e0b;"></i>
            <span>Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</span>
           </button>
           
           <button onclick="printPaymentsStat('paidAmount'); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-money-bill-wave" style="width: 20px; color: #06b6d4;"></i>
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</span>
           </button>
           
           <button onclick="printPaymentsStat('remainingAmount'); togglePrintMenu();" style="width: 100%; text-align: right; padding: 10px 15px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; gap: 10px; color: var(--text-primary); transition: background 0.2s;" onmouseover="this.style.background='var(--theme-bg-secondary)'" onmouseout="this.style.background='transparent'">
            <i class="fas fa-coins" style="width: 20px; color: #8b5cf6;"></i>
            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</span>
           </button>
          </div>
         </div>
        </div>
        
        <script>
         // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
         function togglePrintMenu() {
          const menu = document.getElementById('printMenuDropdown');
          if (menu) {
           menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
          }
         }
         
         // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
         document.addEventListener('click', function(event) {
          const menu = document.getElementById('printMenuDropdown');
          const printBtn = event.target.closest('.dropdown');
          if (menu && !printBtn && menu.style.display === 'block') {
           menu.style.display = 'none';
          }
         });
        </script>
       </div>
      </div>
      
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª -->
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø·</th>
          <th><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th><i class="fas fa-money-bill-wave"></i> Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø³Ø·</th>
          <th><i class="fas fa-calendar-alt"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
          <th><i class="fas fa-calendar-check"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¯ÙŠØ¯</th>
          <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="paymentsTableBody">
         <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </tbody>
       </table>
       <div id="noPaymentsMessage" style="display: none; text-align: center; padding: 3rem; color: var(--text-secondary);">
        <i class="fas fa-inbox" style="font-size: 4rem; color: var(--text-secondary); opacity: 0.3; margin-bottom: 1rem;"></i>
        <p style="font-size: 1.2rem; font-weight: 600;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¯ÙŠØ¯Ø§Øª</p>
        <p style="font-size: 0.95rem;">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙˆÙ† Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù‡Ù†Ø§</p>
       </div>
      </div>
      
      <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
      <div style="background: var(--info-bg); color: var(--info-color); padding: 1rem; border-radius: 8px; margin-top: 1.5rem; border: 1px solid var(--info-border);">
       <div style="display: flex; align-items: center; gap: 0.75rem;">
        <i class="fas fa-info-circle" style="font-size: 1.5rem;"></i>
        <div>
         <strong>Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…ÙÙŠØ¯Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„ÙÙ„ØªØ±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©. ÙƒÙ…Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø¨Ø§Ø¹Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ù„ÙƒÙ„ Ù‚Ø³Ø· Ù…Ø³Ø¯Ø¯.
        </div>
       </div>
      </div>
     </div>
     
     <!-- ğŸ’° ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© -->
     <div id="payments" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-hand-holding-usd"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="paymentsSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„ØŒ Ø±Ù‚Ù… Ù‡Ø§ØªÙ..." onkeyup="filterPayments()">
       </div>
       <button class="btn btn-success" onclick="refreshPaymentsPage()" style="margin-right: 1rem;">
         <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
       </button>
      </div>
      
      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card" onclick="filterPaymentsByStatus('all')" style="cursor: pointer;" title="Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª">
        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-value" id="totalPaymentsCount">
         0
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        </div>
       </div>
       
       <div class="stat-card" onclick="filterPaymentsByStatus('paid')" style="cursor: pointer;" title="Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©">
        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"><i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-value" id="paidPaymentsCount">
         0
        </div>
        <div class="stat-label">
         Ø£Ù‚Ø³Ø§Ø· Ù…Ø³Ø¯Ø¯Ø©
        </div>
       </div>
       
       <div class="stat-card" onclick="filterPaymentsByStatus('overdue')" style="cursor: pointer;" title="Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©">
        <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"><i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-value" id="overduePaymentsCount">
         0
        </div>
        <div class="stat-label">
         Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ£Ø®Ø±Ø©
        </div>
       </div>
       
       <div class="stat-card" onclick="filterPaymentsByStatus('upcoming')" style="cursor: pointer;" title="Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"><i class="fas fa-clock"></i>
        </div>
        <div class="stat-value" id="upcomingPaymentsCount">
         0
        </div>
        <div class="stat-label">
         Ø£Ù‚Ø³Ø§Ø· Ù‚Ø§Ø¯Ù…Ø©
        </div>
       </div>
       
       <div class="stat-card" style="cursor: default;">
        <div class="stat-icon" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);"><i class="fas fa-money-bill-wave"></i>
        </div>
        <div class="stat-value" id="totalPaidAmount">
         0 Ø¯
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©
        </div>
       </div>
       
       <div class="stat-card" style="cursor: default;">
        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);"><i class="fas fa-coins"></i>
        </div>
        <div class="stat-value" id="totalRemainingAmount">
         0 Ø¯
        </div>
        <div class="stat-label">
         Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
        </div>
       </div>
      </div>
      
      <!-- ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø© -->
      <div class="card" style="margin-bottom: 1.5rem; padding: 20px;">
       <h3 style="margin-bottom: 15px; color: var(--primary-color); display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-filter"></i> ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
       </h3>
       
       <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
        <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† -->
        <div class="form-group">
         <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
          <i class="fas fa-calendar-day"></i> Ù…Ù† ØªØ§Ø±ÙŠØ®:
         </label>
         <input type="date" id="paymentsDateFrom" class="form-control" onchange="applyPaymentsFilters()">
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ -->
        <div class="form-group">
         <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
          <i class="fas fa-calendar-day"></i> Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:
         </label>
         <input type="date" id="paymentsDateTo" class="form-control" onchange="applyPaymentsFilters()">
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="form-group">
         <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
          <i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©:
         </label>
         <select id="paymentsStatusFilter" class="form-control" onchange="applyPaymentsFilters()">
          <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="paid">Ù…Ø³Ø¯Ø¯Ø©</option>
          <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
          <option value="overdue">Ù…ØªØ£Ø®Ø±Ø©</option>
          <option value="upcoming">Ù‚Ø§Ø¯Ù…Ø©</option>
         </select>
        </div>
        
        <!-- ÙÙ„ØªØ± Ø§Ù„ØªØ±ØªÙŠØ¨ -->
        <div class="form-group">
         <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
          <i class="fas fa-sort"></i> ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:
         </label>
         <select id="paymentsSortFilter" class="form-control" onchange="applyPaymentsFilters()">
          <option value="date_desc">Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)</option>
          <option value="date_asc">Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹)</option>
          <option value="amount_desc">Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø£ÙƒØ¨Ø± Ø£ÙˆÙ„Ø§Ù‹)</option>
          <option value="amount_asc">Ø§Ù„Ù…Ø¨Ù„Øº (Ø§Ù„Ø£ØµØºØ± Ø£ÙˆÙ„Ø§Ù‹)</option>
          <option value="customer_asc">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø£-ÙŠ)</option>
          <option value="customer_desc">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (ÙŠ-Ø£)</option>
         </select>
        </div>
       </div>
       
       <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
       <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
        <button class="btn btn-secondary" onclick="resetPaymentsFilters()">
         <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
        </button>
        <button class="btn btn-info" onclick="exportPaymentsReport()">
         <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Excel
        </button>
        <button class="btn btn-primary" onclick="printPaymentsReport()">
         <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        </button>
       </div>
      </div>
      
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª -->
      <div class="table-container">
       <table class="table">
        <thead>
         <tr>
          <th><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <th><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
          <th><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø·</th>
          <th><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
          <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
          <th><i class="fas fa-calendar-check"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>
          <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
         </tr>
        </thead>
        <tbody id="paymentsTableBody">
         <tr>
          <td colspan="8" style="text-align: center; padding: 30px;">
           <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: var(--primary-color);"></i>
           <p style="margin-top: 10px; color: var(--text-secondary);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª...</p>
          </td>
         </tr>
        </tbody>
       </table>
      </div>
      
      <!-- Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª -->
      <div id="noPaymentsMessage" style="display: none; text-align: center; padding: 50px; background: var(--theme-bg-secondary); border-radius: 12px; margin-top: 20px;">
       <i class="fas fa-inbox" style="font-size: 48px; color: var(--text-secondary); opacity: 0.5;"></i>
       <p style="margin-top: 15px; font-size: 18px; color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ù…ØªØ§Ø­Ø©</p>
       <p style="color: var(--text-secondary); opacity: 0.7;">Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙˆÙ† Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ù‡Ù†Ø§</p>
      </div>
     </div>
     
     <!-- ğŸ’° ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø§Ù…Ù„Ø© -->
     <div id="expenses" class="page">
      <div class="section-header" style="margin-bottom: 1.5rem;">
       <div class="section-title"><i class="fas fa-money-bill-wave"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
       </div>
       <div class="pos-search-box">
           <i class="fas fa-search"></i>
           <input type="text" id="expensesSearchInput" class="pos-search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ..." onkeyup="filterExpenses()">
       </div>
       <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
        <div class="export-import-buttons">
            <button class="export-btn" onclick="exportData('expenses', 'json')"> <i class="fas fa-download"></i> JSON </button> 
            <button class="export-btn" onclick="exportData('expenses', 'excel')"> <i class="fas fa-file-excel"></i> Excel </button> 
            <button class="export-btn" onclick="exportData('expenses', 'pdf')"> <i class="fas fa-file-pdf"></i> PDF </button>
        </div>
        <button class="btn btn-success" onclick="showAddExpenseModal()"> <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ </button>
        <button class="btn btn-primary" onclick="showAddPurchaseModal()"> <i class="fas fa-cart-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª </button>
       </div>
      </div>
      
      <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© -->
      <div class="stats-grid" style="margin-bottom: 1.5rem;">
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-money-bill-wave"></i></div>
        <div class="stat-value" id="totalExpensesAmount">0 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-shopping-cart"></i></div>
        <div class="stat-value" id="totalPurchasesAmount">0 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
        <div class="stat-value" id="monthlyExpensesAmount">0 Ø¯ÙŠÙ†Ø§Ø±</div>
        <div class="stat-label">Ù…ØµØ§Ø±ÙŠÙ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-receipt"></i></div>
        <div class="stat-value" id="totalExpensesCount">0</div>
        <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
       </div>
      </div>
      
      <!-- Tabs Ù„Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
      <div class="expense-tabs">
       <button class="expense-tab-btn active" onclick="switchExpenseTab('general')">
        <i class="fas fa-money-bill-wave"></i> Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¹Ø§Ù…Ø©
       </button>
       <button class="expense-tab-btn" onclick="switchExpenseTab('purchases')">
        <i class="fas fa-shopping-cart"></i> ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
       </button>
       <button class="expense-tab-btn" onclick="switchExpenseTab('reports')">
        <i class="fas fa-chart-line"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
       </button>
      </div>
      
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¹Ø§Ù…Ø© -->
      <div id="generalExpensesTab" class="expense-tab-content active">
       <div class="table-container">
        <table class="table">
         <thead>
          <tr>
           <th><i class="fas fa-hashtag"></i> #</th>
           <th><i class="fas fa-list"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
           <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº</th>
           <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
           <th><i class="fas fa-sticky-note"></i> Ø§Ù„ÙˆØµÙ</th>
           <th><i class="fas fa-user"></i> Ø§Ù„Ù…Ø¶Ø§Ù Ø¨ÙˆØ§Ø³Ø·Ø©</th>
           <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
         </thead>
         <tbody id="generalExpensesTableBody">
          <!-- Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¹Ø§Ù…Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
         </tbody>
        </table>
       </div>
      </div>
      
      <!-- ØªØ¨ÙˆÙŠØ¨ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
      <div id="purchasesTab" class="expense-tab-content">
       <div class="table-container">
        <table class="table">
         <thead>
          <tr>
           <th><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
           <th><i class="fas fa-building"></i> Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯</th>
           <th><i class="fas fa-phone"></i> Ù‡Ø§ØªÙ Ø§Ù„Ù…ÙˆØ±Ø¯</th>
           <th><i class="fas fa-money-bill"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</th>
           <th><i class="fas fa-boxes"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
           <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
           <th><i class="fas fa-cogs"></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
         </thead>
         <tbody id="purchasesTableBody">
          <!-- ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
         </tbody>
        </table>
       </div>
      </div>
      
      <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
      <div id="reportsTab" class="expense-tab-content">
       <!-- ÙÙ„ØªØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
       <div class="reports-filters">
        <div class="filter-group">
         <label><i class="fas fa-calendar"></i> Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</label>
         <select id="reportsPeriodFilter" onchange="updateExpensesReports()">
          <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
          <option value="week">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
          <option value="month" selected>Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
          <option value="year">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…</option>
          <option value="custom">ÙØªØ±Ø© Ù…Ø®ØµØµØ©</option>
         </select>
        </div>
        <div class="filter-group" id="customDateRangeGroup" style="display: none;">
         <label>Ù…Ù†:</label>
         <input type="date" id="reportsDateFrom">
         <label>Ø¥Ù„Ù‰:</label>
         <input type="date" id="reportsDateTo">
         <button class="btn btn-primary" onclick="updateExpensesReports()">ØªØ·Ø¨ÙŠÙ‚</button>
        </div>
       </div>
       
       <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
       <div class="stats-grid" style="margin: 2rem 0;">
        <div class="stat-card">
         <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);"><i class="fas fa-money-bill-wave"></i></div>
         <div class="stat-value" id="reportTotalExpenses">0 Ø¯ÙŠÙ†Ø§Ø±</div>
         <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</div>
        </div>
        <div class="stat-card">
         <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);"><i class="fas fa-shopping-cart"></i></div>
         <div class="stat-value" id="reportTotalPurchases">0 Ø¯ÙŠÙ†Ø§Ø±</div>
         <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
        </div>
        <div class="stat-card">
         <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"><i class="fas fa-home"></i></div>
         <div class="stat-value" id="reportRentExpenses">0 Ø¯ÙŠÙ†Ø§Ø±</div>
         <div class="stat-label">Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</div>
        </div>
        <div class="stat-card">
         <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);"><i class="fas fa-bolt"></i></div>
         <div class="stat-value" id="reportUtilitiesExpenses">0 Ø¯ÙŠÙ†Ø§Ø±</div>
         <div class="stat-label">Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡/Ø§Ù„Ù…Ø§Ø¡</div>
        </div>
       </div>
       
       <!-- Ø¬Ø¯ÙˆÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…ØµØ§Ø±ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ -->
       <div class="card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-chart-pie"></i> ØªÙØµÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹</h3>
        <div class="table-container">
         <table class="table">
          <thead>
           <tr>
            <th><i class="fas fa-list"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
            <th><i class="fas fa-hashtag"></i> Ø§Ù„Ø¹Ø¯Ø¯</th>
            <th><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            <th><i class="fas fa-percent"></i> Ø§Ù„Ù†Ø³Ø¨Ø©</th>
           </tr>
          </thead>
          <tbody id="expensesByTypeTableBody">
           <!-- Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
          </tbody>
         </table>
        </div>
       </div>
       
       <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© -->
       <div class="card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-boxes"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</h3>
        <div class="table-container">
         <table class="table">
          <thead>
           <tr>
            <th><i class="fas fa-box"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th><i class="fas fa-building"></i> Ø§Ù„Ù…ÙˆØ±Ø¯</th>
            <th><i class="fas fa-sort-numeric-up"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th><i class="fas fa-money-bill"></i> Ø§Ù„Ø³Ø¹Ø±</th>
            <th><i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
           </tr>
          </thead>
          <tbody id="purchasedProductsTableBody">
           <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
          </tbody>
         </table>
        </div>
       </div>
      </div>
     </div>
     
     <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© -->
     <div id="printer" class="page">
      <div class="section-header">
       <div class="section-title"><i class="fas fa-print"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
       </div>
       <div style="display: flex; gap: 1rem;">
        <button class="btn btn-primary" onclick="testPrintReceipt()">
         <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        </button>
        <button class="btn btn-success" onclick="savePrinterSettings()">
         <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </button>
        <button class="btn btn-secondary" onclick="resetPrinterSettings()">
         <i class="fas fa-undo"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        </button>
        <button class="btn btn-info" onclick="refreshPrintersList()">
         <i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª
        </button>
       </div>
      </div>

      <div class="stats-grid">
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-print"></i></div>
        <div class="stat-value" id="totalPrints">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹Ø§Øª</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
        <div class="stat-value" id="todayPrints">0</div>
        <div class="stat-label">Ù…Ø·Ø¨ÙˆØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-cog"></i></div>
        <div class="stat-value" id="activePrinterType">A4</div>
        <div class="stat-label">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ù†Ø´Ø·</div>
       </div>
       <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-receipt"></i></div>
        <div class="stat-value" id="activeTemplateType">Ù†Ù‚Ø¯ÙŠ</div>
        <div class="stat-label">Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù†Ø´Ø·</div>
       </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØµÙ„Ø© -->
      <div class="table-container" style="margin-top: 2rem;">
       <div style="padding: 1.5rem;">
        <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
         <i class="fas fa-printer"></i> Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØµÙ„Ø©
        </h3>
        <div id="connectedPrintersList" style="min-height: 100px;">
         <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
          <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i>
          <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØµÙ„Ø©...</p>
         </div>
        </div>
       </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
      <div style="display: grid; grid-template-columns: 400px 1fr; gap: 2rem; margin-top: 2rem;">
       
       <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
       <div class="table-container" style="height: fit-content;">
        <div style="padding: 1.5rem;">
         <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨
         </h3>

         <!-- Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ -->
         <div class="form-group">
          <label class="form-label">
           <i class="fas fa-file-invoice"></i> Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨
          </label>
          <select class="form-select" id="receiptTemplate" onchange="updateReceiptPreview()">
           <option value="cash">Ø¥ÙŠØµØ§Ù„ Ù†Ù‚Ø¯ÙŠ</option>
           <option value="installment">Ø¥ÙŠØµØ§Ù„ ØªÙ‚Ø³ÙŠØ·</option>
          </select>
         </div>

         <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© -->
         <div class="form-group">
          <label class="form-label">
           <i class="fas fa-print"></i> Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø©
          </label>
          <select class="form-select" id="selectedPrinter">
           <option value="">Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</option>
          </select>
         </div>

         <!-- Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© -->
         <div class="form-group">
          <label class="form-label">
           <i class="fas fa-print"></i> Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
          </label>
          <select class="form-select" id="printerType" onchange="updateReceiptPreview()">
           <option value="a4">Ø·Ø§Ø¨Ø¹Ø© A4</option>
           <option value="thermal-80">Ø·Ø§Ø¨Ø¹Ø© Ø­Ø±Ø§Ø±ÙŠØ© 80mm</option>
           <option value="thermal-58">Ø·Ø§Ø¨Ø¹Ø© Ø­Ø±Ø§Ø±ÙŠØ© 58mm</option>
          </select>
         </div>

         <hr style="margin: 1.5rem 0; border-color: var(--border-color);">

         <!-- Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· -->
         <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-text-height"></i> Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ·
         </h4>

         <!-- Ø­Ø¬Ù… Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø± -->
         <div class="form-group">
          <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø± (px)</label>
          <input type="range" class="form-range" id="storeTitleSize" min="14" max="32" value="24" 
                 oninput="updateReceiptPreview(); document.getElementById('storeTitleSizeValue').textContent = this.value">
          <span id="storeTitleSizeValue" style="font-weight: bold;">24</span>
         </div>

         <!-- Ø­Ø¬Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± -->
         <div class="form-group">
          <label class="form-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (px)</label>
          <input type="range" class="form-range" id="storeInfoSize" min="10" max="20" value="14" 
                 oninput="updateReceiptPreview(); document.getElementById('storeInfoSizeValue').textContent = this.value">
          <span id="storeInfoSizeValue" style="font-weight: bold;">14</span>
         </div>

         <!-- Ø­Ø¬Ù… Ù†Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
         <div class="form-group">
          <label class="form-label">Ù†Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (px)</label>
          <input type="range" class="form-range" id="invoiceTextSize" min="10" max="18" value="13" 
                 oninput="updateReceiptPreview(); document.getElementById('invoiceTextSizeValue').textContent = this.value">
          <span id="invoiceTextSizeValue" style="font-weight: bold;">13</span>
         </div>

         <!-- Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
         <div class="form-group">
          <label class="form-label">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (px)</label>
          <input type="range" class="form-range" id="tableTextSize" min="10" max="18" value="12" 
                 oninput="updateReceiptPreview(); document.getElementById('tableTextSizeValue').textContent = this.value">
          <span id="tableTextSizeValue" style="font-weight: bold;">12</span>
         </div>

         <!-- Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
         <div class="form-group">
          <label class="form-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (px)</label>
          <input type="range" class="form-range" id="totalTextSize" min="12" max="22" value="16" 
                 oninput="updateReceiptPreview(); document.getElementById('totalTextSizeValue').textContent = this.value">
          <span id="totalTextSizeValue" style="font-weight: bold;">16</span>
         </div>

         <hr style="margin: 1.5rem 0; border-color: var(--border-color);">

         <!-- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥ÙŠØµØ§Ù„ -->
         <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-paint-brush"></i> ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥ÙŠØµØ§Ù„
         </h4>

         <!-- Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø·Ø± -->
         <div class="form-group">
          <label class="form-label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø·Ø±</label>
          <input type="range" class="form-range" id="lineHeight" min="1" max="2" step="0.1" value="1.4" 
                 oninput="updateReceiptPreview(); document.getElementById('lineHeightValue').textContent = this.value">
          <span id="lineHeightValue" style="font-weight: bold;">1.4</span>
         </div>

         <!-- Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
         <div class="form-group">
          <label class="form-label">Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (px)</label>
          <input type="range" class="form-range" id="sidePadding" min="5" max="30" value="15" 
                 oninput="updateReceiptPreview(); document.getElementById('sidePaddingValue').textContent = this.value">
          <span id="sidePaddingValue" style="font-weight: bold;">15</span>
         </div>

         <hr style="margin: 1.5rem 0; border-color: var(--border-color);">

         <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
         <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-sliders-h"></i> Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
         </h4>

         <!-- Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª -->
         <div class="form-group">
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
           <input type="checkbox" id="showDateTime" checked onchange="updateReceiptPreview()">
           <span>Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</span>
          </label>
         </div>

         <!-- Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
         <div class="form-group">
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
           <input type="checkbox" id="showInvoiceNumber" checked onchange="updateReceiptPreview()">
           <span>Ø¥Ø¸Ù‡Ø§Ø± Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
          </label>
         </div>

         <!-- Ù†Øµ Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ -->
         <div class="form-group">
          <label class="form-label">Ù†Øµ Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ</label>
          <textarea class="form-control" id="customFooter" rows="2" 
                    placeholder="Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…" oninput="updateReceiptPreview()"></textarea>
         </div>

         <hr style="margin: 1.5rem 0; border-color: var(--border-color);">

         <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± -->
         <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-store"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
         </h4>

         <!-- Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± -->
         <div class="form-group">
          <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
          <input type="text" class="form-control" id="storeName" 
                 value="Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©"
                 placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±" oninput="updateReceiptPreview()">
         </div>

         <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø± -->
         <div class="form-group">
          <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø±</label>
          <input type="text" class="form-control" id="storeAddress" 
                 value="Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±"
                 placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" oninput="updateReceiptPreview()">
         </div>

         <!-- Ù‡Ø§ØªÙ Ø§Ù„Ù…ØªØ¬Ø± -->
         <div class="form-group">
          <label class="form-label">Ù‡Ø§ØªÙ Ø§Ù„Ù…ØªØ¬Ø±</label>
          <input type="text" class="form-control" id="storePhone" 
                 value="07803092185"
                 placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" oninput="updateReceiptPreview()">
         </div>

         <!-- Ù…Ø³Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ -->
         <div class="form-group">
          <label class="form-label">Ù…Ø³Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ</label>
          <input type="text" class="form-control" id="storeLogo" 
                 value="yaqoub_logo.png"
                 placeholder="Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù„ÙˆØ¬Ùˆ" oninput="updateReceiptPreview()">
          <small style="color: var(--text-secondary); font-size: 0.85rem;">
           Ø¶Ø¹ Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆØ§ÙƒØªØ¨ Ø§Ø³Ù…Ù‡Ø§ Ù‡Ù†Ø§
          </small>
         </div>

         <!-- Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ -->
         <div class="form-group">
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
           <input type="checkbox" id="showLogo" checked onchange="updateReceiptPreview()">
           <span>Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø§Ù„Ø¥ÙŠØµØ§Ù„</span>
          </label>
         </div>

         <hr style="margin: 1.5rem 0; border-color: var(--border-color);">

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
         <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-sticky-note"></i> Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù‡Ø§Ù…Ø©
         </h4>

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© 1 -->
         <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© 1</label>
          <input type="text" class="form-control" id="note1" 
                 value="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ùˆ ÙˆØµÙ„ Ø£Ù…Ø§Ù†Ø©"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© 2 -->
         <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© 2</label>
          <input type="text" class="form-control" id="note2" 
                 value="Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù…ÙŠ 24 Ø³Ø§Ø¹Ø©"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© 3 -->
         <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© 3</label>
          <input type="text" class="form-control" id="note3" 
                 value="Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù„Ø§ ÙŠØ±Ø¬Ø¹ ÙˆÙ„Ø§ ÙŠØ¨Ø¯Ù„"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© 4 -->
         <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© 4</label>
          <input type="text" class="form-control" id="note4" 
                 value="Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ù‡Ùˆ Ù…Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø·Ø±ÙÙŠÙ†"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© 5 -->
         <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© 5</label>
          <input type="text" class="form-control" id="note5" 
                 value="Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¶Ù…Ø§Ù†"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© 6 -->
         <div class="form-group">
          <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© 6</label>
          <input type="text" class="form-control" id="note6" 
                 value="ÙƒØ³Ø± Ø§Ù„Ø´Ø§Ø´Ø© ØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø¨Ø§Ù„Ø¶Ù…Ø§Ù†"
                 oninput="updateReceiptPreview()">
         </div>

         <hr style="margin: 1.5rem 0; border-color: var(--border-color);">

         <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
         <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
          <i class="fas fa-tools"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
         </h4>

         <!-- Ø§Ø³Ù… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø© -->
         <div class="form-group">
          <label class="form-label">Ø§Ø³Ù… Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
          <input type="text" class="form-control" id="maintenanceName" 
                 value="Ø­Ù…Ø²Ù‡ Ø§Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© -->
         <div class="form-group">
          <label class="form-label">Ù†ÙˆØ¹ Ø®Ø¯Ù…Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
          <input type="text" class="form-control" id="maintenanceService" 
                 value="ØµÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø¨Ø§Ù„Øª"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ù‡Ø§ØªÙ Ø§Ù„ØµÙŠØ§Ù†Ø© -->
         <div class="form-group">
          <label class="form-label">Ù‡Ø§ØªÙ Ø§Ù„ØµÙŠØ§Ù†Ø©</label>
          <input type="text" class="form-control" id="maintenancePhone" 
                 value="+964 785 570 6118"
                 oninput="updateReceiptPreview()">
         </div>

         <!-- Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
         <div class="form-group">
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
           <input type="checkbox" id="showMaintenance" checked onchange="updateReceiptPreview()">
           <span>Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</span>
          </label>
         </div>

        </div>
       </div>

       <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø© -->
       <div class="table-container">
        <div style="padding: 1.5rem;">
         <h3 style="margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: space-between;">
          <span><i class="fas fa-eye"></i> Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</span>
          <span style="font-size: 0.9rem; color: var(--text-secondary);">
           ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ
          </span>
         </h3>
         
         <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
         <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 12px; display: flex; justify-content: center; align-items: flex-start; min-height: 600px; max-height: 800px; overflow-y: auto;">
          <div id="receiptPreview" style="background: white; color: black; box-shadow: 0 10px 40px rgba(0,0,0,0.2); border-radius: 4px; max-width: 100%; overflow: hidden;">
           <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§ -->
          </div>
         </div>

        </div>
       </div>

      </div>

     </div>

     <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
     <div id="settings" class="page">
      <div class="section-header" style="margin-bottom: 2rem;">
       <div class="section-title"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
       <div class="section-subtitle">Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù† Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</div>
      </div>

      <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù… -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div class="info-mini-card">
          <div class="info-mini-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
            <i class="fas fa-box"></i>
          </div>
          <div class="info-mini-content">
            <div class="info-mini-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
            <div class="info-mini-value" id="settingsProductCount">0</div>
          </div>
        </div>
        
        <div class="info-mini-card">
          <div class="info-mini-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
            <i class="fas fa-layer-group"></i>
          </div>
          <div class="info-mini-content">
            <div class="info-mini-label">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</div>
            <div class="info-mini-value" id="settingsCategoryCount">0</div>
          </div>
        </div>
        
        <div class="info-mini-card">
          <div class="info-mini-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
            <i class="fas fa-receipt"></i>
          </div>
          <div class="info-mini-content">
            <div class="info-mini-label">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
            <div class="info-mini-value" id="settingsInvoiceCount">0</div>
          </div>
        </div>
        
        <div class="info-mini-card">
          <div class="info-mini-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
            <i class="fas fa-money-bill-wave"></i>
          </div>
          <div class="info-mini-content">
            <div class="info-mini-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
            <div class="info-mini-value" id="settingsSalesValue">0 Ø¯.Ø¹</div>
          </div>
        </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <div style="margin-bottom: 2rem;">
        <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
          <span style="width: 4px; height: 24px; background: var(--primary-gradient); border-radius: 2px;"></span>
          <i class="fas fa-sliders-h"></i>
          Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem;">
          
          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± -->
          <div class="settings-card" onclick="showSettingsPage('store')">
            <div class="settings-card-icon store-icon">
              <i class="fas fa-store"></i>
            </div>
            <div class="settings-card-content">
              <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
              <p>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ ÙˆØ§Ù„ÙØ±ÙˆØ¹</p>
            </div>
            <div class="settings-card-arrow">
              <i class="fas fa-chevron-left"></i>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
          <div class="settings-card" onclick="showSettingsPage('system')">
            <div class="settings-card-icon system-icon">
              <i class="fas fa-desktop"></i>
            </div>
            <div class="settings-card-content">
              <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
              <p>Ø§Ù„Ù…Ø¸Ù‡Ø±ØŒ Ø§Ù„Ù„ØºØ©ØŒ Ø§Ù„Ø¹Ù…Ù„Ø© ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</p>
            </div>
            <div class="settings-card-arrow">
              <i class="fas fa-chevron-left"></i>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
          <div class="settings-card" onclick="showSettingsPage('printing')">
            <div class="settings-card-icon printing-icon">
              <i class="fas fa-print"></i>
            </div>
            <div class="settings-card-content">
              <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
              <p>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª</p>
            </div>
            <div class="settings-card-arrow">
              <i class="fas fa-chevron-left"></i>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
          <div class="settings-card" onclick="showSettingsPage('account')">
            <div class="settings-card-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
              <i class="fas fa-user-circle"></i>
            </div>
            <div class="settings-card-content">
              <h3>Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
              <p>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø´Ø±ÙƒØ©</p>
            </div>
            <div class="settings-card-arrow">
              <i class="fas fa-chevron-left"></i>
            </div>
          </div>

        </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
      <div style="margin-bottom: 2rem;">
        <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
          <span style="width: 4px; height: 24px; background: var(--primary-gradient); border-radius: 2px;"></span>
          <i class="fas fa-database"></i>
          Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem;">
          
          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
          <div class="settings-card" onclick="showSettingsPage('backup')">
            <div class="settings-card-icon backup-icon">
              <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="settings-card-content">
              <h3>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h3>
              <p>Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            </div>
            <div class="settings-card-arrow">
              <i class="fas fa-chevron-left"></i>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† -->
          <div class="settings-card" onclick="showSettingsPage('security')">
            <div class="settings-card-icon security-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <div class="settings-card-content">
              <h3>Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©</h3>
              <p>ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
            </div>
            <div class="settings-card-arrow">
              <i class="fas fa-chevron-left"></i>
            </div>
          </div>

        </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
      <div style="margin-bottom: 2rem;">
        <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
          <span style="width: 4px; height: 24px; background: var(--primary-gradient); border-radius: 2px;"></span>
          <i class="fas fa-chart-line"></i>
          Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
          
          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
          <div class="stat-overview-card">
            <div class="stat-overview-header">
              <div class="stat-overview-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                <i class="fas fa-warehouse"></i>
              </div>
              <h4>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h4>
            </div>
            <div class="stat-overview-body">
              <div class="stat-overview-item">
                <span>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</span>
                <strong id="activeProductsCount">0</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø§Ø±Ø¨Øª Ø§Ù„Ù†ÙØ§Ø°</span>
                <strong id="lowStockCount" style="color: #fbbf24;">0</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ù…Ù†ØªØ¬Ø§Øª Ù†ÙØ°Øª</span>
                <strong id="outOfStockCount" style="color: #ef4444;">0</strong>
              </div>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
          <div class="stat-overview-card">
            <div class="stat-overview-header">
              <div class="stat-overview-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                <i class="fas fa-chart-bar"></i>
              </div>
              <h4>Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h4>
            </div>
            <div class="stat-overview-body">
              <div class="stat-overview-item">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span>
                <strong id="totalInvoicesCount">0</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                <strong id="totalSalesAmount">0 Ø¯.Ø¹</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
                <strong id="averageInvoice">0 Ø¯.Ø¹</strong>
              </div>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† -->
          <div class="stat-overview-card">
            <div class="stat-overview-header">
              <div class="stat-overview-icon" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                <i class="fas fa-file-invoice-dollar"></i>
              </div>
              <h4>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†</h4>
            </div>
            <div class="stat-overview-body">
              <div class="stat-overview-item">
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†</span>
                <strong id="totalDebtorsCount">0</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†</span>
                <strong id="totalDebtsAmount">0 Ø¯.Ø¹</strong>
              </div>
                            <div class="stat-overview-item">
                                <span>Ø¯ÙŠÙˆÙ† Ù…ØªØ£Ø®Ø±Ø©</span>
                                <strong id="overdueDebtsCount" style="color: #ef4444;">0</strong>
                            </div>
                            <div class="stat-overview-item">
                                <span>Ø¯ÙŠÙˆÙ† Ù…Ø´Ø¯Ø¯Ø©</span>
                                <strong id="severeDebtsCount" style="color: #b91c1c;">0</strong>
                            </div>
            </div>
          </div>

          <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
          <div class="stat-overview-card">
            <div class="stat-overview-header">
              <div class="stat-overview-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                <i class="fas fa-info-circle"></i>
              </div>
              <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
            </div>
            <div class="stat-overview-body">
              <div class="stat-overview-item">
                <span>Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
                <strong>v2.0.0</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</span>
                <strong id="lastBackupDate">Ù„Ø§ ØªÙˆØ¬Ø¯</strong>
              </div>
              <div class="stat-overview-item">
                <span>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                <strong style="color: #22c55e;">
                  <i class="fas fa-check-circle"></i> ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø¬ÙŠØ¯
                </strong>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
      <div>
        <h3 style="font-size: 1.3rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
          <span style="width: 4px; height: 24px; background: var(--primary-gradient); border-radius: 2px;"></span>
          <i class="fas fa-bolt"></i>
          Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          
          <button class="quick-action-btn" onclick="showSettingsPage('backup')" style="background: linear-gradient(135deg, #667eea, #764ba2);">
            <i class="fas fa-download"></i>
            <span>ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
          </button>

          <button class="quick-action-btn" onclick="window.print()" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
            <i class="fas fa-print"></i>
            <span>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span>
          </button>

          <button class="quick-action-btn" onclick="refreshApp()" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
            <i class="fas fa-sync-alt"></i>
            <span>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
          </button>

          <button class="quick-action-btn" onclick="showSettingsPage('system')" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
            <i class="fas fa-palette"></i>
            <span>ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±</span>
          </button>

        </div>
      </div>

     </div>

     <!-- ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± -->
     <div id="settings-store" class="page" style="display: none;">
      <div class="section-header">
       <button class="btn btn-secondary" onclick="showPage('settings')" style="margin-left: 1rem;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
       </button>
       <div class="section-title"><i class="fas fa-store"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</div>
      </div>

      <div class="settings-full-width">
        <div class="settings-content-wrapper">
          
          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-info-circle"></i> Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            </h3>
            
            <div class="form-group">
              <label class="form-label"><i class="fas fa-store"></i> Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
              <input type="text" class="form-input" id="settingsStoreName" placeholder="Ø§Ø³Ù… Ù…ØªØ¬Ø±Ùƒ">
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</label>
              <input type="text" class="form-input" id="settingsOwnerName" placeholder="Ø§Ø³Ù… Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…ØªØ¬Ø±">
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-file-alt"></i> Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
              <input type="text" class="form-input" id="settingsCommercialReg" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ">
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-certificate"></i> Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</label>
              <input type="text" class="form-input" id="settingsTaxNumber" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ù„Ù„Ù…ØªØ¬Ø±">
            </div>
          </div>

          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-address-card"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
            </h3>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <textarea class="form-input" id="settingsStoreAddress" rows="3" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© - Ø§Ù„Ø­ÙŠ - Ø§Ù„Ø´Ø§Ø±Ø¹"></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div class="form-group">
                <label class="form-label"><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 1</label>
                <input type="tel" class="form-input" id="settingsStorePhone1" placeholder="07XXXXXXXXX">
              </div>

              <div class="form-group">
                <label class="form-label"><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ 2</label>
                <input type="tel" class="form-input" id="settingsStorePhone2" placeholder="07XXXXXXXXX">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="email" class="form-input" id="settingsStoreEmail" placeholder="info@store.com">
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fab fa-whatsapp"></i> Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
              <input type="tel" class="form-input" id="settingsWhatsapp" placeholder="07XXXXXXXXX">
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-globe"></i> Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="url" class="form-input" id="settingsWebsite" placeholder="https://yourstore.com">
            </div>
          </div>

          <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-dollar-sign"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            </h3>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-percentage"></i> Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (%)</label>
              <input type="number" class="form-input" id="settingsTaxRate" value="0" min="0" max="100" step="0.1">
              <small style="color: var(--theme-text-secondary); margin-top: 0.5rem; display: block;">
                Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
              </small>
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-coins"></i> Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
              <select class="form-select" id="settingsDefaultCurrency">
                <option value="IQD">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ (IQD)</option>
                <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                <option value="GBP">Ø¬Ù†ÙŠÙ‡ Ø§Ø³ØªØ±Ù„ÙŠÙ†ÙŠ (GBP)</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-money-bill"></i> Ø£Ù‚Ù„ Ù…Ø¨Ù„Øº Ù„Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ù…ÙˆØ­</label>
              <input type="number" class="form-input" id="settingsMinDebtAmount" value="0">
            </div>
          </div>

          <!-- Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-clock"></i> Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„
            </h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div class="form-group">
                <label class="form-label">ÙˆÙ‚Øª Ø§Ù„ÙØªØ­</label>
                <input type="time" class="form-input" id="settingsOpenTime" value="09:00">
              </div>

              <div class="form-group">
                <label class="form-label">ÙˆÙ‚Øª Ø§Ù„Ø¥ØºÙ„Ø§Ù‚</label>
                <input type="time" class="form-input" id="settingsCloseTime" value="22:00">
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ø·Ù„</label>
              <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="checkbox" id="closedFriday" style="width: auto;">
                  <span>Ø§Ù„Ø¬Ù…Ø¹Ø©</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="checkbox" id="closedSaturday" style="width: auto;">
                  <span>Ø§Ù„Ø³Ø¨Øª</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Ø§Ù„Ø´Ø¹Ø§Ø± -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-image"></i> Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø±
            </h3>

            <div class="form-group">
              <label class="form-label">Ø±ÙØ¹ Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø±</label>
              <input type="file" class="form-input" id="settingsStoreLogo" accept="image/*">
              <small style="color: var(--theme-text-secondary); margin-top: 0.5rem; display: block;">
                Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø´Ø¹Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹Ø© (ÙŠÙØ¶Ù„ ØµÙˆØ±Ø© Ø¨Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© PNG)
              </small>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" onclick="saveStoreSettings()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn btn-secondary" onclick="showPage('settings')">
              <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>

        </div>
      </div>
     </div>

     <!-- ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
     <div id="settings-system" class="page" style="display: none;">
      <div class="section-header">
       <button class="btn btn-secondary" onclick="showPage('settings')" style="margin-left: 1rem;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
       </button>
       <div class="section-title"><i class="fas fa-desktop"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      </div>

      <div class="settings-full-width">
        <div class="settings-content-wrapper">
          
          <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¸Ù‡Ø± -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-palette"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¸Ù‡Ø±
            </h3>

            <div class="form-group">
              <label class="form-label">Ø§Ø®ØªØ± Ù…Ø¸Ù‡Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <select class="form-select" id="themeSelect" onchange="changeTheme(this.value)" style="font-size: 1rem;">
                <optgroup label="Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©">
                  <option value="dark">ğŸŒ™ Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ø¯Ø§ÙƒÙ† (ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ)</option>
                  <option value="light">â˜€ï¸ Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„ÙØ§ØªØ­ (ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ)</option>
                </optgroup>
                
                <optgroup label="Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ø¯Ø§ÙƒÙ†Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø©">
                  <option value="blue-dark">ğŸ”µ Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† (Blue Dark)</option>
                  <option value="green-dark">ğŸ’š Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† (Green Dark)</option>
                  <option value="orange-dark">ğŸ§¡ Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¯Ø§ÙƒÙ† (Orange Dark)</option>
                  <option value="purple-dark">ğŸ’œ Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¯Ø§ÙƒÙ† (Purple Dark)</option>
                  <option value="red-dark">â¤ï¸ Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ† (Red Dark)</option>
                  <option value="olive">ğŸŸ¢ Ø²ÙŠØªÙˆÙ†ÙŠ Ø¯Ø§ÙƒÙ† (Olive)</option>
                  <option value="royal-blue">ğŸ”´ Ø£Ø²Ø±Ù‚ Ù…Ù„ÙƒÙŠ (Royal Blue)</option>
                </optgroup>
                
                <optgroup label="Ø§Ù„Ø«ÙŠÙ…Ø§Øª Ø§Ù„ÙØ§ØªØ­Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø©">
                  <option value="cyan-light">ğŸ©µ Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­ (Cyan Light)</option>
                  <option value="gold-light">ğŸŸ¡ Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ (Gold Light)</option>
                  <option value="pink-light">ğŸŒ¸ ÙˆØ±Ø¯ÙŠ ÙØ§ØªØ­ (Pink Light)</option>
                </optgroup>
              </select>
              <small style="color: var(--theme-text-secondary); margin-top: 0.5rem; display: block;">
                Ø§Ø®ØªØ± Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…ÙØ¶Ù„ - Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙˆØ±Ø§Ù‹
              </small>
              
              <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø«ÙŠÙ…Ø§Øª -->
              <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 0.75rem; margin-top: 1rem; padding: 1rem; background: var(--theme-bg-hover); border-radius: 12px;">
                <button onclick="changeTheme('dark')" class="theme-preview-btn" style="background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); color: #e8e8e8;" title="Ø§Ù„Ø¯Ø§ÙƒÙ† Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ">
                  ğŸŒ™
                </button>
                <button onclick="changeTheme('light')" class="theme-preview-btn" style="background: linear-gradient(135deg, #f5f5f0 0%, #ffffff 100%); color: #1a1a1a; border: 1px solid #d8d8d8;" title="Ø§Ù„ÙØ§ØªØ­ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ">
                  â˜€ï¸
                </button>
                <button onclick="changeTheme('blue-dark')" class="theme-preview-btn" style="background: linear-gradient(135deg, #0a1628 0%, #152238 100%); color: #e1f0ff;" title="Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ†">
                  ğŸ”µ
                </button>
                <button onclick="changeTheme('green-dark')" class="theme-preview-btn" style="background: linear-gradient(135deg, #0a1f0f 0%, #14321f 100%); color: #d1fae5;" title="Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ†">
                  ğŸ’š
                </button>
                <button onclick="changeTheme('orange-dark')" class="theme-preview-btn" style="background: linear-gradient(135deg, #1f1208 0%, #351e18 100%); color: #ffe4d1;" title="Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¯Ø§ÙƒÙ†">
                  ğŸ§¡
                </button>
                <button onclick="changeTheme('purple-dark')" class="theme-preview-btn" style="background: linear-gradient(135deg, #1a0a28 0%, #2e1542 100%); color: #f0d1ff;" title="Ø¨Ù†ÙØ³Ø¬ÙŠ Ø¯Ø§ÙƒÙ†">
                  ğŸ’œ
                </button>
                <button onclick="changeTheme('red-dark')" class="theme-preview-btn" style="background: linear-gradient(135deg, #280a0a 0%, #421515 100%); color: #ffd1d1;" title="Ø£Ø­Ù…Ø± Ø¯Ø§ÙƒÙ†">
                  â¤ï¸
                </button>
                <button onclick="changeTheme('cyan-light')" class="theme-preview-btn" style="background: linear-gradient(135deg, #e0f7fa 0%, #ffffff 100%); color: #0e2933; border: 1px solid #b0dce5;" title="Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­">
                  ğŸ©µ
                </button>
                <button onclick="changeTheme('gold-light')" class="theme-preview-btn" style="background: linear-gradient(135deg, #fffbea 0%, #ffffff 100%); color: #2a2008; border: 1px solid #e8d89b;" title="Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­">
                  ğŸŸ¡
                </button>
                <button onclick="changeTheme('pink-light')" class="theme-preview-btn" style="background: linear-gradient(135deg, #fce7f3 0%, #ffffff 100%); color: #2d081f; border: 1px solid #f5c0dd;" title="ÙˆØ±Ø¯ÙŠ ÙØ§ØªØ­">
                  ğŸŒ¸
                </button>
                <button onclick="changeTheme('olive')" class="theme-preview-btn" style="background: linear-gradient(135deg, #1a1f0a 0%, #2e3515 100%); color: #e8f0d1;" title="Ø²ÙŠØªÙˆÙ†ÙŠ">
                  ğŸŸ¢
                </button>
                <button onclick="changeTheme('royal-blue')" class="theme-preview-btn" style="background: linear-gradient(135deg, #0c1445 0%, #162270 100%); color: #d6e4ff;" title="Ø£Ø²Ø±Ù‚ Ù…Ù„ÙƒÙŠ">
                  ğŸ”´
                </button>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
              <select class="form-select" id="colorSchemeSelect" onchange="previewColorScheme(this.value)">
                <option value="default">Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¨Ù†ÙØ³Ø¬ÙŠ ÙˆØ±Ø¯ÙŠ)</option>
                <option value="blue">Ø£Ø²Ø±Ù‚ Ø¹ØµØ±ÙŠ ğŸ’™</option>
                <option value="green">Ø£Ø®Ø¶Ø± Ø·Ø¨ÙŠØ¹ÙŠ ğŸ’š</option>
                <option value="orange">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¯Ø§ÙØ¦ ğŸ§¡</option>
                <option value="red">Ø£Ø­Ù…Ø± Ù†Ø§Ø±ÙŠ â¤ï¸</option>
                <option value="purple">Ø¨Ù†ÙØ³Ø¬ÙŠ Ù…Ù„ÙƒÙŠ ğŸ’œ</option>
                <option value="cyan">Ø³Ù…Ø§ÙˆÙŠ Ù…Ù†Ø¹Ø´ ğŸ©µ</option>
                <option value="amber">ÙƒÙ‡Ø±Ù…Ø§Ù†ÙŠ Ø°Ù‡Ø¨ÙŠ ğŸŸ¡</option>
                <option value="teal">ØªØ±ÙƒÙˆØ§Ø² Ù‡Ø§Ø¯Ø¦ ğŸ”µ</option>
              </select>
              <small style="color: var(--theme-text-secondary); margin-top: 0.5rem; display: block;">
                Ø§Ø®ØªØ± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ø¯ÙŠÙƒ - Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
              </small>
            </div>

            <div class="form-group">
              <label class="form-label">ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</label>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1rem;">
                
                <div>
                  <label style="font-size: 0.875rem; color: var(--theme-text-secondary); display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-palette"></i> Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                  </label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="color" id="primaryColorPicker" value="#6366f1" style="width: 60px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                    <input type="text" id="primaryColorInput" value="#6366f1" class="form-input" style="flex: 1;" placeholder="#6366f1">
                  </div>
                </div>

                <div>
                  <label style="font-size: 0.875rem; color: var(--theme-text-secondary); display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-palette"></i> Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ
                  </label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="color" id="secondaryColorPicker" value="#8b5cf6" style="width: 60px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                    <input type="text" id="secondaryColorInput" value="#8b5cf6" class="form-input" style="flex: 1;" placeholder="#8b5cf6">
                  </div>
                </div>

                <div>
                  <label style="font-size: 0.875rem; color: var(--theme-text-secondary); display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-check-circle"></i> Ù„ÙˆÙ† Ø§Ù„Ù†Ø¬Ø§Ø­
                  </label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="color" id="successColorPicker" value="#10b981" style="width: 60px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                    <input type="text" id="successColorInput" value="#10b981" class="form-input" style="flex: 1;" placeholder="#10b981">
                  </div>
                </div>

                <div>
                  <label style="font-size: 0.875rem; color: var(--theme-text-secondary); display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-exclamation-triangle"></i> Ù„ÙˆÙ† Ø§Ù„ØªØ­Ø°ÙŠØ±
                  </label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="color" id="warningColorPicker" value="#f59e0b" style="width: 60px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                    <input type="text" id="warningColorInput" value="#f59e0b" class="form-input" style="flex: 1;" placeholder="#f59e0b">
                  </div>
                </div>

                <div>
                  <label style="font-size: 0.875rem; color: var(--theme-text-secondary); display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-times-circle"></i> Ù„ÙˆÙ† Ø§Ù„Ø®Ø·Ø±
                  </label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="color" id="dangerColorPicker" value="#ef4444" style="width: 60px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                    <input type="text" id="dangerColorInput" value="#ef4444" class="form-input" style="flex: 1;" placeholder="#ef4444">
                  </div>
                </div>

                <div>
                  <label style="font-size: 0.875rem; color: var(--theme-text-secondary); display: block; margin-bottom: 0.5rem;">
                    <i class="fas fa-info-circle"></i> Ù„ÙˆÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                  </label>
                  <div style="display: flex; gap: 0.5rem; align-items: center;">
                    <input type="color" id="infoColorPicker" value="#3b82f6" style="width: 60px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                    <input type="text" id="infoColorInput" value="#3b82f6" class="form-input" style="flex: 1;" placeholder="#3b82f6">
                  </div>
                </div>

              </div>
              <button class="btn btn-secondary" onclick="resetDefaultColors()" style="margin-top: 1rem;">
                <i class="fas fa-undo"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
              </button>
            </div>

            <div class="form-group">
              <label class="form-label">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</label>
              <select class="form-select" id="fontSizeSelect">
                <option value="small">ØµØºÙŠØ±</option>
                <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                <option value="large">ÙƒØ¨ÙŠØ±</option>
              </select>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="compactModeCheck" style="width: auto;">
                <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯Ù…Ø¬ (Ø¹Ø±Ø¶ Ø£ÙƒØ«Ø± ÙƒØ«Ø§ÙØ©)</span>
              </label>
            </div>
          </div>

          <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-language"></i> Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚
            </h3>

            <div class="form-group">
              <label class="form-label">Ù„ØºØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
              <select class="form-select" id="languageSelect">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡®ğŸ‡¶</option>
                <option value="en">English ğŸ‡¬ğŸ‡§</option>
                <option value="ku">ÙƒÙˆØ±Ø¯ÛŒ ğŸ´</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
              <select class="form-select" id="dateFormatSelect">
                <option value="DD/MM/YYYY">ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©</option>
                <option value="MM/DD/YYYY">Ø´Ù‡Ø±/ÙŠÙˆÙ…/Ø³Ù†Ø©</option>
                <option value="YYYY-MM-DD">Ø³Ù†Ø©-Ø´Ù‡Ø±-ÙŠÙˆÙ…</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª</label>
              <select class="form-select" id="timeFormatSelect">
                <option value="12">12 Ø³Ø§Ø¹Ø© (AM/PM)</option>
                <option value="24">24 Ø³Ø§Ø¹Ø©</option>
              </select>
            </div>
          </div>

          <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-tachometer-alt"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
            </h3>

            <div class="form-group">
              <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©</label>
              <select class="form-select" id="itemsPerPageSelect">
                <option value="10">10 Ø¹Ù†Ø§ØµØ±</option>
                <option value="25" selected>25 Ø¹Ù†ØµØ±</option>
                <option value="50">50 Ø¹Ù†ØµØ±</option>
                <option value="100">100 Ø¹Ù†ØµØ±</option>
              </select>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="animationsCheck" checked style="width: auto;">
                <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="autosaveCheck" checked style="width: auto;">
                <span>Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚</span>
              </label>
            </div>
          </div>

          <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-cash-register"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
            </h3>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="barcodeSound" checked style="width: auto;">
                <span>ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¹Ù†Ø¯ Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="autoPrint" style="width: auto;">
                <span>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="clearCartAfterSale" checked style="width: auto;">
                <span>Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹</span>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" onclick="saveSystemSettings()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn btn-secondary" onclick="showPage('settings')">
              <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>

        </div>
      </div>
     </div>

     <!-- ØµÙØ­Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
     <div id="settings-backup" class="page" style="display: none;">
      <div class="section-header">
       <button class="btn btn-secondary" onclick="showPage('settings')" style="margin-left: 1rem;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
       </button>
       <div class="section-title"><i class="fas fa-database"></i> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
      </div>

      <div class="settings-full-width">
        <div class="settings-content-wrapper">
          
          <!-- Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-download"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            </h3>

            <div style="background: rgba(34, 197, 94, 0.1); border-right: 4px solid #22c55e; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <h4 style="color: #22c55e; margin-bottom: 0.5rem;">
                <i class="fas fa-info-circle"></i> Ù†ØµÙŠØ­Ø© Ù…Ù‡Ù…Ø©
              </h4>
              <p style="color: var(--theme-text-secondary); line-height: 1.6;">
                Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ (ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø£Ùˆ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹) Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¢Ù…Ù†Ø©.
              </p>
            </div>

                        <div style="display: grid; gap: 1rem;">
                            <button class="btn btn-success" onclick="systemExportBackup('full')" style="padding: 1.5rem; font-size: 1.1rem;">
                                <i class="fas fa-download"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø©
                            </button>

                            <button class="btn" style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 1.5rem;" onclick="systemExportBackup('selective')">
                                <i class="fas fa-database"></i> Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø· (Ù…Ù†ØªØ¬Ø§ØªØŒ ÙÙˆØ§ØªÙŠØ±ØŒ Ø¯ÙŠÙˆÙ†)
                            </button>
                        </div>
          </div>

          <!-- Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-upload"></i> Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            </h3>

            <div style="background: rgba(251, 191, 36, 0.1); border-right: 4px solid #fbbf24; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <h4 style="color: #fbbf24; margin-bottom: 0.5rem;">
                <i class="fas fa-exclamation-triangle"></i> ØªØ­Ø°ÙŠØ±
              </h4>
              <p style="color: var(--theme-text-secondary); line-height: 1.6;">
                Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©.
              </p>
            </div>

            <input type="file" id="backupFileInput" accept=".json" style="display: none;" onchange="handleBackupRestore(event)">
            
            <button class="btn btn-warning" onclick="document.getElementById('backupFileInput').click()" style="width: 100%; padding: 1.5rem; font-size: 1.1rem;">
              <i class="fas fa-upload"></i> Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            </button>
          </div>

          <!-- Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-clock"></i> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            </h3>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="autoBackupEnabled" style="width: auto;">
                <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</span>
              </label>
            </div>

            <div class="form-group">
              <label class="form-label">ØªÙƒØ±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</label>
              <select class="form-select" id="autoBackupFrequency">
                <option value="daily">ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</option>
                <option value="monthly">Ø´Ù‡Ø±ÙŠØ§Ù‹</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Ù…ÙˆÙ‚Ø¹ Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®</label>
              <div style="display: flex; gap: 1rem;">
                <input type="text" class="form-input" id="backupLocation" readonly value="Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ">
                <button class="btn btn-secondary" onclick="chooseBackupLocation()">
                  <i class="fas fa-folder-open"></i> ØªØºÙŠÙŠØ±
                </button>
              </div>
            </div>

            <button class="btn btn-primary" onclick="saveBackupSettings()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            </button>
          </div>

          <!-- Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹ -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-exclamation-circle"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹
            </h3>

            <div style="background: rgba(239, 68, 68, 0.1); border-right: 4px solid #ef4444; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <h4 style="color: #ef4444; margin-bottom: 0.5rem;">
                <i class="fas fa-skull-crossbones"></i> Ø®Ø·Ø± - Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹
              </h4>
              <p style="color: var(--theme-text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø³ØªØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØªØ¹ÙŠØ¯ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø­Ø§Ù„ØªÙ‡ Ø§Ù„Ø£ÙˆÙ„Ù‰. 
                Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¹Ø¯ ØªÙ†ÙÙŠØ°Ù‡Ø§!
              </p>
              <ul style="color: var(--theme-text-secondary); line-height: 1.8; margin-right: 1.5rem;">
                <li>ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª</li>
                <li>ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</li>
                <li>ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</li>
                <li>ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·</li>
                <li>ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªØ®ØµÙŠØµØ§Øª</li>
                <li>ğŸ—‘ï¸ Ù…Ø³Ø­ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</li>
              </ul>
            </div>

            <div style="display: grid; gap: 1rem;">
              <button class="btn btn-warning" onclick="clearSampleData()" style="padding: 1rem; font-size: 1rem;">
                <i class="fas fa-broom"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙ‚Ø·
              </button>
              
              <button class="btn btn-danger" onclick="confirmFactoryReset()" style="padding: 1.5rem; font-size: 1.1rem;">
                <i class="fas fa-trash-alt"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹ Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡)
              </button>
            </div>
          </div>

        </div>
      </div>
     </div>

     <!-- ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
     <div id="settings-account" class="page" style="display: none;">
      <div class="section-header">
       <button class="btn btn-secondary" onclick="showPage('settings')" style="margin-left: 1rem;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
       </button>
       <div class="section-title"><i class="fas fa-user-circle"></i> Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
      </div>

      <div class="settings-full-width">
        <div class="settings-content-wrapper">
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© -->
        <div class="settings-section">
          <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
            <span style="width: 4px; height: 28px; background: var(--primary-gradient); border-radius: 2px;"></span>
            <i class="fas fa-building"></i>
            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
          </h3>
          
          <div style="background: linear-gradient(135deg, var(--theme-bg-secondary) 0%, var(--theme-bg-hover) 100%); border-radius: 20px; padding: 2.5rem; border: 2px solid rgba(102, 126, 234, 0.2); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);">
            
            <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ© -->
            <div style="text-align: center; margin-bottom: 2rem;">
              <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);">
                <i class="fas fa-building" style="font-size: 3rem; color: white;"></i>
              </div>
              <h2 style="font-size: 2rem; font-weight: 700; color: var(--theme-text-primary); margin: 0 0 0.5rem 0;">
                Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ
              </h2>
              <p style="font-size: 1.1rem; color: var(--theme-text-secondary); margin: 0;">
                Digital Innovation Company
              </p>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
              
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                  <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-phone" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div>
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.25rem 0;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</p>
                    <p style="font-size: 1.25rem; font-weight: 600; color: var(--theme-text-primary); margin: 0; direction: ltr; text-align: right;">07813798636</p>
                  </div>
                </div>
              </div>

              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem;">
                  <div style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fab fa-whatsapp" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div>
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.25rem 0;">ÙˆØ§ØªØ³Ø§Ø¨</p>
                    <a href="https://wa.me/9647813798636?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙŠ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±" target="_blank" style="font-size: 1.25rem; font-weight: 600; color: #25D366; margin: 0; direction: ltr; text-align: right; text-decoration: none; display: block;">
                      +964 781 379 8636
                    </a>
                  </div>
                </div>
              </div>

            </div>

            <!-- Ø²Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ -->
            <div style="margin-top: 2rem;">
              <a href="https://wa.me/9647813798636?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ¬Ø¯ÙŠØ¯ Ø§Ø´ØªØ±Ø§ÙƒÙŠ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ±" target="_blank" class="btn btn-primary" style="width: 100%; padding: 1.25rem; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem; background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); border: none;">
                <i class="fab fa-whatsapp" style="font-size: 1.5rem;"></i>
                <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø­Ø³Ø§Ø¨ -->
        <div style="margin-bottom: 3rem;">
          <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
            <span style="width: 4px; height: 28px; background: var(--primary-gradient); border-radius: 2px;"></span>
            <i class="fas fa-user"></i>
            Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
          </h3>
          
          <div style="background: linear-gradient(135deg, var(--theme-bg-secondary) 0%, var(--theme-bg-hover) 100%); border-radius: 20px; padding: 2.5rem; border: 2px solid rgba(102, 126, 234, 0.2); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);">
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
              
              <!-- Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-fingerprint" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div style="flex: 1; min-width: 0;">
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UID)</p>
                    <p id="accountUserUID" style="font-size: 0.95rem; font-weight: 600; color: var(--theme-text-primary); margin: 0; font-family: 'Courier New', monospace; overflow: hidden; text-overflow: ellipsis;">
                      Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                    </p>
                  </div>
                  <button onclick="copyToClipboard(document.getElementById('accountUserUID').textContent)" class="btn btn-sm" style="padding: 0.5rem; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.3);" title="Ù†Ø³Ø®">
                    <i class="fas fa-copy"></i>
                  </button>
                </div>
              </div>

              <!-- Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-key" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div style="flex: 1; min-width: 0;">
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</p>
                    <p id="accountUserSecret" style="font-size: 1.1rem; font-weight: 600; color: var(--theme-text-primary); margin: 0; font-family: 'Courier New', monospace; letter-spacing: 2px;">
                      **********
                    </p>
                  </div>
                  <button onclick="copyToClipboard(document.getElementById('accountUserSecret').getAttribute('data-secret'))" class="btn btn-sm" style="padding: 0.5rem; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.3);" title="Ù†Ø³Ø®">
                    <i class="fas fa-copy"></i>
                  </button>
                </div>
              </div>

              <!-- ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-calendar-alt" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div style="flex: 1; min-width: 0;">
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</p>
                    <p id="accountCreatedDate" style="font-size: 1rem; font-weight: 600; color: var(--theme-text-primary); margin: 0;">
                      --/--/----
                    </p>
                  </div>
                </div>
              </div>

              <!-- Ø§Ù„Ù…Ù†ØµØ© -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <i class="fas fa-desktop" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div style="flex: 1; min-width: 0;">
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">Ø§Ù„Ù…Ù†ØµØ©</p>
                    <p id="accountPlatform" style="font-size: 1rem; font-weight: 600; color: var(--theme-text-primary); margin: 0;">
                      Windows
                    </p>
                  </div>
                </div>
              </div>

            </div>

            <!-- ØªÙ†Ø¨ÙŠÙ‡ -->
            <div style="margin-top: 2rem; padding: 1.25rem; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; display: flex; align-items: start; gap: 1rem;">
              <i class="fas fa-info-circle" style="color: #f59e0b; font-size: 1.25rem; flex-shrink: 0; margin-top: 0.25rem;"></i>
              <div>
                <p style="font-weight: 600; color: var(--theme-text-primary); margin: 0 0 0.5rem 0;">
                  <i class="fas fa-lock"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©
                </p>
                <p style="font-size: 0.95rem; color: var(--theme-text-secondary); margin: 0; line-height: 1.6;">
                  Ø§Ø­ØªÙØ¸ Ø¨Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UID) ÙˆØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†. Ø³ØªØ­ØªØ§Ø¬Ù‡Ù…Ø§ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø± Ø£Ùˆ Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
        <div style="margin-bottom: 3rem;">
          <h3 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--theme-text-primary); display: flex; align-items: center; gap: 0.75rem;">
            <span style="width: 4px; height: 28px; background: var(--primary-gradient); border-radius: 2px;"></span>
            <i class="fas fa-crown"></i>
            Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
          </h3>
          
          <div style="background: linear-gradient(135deg, var(--theme-bg-secondary) 0%, var(--theme-bg-hover) 100%); border-radius: 20px; padding: 2.5rem; border: 2px solid rgba(102, 126, 234, 0.2); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);">
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
              
              <!-- Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-star" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div>
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</p>
                    <p id="accountSubscriptionType" style="font-size: 1.1rem; font-weight: 700; color: #f59e0b; margin: 0;">
                      ØªØ¬Ø±ÙŠØ¨ÙŠ
                    </p>
                  </div>
                </div>
              </div>

              <!-- Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div id="accountDaysIcon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-clock" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div>
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</p>
                    <p id="accountDaysLeft" style="font-size: 1.5rem; font-weight: 700; color: #10b981; margin: 0;">
                      30 ÙŠÙˆÙ…
                    </p>
                  </div>
                </div>
              </div>

              <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-calendar-check" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div>
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</p>
                    <p id="accountStartDate" style="font-size: 1rem; font-weight: 600; color: var(--theme-text-primary); margin: 0;">
                      --/--/----
                    </p>
                  </div>
                </div>
              </div>

              <!-- ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ -->
              <div style="background: var(--theme-bg-tertiary); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(102, 126, 234, 0.1);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-calendar-times" style="font-size: 1.25rem; color: white;"></i>
                  </div>
                  <div>
                    <p style="font-size: 0.875rem; color: var(--theme-text-secondary); margin: 0 0 0.5rem 0;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                    <p id="accountEndDate" style="font-size: 1rem; font-weight: 600; color: var(--theme-text-primary); margin: 0;">
                      --/--/----
                    </p>
                  </div>
                </div>
              </div>

            </div>

            <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
            <div style="margin-bottom: 2rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                <span style="font-size: 0.875rem; color: var(--theme-text-secondary);">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</span>
                <span id="accountProgressPercent" style="font-size: 0.875rem; font-weight: 600; color: var(--theme-text-primary);">0%</span>
              </div>
              <div style="background: var(--theme-bg-tertiary); border-radius: 10px; height: 12px; overflow: hidden;">
                <div id="accountProgressBar" style="background: linear-gradient(90deg, #10b981 0%, #059669 100%); height: 100%; width: 0%; transition: all 0.5s ease; border-radius: 10px;"></div>
              </div>
            </div>

            <!-- Ø²Ø± Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ -->
            <button onclick="showActivationModal()" class="btn btn-primary" style="width: 100%; padding: 1.25rem; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 0.75rem;">
              <i class="fas fa-sync-alt"></i>
              <span>ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</span>
            </button>
          </div>
        </div>

      </div>
     </div>


     <!-- ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
     <div id="settings-printing" class="page" style="display: none;">
      <div class="section-header">
       <button class="btn btn-secondary" onclick="showPage('settings')" style="margin-left: 1rem;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
       </button>
       <div class="section-title"><i class="fas fa-print"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</div>
      </div>

      <div class="settings-full-width">
        <div class="settings-content-wrapper">
          
          <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-print"></i> Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            </h3>

            <div class="form-group">
              <label class="form-label">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</label>
              <select class="form-select" id="defaultPrinterSelect">
                <option value="">Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…</option>
                <option value="printer1">Thermal Printer POS-80</option>
                <option value="printer2">HP LaserJet Pro</option>
              </select>
              <button class="btn btn-secondary" onclick="refreshPrinters()" style="margin-top: 0.5rem;">
                <i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª
              </button>
            </div>

            <div class="form-group">
              <label class="form-label">Ø­Ø¬Ù… Ø§Ù„ÙˆØ±Ù‚Ø©</label>
              <select class="form-select" id="paperSizeSelect">
                <option value="58mm">58mm (Thermal)</option>
                <option value="80mm" selected>80mm (Thermal)</option>
                <option value="A4">A4</option>
                <option value="A5">A5</option>
              </select>
            </div>
          </div>

          <!-- ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-receipt"></i> ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            </h3>

            <div class="form-group">
              <label class="form-label">Ø­Ø¬Ù… Ø®Ø· Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
              <select class="form-select" id="invoiceFontSize">
                <option value="small">ØµØºÙŠØ± (10px)</option>
                <option value="medium" selected>Ù…ØªÙˆØ³Ø· (12px)</option>
                <option value="large">ÙƒØ¨ÙŠØ± (14px)</option>
                <option value="xlarge">ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (16px)</option>
              </select>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="showLogoOnInvoice" checked style="width: auto;">
                <span>Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØ¬Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="showBarcodeOnInvoice" checked style="width: auto;">
                <span>Ø¥Ø¸Ù‡Ø§Ø± Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="showTaxOnInvoice" checked style="width: auto;">
                <span>Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span>
              </label>
            </div>

            <div class="form-group">
              <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
              <textarea class="form-input" id="invoiceFooterNote" rows="3" placeholder="Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… - Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ÙŠÙˆÙ…Ø§Ù‹ Ø³Ø¹ÙŠØ¯Ø§Ù‹"></textarea>
            </div>
          </div>

          <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© -->
          <div style="margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-magic"></i> Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            </h3>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="autoPrintInvoice" style="width: auto;">
                <span>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="printCopies" style="width: auto;">
                <span>Ø·Ø¨Ø§Ø¹Ø© Ù†Ø³Ø®ØªÙŠÙ† (Ù†Ø³Ø®Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙˆÙ†Ø³Ø®Ø© Ù„Ù„Ø£Ø±Ø´ÙŠÙ)</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="openCashDrawer" style="width: auto;">
                <span>ÙØªØ­ Ø¯Ø±Ø¬ Ø§Ù„Ù†Ù‚ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹</span>
              </label>
            </div>

            <button class="btn" style="background: linear-gradient(135deg, #667eea, #764ba2); width: 100%; padding: 1.2rem; margin-top: 1rem;" onclick="printTestPage()">
              <i class="fas fa-file-pdf"></i> Ø·Ø¨Ø§Ø¹Ø© ØµÙØ­Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            </button>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" onclick="savePrintingSettings()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn btn-secondary" onclick="showPage('settings')">
              <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>

        </div>
      </div>
     </div>

     <!-- ØµÙØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† -->
     <div id="settings-security" class="page" style="display: none;">
      <div class="section-header">
       <button class="btn btn-secondary" onclick="showPage('settings')" style="margin-left: 1rem;">
         <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
       </button>
       <div class="section-title"><i class="fas fa-shield-alt"></i> Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©</div>
      </div>

      <div class="settings-full-width">
        <div class="settings-content-wrapper">
          
          <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-key"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            </h3>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="enablePassword" style="width: auto;">
                <span>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</span>
              </label>
            </div>

            <div id="passwordFields" style="display: none;">
              <div class="form-group">
                <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                <input type="password" class="form-input" id="currentPassword">
              </div>

              <div class="form-group">
                <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                <input type="password" class="form-input" id="newPassword">
              </div>

              <div class="form-group">
                <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" class="form-input" id="confirmPassword">
              </div>

              <button class="btn btn-warning" onclick="changePassword()">
                <i class="fas fa-key"></i> ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
              </button>
            </div>
          </div>

          <!-- Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-user-shield"></i> Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            </h3>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="requirePasswordForDelete" checked style="width: auto;">
                <span>Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø°Ù</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="requirePasswordForReports" style="width: auto;">
                <span>Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span>
              </label>
            </div>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="requirePasswordForSettings" checked style="width: auto;">
                <span>Ø·Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
              </label>
            </div>
          </div>

          <!-- Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª -->
          <div class="settings-section">
            <h3 style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid rgba(255,255,255,0.1);">
              <i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
            </h3>

            <div class="form-group">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="enableActivityLog" checked style="width: auto;">
                <span>ØªÙØ¹ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
              </label>
              <small style="color: var(--theme-text-secondary); margin-top: 0.5rem; display: block;">
                ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (Ø§Ù„Ø¨ÙŠØ¹ØŒ Ø§Ù„Ø­Ø°ÙØŒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)
              </small>
            </div>

            <div class="form-group">
              <label class="form-label">Ù…Ø¯Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø¬Ù„</label>
              <select class="form-select" id="logRetentionPeriod">
                <option value="30">30 ÙŠÙˆÙ…</option>
                <option value="90" selected>90 ÙŠÙˆÙ…</option>
                <option value="180">180 ÙŠÙˆÙ…</option>
                <option value="365">Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
                <option value="0">Ø¨Ø¯ÙˆÙ† Ø­Ø¯</option>
              </select>
            </div>

            <button class="btn btn-secondary" onclick="viewActivityLog()">
              <i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
            </button>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" onclick="saveSecuritySettings()">
              <i class="fas fa-save"></i> Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </button>
            <button class="btn btn-secondary" onclick="showPage('settings')">
              <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
            </button>
          </div>

        </div>
      </div>
     </div>

    </div>
   </main>
  </div><!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
  <div id="addProductModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3><button class="close-btn" onclick="closeModal('addProductModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <form id="addProductForm">
     <div class="form-grid">
      <div class="form-group"><label class="form-label"> <i class="fas fa-tag"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ </label> <input type="text" class="form-input" id="productName" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-barcode"></i> Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ </label>
       <div class="barcode-section"><input type="text" class="form-input barcode-input" id="productBarcode"> <button type="button" class="generate-barcode-btn" onclick="generateBarcode()"> <i class="fas fa-magic"></i> ØªÙˆÙ„ÙŠØ¯ </button>
       </div>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-layer-group"></i> Ø§Ù„ØªØµÙ†ÙŠÙ </label> <select class="form-select" id="productCategory" required> <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option> </select>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-truck"></i> Ø§Ù„Ù…ÙˆØ±Ø¯ </label> <input type="text" class="form-input" id="productSupplier">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-coins"></i> Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (Ù…ÙØ±Ø¯) </label> <input type="number" class="form-input" id="productCostRetail" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-coins"></i> Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (Ø¬Ù…Ù„Ø©) </label> <input type="number" class="form-input" id="productCostWholesale">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ù…ÙØ±Ø¯) </label> <input type="number" class="form-input" id="productPriceRetail" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ø¬Ù…Ù„Ø©) </label> <input type="number" class="form-input" id="productPriceWholesale">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-warehouse"></i> Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© </label> <input type="number" class="form-input" id="productStock" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ† </label> <input type="number" class="form-input" id="productMinStock" value="10">
      </div>
     </div>
     <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addProductModal')"> <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ </button> <button type="submit" class="btn btn-primary"> <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ </button>
     </div>
    </form>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ -->
  <div id="editProductModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3><button class="close-btn" onclick="closeModal('editProductModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <form id="editProductForm" onsubmit="handleEditProduct(event)">
     <input type="hidden" id="editProductId">
     <div class="form-grid">
      <div class="form-group"><label class="form-label"> <i class="fas fa-tag"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ </label> <input type="text" class="form-input" id="editProductName" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-barcode"></i> Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ </label> <input type="text" class="form-input" id="editProductBarcode">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-layer-group"></i> Ø§Ù„ØªØµÙ†ÙŠÙ </label> <select class="form-select" id="editProductCategory" required> <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option> </select>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-truck"></i> Ø§Ù„Ù…ÙˆØ±Ø¯ </label> <input type="text" class="form-input" id="editProductSupplier">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-coins"></i> Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (Ù…ÙØ±Ø¯) </label> <input type="number" class="form-input" id="editProductCostRetail" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-coins"></i> Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (Ø¬Ù…Ù„Ø©) </label> <input type="number" class="form-input" id="editProductCostWholesale">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ù…ÙØ±Ø¯) </label> <input type="number" class="form-input" id="editProductPriceRetail" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ø¬Ù…Ù„Ø©) </label> <input type="number" class="form-input" id="editProductPriceWholesale">
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-warehouse"></i> Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© </label> <input type="number" class="form-input" id="editProductStock" required>
      </div>
      <div class="form-group"><label class="form-label"> <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ† </label> <input type="number" class="form-input" id="editProductMinStock">
      </div>
     </div>
     <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('editProductModal')"> <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ </button> <button type="submit" class="btn btn-success"> <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª </button>
     </div>
    </form>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ -->
  <div id="addCategoryModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯</h3><button class="close-btn" onclick="closeModal('addCategoryModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <form id="addCategoryForm">
     <div class="form-group"><label class="form-label"> <i class="fas fa-tag"></i> Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ </label> <input type="text" class="form-input" id="categoryName" required>
     </div>
     <div class="form-group"><label class="form-label"> <i class="fas fa-icons"></i> Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© </label>
      <div class="category-icon-grid" id="categoryIconGrid"><!-- Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
      </div><input type="hidden" id="selectedCategoryIcon" value="fas fa-box">
     </div>
     <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('addCategoryModal')"> <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ </button> <button type="submit" class="btn btn-primary"> <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØµÙ†ÙŠÙ </button>
     </div>
    </form>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
  <div id="paymentModal" class="modal">
   <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-credit-card"></i> Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
     <button class="close-btn" onclick="closeModal('paymentModal')">
         <i class="fas fa-times"></i>
     </button>
    </div>
    
    <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
    <div class="payment-options-container">
        <button class="payment-option-card cash-payment" onclick="processCashPayment()">
            <div class="payment-option-icon">
                <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="payment-option-title">Ø¯ÙØ¹ Ù†Ù‚Ø¯ÙŠ</div>
            <div class="payment-option-description">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ ÙÙˆØ±Ø§Ù‹ Ø¨Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ</div>
        </button>
        
        <button class="payment-option-card installment-payment" onclick="showInstallmentForm()">
            <div class="payment-option-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="payment-option-title">Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</div>
            <div class="payment-option-description">ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù„Ù‰ Ø¹Ø¯Ø© Ø£Ø´Ù‡Ø±</div>
        </button>
    </div>
    
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· -->
    <div id="installmentForm" class="installment-form">
        <div class="installment-header">
            <i class="fas fa-user-edit"></i>
            <h4>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·</h4>
        </div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
        <div class="form-section">
            <div class="section-title">
                <i class="fas fa-user-circle"></i>
                <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
            </div>
            
            <!-- Ø®ÙŠØ§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„ Ù…Ø¯ÙŠÙ† -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-search"></i>
                    Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„ Ù…Ø¯ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                </label>
                <div class="search-customer-wrapper">
                    <input type="text" 
                           class="form-input" 
                           id="searchExistingCustomer" 
                           placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..."
                           oninput="searchDebtCustomers(this.value)">
                    <div id="customerSearchResults" class="customer-search-results"></div>
                </div>
                <small class="form-hint">
                    <i class="fas fa-info-circle"></i>
                    Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ù‡ØŒ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </small>
            </div>
            
            <div class="form-grid-2">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user"></i>
                        Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
                        <span class="required">*</span>
                    </label>
                    <input type="text" class="form-input" id="customerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-phone"></i>
                        Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
                        <span class="required">*</span>
                    </label>
                    <input type="text" class="form-input" id="customerPhone" placeholder="07XX XXX XXXX" required>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-map-marker-alt"></i>
                    Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                </label>
                <input type="text" class="form-input" id="customerAddress" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„">
            </div>
        </div>
        
        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· -->
        <div class="form-section">
            <div class="section-title">
                <i class="fas fa-calculator"></i>
                <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</span>
            </div>
            
            <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
            <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-right: 4px solid var(--primary-color);">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <i class="fas fa-sliders-h" style="color: var(--primary-color);"></i>
                    <span style="font-weight: 600; color: var(--theme-text-primary); font-size: 0.95rem;">ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</span>
                </div>
                <div class="form-group" style="margin: 0;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="advancedEditMode" onchange="toggleAdvancedEditMode()" style="width: 18px; height: 18px; cursor: pointer;">
                        <span style="font-size: 0.9rem; color: var(--theme-text-secondary);">
                            ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠØŒ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØŒ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ)
                        </span>
                    </label>
                    <small class="form-hint" style="margin-top: 0.5rem; margin-right: 1.75rem;">
                        <i class="fas fa-info-circle"></i>
                        ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± ÙŠØªÙŠØ­ Ù„Ùƒ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¨Ø§Ù„Øº ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·
                    </small>
                </div>
            </div>
            
            <div class="form-grid-3">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-calendar"></i>
                        Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
                    </label>
                    <input type="number" class="form-input" id="installmentMonths" min="1" max="60" value="12" onchange="calculateInstallment()">
                    <small class="form-hint">Ù…Ù† 1 Ø¥Ù„Ù‰ 60 Ø´Ù‡Ø±</small>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-money-bill-wave"></i>
                        Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
                    </label>
                    <input type="number" class="form-input" id="additionalAmount" value="0" min="0" step="1000" placeholder="0" onchange="calculateInstallment()">
                    <small class="form-hint">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</small>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-hand-holding-usd"></i>
                        Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
                    </label>
                    <input type="number" class="form-input" id="downPayment" value="0" min="0" step="1000" placeholder="0" onchange="calculateInstallment()">
                    <small class="form-hint">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù‚Ø¯Ù…Ø§Ù‹</small>
                </div>
            </div>
            
            <!-- ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-calendar-alt"></i>
                    ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                </label>
                <input type="date" class="form-input" id="installmentStartDate">
                <small class="form-hint">Ø­Ø¯Ø¯ ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</small>
            </div>
            
            <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
            <div id="advancedEditFields" style="display: none; margin-top: 1rem;">
                <div style="background: rgba(255, 193, 7, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-right: 4px solid var(--warning-color);">
                    <div style="display: flex; gap: 0.5rem; align-items: start;">
                        <i class="fas fa-exclamation-triangle" style="color: var(--warning-color); margin-top: 0.2rem;"></i>
                        <div style="flex: 1;">
                            <p style="margin: 0; font-size: 0.85rem; color: var(--theme-text-primary); line-height: 1.4;">
                                <strong>ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù…ÙØ¹Ù‘Ù„:</strong> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ù…Ø¨Ø§Ø´Ø±Ø©. 
                                Ø£ÙŠ ØªØºÙŠÙŠØ± Ø³ØªÙ‚ÙˆÙ… Ø¨Ù‡ Ø³ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="form-grid-3">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-shopping-cart"></i>
                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
                        </label>
                        <input type="number" class="form-input" id="customOriginalAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ" step="1000" min="0" oninput="recalculateFromOriginal()">
                        <small class="form-hint">
                            <i class="fas fa-sync-alt"></i> Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù‚Ø³Ø·
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-wallet"></i>
                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        </label>
                        <input type="number" class="form-input" id="customTotalAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" step="1000" min="0" oninput="recalculateFromTotal()">
                        <small class="form-hint">
                            <i class="fas fa-sync-alt"></i> Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-calendar-check"></i>
                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
                        </label>
                        <input type="number" class="form-input" id="customMonthlyAmount" placeholder="Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ" step="100" min="0" oninput="recalculateFromMonthly()">
                        <small class="form-hint">
                            <i class="fas fa-sync-alt"></i> Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        </small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
        <div class="installment-summary">
            <div class="summary-title">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
            </div>
            <div class="summary-items">
                <div class="summary-row">
                    <span class="summary-label">
                        <i class="fas fa-shopping-cart"></i>
                        Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
                    </span>
                    <span class="summary-value" id="originalAmount">0 Ø¯ÙŠÙ†Ø§Ø±</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">
                        <i class="fas fa-plus-circle"></i>
                        Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
                    </span>
                    <span class="summary-value text-warning" id="addedProfit">0 Ø¯ÙŠÙ†Ø§Ø±</span>
                </div>
                <div class="summary-row" id="downPaymentRow" style="display: none;">
                    <span class="summary-label">
                        <i class="fas fa-hand-holding-usd"></i>
                        Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
                    </span>
                    <span class="summary-value text-success" id="downPaymentDisplay">0 Ø¯ÙŠÙ†Ø§Ø±</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-row total-row">
                    <span class="summary-label">
                        <i class="fas fa-wallet"></i>
                        Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                    </span>
                    <span class="summary-value" id="totalInstallmentAmount">0 Ø¯ÙŠÙ†Ø§Ø±</span>
                </div>
                <div class="summary-row monthly-row">
                    <span class="summary-label">
                        <i class="fas fa-calendar-check"></i>
                        Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
                    </span>
                    <span class="summary-value highlight" id="monthlyPayment">0 Ø¯ÙŠÙ†Ø§Ø±</span>
                </div>
            </div>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">
                <i class="fas fa-times"></i>
                Ø¥Ù„ØºØ§Ø¡
            </button>
            <button type="button" class="btn btn-primary" onclick="processInstallmentPayment()">
                <i class="fas fa-check-circle"></i>
                Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹
            </button>
        </div>
    </div>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <div id="productDetailsModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3><button class="close-btn" onclick="closeModal('productDetailsModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <div id="productDetailsContent"><!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
  <div id="invoiceDetailsModal" class="modal">
   <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-file-invoice"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3><button class="close-btn" onclick="closeModal('invoiceDetailsModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <div id="invoiceDetailsContent"><!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† -->
  <div id="debtDetailsModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-user-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø¯ÙŠÙ†</h3><button class="close-btn" onclick="closeModal('debtDetailsModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <div id="debtDetailsContent"><!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ø¯ÙŠÙ† -->
  <div id="payDebtModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-money-check-alt"></i> ØªØ³Ø¯ÙŠØ¯ Ø¯ÙŠÙ†</h3><button class="close-btn" onclick="closeModal('payDebtModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <form id="payDebtForm">
     <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</label> <input type="text" class="form-input" id="remainingDebtAmount" readonly>
     </div>
     <div class="form-group"><label class="form-label">Ù…Ø¨Ù„Øº Ø§Ù„ØªØ³Ø¯ÙŠØ¯</label> <input type="number" class="form-input" id="paymentAmount" required>
     </div>
     <div class="form-group"><label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label> <textarea class="form-input" id="paymentNotes" rows="3"></textarea>
     </div>
     <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('payDebtModal')"> <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ </button> <button type="submit" class="btn btn-success"> <i class="fas fa-check"></i> ØªØ³Ø¯ÙŠØ¯ </button>
     </div>
    </form>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø· Ø´Ù‡Ø±ÙŠ -->
  <div id="payInstallmentModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-money-check-alt"></i> ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</h3><button class="close-btn" onclick="closeModal('payInstallmentModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <form id="payInstallmentForm" onsubmit="handlePayInstallment(event)">
     <div class="form-group"><label class="form-label">Ø§Ù„Ø´Ù‡Ø±</label> <input type="text" class="form-input" id="installmentMonthDisplay" readonly>
     </div>
     <div class="form-group">
      <label class="form-label">Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø³Ø· <span style="color: var(--theme-text-secondary); font-size: 0.85em;">(ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)</span></label>
      <input type="number" class="form-input" id="installmentAmountInput" placeholder="Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" step="1" min="0" required style="font-size: 1.1em; font-weight: 600; color: var(--primary-color);">
     </div>
     <div class="form-group"><label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label> <textarea class="form-input" id="installmentNotes" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª..."></textarea>
     </div>
     <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('payInstallmentModal')"> <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ </button> <button type="submit" class="btn btn-success"> <i class="fas fa-check"></i> ØªØ³Ø¯ÙŠØ¯ </button>
     </div>
    </form>
   </div>
  </div><!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù -->
  <div id="confirmDeleteModal" class="modal">
   <div class="modal-content" style="max-width: 500px;">
    <div class="modal-header">
     <h3 class="modal-title" style="color: var(--danger-color);"><i class="fas fa-exclamation-triangle"></i> ØªØ­Ø°ÙŠØ±: Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†</h3><button class="close-btn" onclick="closeModal('confirmDeleteModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <div style="padding: 1rem 0;">
     <div style="background: var(--danger-gradient); opacity: 0.1; padding: 2rem; border-radius: 12px; text-align: center; margin-bottom: 1.5rem;"><i class="fas fa-exclamation-circle" style="font-size: 4rem; color: var(--danger-color);"></i>
     </div>
     <div style="text-align: center; margin-bottom: 1.5rem;">
      <h4 style="font-size: 1.25rem; margin-bottom: 0.5rem; color: var(--theme-text-primary);">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙŠÙ†ØŸ</h4>
      <p style="color: var(--theme-text-secondary); font-size: 0.95rem;">Ø§Ù„Ø¹Ù…ÙŠÙ„: <strong id="deleteDebtCustomerName" style="color: var(--theme-text-primary);"></strong></p>
     </div>
     <div style="background: var(--theme-bg-secondary); border-right: 4px solid var(--danger-color); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
      <p style="font-weight: 600; margin-bottom: 0.75rem; color: var(--danger-color);"><i class="fas fa-info-circle"></i> Ø³ÙŠØªÙ… Ø­Ø°Ù:</p>
      <ul style="list-style: none; padding-right: 1.5rem; color: var(--theme-text-secondary); font-size: 0.9rem;">
       <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: var(--danger-color); margin-left: 0.5rem;"></i> Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙŠÙ†</li>
       <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: var(--danger-color); margin-left: 0.5rem;"></i> Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</li>
       <li style="margin-bottom: 0.5rem;"><i class="fas fa-check" style="color: var(--danger-color); margin-left: 0.5rem;"></i> Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª</li>
      </ul>
      <p style="margin-top: 1rem; font-weight: 600; color: var(--danger-color); font-size: 0.9rem;"><i class="fas fa-exclamation-triangle"></i> Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!</p>
     </div>
    </div>
    <div class="form-actions"><button type="button" class="btn btn-secondary" onclick="closeModal('confirmDeleteModal')"> <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡ </button> <button type="button" class="btn btn-danger" onclick="executeDeleteDebt()" style="background: var(--danger-gradient);"> <i class="fas fa-trash-alt"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù </button>
    </div>
   </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­ -->
  <div id="systemManagementModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <h3 class="modal-title">
          <i class="fas fa-tools"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­
        </h3>
        <button class="close-btn" onclick="closeModal('systemManagementModal')" style="color: white;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body" style="padding: 2rem;">
        <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
          <h4 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-info-circle"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
          </h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
              <div id="systemStatusUID" style="font-weight: bold; font-size: 1.1rem;">---</div>
            </div>
            <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
              <div id="systemStatusAccount" style="font-weight: bold; font-size: 1.1rem;">---</div>
            </div>
            <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</div>
              <div id="systemStatusVersion" style="font-weight: bold; font-size: 1.1rem;">---</div>
            </div>
            <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.25rem;">Ø­Ø§Ù„Ø© Firebase</div>
              <div id="systemStatusFirebase" style="font-weight: bold; font-size: 1.1rem;">---</div>
            </div>
          </div>
        </div>

        <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­ -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
          <!-- ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
          <div style="background: var(--theme-bg-secondary); border: 2px solid var(--theme-border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
            <h5 style="color: var(--theme-text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-search" style="color: #3b82f6;"></i> ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø¨
            </h5>
            <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</p>
            <button onclick="systemCheckAccount()" class="btn btn-primary" style="width: 100%; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
              <i class="fas fa-search"></i> ÙØ­Øµ Ø§Ù„Ø¢Ù†
            </button>
          </div>

          <!-- Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
          <div style="background: var(--theme-bg-secondary); border: 2px solid var(--theme-border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
            <h5 style="color: var(--theme-text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-wrench" style="color: #10b981;"></i> Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            </h5>
            <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
            <button onclick="systemFixRegistration()" class="btn btn-success" style="width: 100%; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
              <i class="fas fa-wrench"></i> Ø¥ØµÙ„Ø§Ø­
            </button>
          </div>

          <!-- Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙÙŠÙØ© -->
          <div style="background: var(--theme-bg-secondary); border: 2px solid var(--theme-border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
            <h5 style="color: var(--theme-text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-sync" style="color: #6366f1;"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙÙŠÙØ©
            </h5>
            <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
            <button onclick="systemSoftReset()" class="btn" style="width: 100%; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white;">
              <i class="fas fa-sync"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            </button>
          </div>

          <!-- Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒØ§Ù…Ù„Ø© -->
          <div style="background: var(--theme-bg-secondary); border: 2px solid var(--theme-border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
            <h5 style="color: var(--theme-text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒØ§Ù…Ù„Ø©
            </h5>
            <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
            <button onclick="systemFullReset()" class="btn btn-danger" style="width: 100%; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
              <i class="fas fa-exclamation-triangle"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒØ§Ù…Ù„Ø©
            </button>
          </div>

          <!-- Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø© -->
          <div style="background: var(--theme-bg-secondary); border: 2px solid var(--theme-border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
            <h5 style="color: var(--theme-text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-trash-alt" style="color: #f59e0b;"></i> Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ§Ù„Ø­Ø©
            </h5>
            <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ø¥Ø²Ø§Ù„Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ØªØ§Ù„ÙØ©</p>
            <button onclick="systemClearInvalidData()" class="btn" style="width: 100%; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
              <i class="fas fa-trash-alt"></i> Ù…Ø³Ø­
            </button>
          </div>

          <!-- ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
          <div style="background: var(--theme-bg-secondary); border: 2px solid var(--theme-border); border-radius: 12px; padding: 1.5rem; transition: all 0.3s ease;">
            <h5 style="color: var(--theme-text-primary); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-download" style="color: #8b5cf6;"></i> ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            </h5>
            <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
            <button onclick="systemExportBackup()" class="btn" style="width: 100%; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
              <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ±
            </button>
          </div>
        </div>

        <!-- Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
        <div style="margin-bottom: 1rem;">
          <h4 style="color: var(--theme-text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-list"></i> Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
          </h4>
          <div id="systemConsoleLog" style="background: #1f2937; color: #e5e7eb; padding: 1.5rem; border-radius: 8px; max-height: 250px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.6;">
            <div style="color: #3b82f6;">â„¹ï¸ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª...</div>
          </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø·ÙˆØ± -->
        <div style="text-align: center; padding: 1rem; border-top: 2px solid var(--theme-border); color: var(--theme-text-secondary); font-size: 0.9rem;">
          <p style="margin-bottom: 0.5rem;">
            <strong style="color: var(--theme-text-primary);">Digital Creativity Company</strong>
          </p>
          <p>Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - ÙƒØ§Ø´ Ø¨Ø±Ùˆ</p>
          <p style="margin-top: 0.5rem;">Ø§Ù„Ù…Ø·ÙˆØ±: ÙƒØ±Ø§Ø± | 07813798636</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ«Ø© -->
  <div id="cashPaymentModal" class="modal">
   <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
     <h3 class="modal-title" style="color: white;">
      <i class="fas fa-money-bill-wave"></i> Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ù†Ù‚Ø¯Ø§Ù‹
     </h3>
     <button class="close-btn" onclick="closeCashPaymentModal()" style="color: white;">
      <i class="fas fa-times"></i>
     </button>
    </div>
    
    <div style="padding: 2rem;">
     <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
     <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
      <div style="text-align: center; margin-bottom: 1rem;">
       <i class="fas fa-shopping-cart" style="font-size: 2.5rem; color: var(--primary-color);"></i>
      </div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
       <span style="color: var(--theme-text-secondary);">
        <i class="fas fa-box"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:
       </span>
       <span id="cashModalItemCount" style="font-weight: 600; color: var(--theme-text-primary);">0</span>
      </div>
      <div style="height: 1px; background: rgba(102, 126, 234, 0.2); margin: 1rem 0;"></div>
      <div style="display: flex; justify-content: space-between; align-items: center;">
       <span style="color: var(--theme-text-secondary); font-size: 0.9rem;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ„ÙŠ:</span>
       <span id="cashModalOriginalTotal" style="font-weight: 600; color: var(--theme-text-primary); font-size: 1.1rem;">0 Ø¯ÙŠÙ†Ø§Ø±</span>
      </div>
     </div>
     
     <!-- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
      <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
       <i class="fas fa-edit" style="color: var(--warning-color);"></i>
       <h4 style="font-size: 1rem; color: var(--theme-text-primary);">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h4>
      </div>
      
      <div class="form-group" style="margin-bottom: 1rem;">
       <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-dollar-sign"></i>
        Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
       </label>
       <div style="position: relative;">
        <input type="number" 
               class="form-input" 
               id="cashModalFinalPrice" 
               placeholder="Ø§ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ"
               step="1000"
               min="0"
               oninput="updateCashPaymentPreview()"
               style="padding-right: 3rem; font-size: 1.2rem; font-weight: 600; border: 2px solid rgba(102, 126, 234, 0.3);">
        <span style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); color: var(--theme-text-secondary); font-weight: 600;">Ø¯ÙŠÙ†Ø§Ø±</span>
       </div>
       <small class="form-hint" style="display: flex; align-items: center; gap: 0.3rem; margin-top: 0.5rem;">
        <i class="fas fa-info-circle"></i>
        Ø§ØªØ±Ùƒ Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠØŒ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„ØºØ§Ù‹ Ù…Ø®ØªÙ„ÙØ§Ù‹
       </small>
      </div>
      
      <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚ -->
      <div id="cashPriceDifferenceDisplay" style="display: none; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
       <div style="display: flex; justify-content: space-between; align-items: center;">
        <span id="cashDifferenceLabel" style="display: flex; align-items: center; gap: 0.5rem;">
         <i class="fas fa-exchange-alt"></i> Ø§Ù„ÙØ±Ù‚:
        </span>
        <span id="cashDifferenceAmount" style="font-weight: 700; font-size: 1.1rem;"></span>
       </div>
      </div>
     </div>
     
     <!-- Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ø°ÙŠ Ø³ÙŠÙØ·Ø¨Ø¹ -->
     <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(56, 142, 60, 0.1)); padding: 1.5rem; border-radius: 12px; border: 2px solid rgba(76, 175, 80, 0.3); margin-bottom: 1.5rem;">
      <div style="display: flex; justify-content: space-between; align-items: center;">
       <span style="color: var(--theme-text-secondary); display: flex; align-items: center; gap: 0.5rem;">
        <i class="fas fa-print"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ Ø³ÙŠÙØ·Ø¨Ø¹:
       </span>
       <span id="cashModalFinalAmount" style="font-weight: 700; font-size: 1.5rem; color: var(--success-color);">0 Ø¯ÙŠÙ†Ø§Ø±</span>
      </div>
     </div>
     
     <!-- Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© -->
     <div style="background: rgba(255, 193, 7, 0.1); padding: 1rem; border-radius: 8px; border-right: 4px solid var(--warning-color); margin-bottom: 1.5rem;">
      <div style="display: flex; gap: 0.75rem;">
       <i class="fas fa-lightbulb" style="color: var(--warning-color); font-size: 1.2rem;"></i>
       <div style="flex: 1;">
        <p style="margin: 0; font-size: 0.9rem; color: var(--theme-text-primary); line-height: 1.5;">
         ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© (Ù…Ø«Ù„ Ù…Ù†Ø­ Ø®ØµÙ… Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø±Ø³ÙˆÙ…). 
         Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø°ÙŠ ØªØ¯Ø®Ù„Ù‡ Ù‡Ùˆ Ù…Ø§ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø·Ø¨ÙˆØ¹Ø©.
        </p>
       </div>
      </div>
     </div>
     
     <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
     <div class="form-actions" style="display: flex; gap: 1rem;">
      <button type="button" class="btn btn-secondary" onclick="closeCashPaymentModal()" style="flex: 1;">
       <i class="fas fa-times"></i>
       Ø¥Ù„ØºØ§Ø¡
      </button>
      <button type="button" class="btn btn-success" onclick="confirmCashPayment()" style="flex: 2; background: linear-gradient(135deg, #4CAF50, #388E3C); font-size: 1.1rem; padding: 1rem;">
       <i class="fas fa-check-circle"></i>
       ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©
      </button>
     </div>
    </div>
   </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
  <div id="userInfoModal" class="modal">
   <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
     <h3 class="modal-title" style="color: var(--success-color);"><i class="fas fa-user-check"></i> ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­</h3>
     <button class="close-btn" onclick="closeModal('userInfoModal')"> <i class="fas fa-times"></i> </button>
    </div>
    <div style="padding: 1.5rem 0;">
     <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 2rem; border-radius: 12px; text-align: center; margin-bottom: 1.5rem;">
      <i class="fas fa-user-circle" style="font-size: 4rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
      <h4 style="font-size: 1.2rem; margin-bottom: 0.5rem; color: var(--theme-text-primary);">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ</h4>
      <p style="color: var(--theme-text-secondary); font-size: 0.9rem;">Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†</p>
     </div>
     
     <div style="background: var(--theme-bg-secondary); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
      <div style="margin-bottom: 1.5rem;">
       <label style="display: block; font-size: 0.9rem; color: var(--theme-text-secondary); margin-bottom: 0.5rem;">
        <i class="fas fa-fingerprint"></i> Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UID)
       </label>
       <div style="background: var(--theme-bg-card); padding: 1rem; border-radius: 8px; border: 2px solid rgba(102, 126, 234, 0.3); display: flex; align-items: center; gap: 1rem;">
        <code id="userUID" style="flex: 1; color: var(--primary-color); font-size: 1.1rem; font-weight: 600;"></code>
        <button onclick="copyToClipboard(document.getElementById('userUID').textContent)" class="btn btn-sm" style="padding: 0.5rem 1rem; background: var(--primary-gradient);">
         <i class="fas fa-copy"></i> Ù†Ø³Ø®
        </button>
       </div>
      </div>
      
      <div style="margin-bottom: 1.5rem;">
       <label style="display: block; font-size: 0.9rem; color: var(--theme-text-secondary); margin-bottom: 0.5rem;">
        <i class="fas fa-key"></i> Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ (Secret Key)
       </label>
       <div style="background: var(--theme-bg-card); padding: 1rem; border-radius: 8px; border: 2px solid rgba(240, 147, 251, 0.3); display: flex; align-items: center; gap: 1rem;">
        <code id="userSecret" style="flex: 1; color: #f093fb; font-size: 1.1rem; font-weight: 600;"></code>
        <button onclick="copyToClipboard(document.getElementById('userSecret').textContent)" class="btn btn-sm" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #f093fb, #f5576c);">
         <i class="fas fa-copy"></i> Ù†Ø³Ø®
        </button>
       </div>
      </div>
      
      <div style="background: linear-gradient(135deg, rgba(67, 233, 123, 0.1), rgba(56, 249, 215, 0.1)); padding: 1rem; border-radius: 8px; border-right: 4px solid #43e97b;">
       <p style="margin: 0; font-size: 0.95rem; color: var(--theme-text-primary);">
        <i class="fas fa-gift" style="color: #43e97b; margin-left: 0.5rem;"></i>
        <strong>Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</strong> <span id="trialDaysDisplay"></span> ÙŠÙˆÙ…
       </p>
      </div>
     </div>
     
     <div style="background: var(--theme-bg-secondary); border-right: 4px solid var(--warning-color); padding: 1rem; border-radius: 8px;">
      <p style="font-weight: 600; margin-bottom: 0.5rem; color: var(--warning-color);"><i class="fas fa-exclamation-triangle"></i> ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…:</p>
      <ul style="list-style: none; padding-right: 1.5rem; color: var(--theme-text-secondary); font-size: 0.85rem; margin: 0;">
       <li style="margin-bottom: 0.25rem;">â€¢ Ø§Ø­ÙØ¸ UID ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†</li>
       <li style="margin-bottom: 0.25rem;">â€¢ Ø³ØªØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡Ù…Ø§ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø²</li>
       <li style="margin-bottom: 0.25rem;">â€¢ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¯ÙÙˆØ¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„</li>
      </ul>
     </div>
    </div>
    <div class="form-actions">
     <button type="button" class="btn btn-primary" onclick="closeModal('userInfoModal')">
      <i class="fas fa-check"></i> ÙÙ‡Ù…ØªØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
     </button>
    </div>
   </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
  <div id="activationModal" class="modal">
   <div class="modal-content" style="max-width: 550px;">
    <div class="modal-header">
     <h3 class="modal-title" style="color: var(--warning-color);"><i class="fas fa-crown"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
     <button class="close-btn" onclick="closeActivationModal()"> <i class="fas fa-times"></i> </button>
    </div>
    <div style="padding: 1.5rem 0;">
     
     <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
     <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1)); padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 1.5rem; border: 2px solid rgba(245, 158, 11, 0.3);">
      <i class="fas fa-hourglass-end" style="font-size: 3rem; color: var(--warning-color); margin-bottom: 1rem;"></i>
      <h4 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--theme-text-primary);">Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h4>
      <p style="color: var(--theme-text-secondary); font-size: 0.9rem; margin: 0;">Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ</p>
     </div>

     <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„ -->
     <div style="margin-bottom: 1.5rem;">
      <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
       <button onclick="showActivationTab('code')" id="codeTabBtn" class="btn" style="flex: 1; background: var(--primary-gradient); padding: 0.75rem;">
        <i class="fas fa-ticket-alt"></i> Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„
       </button>
       <button onclick="showActivationTab('login')" id="loginTabBtn" class="btn btn-secondary" style="flex: 1; padding: 0.75rem;">
        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
       </button>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ -->
      <div id="codeTab" class="activation-tab">
       <div style="background: var(--theme-bg-secondary); border-radius: 12px; padding: 1.5rem;">
        <div style="margin-bottom: 1rem;">
         <label style="display: block; font-size: 0.9rem; color: var(--theme-text-secondary); margin-bottom: 0.5rem;">
          <i class="fas fa-ticket-alt"></i> Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„
         </label>
         <input type="text" id="activationCodeInput" placeholder="Ù…Ø«Ø§Ù„: ABC123XYZ456" style="width: 100%; padding: 1rem; border-radius: 8px; border: 2px solid rgba(102, 126, 234, 0.3); background: var(--theme-bg-card); color: var(--theme-text-primary); font-size: 1.1rem; font-weight: 600; text-align: center; letter-spacing: 2px; text-transform: uppercase;" maxlength="20">
        </div>
        
        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); padding: 1rem; border-radius: 8px; border-right: 4px solid #10b981; margin-bottom: 1rem;">
         <p style="margin: 0; font-size: 0.85rem; color: var(--theme-text-secondary);">
          <i class="fas fa-info-circle" style="color: #10b981; margin-left: 0.5rem;"></i>
          Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø£Ùˆ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
         </p>
        </div>

        <button onclick="activateWithCode()" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem;">
         <i class="fas fa-check-circle"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†
        </button>
       </div>
      </div>

      <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
      <div id="loginTab" class="activation-tab" style="display: none;">
       <div style="background: var(--theme-bg-secondary); border-radius: 12px; padding: 1.5rem;">
        <div style="margin-bottom: 1rem;">
         <label style="display: block; font-size: 0.9rem; color: var(--theme-text-secondary); margin-bottom: 0.5rem;">
          <i class="fas fa-fingerprint"></i> Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UID)
         </label>
         <input type="text" id="loginUIDInput" placeholder="Ø£Ø¯Ø®Ù„ UID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" style="width: 100%; padding: 1rem; border-radius: 8px; border: 2px solid rgba(102, 126, 234, 0.3); background: var(--theme-bg-card); color: var(--theme-text-primary); font-size: 1rem;">
        </div>
        
        <div style="margin-bottom: 1rem;">
         <label style="display: block; font-size: 0.9rem; color: var(--theme-text-secondary); margin-bottom: 0.5rem;">
          <i class="fas fa-key"></i> Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ
         </label>
         <input type="password" id="loginSecretInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ" style="width: 100%; padding: 1rem; border-radius: 8px; border: 2px solid rgba(240, 147, 251, 0.3); background: var(--theme-bg-card); color: var(--theme-text-primary); font-size: 1rem;">
        </div>

        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 1rem; border-radius: 8px; border-right: 4px solid var(--primary-color); margin-bottom: 1rem;">
         <p style="margin: 0; font-size: 0.85rem; color: var(--theme-text-secondary);">
          <i class="fas fa-shield-alt" style="color: var(--primary-color); margin-left: 0.5rem;"></i>
          Ø§Ø³ØªØ®Ø¯Ù… UID ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ Ø§Ù„Ø°ÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„
         </p>
        </div>

        <button onclick="loginWithCredentials()" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem;">
         <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                <button onclick="createLocalUserIfNeeded()" class="btn btn-success" style="width: 100%; margin-top: 0.5rem; padding: 1rem; font-size: 1rem;">
                    <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        </button>
        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
        <div id="userDetailsForm" style="display:block; margin-top:1.5rem; background:rgb(23,25,27); border-radius:10px; padding:1.2rem; border:1px solid rgb(229,231,235);">
            <h4 style="margin-bottom:1rem; color:var(--primary-gradient); font-weight:700; letter-spacing:1px; text-shadow:0 2px 8px rgba(99,102,241,0.10); font-family:'Cairo',sans-serif;"><i class="fas fa-user"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h4>
            <div class="form-group" style="margin-bottom:1rem;">
                <label style="color:var(--theme-text-secondary); font-weight:600; margin-bottom:0.3rem; display:block; font-family:'Cairo',sans-serif; font-size:1.08rem;"><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ</label>
                <input type="text" id="newUserFullName" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ" required style="background:var(--theme-bg-card); color:var(--theme-text-primary); border:2px solid var(--theme-border,#d8d8d8); border-radius:8px; padding:1.1rem 0.9rem; font-size:1.13rem; font-weight:600; font-family:'Cairo',sans-serif; transition:box-shadow 0.2s;">
            </div>
            <div class="form-group" style="margin-bottom:1rem;">
                <label style="color:var(--theme-text-secondary); font-weight:600; margin-bottom:0.3rem; display:block; font-family:'Cairo',sans-serif; font-size:1.08rem;"><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="tel" id="newUserPhone" class="form-input" placeholder="07XX XXX XXXX" required style="background:var(--theme-bg-card); color:var(--theme-text-primary); border:2px solid var(--theme-border,#d8d8d8); border-radius:8px; padding:1.1rem 0.9rem; font-size:1.13rem; font-weight:600; font-family:'Cairo',sans-serif; transition:box-shadow 0.2s;">
            </div>
            <div class="form-group" style="margin-bottom:1rem;">
                <label style="color:var(--theme-text-secondary); font-weight:600; margin-bottom:0.3rem; display:block; font-family:'Cairo',sans-serif; font-size:1.08rem;"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                <input type="text" id="newUserAddress" class="form-input" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„" required style="background:var(--theme-bg-card); color:var(--theme-text-primary); border:2px solid var(--theme-border,#d8d8d8); border-radius:8px; padding:1.1rem 0.9rem; font-size:1.13rem; font-weight:600; font-family:'Cairo',sans-serif; transition:box-shadow 0.2s;">
            </div>
            <div class="form-group" style="margin-bottom:1rem;">
                <label style="color:var(--theme-text-secondary); font-weight:600; margin-bottom:0.3rem; display:block; font-family:'Cairo',sans-serif; font-size:1.08rem;"><i class="fas fa-store"></i> Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±</label>
                <input type="text" id="newUserStoreName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±/Ø§Ù„Ù…Ø¤Ø³Ø³Ø©" required style="background:var(--theme-bg-card); color:var(--theme-text-primary); border:2px solid var(--theme-border,#d8d8d8); border-radius:8px; padding:1.1rem 0.9rem; font-size:1.13rem; font-weight:600; font-family:'Cairo',sans-serif; transition:box-shadow 0.2s;">
            </div>
            <div class="form-group" style="margin-bottom:1rem; display:flex; align-items:center; gap:0.7rem;">
                <label style="color:var(--theme-text-secondary); font-weight:500;"><i class="fas fa-map-marked-alt"></i> Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</label>
                <button type="button" class="btn btn-info" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;padding:0.5rem 1.2rem;border-radius:7px;font-weight:600;box-shadow:0 2px 8px rgba(59,130,246,0.10);" onclick="getUserLocation()"><i class="fas fa-map-marker-alt"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
                <span id="locationStatus" style="font-size:0.95rem; color:#059669; margin-right:8px;"></span>
            </div>
            <input type="hidden" id="newUserLat">
            <input type="hidden" id="newUserLng">
            <div style="margin-top:1.2rem; display:flex; gap:0.7rem;">
                <button type="button" class="btn btn-success" style="width: 100%; margin-bottom: 0.5rem; padding: 1rem; font-size: 1rem; border-radius: 8px; background: linear-gradient(135deg,#10b981,#059669); color: #fff; font-weight: 700;" onclick="saveNewUserDetails()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                <button type="button" class="btn btn-secondary" style="width: 100%; padding: 1rem; font-size: 1rem; border-radius: 8px; background: linear-gradient(135deg,#64748b,#334155); color: #fff; font-weight: 700;" onclick="hideUserDetailsForm()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
        </button>
       </div>
      </div>
     </div>

     <!-- ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
     <div style="background: var(--theme-bg-secondary); border-radius: 8px; padding: 1rem;">
      <p style="font-weight: 600; margin-bottom: 0.5rem; color: var(--theme-text-primary); font-size: 0.9rem;">
       <i class="fas fa-question-circle" style="color: var(--primary-color);"></i> Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ
      </p>
      <ul style="list-style: none; padding-right: 1.5rem; color: var(--theme-text-secondary); font-size: 0.8rem; margin: 0;">
       <li style="margin-bottom: 0.25rem;">â€¢ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² ØªÙØ¹ÙŠÙ„</li>
       <li style="margin-bottom: 0.25rem;">â€¢ Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙ…Ù„Ùƒ Ø­Ø³Ø§Ø¨ Ø³Ø§Ø¨Ù‚ØŒ Ø§Ø³ØªØ®Ø¯Ù… UID ÙˆØ§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ</li>
       <li>â€¢ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: 30 ÙŠÙˆÙ… Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</li>
      </ul>
     </div>
    </div>
   </div>
  </div>

  <!-- ğŸ’° Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯ -->
  <div id="addExpenseModal" class="modal">
   <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h3>
     <button class="close-btn" onclick="closeAddExpenseModal()"> <i class="fas fa-times"></i> </button>
    </div>
    <div class="modal-body">
     <div class="form-group">
      <label><i class="fas fa-list"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
      <select id="expenseType" class="form-control" required>
       <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</option>
       <option value="rent">ğŸ  Ø¥ÙŠØ¬Ø§Ø±</option>
       <option value="utilities">âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¡/Ù…Ø§Ø¡</option>
       <option value="salary">ğŸ’° Ø±ÙˆØ§ØªØ¨</option>
       <option value="maintenance">ğŸ”§ ØµÙŠØ§Ù†Ø©</option>
       <option value="transportation">ğŸš— Ù†Ù‚Ù„ ÙˆÙ…ÙˆØ§ØµÙ„Ø§Øª</option>
       <option value="supplies">ğŸ“¦ Ù„ÙˆØ§Ø²Ù… Ù…ÙƒØªØ¨ÙŠØ©</option>
       <option value="marketing">ğŸ“¢ ØªØ³ÙˆÙŠÙ‚ ÙˆØ¥Ø¹Ù„Ø§Ù†</option>
       <option value="insurance">ğŸ›¡ï¸ ØªØ£Ù…ÙŠÙ†Ø§Øª</option>
       <option value="taxes">ğŸ“Š Ø¶Ø±Ø§Ø¦Ø¨ ÙˆØ±Ø³ÙˆÙ…</option>
       <option value="other">ğŸ“ Ø£Ø®Ø±Ù‰</option>
      </select>
     </div>
     <div class="form-group">
      <label><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯ÙŠÙ†Ø§Ø±)</label>
      <input type="number" id="expenseAmount" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº" min="0" required>
     </div>
     <div class="form-group">
      <label><i class="fas fa-sticky-note"></i> Ø§Ù„ÙˆØµÙ</label>
      <textarea id="expenseDescription" class="form-control" rows="3" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…ØµØ±ÙˆÙ"></textarea>
     </div>
     <div class="form-group">
      <label><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
      <input type="date" id="expenseDate" class="form-control" required>
     </div>
     <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeAddExpenseModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn btn-primary" onclick="saveExpense()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
     </div>
    </div>
   </div>
  </div>

  <!-- ğŸ›’ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª -->
  <div id="addPurchaseModal" class="modal">
   <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-cart-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø© Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
     <button class="close-btn" onclick="closeAddPurchaseModal()"> <i class="fas fa-times"></i> </button>
    </div>
    <div class="modal-body">
     <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-building"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯</h4>
      <div class="form-row">
       <div class="form-group" style="flex: 1;">
        <label><i class="fas fa-building"></i> Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯</label>
        <input type="text" id="supplierName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯" required>
       </div>
       <div class="form-group" style="flex: 1;">
        <label><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="tel" id="supplierPhone" class="form-control" placeholder="07XX XXX XXXX">
       </div>
      </div>
      <div class="form-row">
       <div class="form-group" style="flex: 1;">
        <label><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
        <input type="text" id="invoiceNumber" class="form-control" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
       </div>
       <div class="form-group" style="flex: 1;">
        <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
        <input type="date" id="purchaseDate" class="form-control" required>
       </div>
      </div>
     </div>

     <!-- Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
     <div style="margin-bottom: 1.5rem;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
       <h4 style="color: var(--primary-color);"><i class="fas fa-boxes"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
       <button class="btn btn-success" onclick="addPurchaseItem()"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
      </div>
      <div id="purchaseItemsContainer">
       <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
      </div>
     </div>

     <!-- Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius);">
      <div class="summary-row">
       <span style="font-size: 1.2rem; font-weight: bold;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
       <span id="purchaseTotalAmount" style="font-size: 1.3rem; font-weight: bold; color: var(--primary-color);">0 Ø¯ÙŠÙ†Ø§Ø±</span>
      </div>
     </div>

     <div class="modal-footer" style="margin-top: 1.5rem;">
      <button class="btn btn-secondary" onclick="closeAddPurchaseModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn btn-primary" onclick="savePurchase()"><i class="fas fa-save"></i> Ø­ÙØ¸ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</button>
     </div>
    </div>
   </div>
  </div>

  <!-- ğŸ“ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
  <div id="viewPurchaseModal" class="modal">
   <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-file-invoice"></i> ØªÙØ§ØµÙŠÙ„ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
     <button class="close-btn" onclick="closeViewPurchaseModal()"> <i class="fas fa-times"></i> </button>
    </div>
    <div class="modal-body" id="purchaseDetailsContent">
     <!-- Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
   </div>
  </div>

  <!-- ğŸ’³ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† ÙŠØ¯ÙˆÙŠØ§Ù‹ -->
  <div id="addManualDebtModal" class="modal">
   <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯</h3>
     <button class="close-btn" onclick="closeAddManualDebtModal()"> <i class="fas fa-times"></i> </button>
    </div>
    <div class="modal-body">
     <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
      <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
       <div class="form-group">
        <label><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
        <input type="text" id="manualDebtCustomerName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="tel" id="manualDebtCustomerPhone" class="form-control" placeholder="07XX XXX XXXX" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input type="text" id="manualDebtCustomerAddress" class="form-control" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„">
       </div>
       <div class="form-group">
        <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙŠÙ†</label>
        <input type="date" id="manualDebtDate" class="form-control" required>
       </div>
      </div>
     </div>

     <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-shopping-cart"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
      
      <!-- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
      <div class="form-group">
       <label><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬</label>
       <div style="position: relative;">
        <input type="text" id="manualDebtProductSearch" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." oninput="searchProductsForDebt(this.value)">
        <div id="manualDebtProductSearchResults" style="position: absolute; top: 100%; left: 0; right: 0; background: var(--theme-bg-primary); border: 1px solid var(--theme-border-color); border-radius: var(--border-radius); max-height: 200px; overflow-y: auto; z-index: 1000; display: none; margin-top: 5px;"></div>
       </div>
      </div>
      
      <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ÙŠØ¯ÙˆÙŠØ§Ù‹ -->
      <div class="form-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 1rem; align-items: end; margin-bottom: 1rem;">
       <div class="form-group" style="margin: 0;">
        <label><i class="fas fa-box"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input type="text" id="manualDebtProductName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
       </div>
       <div class="form-group" style="margin: 0;">
        <label><i class="fas fa-tag"></i> Ø§Ù„Ø³Ø¹Ø±</label>
        <input type="number" id="manualDebtProductPrice" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø±" min="0">
       </div>
       <div class="form-group" style="margin: 0;">
        <label><i class="fas fa-sort-numeric-up"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input type="number" id="manualDebtProductQty" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="1" value="1">
       </div>
       <button type="button" class="btn btn-success" onclick="addManualDebtProduct()" style="padding: 0.75rem 1.5rem;">
        <i class="fas fa-plus"></i>
       </button>
      </div>
      
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
      <div id="manualDebtProductsContainer" style="display: none; margin-top: 1rem;">
       <h5 style="margin-bottom: 0.75rem; color: var(--theme-text-secondary);"><i class="fas fa-list"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h5>
       <div class="table-container" style="max-height: 300px; overflow-y: auto;">
        <table class="table">
         <thead>
          <tr>
           <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
           <th>Ø§Ù„Ø³Ø¹Ø±</th>
           <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
           <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
           <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
         </thead>
         <tbody id="manualDebtProductsTable">
         </tbody>
        </table>
       </div>
      </div>
     </div>

     <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-money-bill-wave"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†</h4>
      <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
       <div class="form-group">
        <label><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¯ÙŠÙ†Ø§Ø±)</label>
        <input type="number" id="manualDebtTotalAmount" class="form-control" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" min="0" onchange="calculateManualDebtInstallments()" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-hand-holding-usd"></i> Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (Ø¯ÙŠÙ†Ø§Ø±)</label>
        <input type="number" id="manualDebtDownPayment" class="form-control" placeholder="0" min="0" value="0" onchange="calculateManualDebtInstallments()">
       </div>
       <div class="form-group">
        <label><i class="fas fa-calendar-alt"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</label>
        <input type="number" id="manualDebtMonths" class="form-control" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±" min="1" max="60" onchange="calculateManualDebtInstallments()" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-plus-circle"></i> Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="number" id="manualDebtAdditionalAmount" class="form-control" placeholder="0" min="0" value="0" onchange="calculateManualDebtInstallments()">
       </div>
       <div class="form-group">
        <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</label>
        <input type="date" id="manualDebtStartDate" class="form-control">
       </div>
      </div>
      <div class="form-group">
       <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
       <textarea id="manualDebtNotes" class="form-control" rows="2" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø¯ÙŠÙ†"></textarea>
      </div>
     </div>

     <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
     <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 1.5rem; border-radius: var(--border-radius); border: 2px solid rgba(99, 102, 241, 0.3);">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-calculator"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h4>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
       <div style="text-align: center;">
        <div style="font-size: 0.9rem; color: var(--theme-text-tertiary); margin-bottom: 0.5rem;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
        <div id="manualDebtRemainingAmount" style="font-size: 1.5rem; font-weight: bold; color: var(--danger-color);">0 Ø¯ÙŠÙ†Ø§Ø±</div>
       </div>
       <div style="text-align: center;">
        <div style="font-size: 0.9rem; color: var(--theme-text-tertiary); margin-bottom: 0.5rem;">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
        <div id="manualDebtMonthlyAmount" style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">0 Ø¯ÙŠÙ†Ø§Ø±</div>
       </div>
       <div style="text-align: center;">
        <div style="font-size: 0.9rem; color: var(--theme-text-tertiary); margin-bottom: 0.5rem;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
        <div id="manualDebtFinalTotal" style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">0 Ø¯ÙŠÙ†Ø§Ø±</div>
       </div>
      </div>
     </div>

     <div class="modal-footer" style="margin-top: 1.5rem;">
      <button class="btn btn-secondary" onclick="closeAddManualDebtModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn btn-primary" onclick="saveManualDebt()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†</button>
     </div>
    </div>
   </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ -->
  <div id="editDebtModal" class="modal">
   <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
     <h3 class="modal-title"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¯ÙŠÙ† Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
     <button class="close-btn" onclick="closeEditDebtModal()"> <i class="fas fa-times"></i> </button>
    </div>
    <div class="modal-body">
     <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
      <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
       <div class="form-group">
        <label><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
        <input type="text" id="editDebtCustomerName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
        <input type="tel" id="editDebtCustomerPhone" class="form-control" placeholder="07XX XXX XXXX" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
        <input type="text" id="editDebtCustomerAddress" class="form-control" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„">
       </div>
       <div class="form-group">
        <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙŠÙ†</label>
        <input type="date" id="editDebtDate" class="form-control" required>
       </div>
      </div>
     </div>

     <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-shopping-cart"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
      
      <!-- Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
      <div class="form-group">
       <label><i class="fas fa-search"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬</label>
       <div style="position: relative;">
        <input type="text" id="editDebtProductSearch" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." oninput="searchProductsForEditDebt(this.value)">
        <div id="editDebtProductSearchResults" style="position: absolute; top: 100%; left: 0; right: 0; background: var(--theme-bg-primary); border: 1px solid var(--theme-border-color); border-radius: var(--border-radius); max-height: 200px; overflow-y: auto; z-index: 1000; display: none; margin-top: 5px;"></div>
       </div>
      </div>
      
      <!-- Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ÙŠØ¯ÙˆÙŠØ§Ù‹ -->
      <div class="form-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 1rem; align-items: end; margin-bottom: 1rem;">
       <div class="form-group" style="margin: 0;">
        <label><i class="fas fa-box"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input type="text" id="editDebtProductName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
       </div>
       <div class="form-group" style="margin: 0;">
        <label><i class="fas fa-tag"></i> Ø§Ù„Ø³Ø¹Ø±</label>
        <input type="number" id="editDebtProductPrice" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø±" min="0">
       </div>
       <div class="form-group" style="margin: 0;">
        <label><i class="fas fa-sort-numeric-up"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input type="number" id="editDebtProductQty" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="1" value="1">
       </div>
       <button type="button" class="btn btn-success" onclick="addEditDebtProduct()" style="padding: 0.75rem 1.5rem;">
        <i class="fas fa-plus"></i>
       </button>
      </div>
      
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
      <div id="editDebtProductsContainer" style="display: none; margin-top: 1rem;">
       <h5 style="margin-bottom: 0.75rem; color: var(--theme-text-secondary);"><i class="fas fa-list"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h5>
       <div class="table-container" style="max-height: 300px; overflow-y: auto;">
        <table class="table">
         <thead>
          <tr>
           <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
           <th>Ø§Ù„Ø³Ø¹Ø±</th>
           <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
           <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
           <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
         </thead>
         <tbody id="editDebtProductsTable">
         </tbody>
        </table>
       </div>
      </div>
     </div>

     <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† -->
     <div style="background: var(--theme-bg-secondary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-money-bill-wave"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†</h4>
      <div class="form-row" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
       <div class="form-group">
        <label><i class="fas fa-money-bill"></i> Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¯ÙŠÙ†Ø§Ø±)</label>
        <input type="number" id="editDebtTotalAmount" class="form-control" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" min="0" onchange="calculateEditDebtInstallments()" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-hand-holding-usd"></i> Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© (Ø¯ÙŠÙ†Ø§Ø±)</label>
        <input type="number" id="editDebtDownPayment" class="form-control" placeholder="0" min="0" value="0" onchange="calculateEditDebtInstallments()">
       </div>
       <div class="form-group">
        <label><i class="fas fa-calendar-alt"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</label>
        <input type="number" id="editDebtMonths" class="form-control" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±" min="1" max="60" onchange="calculateEditDebtInstallments()" required>
       </div>
       <div class="form-group">
        <label><i class="fas fa-plus-circle"></i> Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="number" id="editDebtAdditionalAmount" class="form-control" placeholder="0" min="0" value="0" onchange="calculateEditDebtInstallments()">
       </div>
       <div class="form-group">
        <label><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</label>
        <input type="date" id="editDebtStartDate" class="form-control">
       </div>
      </div>
      <div class="form-group">
       <label><i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
       <textarea id="editDebtNotes" class="form-control" rows="2" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø¯ÙŠÙ†"></textarea>
      </div>
     </div>

     <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
     <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); padding: 1.5rem; border-radius: var(--border-radius); border: 2px solid rgba(99, 102, 241, 0.3);">
      <h4 style="margin-bottom: 1rem; color: var(--primary-color);"><i class="fas fa-calculator"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h4>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
       <div style="text-align: center;">
        <div style="font-size: 0.9rem; color: var(--theme-text-tertiary); margin-bottom: 0.5rem;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
        <div id="editDebtRemainingAmount" style="font-size: 1.5rem; font-weight: bold; color: var(--danger-color);">0 Ø¯ÙŠÙ†Ø§Ø±</div>
       </div>
       <div style="text-align: center;">
        <div style="font-size: 0.9rem; color: var(--theme-text-tertiary); margin-bottom: 0.5rem;">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
        <div id="editDebtMonthlyAmount" style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">0 Ø¯ÙŠÙ†Ø§Ø±</div>
       </div>
       <div style="text-align: center;">
        <div style="font-size: 0.9rem; color: var(--theme-text-tertiary); margin-bottom: 0.5rem;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
        <div id="editDebtFinalTotal" style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">0 Ø¯ÙŠÙ†Ø§Ø±</div>
       </div>
      </div>
     </div>

     <div class="modal-footer" style="margin-top: 1.5rem;">
      <button class="btn btn-secondary" onclick="closeEditDebtModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="btn btn-primary" onclick="updateDebt()"><i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
     </div>
    </div>
   </div>
  </div>

  <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let cart = [];
        let products = [];
        let categories = [];
        let salesData = [];
        let debtsData = [];
        let selectedPaymentMethod = 'Ù†Ù‚Ø¯ÙŠ';
        let isLoading = false;
        let currentCategory = 'all';
        let currentTheme = 'dark';
        let sidebarCollapsed = false;
        
        // ğŸ’° Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
        let expensesData = [];
        let purchasesData = [];
        let currentExpenseTab = 'general';
        let purchaseItems = [];
        
        // Ù…ØªØºÙŠØ±Ø§Øª ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø·
        let currentInstallmentDebtId = null;
        let currentInstallmentMonth = null;
        
        // Ù…ØªØºÙŠØ± Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†
        let debtToDelete = null;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙŠÙ†
        let manualDebtProducts = [];
        let editDebtProducts = [];
        let currentEditDebtId = null;

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultConfig = {
            store_name: 'Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©',
            store_address: 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„Ù…Ù†ØµÙˆØ±',
            store_phone: '07803092185',
            tax_rate: '0'
        };

        // Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        const availableIcons = [
            // Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª ÙˆØ­ÙˆØ§Ø³ÙŠØ¨
            'fas fa-laptop', 'fas fa-desktop', 'fas fa-tablet-alt', 'fas fa-mobile-alt',
            'fas fa-keyboard', 'fas fa-mouse', 'fas fa-headphones', 'fas fa-microphone',
            'fas fa-camera', 'fas fa-video', 'fas fa-webcam', 'fas fa-gamepad',
            'fas fa-headset', 'fas fa-microchip', 'fas fa-memory', 'fas fa-hdd',
            'fas fa-sim-card', 'fas fa-sd-card', 'fas fa-save', 'fas fa-compact-disc',
            'fas fa-server', 'fas fa-database', 'fas fa-network-wired', 'fas fa-ethernet',
            'fas fa-wifi', 'fas fa-bluetooth', 'fas fa-satellite-dish', 'fas fa-router',
            'fas fa-usb', 'fas fa-plug', 'fas fa-power-off', 'fas fa-print',
            'fas fa-scanner', 'fas fa-fax', 'fas fa-calculator', 'fas fa-cash-register',
            
            // Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù…Ù†Ø²Ù„ÙŠØ©
            'fas fa-tv', 'fas fa-blender', 'fas fa-lightbulb', 'fas fa-fan', 
            'fas fa-snowflake', 'fas fa-fire', 'fas fa-temperature-high', 'fas fa-temperature-low',
            'fas fa-thermometer-half', 'fas fa-wind', 'fas fa-bolt', 'fas fa-charging-station',
            'fas fa-battery-full', 'fas fa-battery-half', 'fas fa-battery-quarter', 'fas fa-solar-panel',
            'fas fa-broadcast-tower', 'fas fa-satellite', 'fas fa-coffee', 'fas fa-mug-hot',
            'fas fa-blender-phone', 'fas fa-utensils', 'fas fa-sink', 'fas fa-toilet',
            'fas fa-shower', 'fas fa-bath', 'fas fa-pump-soap', 'fas fa-spray-can',
            
            // Ù…ÙƒØªØ¨ÙŠØ§Øª ÙˆÙ‚Ø±Ø·Ø§Ø³ÙŠØ©
            'fas fa-book', 'fas fa-book-open', 'fas fa-bookmark', 'fas fa-books',
            'fas fa-pen', 'fas fa-pencil-alt', 'fas fa-pen-fancy', 'fas fa-pen-nib',
            'fas fa-marker', 'fas fa-highlighter', 'fas fa-eraser', 'fas fa-ruler',
            'fas fa-ruler-combined', 'fas fa-ruler-horizontal', 'fas fa-ruler-vertical', 'fas fa-drafting-compass',
            'fas fa-paperclip', 'fas fa-thumbtack', 'fas fa-sticky-note', 'fas fa-clipboard',
            'fas fa-clipboard-list', 'fas fa-paste', 'fas fa-file', 'fas fa-file-alt',
            'fas fa-folder', 'fas fa-folder-open', 'fas fa-archive', 'fas fa-envelope',
            'fas fa-envelope-open', 'fas fa-stamp', 'fas fa-stapler', 'fas fa-scissors',
            
            // Ø£Ø«Ø§Ø« ÙˆÙ…ÙƒØ§ØªØ¨
            'fas fa-chair', 'fas fa-couch', 'fas fa-bed', 'fas fa-door-open',
            'fas fa-door-closed', 'fas fa-table', 'fas fa-desktop', 'fas fa-lamp',
            'fas fa-warehouse', 'fas fa-store', 'fas fa-store-alt', 'fas fa-building',
            
            // Ù…Ù„Ø§Ø¨Ø³ ÙˆØ¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª
            'fas fa-tshirt', 'fas fa-hat-cowboy', 'fas fa-hat-wizard', 'fas fa-glasses',
            'fas fa-sunglasses', 'fas fa-ring', 'fas fa-gem', 'fas fa-crown',
            'fas fa-user-tie', 'fas fa-shoe-prints', 'fas fa-socks', 'fas fa-mitten',
            'fas fa-watch', 'fas fa-clock', 'fas fa-stopwatch', 'fas fa-hourglass',
            
            // Ø±ÙŠØ§Ø¶Ø© ÙˆÙ„ÙŠØ§Ù‚Ø©
            'fas fa-dumbbell', 'fas fa-running', 'fas fa-walking', 'fas fa-biking',
            'fas fa-swimming-pool', 'fas fa-bicycle', 'fas fa-football-ball', 'fas fa-basketball-ball',
            'fas fa-baseball-ball', 'fas fa-volleyball-ball', 'fas fa-table-tennis', 'fas fa-bowling-ball',
            'fas fa-skating', 'fas fa-skiing', 'fas fa-snowboarding', 'fas fa-heart',
            
            // Ø£Ø¯ÙˆØ§Øª ÙˆØµÙŠØ§Ù†Ø©
            'fas fa-tools', 'fas fa-wrench', 'fas fa-screwdriver', 'fas fa-hammer',
            'fas fa-toolbox', 'fas fa-cog', 'fas fa-cogs', 'fas fa-paint-roller',
            'fas fa-brush', 'fas fa-magic', 'fas fa-spray-can', 'fas fa-fire-extinguisher',
            'fas fa-flashlight', 'fas fa-oil-can', 'fas fa-tape', 'fas fa-shield-alt',
            
            // Ø·Ø¨ÙŠØ© ÙˆØµØ­ÙŠØ©
            'fas fa-medkit', 'fas fa-first-aid', 'fas fa-pills', 'fas fa-prescription-bottle',
            'fas fa-syringe', 'fas fa-thermometer', 'fas fa-heartbeat', 'fas fa-stethoscope',
            'fas fa-hospital', 'fas fa-ambulance', 'fas fa-wheelchair', 'fas fa-hand-holding-medical',
            
            // Ø³ÙŠØ§Ø±Ø§Øª ÙˆÙ…Ø±ÙƒØ¨Ø§Øª
            'fas fa-car', 'fas fa-car-side', 'fas fa-car-alt', 'fas fa-truck',
            'fas fa-motorcycle', 'fas fa-bus', 'fas fa-taxi', 'fas fa-shuttle-van',
            'fas fa-oil-can', 'fas fa-gas-pump', 'fas fa-tire', 'fas fa-wheel',
            
            // Ø·Ø¹Ø§Ù… ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª
            'fas fa-utensils', 'fas fa-utensil-spoon', 'fas fa-utensil-fork', 'fas fa-pizza-slice',
            'fas fa-hamburger', 'fas fa-hotdog', 'fas fa-ice-cream', 'fas fa-cake',
            'fas fa-birthday-cake', 'fas fa-cookie', 'fas fa-apple-alt', 'fas fa-lemon',
            'fas fa-carrot', 'fas fa-pepper-hot', 'fas fa-cheese', 'fas fa-bread-slice',
            'fas fa-coffee', 'fas fa-mug-hot', 'fas fa-wine-glass', 'fas fa-glass-martini',
            'fas fa-beer', 'fas fa-wine-bottle', 'fas fa-flask', 'fas fa-blender',
            
            // Ø­ÙŠÙˆØ§Ù†Ø§Øª ÙˆÙ†Ø¨Ø§ØªØ§Øª
            'fas fa-dog', 'fas fa-cat', 'fas fa-fish', 'fas fa-dove',
            'fas fa-spider', 'fas fa-frog', 'fas fa-horse', 'fas fa-crow',
            'fas fa-seedling', 'fas fa-tree', 'fas fa-leaf', 'fas fa-cannabis',
            
            // ØªØ±ÙÙŠÙ‡ ÙˆÙÙ†ÙˆÙ†
            'fas fa-music', 'fas fa-guitar', 'fas fa-drum', 'fas fa-film',
            'fas fa-photo-video', 'fas fa-palette', 'fas fa-paint-brush', 'fas fa-theater-masks',
            'fas fa-ticket-alt', 'fas fa-trophy', 'fas fa-medal', 'fas fa-award',
            
            // ØªØ¹Ù„ÙŠÙ… ÙˆØ¹Ù„ÙˆÙ…
            'fas fa-graduation-cap', 'fas fa-school', 'fas fa-chalkboard', 'fas fa-chalkboard-teacher',
            'fas fa-user-graduate', 'fas fa-flask', 'fas fa-microscope', 'fas fa-atom',
            'fas fa-dna', 'fas fa-vial', 'fas fa-vials', 'fas fa-magnet',
            
            // Ø¹Ø§Ù…Ø© ÙˆÙ…ØªÙ†ÙˆØ¹Ø©
            'fas fa-box', 'fas fa-boxes', 'fas fa-cube', 'fas fa-cubes',
            'fas fa-shopping-bag', 'fas fa-shopping-cart', 'fas fa-shopping-basket', 'fas fa-gift',
            'fas fa-tag', 'fas fa-tags', 'fas fa-barcode', 'fas fa-qrcode',
            'fas fa-star', 'fas fa-crown', 'fas fa-gem', 'fas fa-key',
            'fas fa-lock', 'fas fa-unlock', 'fas fa-shield-alt', 'fas fa-home',
            'fas fa-map-marker-alt', 'fas fa-phone', 'fas fa-envelope', 'fas fa-globe',
            'fas fa-flag', 'fas fa-bell', 'fas fa-comment', 'fas fa-comments',
            'fas fa-umbrella', 'fas fa-sun', 'fas fa-moon', 'fas fa-cloud',
            'fas fa-snowflake', 'fas fa-rainbow', 'fas fa-fire', 'fas fa-water'
        ];

        // Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€ Data SDK
        const dataHandler = {
            async onDataChanged(data) {
                // ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                products = data.filter(item => item.type === 'product');
                categories = data.filter(item => item.type === 'category');
                salesData = data.filter(item => item.type === 'sale');
                debtsData = data.filter(item => item.type === 'debt');
                
                console.log('Data changed - debtsData:', debtsData);
                
                // âœ… Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ localStorage ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                await ensureDebtsInLocalStorage();
                
                // Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                if (typeof fixDebtsData === 'function' && debtsData && debtsData.length > 0) {
                    console.log('ğŸ”§ Running automatic debt data repair on data change...');
                    await fixDebtsData();
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
                updateAllViews();
            }
        };

        // ==================== Ø¯ÙˆØ§Ù„ Firebase ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… ====================
        
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†
        function generateRandomKey(len = 10) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let s = '';
            for (let i = 0; i < len; i++) s += chars.charAt(Math.floor(Math.random() * chars.length));
            return s;
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        window.createLocalUserIfNeeded = function() {
            document.getElementById('userDetailsForm').style.display = 'block';
        };

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        window.hideUserDetailsForm = function() {
            document.getElementById('userDetailsForm').style.display = 'none';
        };

        // Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
        window.getUserLocation = function() {
            const status = document.getElementById('locationStatus');
            status.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(pos) {
                    document.getElementById('newUserLat').value = pos.coords.latitude;
                    document.getElementById('newUserLng').value = pos.coords.longitude;
                    status.textContent = 'ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­';
                }, function(err) {
                    let msg = 'ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                    if (window && window.process && window.process.type === 'renderer') {
                        msg += ' - Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªÙØ¹ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ùˆ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒÙ…Ø³Ø¤ÙˆÙ„.';
                    } else if (err && err.code === 1) {
                        msg += ' - ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.';
                    } else if (err && err.code === 2) {
                        msg += ' - Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ GPS.';
                    } else if (err && err.code === 3) {
                        msg += ' - Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø·Ù„Ø¨. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.';
                    }
                    status.textContent = msg;
                });
            } else {
                status.textContent = 'Ø§Ù„Ù…ØªØµÙØ­ Ø£Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø³Ø·Ø­ Ù…ÙƒØªØ¨ØŒ Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªÙØ¹ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù….';
            }
        };

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
        window.saveNewUserDetails = async function() {
            // âœ… ÙØ­Øµ Firebase Ø£ÙˆÙ„Ø§Ù‹
            if (!window.database || typeof database === 'undefined') {
                console.error('âŒ Firebase ØºÙŠØ± Ù…ØªØµÙ„');
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Firebase
                if (typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0) {
                    try {
                        window.database = firebase.database();
                        console.log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­');
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                        setTimeout(() => window.saveNewUserDetails(), 1000);
                        return;
                    } catch (error) {
                        console.error('âŒ ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
                    }
                }
                
                alert('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!\n\nØ§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù†:\n1. Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n2. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚\n3. Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø±Øª Ø§Ù„Ù…Ø´ÙƒÙ„Ø©');
                return;
            }

            const fullName = document.getElementById('newUserFullName').value.trim();
            const phone = document.getElementById('newUserPhone').value.trim();
            const address = document.getElementById('newUserAddress').value.trim();
            const storeName = document.getElementById('newUserStoreName').value.trim();
            const lat = document.getElementById('newUserLat').value;
            const lng = document.getElementById('newUserLng').value;

            if (!fullName || !phone || !address || !storeName) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            try {
                let uid = localStorage.getItem('app_uid');
                let secret = localStorage.getItem('app_secret');
                
                if (uid && secret) {
                    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
                    try {
                        const snap = await database.ref(`users/${uid}`).once('value');
                        if (snap.exists()) {
                            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                            return;
                        }
                    } catch (error) {
                        console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯:', error);
                        // Ù†ØªØ§Ø¨Ø¹ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    }
                }

                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯...');
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                const newUserRef = database.ref('users').push();
                uid = newUserRef.key;
                secret = generateRandomKey(10);

                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ø±Ø¨Ø©
                let trialDays = 30; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                try {
                    const appSettingsSnap = await database.ref('appSettings/trialDays').once('value');
                    if (appSettingsSnap.exists()) {
                        trialDays = Number(appSettingsSnap.val());
                    }
                } catch (error) {
                    console.warn('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:', error);
                }

                const createdAt = Date.now();
                const trialUntil = createdAt + (trialDays * 24 * 60 * 60 * 1000);

                const userObj = {
                    profile: {
                        uid,
                        secret,
                        fullName,
                        phone,
                        address,
                        storeName,
                        lat: lat || null,
                        lng: lng || null,
                        createdAt,
                        deviceInfo: {
                            platform: navigator.platform || '',
                            userAgent: navigator.userAgent || '',
                            appVersion: localStorage.getItem('app_version') || '2.0.0'
                        }
                    },
                    trialUntil,
                    subscription: null,
                    status: 'active',
                    createdBy: 'desktop_app'
                };

                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase
                await database.ref(`users/${uid}`).set(userObj);
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
                localStorage.setItem('app_uid', uid);
                localStorage.setItem('app_secret', secret);
                window.currentUser = userObj;
                window.currentUser.uid = uid;
                
                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                console.log('ğŸ“ UID:', uid);
                
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const formElement = document.getElementById('userDetailsForm');
                if (formElement) {
                    formElement.style.display = 'none';
                }
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                showModal('userInfoModal');
                
                const uidElement = document.getElementById('userUID');
                const secretElement = document.getElementById('userSecret');
                const trialElement = document.getElementById('trialDaysDisplay');
                
                if (uidElement) uidElement.textContent = uid;
                if (secretElement) secretElement.textContent = secret;
                if (trialElement) trialElement.textContent = trialDays;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
                console.error('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error.message, error.stack);
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨.';
                
                if (error.code === 'PERMISSION_DENIED') {
                    errorMessage = 'âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
                } else if (error.message && error.message.includes('network')) {
                    errorMessage = 'âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.';
                } else if (error.message) {
                    errorMessage = `âš ï¸ Ø®Ø·Ø£: ${error.message}`;
                }
                
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                alert(errorMessage + '\n\nØ§Ù„Ø±Ø¬Ø§Ø¡:\n1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\n2. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚\n3. Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ: 07813798636');
            }
        };

        async function checkSubscriptionAndGate() {
            const uid = localStorage.getItem('app_uid');
            if (!uid) {
                showActivationModal();
                return false;
            }

            try {
                const userSnap = await database.ref(`users/${uid}`).once('value');
                if (!userSnap.exists()) {
                    showActivationModal();
                    return false;
                }

                const user = userSnap.val();
                const now = Date.now();
                const trialUntil = user.trialUntil;
                const sub = user.subscription;

                if ((sub && sub.validUntil && sub.validUntil > now) || (trialUntil && trialUntil > now)) {
                    window.currentUser = user;
                    window.currentUser.uid = uid;
                    console.log('âœ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ø§Ø±ÙŠ');
                    return true;
                } else {
                    console.log('âš ï¸ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ');
                    showActivationModal();
                    return false;
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
                return false;
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
        function showActivationModal() {
            showModal('activationModal');
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            showActivationTab('code');
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
        function closeActivationModal() {
            closeModal('activationModal');
        }

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„
        function showActivationTab(tab) {
            const codeTab = document.getElementById('codeTab');
            const loginTab = document.getElementById('loginTab');
            const codeBtn = document.getElementById('codeTabBtn');
            const loginBtn = document.getElementById('loginTabBtn');

            if (tab === 'code') {
                codeTab.style.display = 'block';
                loginTab.style.display = 'none';
                codeBtn.className = 'btn';
                codeBtn.style.background = 'var(--primary-gradient)';
                loginBtn.className = 'btn btn-secondary';
                loginBtn.style.background = '';
            } else {
                codeTab.style.display = 'none';
                loginTab.style.display = 'block';
                loginBtn.className = 'btn';
                loginBtn.style.background = 'var(--primary-gradient)';
                codeBtn.className = 'btn btn-secondary';
                codeBtn.style.background = '';
            }
        }

        // ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„
        async function activateWithCode() {
            const code = document.getElementById('activationCodeInput').value.trim().toUpperCase();
            
            if (!code) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±

            try {
                await redeemCode(code);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… UID Ùˆ Secret
        async function loginWithCredentials() {
            const uid = document.getElementById('loginUIDInput').value.trim();
            const secret = document.getElementById('loginSecretInput').value.trim();

            if (!uid || !secret) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±

            try {
                await handleLogin(uid, secret);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ù†Ø§ÙØ°Ø© Ø·Ù„Ø¨ Ø§Ù„ØªÙØ¹ÙŠÙ„ / Ø¯Ø®ÙˆÙ„ Ø¨Ø³ÙŠØ· (Ù…ÙØ­Ø¯Ù‘Ø«Ø©)
        function showActivationPrompt() {
            showActivationModal();
        }

        async function handleLogin(uid, secret) {
            try {
                const snap = await database.ref(`users/${uid}/profile`).once('value');
                if (!snap.exists()) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                const profile = snap.val();
                if (profile.secret !== secret) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
                localStorage.setItem('app_uid', uid);
                localStorage.setItem('app_secret', secret);
                
                // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userSnap = await database.ref(`users/${uid}`).once('value');
                window.currentUser = userSnap.val();
                window.currentUser.uid = uid;
                
                console.log('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
                closeActivationModal();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        async function redeemCode(code) {
            try {
                const codeSnap = await database.ref(`subscriptionCodes/${code}`).once('value');
                if (!codeSnap.exists()) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                
                const codeData = codeSnap.val();
                if (codeData.used) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                const uid = localStorage.getItem('app_uid');
                if (!uid) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                const validDays = Number(codeData.days || 30);
                const validUntil = Date.now() + (validDays * 24 * 60 * 60 * 1000);

                await database.ref(`users/${uid}/subscription`).set({
                    type: codeData.type || 'custom',
                    validUntil,
                    activatedByCode: code,
                    activatedAt: Date.now()
                });

                await database.ref(`subscriptionCodes/${code}`).update({
                    used: true,
                    usedBy: uid,
                    usedAt: Date.now()
                });

                console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
                closeActivationModal();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù…Ø²:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ===============================================
        // ğŸ§ª Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - TEST FUNCTIONS
        // ===============================================

        /**
         * Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ø¬Ø¹Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ Ù…Ø¤Ù‚ØªØ§Ù‹
         * Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: Ø§ÙØªØ­ Console (F12) ÙˆØ§ÙƒØªØ¨: testExpiredSubscription()
         */
        window.testExpiredSubscription = async function() {
            console.log('ğŸ§ª Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„...');
            
            const uid = localStorage.getItem('app_uid');
            if (!uid) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„');
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }

            try {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
                const originalSnap = await database.ref(`users/${uid}`).once('value');
                const originalData = originalSnap.val();
                
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹');
                window._testBackup = originalData;

                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙƒÙ…Ù†ØªÙ‡ÙŠ
                const yesterday = Date.now() - (24 * 60 * 60 * 1000); // Ø£Ù…Ø³
                
                await database.ref(`users/${uid}`).update({
                    trialUntil: yesterday,
                    subscription: {
                        type: 'expired_test',
                        validUntil: yesterday,
                        activatedAt: yesterday - (30 * 24 * 60 * 60 * 1000)
                    }
                });

                console.log('âœ… ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙƒÙ…Ù†ØªÙ‡ÙŠ');
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ...');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                const result = await checkSubscriptionAndGate();
                
                if (!result) {
                    console.log('âœ… ØªÙ… Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                    console.log('ğŸ’¡ Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©ØŒ Ø§ÙƒØªØ¨: restoreOriginalSubscription()');
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ' + error.message);
            }
        };

        /**
         * Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
         * Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: Ø§ÙØªØ­ Console ÙˆØ§ÙƒØªØ¨: restoreOriginalSubscription()
         */
        window.restoreOriginalSubscription = async function() {
            if (!window._testBackup) {
                console.warn('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©');
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©');
                return;
            }

            const uid = localStorage.getItem('app_uid');
            if (!uid) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„');
                return;
            }

            try {
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©...');
                
                await database.ref(`users/${uid}`).update({
                    trialUntil: window._testBackup.trialUntil,
                    subscription: window._testBackup.subscription || null
                });

                console.log('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...');
                
                delete window._testBackup;
                
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
            }
        };

        /**
         * Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
         * Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: Ø§ÙØªØ­ Console ÙˆØ§ÙƒØªØ¨: showActivationModalTest()
         */
        window.showActivationModalTest = function() {
            console.log('ğŸªŸ Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...');
            showActivationModal();
        };

        /**
         * ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
         * Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…: Ø§ÙØªØ­ Console ÙˆØ§ÙƒØªØ¨: checkCurrentSubscription()
         */
        window.checkCurrentSubscription = async function() {
            const uid = localStorage.getItem('app_uid');
            if (!uid) {
                console.error('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„');
                return;
            }

            try {
                const userSnap = await database.ref(`users/${uid}`).once('value');
                if (!userSnap.exists()) {
                    console.error('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                    return;
                }

                const user = userSnap.val();
                const now = Date.now();
                const trialUntil = user.trialUntil;
                const sub = user.subscription;

                console.log('ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ğŸ†” UID:', uid);
                console.log('ğŸ“… Ø§Ù„Ø¢Ù†:', new Date(now).toLocaleString('ar-IQ'));
                console.log('');
                
                if (trialUntil) {
                    const trialDaysLeft = Math.ceil((trialUntil - now) / (1000 * 60 * 60 * 24));
                    console.log('ğŸ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:');
                    console.log('   ØªÙ†ØªÙ‡ÙŠ ÙÙŠ:', new Date(trialUntil).toLocaleString('ar-IQ'));
                    console.log('   Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:', trialDaysLeft > 0 ? trialDaysLeft + ' ÙŠÙˆÙ…' : 'Ù…Ù†ØªÙ‡ÙŠØ© âŒ');
                }
                
                console.log('');
                
                if (sub && sub.validUntil) {
                    const subDaysLeft = Math.ceil((sub.validUntil - now) / (1000 * 60 * 60 * 24));
                    console.log('ğŸ’ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø¯ÙÙˆØ¹:');
                    console.log('   Ø§Ù„Ù†ÙˆØ¹:', sub.type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
                    console.log('   ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ:', new Date(sub.validUntil).toLocaleString('ar-IQ'));
                    console.log('   Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:', subDaysLeft > 0 ? subDaysLeft + ' ÙŠÙˆÙ…' : 'Ù…Ù†ØªÙ‡ÙŠ âŒ');
                    if (sub.activatedByCode) {
                        console.log('   ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ù„Ø±Ù…Ø²:', sub.activatedByCode);
                    }
                } else {
                    console.log('ğŸ’ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                }
                
                console.log('');
                
                const isValid = (sub && sub.validUntil && sub.validUntil > now) || (trialUntil && trialUntil > now);
                console.log('âœ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:', isValid ? 'Ø³Ø§Ø±ÙŠ âœ“' : 'Ù…Ù†ØªÙ‡ÙŠ âœ—');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:', error);
            }
        };

        // Ø·Ø¨Ø§Ø¹Ø© ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Console
        console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #667eea; font-weight: bold;');
        console.log('%cğŸ§ª Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:', 'color: #667eea; font-size: 16px; font-weight: bold;');
        console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #667eea; font-weight: bold;');
        console.log('%c1ï¸âƒ£ testExpiredSubscription()', 'color: #10b981; font-weight: bold;');
        console.log('   Ø¬Ø¹Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„');
        console.log('');
        console.log('%c2ï¸âƒ£ restoreOriginalSubscription()', 'color: #f59e0b; font-weight: bold;');
        console.log('   Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        console.log('');
        console.log('%c3ï¸âƒ£ showActivationModalTest()', 'color: #8b5cf6; font-weight: bold;');
        console.log('   Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©');
        console.log('');
        console.log('%c4ï¸âƒ£ checkCurrentSubscription()', 'color: #06b6d4; font-weight: bold;');
        console.log('   Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ');
        console.log('%câ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'color: #667eea; font-weight: bold;');

        // ===============================================
        // Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
        // ===============================================

        // Ø¯ÙˆØ§Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        async function saveProductForCurrentUser(productObj) {
            const uid = localStorage.getItem('app_uid');
            if (!uid) throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            
            const key = database.ref(`users/${uid}/products`).push().key;
            productObj.createdAt = Date.now();
            productObj.product_id = key;
            
            await database.ref(`users/${uid}/products/${key}`).set(productObj);
            
            // ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø·
            const actKey = database.ref(`users/${uid}/activities`).push().key;
            await database.ref(`users/${uid}/activities/${actKey}`).set({
                type: 'product_create',
                ref: key,
                productName: productObj.product_name || '',
                createdAt: Date.now()
            });
            
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬:', key);
            return key;
        }

        async function saveSaleForCurrentUser(saleObj) {
            const uid = localStorage.getItem('app_uid');
            if (!uid) throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            
            const key = database.ref(`users/${uid}/sales`).push().key;
            saleObj.createdAt = Date.now();
            saleObj.sale_id = key;
            
            await database.ref(`users/${uid}/sales/${key}`).set(saleObj);
            
            // ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø·
            const actKey = database.ref(`users/${uid}/activities`).push().key;
            await database.ref(`users/${uid}/activities/${actKey}`).set({
                type: 'sale_create',
                ref: key,
                totalAmount: saleObj.total_amount || 0,
                createdAt: Date.now()
            });
            
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹:', key);
            return key;
        }

        async function saveDebtForCurrentUser(debtObj) {
            const uid = localStorage.getItem('app_uid');
            if (!uid) throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            
            const key = database.ref(`users/${uid}/debts`).push().key;
            debtObj.createdAt = Date.now();
            debtObj.debt_id = key;
            
            await database.ref(`users/${uid}/debts/${key}`).set(debtObj);
            
            // ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø·
            const actKey = database.ref(`users/${uid}/activities`).push().key;
            await database.ref(`users/${uid}/activities/${actKey}`).set({
                type: 'debt_create',
                ref: key,
                customerName: debtObj.customer_name || '',
                totalAmount: debtObj.total_amount || 0,
                createdAt: Date.now()
            });
            
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†:', key);
            return key;
        }

        // âœ… Ø¯Ø§Ù„Ø© Ù„Ø¶Ù…Ø§Ù† Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ localStorage Ø¨Ø´ÙƒÙ„ Ø¥Ø¶Ø§ÙÙŠ
        async function ensureDebtsInLocalStorage() {
            try {
                if (debtsData && debtsData.length > 0) {
                    const debtsToSave = debtsData.map(debt => ({
                        ...debt,
                        type: 'debt'
                    }));
                    localStorage.setItem('cached_debts', JSON.stringify(debtsToSave));
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ localStorage (Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)');
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ localStorage:', error);
            }
        }

        // âœ… Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† localStorage
        async function loadDebtsFromLocalStorage() {
            try {
                const cachedDebts = localStorage.getItem('cached_debts');
                if (cachedDebts) {
                    const parsed = JSON.parse(cachedDebts);
                    console.log('ğŸ“¦ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¯ÙŠÙˆÙ† Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ localStorage:', parsed.length);
                    // Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
                    parsed.forEach(debt => {
                        const exists = debtsData.find(d => d.id === debt.id || d.debt_id === debt.debt_id);
                        if (!exists) {
                            debtsData.push(debt);
                            console.log('âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¯ÙŠÙ† Ù…Ù† localStorage:', debt.customer_name);
                        }
                    });
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† localStorage:', error);
            }
        }

        async function loadUserDataFromFirebase() {
            const uid = localStorage.getItem('app_uid');
            if (!uid) return;

            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const productsSnap = await database.ref(`users/${uid}/products`).once('value');
                if (productsSnap.exists()) {
                    const productsObj = productsSnap.val();
                    products = Object.keys(productsObj).map(key => ({
                        ...productsObj[key],
                        product_id: key,
                        type: 'product'
                    }));
                }

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                const salesSnap = await database.ref(`users/${uid}/sales`).once('value');
                if (salesSnap.exists()) {
                    const salesObj = salesSnap.val();
                    salesData = Object.keys(salesObj).map(key => ({
                        ...salesObj[key],
                        sale_id: key,
                        type: 'sale'
                    }));
                }

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ†
                const debtsSnap = await database.ref(`users/${uid}/debts`).once('value');
                if (debtsSnap.exists()) {
                    const debtsObj = debtsSnap.val();
                    debtsData = Object.keys(debtsObj).map(key => ({
                        ...debtsObj[key],
                        debt_id: key,
                        type: 'debt'
                    }));
                }

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                const categoriesSnap = await database.ref(`users/${uid}/categories`).once('value');
                if (categoriesSnap.exists()) {
                    const categoriesObj = categoriesSnap.val();
                    categories = Object.keys(categoriesObj).map(key => ({
                        ...categoriesObj[key],
                        category_id: key,
                        type: 'category'
                    }));
                }

                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase');
                updateAllViews();
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
        }

        // ==================== Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù„ Firebase ====================

        // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ø¹ Firestore ====================
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙØ±ÙŠØ¯
        function getUserId() {
            let userId = localStorage.getItem('user_id');
            if (!userId) {
                userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('user_id', userId);
            }
            return userId;
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
        async function syncToFirestore(collection, docId, data) {
            try {
                if (!window.firestore) {
                    console.warn('âš ï¸ Firestore ØºÙŠØ± Ù…ØªØ§Ø­');
                    return { success: false, error: 'Firestore ØºÙŠØ± Ù…ØªØ§Ø­' };
                }

                const userId = getUserId();
                const docRef = window.firestore
                    .collection('users')
                    .doc(userId)
                    .collection(collection)
                    .doc(docId);

                await docRef.set({
                    ...data,
                    lastModified: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: userId
                }, { merge: true });

                console.log(`âœ… ØªÙ… Ø­ÙØ¸ ${collection}/${docId} ÙÙŠ Firestore`);
                return { success: true };
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ ${collection}:`, error);
                return { success: false, error: error.message };
            }
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù Ù…Ù† Firestore
        async function deleteFromFirestore(collection, docId) {
            try {
                if (!window.firestore) return { success: false };

                const userId = getUserId();
                await window.firestore
                    .collection('users')
                    .doc(userId)
                    .collection(collection)
                    .doc(docId)
                    .delete();

                console.log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${collection}/${docId} Ù…Ù† Firestore`);
                return { success: true };
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù ${collection}:`, error);
                return { success: false, error: error.message };
            }
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        async function syncProductToFirestore(product) {
            return await syncToFirestore('products', product.id.toString(), {
                id: product.id,
                name: product.name,
                category: product.category,
                category_id: product.category_id,
                barcode: product.barcode,
                price: product.price,
                cost: product.cost,
                stock: product.stock,
                min_stock: product.min_stock,
                unit: product.unit,
                description: product.description,
                image: product.image,
                is_active: product.is_active,
                created_at: product.created_at || new Date().toISOString()
            });
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        async function syncCategoryToFirestore(category) {
            return await syncToFirestore('categories', category.id.toString(), {
                id: category.id,
                name: category.name,
                description: category.description,
                icon: category.icon,
                color: category.color,
                created_at: category.created_at || new Date().toISOString()
            });
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        async function syncSaleToFirestore(sale) {
            return await syncToFirestore('sales', sale.invoice_id || sale.id.toString(), {
                id: sale.id,
                invoice_id: sale.invoice_id,
                items: typeof sale.items === 'string' ? sale.items : JSON.stringify(sale.items),
                subtotal: sale.subtotal,
                tax_amount: sale.tax_amount,
                discount: sale.discount,
                discount_amount: sale.discount_amount,
                additional_amount: sale.additional_amount,
                final_total: sale.final_total,
                payment_method: sale.payment_method,
                payment_type: sale.payment_type,
                customer_name: sale.customer_name,
                customer_phone: sale.customer_phone,
                timestamp: sale.timestamp,
                created_at: sale.created_at || new Date().toISOString()
            });
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        async function syncDebtToFirestore(debt) {
            return await syncToFirestore('debts', debt.id.toString(), {
                id: debt.id,
                invoice_id: debt.invoice_id,
                customer_name: debt.customer_name,
                customer_phone: debt.customer_phone,
                customer_address: debt.customer_address,
                total_amount: debt.total_amount,
                paid_amount: debt.paid_amount,
                remaining_amount: debt.remaining_amount,
                monthly_amount: debt.monthly_amount,
                new_monthly_amount: debt.new_monthly_amount,
                installment_months: debt.installment_months,
                installments: debt.installments,
                status: debt.status,
                created_at: debt.created_at,
                next_payment_date: debt.next_payment_date,
                linked_invoices: debt.linked_invoices,
                merge_count: debt.merge_count,
                merge_method: debt.merge_method,
                payment_history: debt.payment_history
            });
        }

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore ÙˆØ¯Ù…Ø¬Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        async function fetchFromFirestore(collection) {
            try {
                if (!window.firestore) {
                    console.warn('âš ï¸ Firestore ØºÙŠØ± Ù…ØªØ§Ø­');
                    return [];
                }

                const userId = getUserId();
                const snapshot = await window.firestore
                    .collection('users')
                    .doc(userId)
                    .collection(collection)
                    .get();

                const data = [];
                snapshot.forEach(doc => {
                    data.push({ ...doc.data(), firestoreId: doc.id });
                });

                console.log(`âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${data.length} Ø³Ø¬Ù„ Ù…Ù† ${collection}`);
                return data;
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${collection}:`, error);
                return [];
            }
        }

        // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø­Ø°Ù)
        async function mergeDataWithLocal(collection, firestoreData, localDataArray, idField = 'id') {
            console.log(`ğŸ”„ Ø¯Ù…Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª ${collection}...`);
            console.log(`ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©: ${localDataArray.length} Ø³Ø¬Ù„`);
            console.log(`â˜ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firestore: ${firestoreData.length} Ø³Ø¬Ù„`);

            let addedCount = 0;
            let updatedCount = 0;

            for (const firestoreItem of firestoreData) {
                const itemId = firestoreItem[idField];
                const existingIndex = localDataArray.findIndex(item => item[idField] == itemId);

                if (existingIndex === -1) {
                    // Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ - Ø¥Ø¶Ø§ÙØ©
                    localDataArray.push(firestoreItem);
                    addedCount++;
                    console.log(`â• Ø¥Ø¶Ø§ÙØ© ${collection}: ${itemId}`);
                } else {
                    // Ø¹Ù†ØµØ± Ù…ÙˆØ¬ÙˆØ¯ - ØªØ­Ø¯ÙŠØ« Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£Ø­Ø¯Ø«
                    const localItem = localDataArray[existingIndex];
                    const localModified = new Date(localItem.lastModified || localItem.created_at || 0);
                    const firestoreModified = new Date(
                        firestoreItem.lastModified?.toDate?.() || 
                        firestoreItem.lastModified || 
                        firestoreItem.created_at || 
                        0
                    );

                    if (firestoreModified > localModified) {
                        localDataArray[existingIndex] = { ...localItem, ...firestoreItem };
                        updatedCount++;
                        console.log(`ğŸ”„ ØªØ­Ø¯ÙŠØ« ${collection}: ${itemId}`);
                    }
                }
            }

            console.log(`âœ… ${collection}: ØªÙ… Ø¥Ø¶Ø§ÙØ© ${addedCount} ÙˆØªØ­Ø¯ÙŠØ« ${updatedCount}`);
            return { added: addedCount, updated: updatedCount };
        }

        // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø©
        async function createFullBackup() {
            try {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±

                const userId = getUserId();
                const backupId = 'backup_' + new Date().toISOString().replace(/[:.]/g, '-');

                // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const backupData = {
                    version: '1.0',
                    timestamp: new Date().toISOString(),
                    userId: userId,
                    data: {
                        products: await dataSDK.queryByField('type', 'product'),
                        categories: await dataSDK.queryByField('type', 'category'),
                        sales: salesData || [],
                        debts: debtsData || [],
                        settings: {
                            store: JSON.parse(localStorage.getItem('storeSettings') || '{}'),
                            system: JSON.parse(localStorage.getItem('systemSettings') || '{}'),
                            printer: JSON.parse(localStorage.getItem('printerSettings') || '{}'),
                            theme: localStorage.getItem('currentTheme'),
                            customColors: JSON.parse(localStorage.getItem('customColors') || '{}')
                        }
                    }
                };

                // Ø­ÙØ¸ ÙÙŠ Firestore
                await window.firestore
                    .collection('users')
                    .doc(userId)
                    .collection('backups')
                    .doc(backupId)
                    .set(backupData);

                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', backupId);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                return { success: true, backupId };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return { success: false, error: error.message };
            }
        }

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        async function restoreFromBackup(backupId) {
            try {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±

                const userId = getUserId();
                const backupDoc = await window.firestore
                    .collection('users')
                    .doc(userId)
                    .collection('backups')
                    .doc(backupId)
                    .get();

                if (!backupDoc.exists) {
                    throw new Error('Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                }

                const backupData = backupDoc.data();
                console.log('ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©:', backupData);

                // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                let totalAdded = 0;
                let totalUpdated = 0;

                // Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                if (backupData.data.products) {
                    const localProducts = await dataSDK.queryByField('type', 'product');
                    const result = await mergeDataWithLocal('products', backupData.data.products, localProducts);
                    totalAdded += result.added;
                    totalUpdated += result.updated;
                    
                    // Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬Ø©
                    for (const product of localProducts) {
                        await dataSDK.save({ ...product, type: 'product' });
                    }
                }

                // Ø¯Ù…Ø¬ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                if (backupData.data.categories) {
                    const localCategories = await dataSDK.queryByField('type', 'category');
                    const result = await mergeDataWithLocal('categories', backupData.data.categories, localCategories);
                    totalAdded += result.added;
                    totalUpdated += result.updated;
                    
                    for (const category of localCategories) {
                        await dataSDK.save({ ...category, type: 'category' });
                    }
                }

                // Ø¯Ù…Ø¬ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
                if (backupData.data.sales) {
                    salesData = salesData || [];
                    const result = await mergeDataWithLocal('sales', backupData.data.sales, salesData, 'invoice_id');
                    totalAdded += result.added;
                    totalUpdated += result.updated;
                }

                // Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙˆÙ†
                if (backupData.data.debts) {
                    debtsData = debtsData || [];
                    const result = await mergeDataWithLocal('debts', backupData.data.debts, debtsData);
                    totalAdded += result.added;
                    totalUpdated += result.updated;
                }

                // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - ÙŠÙ…ÙƒÙ† ØªØ®Ø·ÙŠÙ‡)
                if (backupData.data.settings && confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙŠØ¶Ø§Ù‹ØŸ')) {
                    if (backupData.data.settings.store) {
                        localStorage.setItem('storeSettings', JSON.stringify(backupData.data.settings.store));
                    }
                    if (backupData.data.settings.system) {
                        localStorage.setItem('systemSettings', JSON.stringify(backupData.data.settings.system));
                    }
                    if (backupData.data.settings.printer) {
                        localStorage.setItem('printerSettings', JSON.stringify(backupData.data.settings.printer));
                    }
                    if (backupData.data.settings.theme) {
                        localStorage.setItem('currentTheme', backupData.data.settings.theme);
                    }
                    if (backupData.data.settings.customColors) {
                        localStorage.setItem('customColors', JSON.stringify(backupData.data.settings.customColors));
                    }
                }

                console.log('âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                if (confirm('ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŸ')) {
                    location.reload();
                }

                return { success: true, added: totalAdded, updated: totalUpdated };
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return { success: false, error: error.message };
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        async function getBackupsList() {
            try {
                const userId = getUserId();
                const snapshot = await window.firestore
                    .collection('users')
                    .doc(userId)
                    .collection('backups')
                    .orderBy('timestamp', 'desc')
                    .get();

                const backups = [];
                snapshot.forEach(doc => {
                    backups.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                return backups;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                return [];
            }
        }

        // ==================== Ù†Ù‡Ø§ÙŠØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ====================

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function updateLoaderStatus(message) {
            const statusEl = document.getElementById('loaderStatus');
            if (statusEl) {
                statusEl.textContent = message;
            }
            console.log('ğŸ“Š', message);
        }

        /* ============================================
           Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
           Digital Creativity - Kraar Al-Shaabari
           ============================================ */

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        class SecurityManager {
            constructor() {
                this.currentUser = null;
                this.users = [];
                this.auditLog = []; // Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
                this.init();
            }
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            getCurrentUsername() {
                return this.currentUser ? this.currentUser.username : 'Ù†Ø¸Ø§Ù…';
            }
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            getCurrentUserFullName() {
                return this.currentUser ? this.currentUser.name : 'Ø§Ù„Ù†Ø¸Ø§Ù…';
            }
            
            // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
            logOperation(action, details = {}) {
                const logEntry = {
                    id: 'log_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    timestamp: new Date().toISOString(),
                    user: this.getCurrentUsername(),
                    userName: this.getCurrentUserFullName(),
                    userRole: this.currentUser ? this.currentUser.role : 'system',
                    action: action,
                    details: details
                };
                
                this.auditLog.push(logEntry);
                
                // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„ ÙÙŠ localStorage
                try {
                    // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 1000 Ø¹Ù…Ù„ÙŠØ© ÙÙ‚Ø·
                    if (this.auditLog.length > 1000) {
                        this.auditLog = this.auditLog.slice(-1000);
                    }
                    localStorage.setItem('audit_log', JSON.stringify(this.auditLog));
                } catch (error) {
                    console.warn('ØªØ­Ø°ÙŠØ±: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­ÙØ¸ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', error);
                }
                
                console.log('ğŸ“ Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©:', action, 'Ø¨ÙˆØ§Ø³Ø·Ø©:', this.getCurrentUserFullName());
                
                return logEntry;
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            loadAuditLog() {
                try {
                    const savedLog = localStorage.getItem('audit_log');
                    if (savedLog) {
                        this.auditLog = JSON.parse(savedLog);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:', error);
                    this.auditLog = [];
                }
            }

            init() {
                console.log('ğŸ” ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†...');
                
                // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
                this.loadAuditLog();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† localStorage
                const savedUsers = localStorage.getItem('app_users');
                if (savedUsers) {
                    try {
                        this.users = JSON.parse(savedUsers);
                        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', this.users.length, 'Ù…Ø³ØªØ®Ø¯Ù…');
                    } catch (error) {
                        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯');
                        this.createDefaultAdmin();
                    }
                } else {
                    console.log('ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ...');
                    this.createDefaultAdmin();
                }

                console.log('ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ÙˆÙ†:');
                this.users.forEach(u => {
                    console.log(`  - ${u.username} (${u.role}) - ${u.active ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}`);
                });

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©
                const sessionUser = sessionStorage.getItem('current_user');
                if (sessionUser) {
                    this.currentUser = JSON.parse(sessionUser);
                    this.startInactivityTimer();
                    console.log('âœ… Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©:', this.currentUser.username);
                    
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø¬Ù„Ø³Ø©
                    this.logOperation('Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø¬Ù„Ø³Ø©', { username: this.currentUser.username });
                }
            }

            createDefaultAdmin() {
                this.users = [{
                    id: '1',
                    username: 'admin',
                    password: 'admin123',
                    name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…',
                    role: 'admin',
                    active: true,
                    permissions: this.getAllPermissions(),
                    created_at: new Date().toISOString()
                }];
                this.saveUsers();
                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ±: admin / admin123');
            }

            getAllPermissions() {
                return {
                    // Dashboard
                    dashboard_products_count: true,
                    dashboard_inventory_value: true,
                    dashboard_debts_count: true,
                    dashboard_debts_value: true,
                    dashboard_revenue: true,
                    dashboard_profit: true,

                    // Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
                    sidebar_pos: true,
                    sidebar_invoices: true,
                    sidebar_products: true,
                    sidebar_inventory: true,
                    sidebar_debts: true,
                    sidebar_reports: true,
                    sidebar_printer: true,
                    sidebar_settings: true,

                    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª
                    sales_view: true,
                    products_view: true,
                    inventory_view: true,
                    debts_view: true,
                    reports_view: true,
                    settings_view: true,

                    // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    products_add: true,
                    products_edit: true,
                    products_delete: true,
                    products_export: true,
                    products_import: true,
                    products_add_category: true,
                    products_stock_management: true,

                    // Ø§Ù„Ù…Ø®Ø²Ù†
                    inventory_add: true,
                    inventory_edit: true,
                    inventory_delete: true,
                    inventory_adjust: true,
                    inventory_history: true,
                    inventory_export: true,

                    // Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
                    pos_access: true,
                    pos_sell: true,
                    pos_add_to_cart: true,
                    pos_installment: true,
                    pos_discount: true,
                    pos_print: true,
                    pos_cancel: true,

                    // Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                    invoices_view: true,
                    invoices_delete: true,
                    invoices_export: true,

                    // Ø§Ù„Ø¯ÙŠÙˆÙ†
                    debts_view_details: true,
                    debts_payment: true,
                    debts_delete: true,
                    debts_export: true,
                    debts_reminders: true,

                    // Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                    reports_sales: true,
                    reports_inventory: true,
                    reports_debts: true,
                    reports_profit: true,
                    reports_export: true,

                    // Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    printer_configure: true,
                    printer_test: true,
                    settings_edit: true,
                    settings_backup: true,
                    settings_restore: true
                };
            }

            // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            saveUsers() {
                localStorage.setItem('app_users', JSON.stringify(this.users));
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            login(username, password) {
                console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©...');
                console.log('   Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯Ø®Ù„:', username);
                console.log('   Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„ÙƒÙ„ÙŠ:', this.users.length);
                
                // Ø·Ø¨Ø§Ø¹Ø© ØªÙØ§ØµÙŠÙ„ ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                this.users.forEach((u, index) => {
                    console.log(`   [${index}] username: "${u.username}", active: ${u.active}`);
                });
                
                const user = this.users.find(u => 
                    u.username === username && 
                    u.password === password && 
                    u.active
                );

                if (user) {
                    console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', user.name);
                    this.currentUser = user;
                    sessionStorage.setItem('current_user', JSON.stringify(user));
                    sessionStorage.setItem('is_logged_in', 'true');
                    sessionStorage.setItem('login_time', new Date().toISOString());
                    this.startInactivityTimer();
                    
                    // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    this.logOperation('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', { 
                        username: username,
                        role: user.role,
                        loginTime: new Date().toISOString()
                    });
                    
                    return { success: true, user };
                }

                console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                console.log('   Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù†:');
                console.log('   - Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµØ­ÙŠØ­ØŸ');
                console.log('   - ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØµØ­ÙŠØ­Ø©ØŸ');
                console.log('   - Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ø´Ø·ØŸ');
                
                // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©
                this.auditLog.push({
                    id: 'log_' + Date.now(),
                    timestamp: new Date().toISOString(),
                    user: username,
                    userName: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    userRole: 'unknown',
                    action: 'Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©',
                    details: { username: username }
                });
                
                return { success: false, message: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©' };
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            logout() {
                // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù‚Ø¨Ù„ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const username = this.currentUser ? this.currentUser.username : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                this.logOperation('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', { username: username });
                
                this.currentUser = null;
                sessionStorage.removeItem('current_user');
                sessionStorage.removeItem('is_logged_in');
                sessionStorage.removeItem('login_time');
                this.stopInactivityTimer();
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                window.location.reload();
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            hasPermission(permission) {
                if (!this.currentUser) return false;
                if (this.currentUser.role === 'admin') return true;
                return this.currentUser.permissions && this.currentUser.permissions[permission] === true;
            }

            // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            addUser(userData) {
                const newUser = {
                    id: Date.now().toString(),
                    ...userData,
                    created_at: new Date().toISOString(),
                    active: true
                };
                this.users.push(newUser);
                this.saveUsers();
                return { success: true, user: newUser };
            }

            updateUser(userId, userData) {
                const index = this.users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    this.users[index] = { ...this.users[index], ...userData };
                    this.saveUsers();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ùˆ Ù†ÙØ³Ù‡
                    if (this.currentUser && this.currentUser.id === userId) {
                        this.currentUser = this.users[index];
                        sessionStorage.setItem('current_user', JSON.stringify(this.currentUser));
                    }
                    
                    return { success: true, user: this.users[index] };
                }
                return { success: false, message: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
            }

            deleteUser(userId) {
                // Ù…Ù†Ø¹ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                const user = this.users.find(u => u.id === userId);
                if (user && user.id === '1') {
                    return { success: false, message: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ' };
                }

                const index = this.users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    this.users.splice(index, 1);
                    this.saveUsers();
                    return { success: true };
                }
                return { success: false, message: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
            }

            toggleUserStatus(userId) {
                // Ù…Ù†Ø¹ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                const user = this.users.find(u => u.id === userId);
                if (user && user.id === '1') {
                    return { success: false, message: 'Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ' };
                }

                const index = this.users.findIndex(u => u.id === userId);
                if (index !== -1) {
                    this.users[index].active = !this.users[index].active;
                    this.saveUsers();
                    return { success: true, user: this.users[index] };
                }
                return { success: false, message: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
            }

            getUsers() {
                return this.users;
            }

            // Ù…Ø¤Ù‚Øª Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·
            startInactivityTimer() {
                this.stopInactivityTimer();
                this.inactivityTimer = setTimeout(() => {
                    alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·');
                    this.logout();
                }, 30 * 60 * 1000); // 30 Ø¯Ù‚ÙŠÙ‚Ø©
            }

            stopInactivityTimer() {
                if (this.inactivityTimer) {
                    clearTimeout(this.inactivityTimer);
                    this.inactivityTimer = null;
                }
            }

            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù…Ø¤Ù‚Øª Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·
            resetInactivityTimer() {
                if (this.currentUser) {
                    this.startInactivityTimer();
                }
            }

            // Ø¹Ø±Ø¶ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            showLoginPage() {
                const loginOverlay = document.getElementById('loginOverlay');
                if (loginOverlay) {
                    loginOverlay.style.display = 'flex';
                }
            }

            // Ø¥Ø®ÙØ§Ø¡ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            hideLoginPage() {
                const loginOverlay = document.getElementById('loginOverlay');
                if (loginOverlay) {
                    loginOverlay.style.display = 'none';
                }
            }

            // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            handleLogin() {
                const username = document.getElementById('loginUsername').value.trim();
                const password = document.getElementById('loginPassword').value;

                console.log('ğŸ”‘ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', username);

                if (!username || !password) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                    return;
                }

                console.log('ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†:', this.users.length);
                console.log('ğŸ‘¤ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…:', username);

                const result = this.login(username, password);
                
                console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', result);

                if (result.success) {
                    console.log('âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­!');
                    this.hideLoginPage();
                    this.applyPermissions();
                    this.updateSidebarButtons();
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    if (typeof loadAllData === 'function') {
                        loadAllData();
                    }
                    
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    console.error('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', result.message);
                    alert(result.message);
                }
            }

            // ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù…Ø§Ù†
            openSecurityPanel() {
                if (!this.currentUser || this.currentUser.role !== 'admin') {
                    alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙÙ‚Ø·');
                    return;
                }

                const panel = document.getElementById('securityPanel');
                if (panel) {
                    panel.classList.add('active');
                    this.loadUsersTable();
                }
            }

            // Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ù…Ø§Ù†
            closeSecurityPanel() {
                const panel = document.getElementById('securityPanel');
                if (panel) {
                    panel.classList.remove('active');
                }
            }

            // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            switchSecurityTab(tab) {
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });

                // Ø¥Ø²Ø§Ù„Ø© active Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                document.querySelectorAll('.security-tab').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                const content = document.getElementById(tab + 'Tab');
                if (content) {
                    content.style.display = 'block';
                }

                // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
                const btn = document.querySelector(`.security-tab[onclick*="${tab}"]`);
                if (btn) {
                    btn.classList.add('active');
                }
            }

            // ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            loadUsersTable() {
                const tbody = document.getElementById('usersTableBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                this.users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.username}</td>
                        <td><span class="user-badge badge-${user.role}">${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…'}</span></td>
                        <td><span class="status-${user.active ? 'active' : 'inactive'}">${user.active ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</span></td>
                        <td>${new Date(user.created_at).toLocaleDateString('ar-IQ')}</td>
                        <td>
                            <button class="action-btn btn-edit" onclick="window.securityManager.editUser('${user.id}')">
                                <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                            </button>
                            ${user.id !== '1' ? `
                                <button class="action-btn btn-delete" onclick="window.securityManager.deleteUserConfirm('${user.id}')">
                                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                                </button>
                            ` : ''}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…
            openUserModal(userId = null) {
                const modal = document.getElementById('userModal');
                const modalTitle = document.getElementById('userModalTitle');
                const form = document.getElementById('userForm');
                
                if (!modal || !modalTitle || !form) return;

                form.reset();
                document.getElementById('userId').value = '';

                if (userId) {
                    // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                    const user = this.users.find(u => u.id === userId);
                    if (user) {
                        modalTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…';
                        document.getElementById('userId').value = user.id;
                        document.getElementById('userName').value = user.name;
                        document.getElementById('userUsername').value = user.username;
                        document.getElementById('userRole').value = user.role;
                        
                        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                        this.loadUserPermissions(user.permissions || {});
                    }
                } else {
                    // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                    modalTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
                    this.loadUserPermissions(this.getAllPermissions());
                }

                modal.classList.add('active');
            }

            closeUserModal() {
                const modal = document.getElementById('userModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            // ØªØ­Ù…ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            loadUserPermissions(permissions) {
                Object.keys(permissions).forEach(key => {
                    const checkbox = document.getElementById('perm_' + key);
                    if (checkbox) {
                        checkbox.checked = permissions[key] === true;
                    }
                });
            }

            // Ø¬Ù…Ø¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            getPermissionsFromForm() {
                const permissions = {};
                const allPermissions = this.getAllPermissions();
                
                Object.keys(allPermissions).forEach(key => {
                    const checkbox = document.getElementById('perm_' + key);
                    if (checkbox) {
                        permissions[key] = checkbox.checked;
                    }
                });
                
                return permissions;
            }

            // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            saveUser() {
                const userId = document.getElementById('userId').value;
                const name = document.getElementById('userName').value.trim();
                const username = document.getElementById('userUsername').value.trim();
                const password = document.getElementById('userPassword').value;
                const role = document.getElementById('userRole').value;

                if (!name || !username) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                    return;
                }

                if (!userId && !password) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯');
                    return;
                }

                const permissions = this.getPermissionsFromForm();

                const userData = {
                    name,
                    username,
                    role,
                    permissions
                };

                if (password) {
                    userData.password = password;
                }

                let result;
                if (userId) {
                    result = this.updateUser(userId, userData);
                } else {
                    result = this.addUser(userData);
                }

                if (result.success) {
                    this.closeUserModal();
                    this.loadUsersTable();
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    alert(result.message);
                }
            }

            // ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…
            editUser(userId) {
                this.openUserModal(userId);
            }

            // ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…
            deleteUserConfirm(userId) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                    const result = this.deleteUser(userId);
                    if (result.success) {
                        this.loadUsersTable();
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    } else {
                        alert(result.message);
                    }
                }
            }

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            applyPermissions() {
                if (!this.currentUser) return;

                console.log('ğŸ” ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:', this.currentUser.username);
                console.log('ğŸ“‹ Ø§Ù„Ø¯ÙˆØ±:', this.currentUser.role);

                // Dashboard Stats - Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                this.toggleElement('quickTotalProducts', 'dashboard_products_count');
                this.toggleElement('quickInventoryValue', 'dashboard_inventory_value');
                this.toggleElement('quickTotalDebts', 'dashboard_debts_count');
                this.toggleElement('quickDebtsValue', 'dashboard_debts_value');

                // Sidebar - Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
                this.toggleElement('posNavItem', 'sidebar_pos');
                this.toggleElement('invoicesNavItem', 'sidebar_invoices');
                this.toggleElement('productsNavItem', 'sidebar_products');
                this.toggleElement('inventoryNavItem', 'sidebar_inventory');
                this.toggleElement('debtsNavItem', 'sidebar_debts');
                this.toggleElement('reportsNavItem', 'sidebar_reports');
                this.toggleElement('printerNavItem', 'sidebar_printer');
                this.toggleElement('settingsNavItem', 'sidebar_settings');

                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ data-permission
                this.applyPermissionsToElements();
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
                this.applyDynamicPermissions();
                
                console.log('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
            applyDynamicPermissions() {
                // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ø¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                if (typeof renderProductsTable === 'function') {
                    setTimeout(() => renderProductsTable(), 100);
                }
                
                if (typeof renderDebtsTable === 'function') {
                    setTimeout(() => renderDebtsTable(), 100);
                }
                
                if (typeof renderInvoicesTable === 'function') {
                    setTimeout(() => renderInvoicesTable(), 100);
                }
                
                if (typeof renderInventoryTable === 'function') {
                    setTimeout(() => renderInventoryTable(), 100);
                }
            }

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            applyPermissionsToElements() {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ data-permission
                const elements = document.querySelectorAll('[data-permission]');
                console.log(`ğŸ” Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ù…ÙŠØ©: ${elements.length}`);
                
                let hiddenCount = 0;
                let shownCount = 0;
                
                elements.forEach(element => {
                    const permission = element.getAttribute('data-permission');
                    
                    // Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© (Ù…Ø«Ù„: perm1,perm2)
                    const permissions = permission.split(',').map(p => p.trim());
                    
                    // ÙŠØ­ØªØ§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø£Ùˆ ÙˆØ§Ø­Ø¯Ø© Ù…Ù†Ù‡Ø§ØŸ
                    const requireAll = element.getAttribute('data-require-all') === 'true';
                    
                    let hasAccess = false;
                    if (requireAll) {
                        // ÙŠØ­ØªØ§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                        hasAccess = permissions.every(perm => this.hasPermission(perm));
                    } else {
                        // ÙŠØ­ØªØ§Ø¬ Ø£ÙŠ ØµÙ„Ø§Ø­ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
                        hasAccess = permissions.some(perm => this.hasPermission(perm));
                    }
                    
                    if (hasAccess) {
                        element.style.display = '';
                        element.disabled = false;
                        element.classList.remove('permission-hidden');
                        shownCount++;
                    } else {
                        element.style.display = 'none';
                        element.disabled = true;
                        element.classList.add('permission-hidden');
                        hiddenCount++;
                    }
                });
                
                console.log(`  âœ… Ø¹Ù†Ø§ØµØ± Ù…Ø±Ø¦ÙŠØ©: ${shownCount}`);
                console.log(`  âŒ Ø¹Ù†Ø§ØµØ± Ù…Ø®ÙÙŠØ©: ${hiddenCount}`);
            }

            toggleElement(elementId, permission) {
                const element = document.getElementById(elementId);
                if (element) {
                    const hasAccess = this.hasPermission(permission);
                    element.style.display = hasAccess ? '' : 'none';
                    
                    if (!hasAccess) {
                        element.disabled = true;
                    }
                }
            }

            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù‚Ø¨Ù„ ØªÙ†ÙÙŠØ° Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ©
            checkPermission(permission, showAlert = true) {
                if (!this.currentUser) {
                    if (showAlert) alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                    console.warn('âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„');
                    return false;
                }

                if (this.currentUser.role === 'admin') {
                    return true;
                }

                const hasAccess = this.hasPermission(permission);
                
                if (!hasAccess) {
                    if (showAlert) {
                        alert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªÙ†ÙÙŠØ° Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©');
                    }
                    
                    // ØªØ³Ø¬ÙŠÙ„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©
                    this.logOperation('Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØµÙˆÙ„ Ù…Ø±ÙÙˆØ¶Ø©', {
                        permission: permission,
                        username: this.currentUser.username
                    });
                    
                    console.warn(`â›” Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØµÙˆÙ„ Ù…Ø±ÙÙˆØ¶Ø©: ${permission} Ù…Ù† Ù‚Ø¨Ù„ ${this.currentUser.username}`);
                }

                return hasAccess;
            }
            
            // ÙØ­Øµ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (ÙŠØ­ØªØ§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª)
            checkMultiplePermissions(permissions, showAlert = true) {
                if (!Array.isArray(permissions)) {
                    permissions = [permissions];
                }
                
                for (const permission of permissions) {
                    if (!this.checkPermission(permission, false)) {
                        if (showAlert) {
                            alert(`Ø¹Ø°Ø±Ø§Ù‹ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ©: ${permission}`);
                        }
                        return false;
                    }
                }
                
                return true;
            }
            
            // ÙØ­Øµ Ø£ÙŠ ØµÙ„Ø§Ø­ÙŠØ© (ÙŠØ­ØªØ§Ø¬ ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª)
            checkAnyPermission(permissions, showAlert = true) {
                if (!Array.isArray(permissions)) {
                    permissions = [permissions];
                }
                
                for (const permission of permissions) {
                    if (this.checkPermission(permission, false)) {
                        return true;
                    }
                }
                
                if (showAlert) {
                    alert('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                }
                
                return false;
            }
            
            // ÙØ­Øµ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· (view only)
            isViewOnly(module) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† adminØŒ ÙÙ„ÙŠØ³ view only
                if (this.currentUser && this.currentUser.role === 'admin') {
                    return false;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø©
                const viewPermissions = {
                    'products': 'products_view',
                    'debts': 'debts_view',
                    'inventory': 'inventory_view',
                    'sales': 'sales_view'
                };
                
                const editPermissions = {
                    'products': ['products_add', 'products_edit', 'products_delete'],
                    'debts': ['debts_payment', 'debts_delete'],
                    'inventory': ['inventory_add', 'inventory_edit', 'inventory_delete'],
                    'sales': ['pos_sell']
                };
                
                const viewPerm = viewPermissions[module];
                const editPerms = editPermissions[module];
                
                // Ù„Ù‡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶
                const hasView = this.hasPermission(viewPerm);
                
                // Ù„Ù‡ Ø£ÙŠ ØµÙ„Ø§Ø­ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ØŸ
                let hasEdit = false;
                if (editPerms) {
                    hasEdit = editPerms.some(perm => this.hasPermission(perm));
                }
                
                // view only = Ù„Ù‡ ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ù„ÙƒÙ† Ù„ÙŠØ³ Ù„Ù‡ ØµÙ„Ø§Ø­ÙŠØ§Øª ØªØ¹Ø¯ÙŠÙ„
                return hasView && !hasEdit;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            getCurrentUser() {
                return this.currentUser;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            getCurrentUsername() {
                return this.currentUser ? this.currentUser.username : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒØ§Ù…Ù„
            getCurrentUserFullName() {
                return this.currentUser ? this.currentUser.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }

            // ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© (Audit Trail)
            logActivity(activity) {
                const log = {
                    timestamp: new Date().toISOString(),
                    username: this.getCurrentUsername(),
                    fullName: this.getCurrentUserFullName(),
                    role: this.currentUser ? this.currentUser.role : 'unknown',
                    action: activity.action || 'unknown',
                    module: activity.module || 'general',
                    details: activity.details || {},
                    description: activity.description || ''
                };

                // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„
                const logs = JSON.parse(localStorage.getItem('activity_logs') || '[]');
                logs.push(log);
                
                // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¢Ø®Ø± 1000 Ø³Ø¬Ù„ ÙÙ‚Ø·
                if (logs.length > 1000) {
                    logs.shift();
                }
                
                localStorage.setItem('activity_logs', JSON.stringify(logs));
                
                console.log('ğŸ“ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:', log);
                
                return log;
            }

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            getActivityLogs(filters = {}) {
                const logs = JSON.parse(localStorage.getItem('activity_logs') || '[]');
                
                if (filters.username) {
                    return logs.filter(log => log.username === filters.username);
                }
                
                if (filters.module) {
                    return logs.filter(log => log.module === filters.module);
                }
                
                if (filters.startDate && filters.endDate) {
                    return logs.filter(log => {
                        const logDate = new Date(log.timestamp);
                        return logDate >= filters.startDate && logDate <= filters.endDate;
                    });
                }
                
                return logs;
            }

            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
            updateSidebarButtons() {
                const securityBtn = document.getElementById('securityNavItem');
                const logoutBtn = document.getElementById('logoutNavItem');

                if (this.currentUser) {
                    if (logoutBtn) logoutBtn.style.display = '';
                    
                    if (this.currentUser.role === 'admin') {
                        if (securityBtn) securityBtn.style.display = '';
                    } else {
                        if (securityBtn) securityBtn.style.display = 'none';
                    }
                } else {
                    if (securityBtn) securityBtn.style.display = 'none';
                    if (logoutBtn) logoutBtn.style.display = 'none';
                }
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø¹Ø§Ù…
        window.securityManager = new SecurityManager();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ù…Ø¤Ù‚Øª Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø· Ø¹Ù†Ø¯ Ø£ÙŠ Ù†Ø´Ø§Ø·
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, () => {
                    if (window.securityManager) {
                        window.securityManager.resetInactivityTimer();
                    }
                }, true);
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            if (!sessionStorage.getItem('is_logged_in')) {
                window.securityManager.showLoginPage();
            } else {
                window.securityManager.applyPermissions();
                window.securityManager.updateSidebarButtons();
            }
        });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function initApp() {
            try {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
                updateLoaderStatus('Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
                const isOnline = navigator.onLine;
                console.log('Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:', isOnline ? 'âœ… Ù…ØªØµÙ„' : 'âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„');
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‡ÙŠØ¦Ø© Firebase ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹)
                if (isOnline) {
                    try {
                        console.log('Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase...');
                        updateLoaderStatus('Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...');
                        await Promise.race([
                            Promise.all([
                                createLocalUserIfNeeded(),
                                checkSubscriptionAndGate(),
                                loadUserDataFromFirebase()
                            ]),
                            new Promise((_, reject) => 
                                setTimeout(() => reject(new Error('timeout')), 5000)
                            )
                        ]);
                        console.log('âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase');
                    } catch (error) {
                        console.warn('âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase (Ø³ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„):', error.message);
                        // Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø¯ÙˆÙ† Firebase
                    }
                } else {
                    console.log('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ');
                }

                // ØªÙ‡ÙŠØ¦Ø© Data SDK (Ù…Ø­Ù„ÙŠ - Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù†ØªØ±Ù†Øª)
                console.log('ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©...');
                updateLoaderStatus('Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                if (window.dataSdk) {
                    const initResult = await window.dataSdk.init(dataHandler);
                    if (!initResult.isOk) {
                        console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        return;
                    }
                    console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
                } else {
                    console.error('âŒ Data SDK ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                // ØªÙ‡ÙŠØ¦Ø© Element SDK
                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            try {
                                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                                const storeNameEl = document.getElementById('storeName');
                                const taxRateEl = document.getElementById('taxRate');
                                
                                if (storeNameEl) {
                                    storeNameEl.textContent = config.store_name || defaultConfig.store_name;
                                }
                                
                                if (taxRateEl) {
                                    taxRateEl.textContent = config.tax_rate || defaultConfig.tax_rate;
                                }
                                
                                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                                if (typeof updateInvoicePreview === 'function') {
                                    updateInvoicePreview(config);
                                }
                                
                                // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©
                                if (typeof updateCartSummary === 'function') {
                                    updateCartSummary();
                                }
                            } catch (err) {
                                console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', err);
                            }
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ['store_name', config.store_name || defaultConfig.store_name],
                            ['store_address', config.store_address || defaultConfig.store_address],
                            ['store_phone', config.store_phone || defaultConfig.store_phone],
                            ['tax_rate', config.tax_rate || defaultConfig.tax_rate]
                        ])
                    });
                }

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£ÙˆÙ„ Ù…Ø±Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…
                const isFirstRun = !localStorage.getItem('appInitialized');
                const hasFactoryReset = localStorage.getItem('factoryResetDone') === 'true';
                
                // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø£ÙˆÙ„ Ù…Ø±Ø© ÙˆÙ„ÙŠØ³ Ø¨Ø¹Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹
                updateLoaderStatus('Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                if (!hasFactoryReset) {
                    if (categories.length === 0) {
                        console.log('Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
                        updateLoaderStatus('Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
                        await addSampleCategories();
                    }
                    
                    if (products.length === 0) {
                        console.log('Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...');
                        await addSampleProducts();
                    }
                }
                
                // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                console.log('ÙØ­Øµ ÙˆØ¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©...');
                updateLoaderStatus('ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                await fixOldDebtsData();
                
                // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† localStorage ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ù† localStorage...');
                await loadDebtsFromLocalStorage();

                // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
                console.log('ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©...');
                updateLoaderStatus('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                loadPrinterSettings();
                
                // ØªØ­Ù…ÙŠÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                console.log('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...');
                loadAllSettings();

                console.log('Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...');
                setupEventListeners();
                
                console.log('ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶...');
                updateLoaderStatus('ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©...');
                updateAllViews();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
                console.log('ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
                updateQuickStats();
                
                // ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹)
                if (isOnline) {
                    updateUserSubscriptionCard();
                }
                
                // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø© ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                startTitlebarClock();
                
                // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
                updateDigitalClock();
                setInterval(updateDigitalClock, 1000);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
                setInterval(updateQuickStats, 5000);
                
                // ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© (ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹)
                if (isOnline) {
                    setInterval(updateUserSubscriptionCard, 60000);
                }
                
                // Ø±Ø³Ø§Ù„Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ
                if (!isOnline) {
                    console.log('âš ï¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„)');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
                
                console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                const loader = document.getElementById('appLoader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 500);
                }
                
                // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯
                if (isFirstRun) {
                    localStorage.setItem('appInitialized', 'true');
                    setTimeout(() => {
                        showWelcomeMessage();
                    }, 1000);
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø­ØªÙ‰ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                const loader = document.getElementById('appLoader');
                if (loader) {
                    const statusEl = document.getElementById('loaderStatus');
                    if (statusEl) {
                        statusEl.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ - ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
                        statusEl.style.color = 'var(--danger-color)';
                    }
                }
                
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø³Ø§Ø¹Ø© ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        function startTitlebarClock() {
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const clockElement = document.getElementById('titlebarClock');
                if (clockElement) {
                    clockElement.textContent = `${hours}:${minutes}:${seconds}`;
                }
            }
            
            updateClock();
            setInterval(updateClock, 1000);
        }

        // ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function refreshApp() {
            const btn = event.target.closest('.titlebar-refresh');
            const icon = btn.querySelector('i');
            
            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            icon.style.transform = 'rotate(360deg)';
            btn.disabled = true;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            setTimeout(async () => {
                try {
                    await updateAllViews();
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } catch (error) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
                
                icon.style.transform = 'rotate(0deg)';
                btn.disabled = false;
            }, 800);
        }

        // Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙØ§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        async function addSampleCategories() {
            const sampleCategories = [
                { type: 'category', category_id: '1', category_name: 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', category_icon: 'fas fa-laptop', timestamp: new Date().toISOString() },
                { type: 'category', category_id: '2', category_name: 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', category_icon: 'fas fa-headphones', timestamp: new Date().toISOString() },
                { type: 'category', category_id: '3', category_name: 'Ø£Ø¬Ù‡Ø²Ø© Ø°ÙƒÙŠØ©', category_icon: 'fas fa-mobile-alt', timestamp: new Date().toISOString() }
            ];

            if (window.dataSdk) {
                for (const category of sampleCategories) {
                    await window.dataSdk.create(category);
                }
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        async function addSampleProducts() {
            const sampleProducts = [
                { 
                    type: 'product', 
                    product_id: '1', 
                    product_name: 'Ù„Ø§Ø¨ØªÙˆØ¨ Dell XPS 13', 
                    product_barcode: '1234567890123',
                    product_price_retail: 2500000, 
                    product_price_wholesale: 2300000,
                    product_cost_retail: 2000000, 
                    product_cost_wholesale: 1800000,
                    stock_quantity: 10,
                    min_stock: 5,
                    product_category: '1',
                    supplier: 'Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©',
                    timestamp: new Date().toISOString() 
                },
                { 
                    type: 'product', 
                    product_id: '2', 
                    product_name: 'Ù‡Ø§ØªÙ Samsung Galaxy S23', 
                    product_barcode: '2345678901234',
                    product_price_retail: 1200000, 
                    product_price_wholesale: 1100000,
                    product_cost_retail: 900000, 
                    product_cost_wholesale: 800000,
                    stock_quantity: 25,
                    min_stock: 10,
                    product_category: '3',
                    supplier: 'Ù…ÙˆØ²Ø¹ Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬',
                    timestamp: new Date().toISOString() 
                },
                { 
                    type: 'product', 
                    product_id: '3', 
                    product_name: 'Ø³Ù…Ø§Ø¹Ø§Øª Sony WH-1000XM4', 
                    product_barcode: '3456789012345',
                    product_price_retail: 150000, 
                    product_price_wholesale: 140000,
                    product_cost_retail: 100000, 
                    product_cost_wholesale: 90000,
                    stock_quantity: 50,
                    min_stock: 15,
                    product_category: '2',
                    supplier: 'Ø´Ø±ÙƒØ© Ø§Ù„ØµÙˆØªÙŠØ§Øª',
                    timestamp: new Date().toISOString() 
                }
            ];

            if (window.dataSdk) {
                for (const product of sampleProducts) {
                    await window.dataSdk.create(product);
                }
            }
        }
        
        // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ø¯ÙŠÙˆÙ†
        async function fixOldDebtsData() {
            console.log('Checking and fixing old debts data...');
            
            for (const debt of debtsData) {
                let needsUpdate = false;
                const updates = {};
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹
                const relatedSale = salesData.find(s => s.invoice_id === debt.invoice_id);
                
                // Ø¥ØµÙ„Ø§Ø­ total_amount
                if (!debt.total_amount) {
                    if (debt.final_total) {
                        updates.total_amount = debt.final_total;
                    } else if (relatedSale && relatedSale.final_total) {
                        updates.total_amount = relatedSale.final_total;
                    }
                    if (updates.total_amount) needsUpdate = true;
                }
                
                // Ø¥ØµÙ„Ø§Ø­ remaining_amount
                if (debt.remaining_amount === undefined || debt.remaining_amount === null) {
                    const totalAmt = updates.total_amount || debt.total_amount || debt.final_total || 0;
                    updates.remaining_amount = totalAmt;
                    needsUpdate = true;
                }
                
                // Ø¥ØµÙ„Ø§Ø­ monthly_amount
                if (!debt.monthly_amount) {
                    const totalAmt = updates.total_amount || debt.total_amount || debt.final_total || 0;
                    const months = debt.installment_months || relatedSale?.installment_months || 1;
                    
                    if (relatedSale && relatedSale.monthly_amount) {
                        updates.monthly_amount = relatedSale.monthly_amount;
                    } else if (totalAmt > 0 && months > 0) {
                        updates.monthly_amount = totalAmt / months;
                    }
                    
                    if (updates.monthly_amount) needsUpdate = true;
                }
                
                // Ø¥ØµÙ„Ø§Ø­ installment_months
                if (!debt.installment_months && relatedSale?.installment_months) {
                    updates.installment_months = relatedSale.installment_months;
                    needsUpdate = true;
                }
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if ((!debt.installments || debt.installments.length === 0) && debt.installment_months > 0) {
                    const monthlyAmt = updates.monthly_amount || debt.monthly_amount || 0;
                    const installments = [];
                    
                    for (let i = 1; i <= debt.installment_months; i++) {
                        installments.push({
                            month: i,
                            amount: monthlyAmt,
                            due_date: new Date(new Date(debt.timestamp).getTime() + (i * 30 * 24 * 60 * 60 * 1000)).toISOString(),
                            status: 'pending',
                            paid_date: null,
                            paid_amount: 0
                        });
                    }
                    
                    updates.installments = installments;
                    needsUpdate = true;
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (needsUpdate && window.dataSdk && (debt.id || debt.__backendId)) {
                    const debtId = debt.id || debt.__backendId;
                    console.log('Updating debt:', debtId, updates);
                    await window.dataSdk.update(debtId, updates);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø­Ù„ÙŠ
                    Object.assign(debt, updates);
                }
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (window.dataSdk) {
                const allData = await window.dataSdk.query();
                if (allData.isOk) {
                    debtsData = allData.data.filter(item => item.type === 'debt');
                    console.log('Reloaded debts data:', debtsData);
                    
                    // Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙƒÙˆÙ† ÙØ§Ù‚Ø¯Ø© Ù„Ù„Ù‚ÙŠÙ…
                    await fixDebtsData();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                    renderDebtsTable();
                    updateStatistics();
                }
            }
        }
        
        // Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„ØªØ§Ù„ÙØ© Ø£Ùˆ Ø§Ù„Ù†Ø§Ù‚ØµØ©
        async function fixDebtsData() {
            console.log('=== Fixing Debts Data ===');
            let fixedCount = 0;
            
            for (let debt of debtsData) {
                let needsUpdate = false;
                const updates = {};
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ total_amount
                if (!debt.total_amount || debt.total_amount === 0) {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† final_total
                    if (debt.final_total) {
                        updates.total_amount = debt.final_total;
                        needsUpdate = true;
                    }
                    // Ø£Ùˆ Ù…Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                    else if (debt.invoice_id) {
                        const relatedSale = salesData.find(s => s.invoice_id === debt.invoice_id);
                        if (relatedSale && relatedSale.final_total) {
                            updates.total_amount = relatedSale.final_total;
                            updates.final_total = relatedSale.final_total;
                            needsUpdate = true;
                        }
                    }
                    // Ø£Ùˆ Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                    else if (debt.monthly_amount && debt.installment_months) {
                        const calculated = debt.monthly_amount * debt.installment_months;
                        updates.total_amount = calculated;
                        updates.final_total = calculated;
                        needsUpdate = true;
                    }
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ monthly_amount
                if (!debt.monthly_amount || debt.monthly_amount === 0) {
                    if (debt.total_amount && debt.installment_months) {
                        updates.monthly_amount = debt.total_amount / debt.installment_months;
                        needsUpdate = true;
                    }
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ installments
                if (!debt.installments || debt.installments.length === 0) {
                    if (debt.installment_months && debt.monthly_amount) {
                        const installments = [];
                        const startDate = new Date(debt.timestamp || Date.now());
                        
                        for (let i = 1; i <= debt.installment_months; i++) {
                            const dueDate = new Date(startDate);
                            dueDate.setMonth(dueDate.getMonth() + i);
                            
                            installments.push({
                                month: i,
                                amount: debt.monthly_amount,
                                due_date: dueDate.toISOString(),
                                status: 'pending',
                                paid_date: null,
                                paid_amount: 0
                            });
                        }
                        
                        updates.installments = installments;
                        needsUpdate = true;
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                if (needsUpdate && (debt.id || debt.__backendId)) {
                    console.log(`Fixing debt for ${debt.customer_name}:`, updates);
                    await window.dataSdk.update(debt.id || debt.__backendId, updates);
                    Object.assign(debt, updates);
                    fixedCount++;
                }
            }
            
            if (fixedCount > 0) {
                console.log(`âœ… Fixed ${fixedCount} debt records`);
            } else {
                console.log('âœ“ All debt records are OK');
            }
            console.log('=======================');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
        function updateAllViews() {
            renderProducts();
            renderCategoryFilters();
            renderProductsTable();
            renderInventoryTable();
            renderInvoicesTable();
            renderDebtsTable();
            updateStatistics();
            updateCartCount();
            populateCategorySelects();
            updateQuickStats();
            updateSettingsStats();
            
            // âœ… ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
            if (typeof renderReceiptsTable === 'function') {
                renderReceiptsTable();
            }
        }

        // Ø¹Ø±Ø¶ ÙÙ„Ø§ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        function renderCategoryFilters() {
            const filtersContainer = document.getElementById('categoryFilters');
            if (!filtersContainer) return;
            
            const allBtn = `
                <div class="category-btn ${currentCategory === 'all' ? 'active' : ''}" data-category="all">
                    <i class="fas fa-th-large"></i> Ø§Ù„ÙƒÙ„
                </div>
            `;
            
            const categoryBtns = categories.map(category => `
                <div class="category-btn ${currentCategory === category.category_id ? 'active' : ''}" data-category="${category.category_id}">
                    <i class="${category.category_icon}"></i> ${category.category_name}
                </div>
            `).join('');
            
            filtersContainer.innerHTML = allBtn + categoryBtns;
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            filtersContainer.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    renderProducts();
                });
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            if (!grid) return;
            
            const filteredProducts = currentCategory === 'all' 
                ? products 
                : products.filter(p => p.product_category === currentCategory);
            
            // Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
            const posSearchTerm = document.getElementById('posSearchInput')?.value.toLowerCase() || '';
            const searchedProducts = posSearchTerm 
                ? filteredProducts.filter(p => 
                    p.product_name.toLowerCase().includes(posSearchTerm) ||
                    p.product_barcode?.toLowerCase().includes(posSearchTerm) ||
                    p.supplier?.toLowerCase().includes(posSearchTerm)
                  )
                : filteredProducts;
            
            grid.innerHTML = searchedProducts.map(product => {
                const category = categories.find(c => c.category_id === product.product_category);
                const icon = category ? category.category_icon : 'fas fa-box';
                const stockStatus = product.stock_quantity < product.min_stock ? 'Ù…Ø®Ø²ÙˆÙ† Ù‚Ù„ÙŠÙ„' : `Ù…ØªÙˆÙØ± (${product.stock_quantity})`;
                const stockClass = product.stock_quantity < product.min_stock ? 'text-warning' : 'text-success';
                
                return `
                    <div class="product-card animate__animated animate__fadeInUp" onclick="addToCart('${product.product_id}')">
                        <div class="product-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="product-name">${product.product_name}</div>
                        <div class="product-price">${formatCurrency(product.product_price_retail)}</div>
                        <div class="product-stock ${stockClass}">${stockStatus}</div>
                    </div>
                `;
            }).join('');
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
        function addToCart(productId) {
            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            if (window.securityManager && !window.securityManager.checkPermission('pos_add_to_cart')) {
                return;
            }
            
            const product = products.find(p => p.product_id === productId);
            if (!product) return;
            
            if (product.stock_quantity <= 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const existingItem = cart.find(item => item.product_id === productId);
            
            if (existingItem) {
                if (existingItem.quantity >= product.stock_quantity) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({ 
                    product_id: productId,
                    product_name: product.product_name,
                    product_price: product.product_price_retail,
                    quantity: 1 
                });
            }
            
            console.log('â• Product added to cart:', product.product_name);
            
            renderCart();
            updateCartSummary();
            updateCartCount();
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            console.log('â° Setting timeout for scroll...');
            setTimeout(() => {
                console.log('â° Timeout executed, scrolling...');
                scrollCartToBottom();
            }, 500);
            
            // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }



        // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©
        function renderCart() {
            const cartContainer = document.getElementById('cartItems');
            if (!cartContainer) return;
            
            if (cart.length === 0) {
                cartContainer.innerHTML = `
                    <div class="cart-empty">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>
                        <small>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ø¥Ø¶Ø§ÙØªÙ‡Ø§</small>
                    </div>
                `;
                return;
            }
            
            cartContainer.innerHTML = cart.map(item => {
                const product = products.find(p => p.product_id === item.product_id);
                const category = product ? product.category : 'other';
                
                return `
                <div class="cart-item animate__animated animate__fadeInRight" data-category="${category}">
                    <div class="cart-item-content">
                        <div class="item-header">
                            <div class="item-info">
                                <h4 data-quantity="${item.quantity}">${item.product_name}</h4>
                                <div class="item-price">${formatCurrency(item.product_price)}</div>
                            </div>
                            <button class="remove-btn" onclick="removeFromCart('${item.product_id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="quantity-controls">
                            <div class="qty-controls">
                                <button class="qty-btn" onclick="updateQuantity('${item.product_id}', -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="quantity">${item.quantity}</span>
                                <button class="qty-btn" onclick="updateQuantity('${item.product_id}', 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="item-total">${formatCurrency(item.product_price * item.quantity)}</div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            console.log('ğŸ“¦ Cart rendered with', cart.length, 'items');
            
            // ØªÙ…Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø£Ø³ÙÙ„ ÙÙˆØ±Ø§Ù‹
            scrollCartToBottom();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø­ØªÙˆÙ‰ Ù„Ù„ØªÙ…Ø±ÙŠØ± ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ø§Ø³
            setTimeout(() => {
                const hasScroll = cartContainer.scrollHeight > cartContainer.clientHeight;
                if (hasScroll) {
                    cartContainer.classList.add('has-scroll');
                } else {
                    cartContainer.classList.remove('has-scroll');
                }
                
                console.log('ğŸ”„ Confirming scroll...');
                // ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                scrollCartToBottom();
            }, 100);
            
            // ØªÙ…Ø±ÙŠØ± Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø£Ø·ÙˆÙ„
            setTimeout(() => {
                console.log('ğŸ”„ Final scroll confirmation...');
                scrollCartToBottom();
            }, 300);
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ø³Ù„Ø© - Ù…Ø­Ø³Ù‘Ù†Ø©
        function scrollCartToBottom() {
            const cartContainer = document.getElementById('cartItems');
            if (!cartContainer) {
                console.log('âŒ cartContainer not found');
                return;
            }
            
            console.log('ğŸ”„ Scrolling to bottom...');
            console.log('ScrollHeight:', cartContainer.scrollHeight);
            console.log('ClientHeight:', cartContainer.clientHeight);
            
            // ØªÙ…Ø±ÙŠØ± ÙÙˆØ±ÙŠ Ù„Ù„Ø£Ø³ÙÙ„
            setTimeout(() => {
                const maxScroll = cartContainer.scrollHeight - cartContainer.clientHeight;
                console.log('MaxScroll:', maxScroll);
                
                if (maxScroll > 0) {
                    cartContainer.scrollTop = maxScroll;
                    console.log('âœ… Scrolled to:', cartContainer.scrollTop);
                }
            }, 50);
        }

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
        function scrollCartToTop() {
            const cartContainer = document.getElementById('cartItems');
            if (!cartContainer) return;
            
            cartContainer.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            if (cartCount) {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;
                
                if (totalItems > 0) {
                    cartCount.classList.add('pulse');
                } else {
                    cartCount.classList.remove('pulse');
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ©
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.product_id === productId);
            const product = products.find(p => p.product_id === productId);
            
            if (item && product) {
                const newQuantity = item.quantity + change;
                
                if (newQuantity <= 0) {
                    removeFromCart(productId);
                } else if (newQuantity > product.stock_quantity) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    item.quantity = newQuantity;
                    renderCart();
                    updateCartSummary();
                    updateCartCount();
                }
            }
        }

        // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ù„Ø©
        function removeFromCart(productId) {
            cart = cart.filter(item => item.product_id !== productId);
            renderCart();
            updateCartSummary();
            updateCartCount();
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©
        function updateCartSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
            const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
            const discountAmount = subtotal * (discountPercent / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxRate = parseFloat(getCurrentTaxRate()) / 100;
            const taxAmount = afterDiscount * taxRate;
            const finalTotal = afterDiscount + taxAmount;
            
            updateElement('subtotal', formatCurrency(subtotal));
            updateElement('discountAmount', formatCurrency(discountAmount));
            updateElement('taxAmount', formatCurrency(taxAmount));
            updateElement('finalTotal', formatCurrency(finalTotal));
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ù„Ø© ÙÙŠ Ø§Ù„Ø±Ø£Ø³
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            updateElement('cartItemsCount', totalItems);
            updateElement('cartTotalPrice', formatCurrency(finalTotal));
            
            // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const cashPaymentBtn = document.getElementById('cashPaymentBtn');
            const installmentPaymentBtn = document.getElementById('installmentPaymentBtn');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            const isEmpty = cart.length === 0;
            
            if (cashPaymentBtn) {
                cashPaymentBtn.disabled = isEmpty;
            }
            if (installmentPaymentBtn) {
                installmentPaymentBtn.disabled = isEmpty;
            }
            if (checkoutBtn) {
                checkoutBtn.disabled = isEmpty;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
        function updateQuickStats() {
            // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const totalProducts = products.length;
            updateElement('quickTotalProducts', totalProducts);
            
            // Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© Ã— Ø§Ù„ÙƒÙ…ÙŠØ©)
            const totalValue = products.reduce((sum, p) => {
                const costPrice = p.product_cost_retail || p.purchase_price || 0;
                const quantity = p.stock_quantity || p.product_quantity || 0;
                return sum + (costPrice * quantity);
            }, 0);
            updateElement('quickTotalValue', formatCurrency(totalValue));
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†
            const totalDebts = debtsData.length;
            updateElement('quickDebtsCount', totalDebts);
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ† (Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„ÙØ±ÙŠØ¯ÙŠÙ†)
            const uniqueDebtors = new Set(debtsData.map(d => d.customer_name)).size;
            updateElement('quickDebtorsCount', uniqueDebtors);
            
            // Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© - Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¯Ù‚Ø©
            const totalDebtsValue = debtsData.reduce((sum, d) => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                let paidAmount = 0;
                if (d.installments && Array.isArray(d.installments) && d.installments.length > 0) {
                    d.installments.forEach(inst => {
                        if (inst.status === 'paid') {
                            paidAmount += parseFloat(inst.paid_amount || inst.amount || 0);
                        }
                    });
                } else if (d.paid_amount !== undefined && d.paid_amount !== null) {
                    paidAmount = parseFloat(d.paid_amount) || 0;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                const totalAmount = parseFloat(d.total_amount || d.final_total || 0);
                const remainingAmount = totalAmount - paidAmount;
                
                return sum + (remainingAmount > 0 ? remainingAmount : 0);
            }, 0);
            updateElement('quickDebtsValue', formatCurrency(totalDebtsValue));
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        async function updateUserSubscriptionCard() {
            try {
                const uid = localStorage.getItem('app_uid');
                if (!uid) {
                    console.warn('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ UID Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                    return;
                }

                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase
                const userSnap = await database.ref(`users/${uid}`).once('value');
                if (!userSnap.exists()) {
                    console.warn('âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Firebase');
                    return;
                }

                const user = userSnap.val();
                const profile = user.profile || {};
                const subscription = user.subscription;
                const trialUntil = user.trialUntil;
                const now = Date.now();

                // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø³ØªØ®Ø¯Ø§Ù… UID Ù…Ø®ØªØµØ±)
                const displayName = uid.substring(0, 12) + '...';
                updateElement('userDisplayName', displayName);

                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                let subscriptionType = 'ØªØ¬Ø±ÙŠØ¨ÙŠ';
                let endDate = 0;
                let startDate = profile.createdAt || now;
                let daysLeft = 0;
                let statusColor = '#10b981'; // Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø´Ø·

                if (subscription && subscription.validUntil) {
                    // Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¯ÙÙˆØ¹
                    endDate = Number(subscription.validUntil);
                    startDate = subscription.activatedAt || startDate;
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                    if (subscription.type === 'monthly') {
                        subscriptionType = 'Ø´Ù‡Ø±ÙŠ';
                    } else if (subscription.type === 'yearly') {
                        subscriptionType = 'Ø³Ù†ÙˆÙŠ';
                    } else {
                        subscriptionType = subscription.type || 'Ù…Ø®ØµØµ';
                    }
                } else if (trialUntil) {
                    // ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    endDate = Number(trialUntil);
                    subscriptionType = 'ØªØ¬Ø±ÙŠØ¨ÙŠ';
                }

                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                if (endDate > 0) {
                    daysLeft = Math.ceil((endDate - now) / (1000 * 60 * 60 * 24));
                }

                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                if (daysLeft <= 0) {
                    statusColor = '#ef4444'; // Ø£Ø­Ù…Ø± Ù„Ù„Ù…Ù†ØªÙ‡ÙŠ
                    subscriptionType = 'Ù…Ù†ØªÙ‡ÙŠ';
                } else if (daysLeft <= 7) {
                    statusColor = '#f59e0b'; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                } else {
                    statusColor = '#10b981'; // Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø´Ø·
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
                const typeEl = document.getElementById('subscriptionType');
                if (typeEl) {
                    typeEl.textContent = subscriptionType;
                    typeEl.style.color = statusColor;
                    typeEl.style.background = statusColor + '20'; // Ø´ÙØ§ÙÙŠØ© 20%
                }

                const daysLeftEl = document.getElementById('subscriptionDaysLeft');
                if (daysLeftEl) {
                    if (daysLeft > 0) {
                        daysLeftEl.textContent = daysLeft + ' ÙŠÙˆÙ…';
                        daysLeftEl.style.color = statusColor;
                    } else {
                        daysLeftEl.textContent = 'Ù…Ù†ØªÙ‡ÙŠ';
                        daysLeftEl.style.color = '#ef4444';
                    }
                }

                // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
                const formatDate = (timestamp) => {
                    if (!timestamp) return '--/--/----';
                    const date = new Date(timestamp);
                    return date.toLocaleDateString('ar-IQ', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit' 
                    });
                };

                updateElement('subscriptionStartDate', formatDate(startDate));
                updateElement('subscriptionEndDate', formatDate(endDate));

                // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£ÙŠØ¶Ø§Ù‹
                updateAccountPage(user, uid, daysLeft, statusColor);

                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
            }
        }

        // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateAccountPage(user, uid, daysLeft, statusColor) {
            try {
                const profile = user.profile || {};
                const subscription = user.subscription;
                const trialUntil = user.trialUntil;
                const now = Date.now();

                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                updateElement('accountUserUID', uid);
                
                const secretEl = document.getElementById('accountUserSecret');
                if (secretEl && profile.secret) {
                    secretEl.textContent = profile.secret;
                    secretEl.setAttribute('data-secret', profile.secret);
                }

                const formatDate = (timestamp) => {
                    if (!timestamp) return '--/--/----';
                    const date = new Date(timestamp);
                    return date.toLocaleDateString('ar-IQ', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit' 
                    });
                };

                updateElement('accountCreatedDate', formatDate(profile.createdAt));
                updateElement('accountPlatform', profile.deviceInfo?.platform || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');

                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                let subscriptionType = 'ØªØ¬Ø±ÙŠØ¨ÙŠ';
                let startDate = profile.createdAt || now;
                let endDate = trialUntil || 0;

                if (subscription && subscription.validUntil) {
                    endDate = Number(subscription.validUntil);
                    startDate = subscription.activatedAt || startDate;
                    
                    if (subscription.type === 'monthly') {
                        subscriptionType = 'Ø´Ù‡Ø±ÙŠ';
                    } else if (subscription.type === 'yearly') {
                        subscriptionType = 'Ø³Ù†ÙˆÙŠ';
                    } else {
                        subscriptionType = subscription.type || 'Ù…Ø®ØµØµ';
                    }
                }

                if (daysLeft <= 0) {
                    subscriptionType = 'Ù…Ù†ØªÙ‡ÙŠ';
                }

                updateElement('accountSubscriptionType', subscriptionType);
                updateElement('accountStartDate', formatDate(startDate));
                updateElement('accountEndDate', formatDate(endDate));

                // Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
                const daysLeftEl = document.getElementById('accountDaysLeft');
                if (daysLeftEl) {
                    if (daysLeft > 0) {
                        daysLeftEl.textContent = daysLeft + ' ÙŠÙˆÙ…';
                        daysLeftEl.style.color = statusColor;
                    } else {
                        daysLeftEl.textContent = 'Ù…Ù†ØªÙ‡ÙŠ';
                        daysLeftEl.style.color = '#ef4444';
                    }
                }

                // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø£ÙŠØ§Ù…
                const daysIconEl = document.getElementById('accountDaysIcon');
                if (daysIconEl) {
                    if (daysLeft <= 0) {
                        daysIconEl.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    } else if (daysLeft <= 7) {
                        daysIconEl.style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                    } else {
                        daysIconEl.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    }
                }

                // Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                const totalDays = subscription?.type === 'yearly' ? 365 : 30;
                const usedDays = totalDays - daysLeft;
                const progressPercent = Math.min(100, Math.max(0, (usedDays / totalDays) * 100));
                
                updateElement('accountProgressPercent', Math.round(progressPercent) + '%');
                
                const progressBar = document.getElementById('accountProgressBar');
                if (progressBar) {
                    progressBar.style.width = progressPercent + '%';
                    
                    if (progressPercent >= 90) {
                        progressBar.style.background = 'linear-gradient(90deg, #ef4444 0%, #dc2626 100%)';
                    } else if (progressPercent >= 70) {
                        progressBar.style.background = 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)';
                    } else {
                        progressBar.style.background = 'linear-gradient(90deg, #10b981 0%, #059669 100%)';
                    }
                }

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
            }
        }

        // Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø§Ù„Ù†Øµ
        function copyToClipboard(text) {
            if (!text || text === 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' || text === '**********') {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            navigator.clipboard.writeText(text).then(() => {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }).catch(err => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function updateSettingsStats() {
                        // Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø´Ø¯Ø¯Ø© (Ø¯ÙŠÙˆÙ† Ù…ØªØ£Ø®Ø±Ø© Ø£ÙƒØ«Ø± Ù…Ù† 30 ÙŠÙˆÙ…)
                        const severeDebts = debtsData.filter(d => {
                            if (!d.installments || d.installments.length === 0) return false;
                            const now = new Date();
                            return d.installments.some(inst => {
                                if (inst.paid) return false;
                                const dueDate = new Date(inst.due_date);
                                return (now - dueDate) > (30 * 24 * 60 * 60 * 1000);
                            });
                        }).length;
                        updateElement('severeDebtsCount', severeDebts);
            // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            updateElement('settingsProductCount', products.length);
            
            // Ø¹Ø¯Ø¯ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
            updateElement('settingsCategoryCount', categories.length);
            
            // Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            updateElement('settingsInvoiceCount', salesData.length);
            
            // Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            const totalSales = salesData.reduce((sum, s) => sum + (s.total_amount || 0), 0);
            updateElement('settingsSalesValue', formatCurrency(totalSales));
            
            // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            const activeProducts = products.filter(p => (p.stock_quantity || 0) > 0).length;
            updateElement('activeProductsCount', activeProducts);
            
            // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø§Ø±Ø¨Øª Ø§Ù„Ù†ÙØ§Ø°
            const lowStockProducts = products.filter(p => {
                const qty = p.stock_quantity || 0;
                const min = p.min_stock_quantity || 10;
                return qty > 0 && qty <= min;
            }).length;
            updateElement('lowStockCount', lowStockProducts);
            
            // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù†ÙØ°Øª
            const outOfStockProducts = products.filter(p => (p.stock_quantity || 0) === 0).length;
            updateElement('outOfStockCount', outOfStockProducts);
            
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            updateElement('totalInvoicesCount', salesData.length);
            
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            updateElement('totalSalesAmount', formatCurrency(totalSales));
            
            // Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            const averageInvoice = salesData.length > 0 ? totalSales / salesData.length : 0;
            updateElement('averageInvoice', formatCurrency(averageInvoice));
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†
            const uniqueDebtors = new Set(debtsData.map(d => d.customer_name)).size;
            updateElement('totalDebtorsCount', uniqueDebtors);
            
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† - Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¯Ù‚Ø©
            const totalDebts = debtsData.reduce((sum, d) => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                let paidAmount = 0;
                if (d.installments && Array.isArray(d.installments) && d.installments.length > 0) {
                    d.installments.forEach(inst => {
                        if (inst.status === 'paid') {
                            paidAmount += parseFloat(inst.paid_amount || inst.amount || 0);
                        }
                    });
                } else if (d.paid_amount !== undefined && d.paid_amount !== null) {
                    paidAmount = parseFloat(d.paid_amount) || 0;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                const totalAmount = parseFloat(d.total_amount || d.final_total || 0);
                const remainingAmount = totalAmount - paidAmount;
                
                return sum + (remainingAmount > 0 ? remainingAmount : 0);
            }, 0);
            updateElement('totalDebtsAmount', formatCurrency(totalDebts));
            
            // Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
            const overdueDebts = debtsData.filter(d => {
                if (!d.installments || d.installments.length === 0) return false;
                const now = new Date();
                return d.installments.some(inst => {
                    if (inst.paid) return false;
                    const dueDate = new Date(inst.due_date);
                    return dueDate < now;
                });
            }).length;
            updateElement('overdueDebtsCount', overdueDebts);
            
            // Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
            const lastBackup = localStorage.getItem('lastBackupDate');
            if (lastBackup) {
                const date = new Date(lastBackup);
                updateElement('lastBackupDate', date.toLocaleDateString('ar-IQ'));
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
        function updateDigitalClock() {
            const now = new Date();
            
            // Ø§Ù„ÙˆÙ‚Øª
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;
            updateElement('digitalClockTime', timeString);
            
            // Ø§Ù„ÙŠÙˆÙ…
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const dayName = days[now.getDay()];
            updateElement('digitalClockDay', dayName);
            
            // Ø§Ù„ØªØ§Ø±ÙŠØ®
            const day = now.getDate();
            const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 
                          'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            const dateString = `${day} ${month} ${year}`;
            updateElement('digitalClockDate', dateString);
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
            const sidebarToggle = document.getElementById('sidebarToggle');
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', toggleSidebar);
            }

            // Ø®ØµÙ…
            const discountInput = document.getElementById('discountInput');
            if (discountInput) {
                discountInput.addEventListener('input', updateCartSummary);
            }
            
            // Ø§Ù„Ø¨Ø­Ø«
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', renderProducts);
            }
            
            // Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.payment-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedPaymentMethod = btn.dataset.method;
                });
            });
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø³Ù„Ø©
            const cashPaymentBtn = document.getElementById('cashPaymentBtn');
            if (cashPaymentBtn) {
                cashPaymentBtn.addEventListener('click', async () => {
                    console.log('ğŸ’µ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±');
                    console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cart.length);
                    
                    if (cart.length === 0) {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        return;
                    }
                    
                    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                    console.log('âœ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©...');
                    showCashPaymentModal();
                });
            }
            
            const installmentPaymentBtn = document.getElementById('installmentPaymentBtn');
            if (installmentPaymentBtn) {
                installmentPaymentBtn.addEventListener('click', () => {
                    console.log('ğŸ“… ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·');
                    console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cart.length);
                    
                    if (cart.length === 0) {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        return;
                    }
                    
                    console.log('âœ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·...');
                    showModal('paymentModal');
                    showInstallmentForm();
                });
            }
            
            // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ - Ø§Ù„Ø²Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù„Ù„ØªÙˆØ§ÙÙ‚)
            const checkoutBtn = document.getElementById('checkoutBtn');
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', () => {
                    console.log('ğŸ›ï¸ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹');
                    console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cart.length);
                    
                    if (cart.length === 0) {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        return;
                    }
                    
                    console.log('âœ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹...');
                    showModal('paymentModal');
                });
            }

            // Ù†Ù…Ø§Ø°Ø¬
            const addProductForm = document.getElementById('addProductForm');
            if (addProductForm) {
                addProductForm.addEventListener('submit', handleAddProduct);
            }

            const addCategoryForm = document.getElementById('addCategoryForm');
            if (addCategoryForm) {
                addCategoryForm.addEventListener('submit', handleAddCategory);
            }

            const payDebtForm = document.getElementById('payDebtForm');
            if (payDebtForm) {
                payDebtForm.addEventListener('submit', handlePayDebt);
            }

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            const installmentInputs = ['installmentMonths', 'additionalAmount', 'downPayment'];
            installmentInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateInstallment);
                }
            });
            
            // ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            const inventoryCategory = document.getElementById('inventoryCategory');
            const stockStatus = document.getElementById('stockStatus');
            if (inventoryCategory) inventoryCategory.addEventListener('change', renderInventoryTable);
            if (stockStatus) stockStatus.addEventListener('change', renderInventoryTable);
            
            // Ø¥Ø®ÙØ§Ø¡ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.addEventListener('click', (e) => {
                // Ø¥Ø®ÙØ§Ø¡ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø­Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const searchBox = document.querySelector('.search-box');
                const searchResults = document.getElementById('searchResults');
                if (searchResults && searchBox && !searchBox.contains(e.target)) {
                    searchResults.classList.remove('active');
                }
                
                // Ø¥Ø®ÙØ§Ø¡ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø­Ø« Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                const customerSearchWrapper = document.querySelector('.search-customer-wrapper');
                const customerSearchResults = document.getElementById('customerSearchResults');
                if (customerSearchResults && customerSearchWrapper && !customerSearchWrapper.contains(e.target)) {
                    customerSearchResults.classList.remove('active');
                }
            });
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            
            if (sidebar && toggleBtn) {
                sidebarCollapsed = !sidebarCollapsed;
                
                if (sidebarCollapsed) {
                    sidebar.classList.add('collapsed');
                    toggleBtn.innerHTML = '<i class="fas fa-angle-double-left"></i>';
                } else {
                    sidebar.classList.remove('collapsed');
                    toggleBtn.innerHTML = '<i class="fas fa-angle-double-right"></i>';
                }
            }
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'light');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                currentTheme = 'light';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                currentTheme = 'dark';
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ø«ÙŠÙ… ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            localStorage.setItem('theme', currentTheme);
        }

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø¨Ø´ÙƒÙ„ Ø¨Ø±Ù…Ø¬ÙŠ (Ø¨Ø¯ÙˆÙ† event)
        function navigateTo(pageId) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
        }

        // Ø¹Ø±Ø¶ ØµÙØ­Ø©
        function showPage(pageId) {
            console.log('ğŸ“„ Showing page:', pageId);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„ÙØ±Ø¹ÙŠØ©)
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = ''; // Ø¥Ø²Ø§Ù„Ø© inline style
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.style.display = ''; // Ø¥Ø²Ø§Ù„Ø© inline style
                targetPage.classList.add('active');
                console.log('âœ… Page shown:', pageId);
            } else {
                console.error('âŒ Page not found:', pageId);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ù‚Ù„
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Ø¥Ø¶Ø§ÙØ© active Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
            const activeLink = document.querySelector(`.nav-link[onclick*="'${pageId}'"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            if (window.securityManager) {
                setTimeout(() => {
                    window.securityManager.applyPermissionsToElements();
                }, 100);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©
            const pageTitles = {
                'pos': 'Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹',
                'products': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                'inventory': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†',
                'invoices': 'Ø§Ù„ÙÙˆØ§ØªÙŠØ±',
                'debts': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†',
                'payments': 'Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·',
                'expenses': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ',
                'printer': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©',
                'settings': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©'
            };
            
            const titleElement = document.getElementById('currentPageTitle');
            if (titleElement) {
                titleElement.textContent = pageTitles[pageId] || 'Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹';
            }
            
            // Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„ØµÙØ­Ø§Øª
            if (pageId === 'printer') {
                // ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
                setTimeout(() => {
                    initPrinterPage();
                }, 100);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            if (pageId === 'settings') {
                setTimeout(() => {
                    updateSettingsStats();
                }, 100);
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
        function showModal(modalId) {
            console.log('ğŸªŸ ÙØªØ­ Ù†Ø§ÙØ°Ø©:', modalId);
            const modal = document.getElementById(modalId);
            
            if (modal) {
                modal.classList.add('active');
                console.log('âœ… ØªÙ… ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ù†Ø¬Ø§Ø­');
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Øµ Ù„Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØµÙ†ÙŠÙ
                if (modalId === 'addCategoryModal') {
                    renderCategoryIcons();
                }
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Øµ Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹
                if (modalId === 'paymentModal') {
                    // Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                    const installmentForm = document.getElementById('installmentForm');
                    if (installmentForm) {
                        installmentForm.style.display = 'none';
                    }
                    console.log('ğŸ’³ Ø¬Ø§Ù‡Ø² Ù„Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹');
                }
            } else {
                console.error('âŒ Ø§Ù„Ù†Ø§ÙØ°Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©:', modalId);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
        function closeModal(modalId) {
            console.log('ğŸšª Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø©:', modalId);
            const modal = document.getElementById(modalId);
            
            if (modal) {
                modal.classList.remove('active');
                console.log('âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
                const form = modal.querySelector('form');
                if (form) {
                    form.reset();
                }
                
                // Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹
                if (modalId === 'paymentModal') {
                    const installmentForm = document.getElementById('installmentForm');
                    if (installmentForm) {
                        installmentForm.style.display = 'none';
                    }
                }
            } else {
                console.error('âŒ Ø§Ù„Ù†Ø§ÙØ°Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©:', modalId);
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        function showAddProductModal() {
            showModal('addProductModal');
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ
        function showAddCategoryModal() {
            showModal('addCategoryModal');
        }

        // Ø¹Ø±Ø¶ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        function renderCategoryIcons() {
            const iconGrid = document.getElementById('categoryIconGrid');
            if (!iconGrid) return;
            
            iconGrid.innerHTML = availableIcons.map(icon => `
                <div class="category-icon-btn" data-icon="${icon}" onclick="selectCategoryIcon('${icon}')">
                    <i class="${icon}"></i>
                </div>
            `).join('');
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            selectCategoryIcon('fas fa-box');
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØµÙ†ÙŠÙ
        function selectCategoryIcon(icon) {
            document.querySelectorAll('.category-icon-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = document.querySelector(`[data-icon="${icon}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
                document.getElementById('selectedCategoryIcon').value = icon;
            }
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯
        function generateBarcode() {
            const barcodeInput = document.getElementById('productBarcode');
            if (barcodeInput) {
                const barcode = Date.now().toString() + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                barcodeInput.value = barcode;
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        async function handleAddProduct(event) {
            event.preventDefault();
            
            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            if (!window.securityManager.checkPermission('products_add')) {
                return;
            }
            
            if (isLoading) return;
            setLoading(true);
            
            const productData = {
                type: 'product',
                product_id: Date.now().toString(),
                product_name: document.getElementById('productName').value,
                product_barcode: document.getElementById('productBarcode').value || generateBarcodeString(),
                product_cost_retail: parseFloat(document.getElementById('productCostRetail').value),
                product_cost_wholesale: parseFloat(document.getElementById('productCostWholesale').value) || parseFloat(document.getElementById('productCostRetail').value),
                product_price_retail: parseFloat(document.getElementById('productPriceRetail').value),
                product_price_wholesale: parseFloat(document.getElementById('productPriceWholesale').value) || parseFloat(document.getElementById('productPriceRetail').value),
                stock_quantity: parseInt(document.getElementById('productStock').value),
                min_stock: parseInt(document.getElementById('productMinStock').value),
                product_category: document.getElementById('productCategory').value,
                supplier: document.getElementById('productSupplier').value || '',
                timestamp: new Date().toISOString(),
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                created_by: window.securityManager.getCurrentUsername(),
                created_by_name: window.securityManager.getCurrentUserFullName(),
                created_at: new Date().toISOString()
            };

            if (window.dataSdk) {
                const result = await window.dataSdk.create(productData);
                if (result.isOk) {
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    window.securityManager.logOperation('Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬', {
                        productId: productData.product_id,
                        productName: productData.product_name,
                        barcode: productData.product_barcode
                    });
                    
                    closeModal('addProductModal');
                    document.getElementById('addProductForm').reset();
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            }
            
            setLoading(false);
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
        function showEditProductModal(productId) {
            const product = products.find(p => p.product_id === productId);
            if (!product) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('editProductId').value = productId;
            document.getElementById('editProductName').value = product.product_name;
            document.getElementById('editProductBarcode').value = product.product_barcode || '';
            document.getElementById('editProductCategory').value = product.product_category || '';
            document.getElementById('editProductSupplier').value = product.supplier || '';
            document.getElementById('editProductCostRetail').value = product.product_cost_retail;
            document.getElementById('editProductCostWholesale').value = product.product_cost_wholesale || '';
            document.getElementById('editProductPriceRetail').value = product.product_price_retail;
            document.getElementById('editProductPriceWholesale').value = product.product_price_wholesale || '';
            document.getElementById('editProductStock').value = product.stock_quantity;
            document.getElementById('editProductMinStock').value = product.min_stock;
            
            // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
            populateCategorySelects();
            document.getElementById('editProductCategory').value = product.product_category || '';
            
            showModal('editProductModal');
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
        async function handleEditProduct(event) {
            event.preventDefault();
            
            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            if (!window.securityManager.checkPermission('products_edit')) {
                return;
            }
            
            if (isLoading) return;
            setLoading(true);
            
            const productId = document.getElementById('editProductId').value;
            const product = products.find(p => p.product_id === productId);
            
            if (!product) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                setLoading(false);
                return;
            }
            
            const updatedData = {
                product_name: document.getElementById('editProductName').value,
                product_barcode: document.getElementById('editProductBarcode').value,
                product_category: document.getElementById('editProductCategory').value,
                supplier: document.getElementById('editProductSupplier').value || '',
                product_cost_retail: parseFloat(document.getElementById('editProductCostRetail').value),
                product_cost_wholesale: parseFloat(document.getElementById('editProductCostWholesale').value) || parseFloat(document.getElementById('editProductCostRetail').value),
                product_price_retail: parseFloat(document.getElementById('editProductPriceRetail').value),
                product_price_wholesale: parseFloat(document.getElementById('editProductPriceWholesale').value) || parseFloat(document.getElementById('editProductPriceRetail').value),
                stock_quantity: parseInt(document.getElementById('editProductStock').value),
                min_stock: parseInt(document.getElementById('editProductMinStock').value),
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                modified_by: window.securityManager.getCurrentUsername(),
                modified_by_name: window.securityManager.getCurrentUserFullName(),
                modified_at: new Date().toISOString()
            };
            
            if (window.dataSdk && (product.id || product.__backendId)) {
                const updateId = product.id || product.__backendId;
                const result = await window.dataSdk.update(updateId, updatedData);
                
                if (result.isOk) {
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    window.securityManager.logOperation('ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬', {
                        productId: product.product_id,
                        productName: updatedData.product_name,
                        barcode: updatedData.product_barcode
                    });
                    
                    closeModal('editProductModal');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            }
            
            setLoading(false);
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ
        async function handleAddCategory(event) {
            event.preventDefault();
            
            if (isLoading) return;
            setLoading(true);
            
            const categoryName = document.getElementById('categoryName').value;
            const categoryIcon = document.getElementById('selectedCategoryIcon').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!categoryName || !categoryName.trim()) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                setLoading(false);
                return;
            }
            
            const categoryData = {
                type: 'category',
                category_id: Date.now().toString(),
                category_name: categoryName.trim(),
                category_icon: categoryIcon || 'fas fa-box',
                timestamp: new Date().toISOString()
            };

            try {
                if (window.dataSdk) {
                    const result = await window.dataSdk.create(categoryData);
                    if (result.isOk) {
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØµÙ†ÙŠÙ Ù„Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                        categories.push(categoryData);
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                        updateAllViews();
                        
                        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                        closeModal('addCategoryModal');
                        document.getElementById('addCategoryForm').reset();
                        
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    } else {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    }
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØµÙ†ÙŠÙ:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
            
            setLoading(false);
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙƒÙ†Øµ
        function generateBarcodeString() {
            return Date.now().toString() + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        }

        // Ù…Ù„Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        function populateCategorySelects() {
            const selects = ['productCategory', 'inventoryCategory'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    const currentValue = select.value;
                    
                    if (selectId === 'inventoryCategory') {
                        select.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>';
                    } else {
                        select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>';
                    }
                    
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.category_id;
                        option.textContent = category.category_name;
                        select.appendChild(option);
                    });
                    
                    if (currentValue) {
                        select.value = currentValue;
                    }
                }
            });
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function renderProductsTable() {
            const tbody = document.getElementById('productsTableBody');
            if (!tbody) return;
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            const sortedProducts = [...products].sort((a, b) => {
                const dateA = new Date(a.created_at || a.timestamp || 0);
                const dateB = new Date(b.created_at || b.timestamp || 0);
                return dateB.getTime() - dateA.getTime();
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const searchTerm = document.getElementById('productsSearchInput')?.value.toLowerCase() || '';
            const filteredProducts = searchTerm 
                ? sortedProducts.filter(product => 
                    (product.product_name && product.product_name.toLowerCase().includes(searchTerm)) ||
                    (product.product_barcode && product.product_barcode.toLowerCase().includes(searchTerm)) ||
                    (product.supplier && product.supplier.toLowerCase().includes(searchTerm))
                  )
                : sortedProducts;
            
            tbody.innerHTML = filteredProducts.map(product => {
                const category = categories.find(c => c.category_id === product.product_category);
                const categoryName = category ? category.category_name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const stockClass = product.stock_quantity < product.min_stock ? 'text-warning' : 'text-success';

                // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                let actionButtons = '';
                
                // Ø²Ø± Ø§Ù„Ø¹Ø±Ø¶ (Ù…ØªØ§Ø­ Ù„Ù„Ø¬Ù…ÙŠØ¹)
                actionButtons += `<button class="action-btn view-btn" onclick="showProductDetails('${product.product_id}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„"><i class="fas fa-eye"></i></button>`;
                
                // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ÙŠØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ©)
                if (window.securityManager && window.securityManager.hasPermission('products_edit')) {
                    actionButtons += `<button class="action-btn edit-btn" onclick="if(window.securityManager.checkPermission('products_edit')) showEditProductModal('${product.product_id}')" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬" data-permission="products_edit"><i class="fas fa-edit"></i></button>`;
                }
                
                // Ø²Ø± Ø§Ù„Ø­Ø°Ù (ÙŠØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ©)
                if (window.securityManager && window.securityManager.hasPermission('products_delete')) {
                    actionButtons += `<button class="action-btn delete-btn" onclick="if(window.securityManager.checkPermission('products_delete')) deleteProduct('${product.product_id}')" title="Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬" data-permission="products_delete"><i class="fas fa-trash"></i></button>`;
                }

                return `
                    <tr>
                        <td>${product.product_barcode || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="${category ? category.category_icon : 'fas fa-box'}"></i>
                                ${product.product_name}
                            </div>
                        </td>
                        <td>${categoryName}</td>
                        <td>${formatCurrency(product.product_price_retail)}</td>
                        <td>${formatCurrency(product.product_cost_retail)}</td>
                        <td>
                            <span class="${stockClass}">
                                ${product.stock_quantity}
                            </span>
                        </td>
                        <td>
                            ${actionButtons}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        function renderInventoryTable() {
            const tbody = document.getElementById('inventoryTableBody');
            if (!tbody) return;
            
            const categoryFilter = document.getElementById('inventoryCategory')?.value || 'all';
            const statusFilter = document.getElementById('stockStatus')?.value || 'all';
            const searchTerm = document.getElementById('inventorySearchInput')?.value.toLowerCase() || '';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            let filteredProducts = [...products].sort((a, b) => {
                const dateA = new Date(a.created_at || a.timestamp || 0);
                const dateB = new Date(b.created_at || b.timestamp || 0);
                return dateB.getTime() - dateA.getTime();
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    (product.product_name && product.product_name.toLowerCase().includes(searchTerm)) ||
                    (product.product_barcode && product.product_barcode.toLowerCase().includes(searchTerm)) ||
                    (product.supplier && product.supplier.toLowerCase().includes(searchTerm))
                );
            }
            
            if (categoryFilter !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.product_category === categoryFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredProducts = filteredProducts.filter(p => {
                    if (statusFilter === 'in-stock') return p.stock_quantity > p.min_stock;
                    if (statusFilter === 'low-stock') return p.stock_quantity <= p.min_stock && p.stock_quantity > 0;
                    if (statusFilter === 'out-of-stock') return p.stock_quantity === 0;
                    return true;
                });
            }
            
            tbody.innerHTML = filteredProducts.map(product => {
                const category = categories.find(c => c.category_id === product.product_category);
                const categoryName = category ? category.category_name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const totalCost = product.stock_quantity * product.product_cost_retail;
                const totalValue = product.stock_quantity * product.product_price_retail;
                const profit = totalValue - totalCost;
                
                let status = 'Ù…ØªÙˆÙØ±';
                let statusClass = 'text-success';
                
                if (product.stock_quantity === 0) {
                    status = 'Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†';
                    statusClass = 'text-danger';
                } else if (product.stock_quantity <= product.min_stock) {
                    status = 'Ù…Ø®Ø²ÙˆÙ† Ù‚Ù„ÙŠÙ„';
                    statusClass = 'text-warning';
                }
                
                return `
                    <tr data-product-id="${product.product_id}">
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="${category ? category.category_icon : 'fas fa-box'}"></i>
                                ${product.product_name}
                            </div>
                        </td>
                        <td>${categoryName}</td>
                        <td>${product.stock_quantity}</td>
                        <td>${formatCurrency(totalCost)}</td>
                        <td>${formatCurrency(totalValue)}</td>
                        <td class="text-success">${formatCurrency(profit)}</td>
                        <td>
                            <span class="${statusClass}">${status}</span>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        function renderInvoicesTable() {
            const tbody = document.getElementById('invoicesTableBody');
            if (!tbody) return;
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            const sortedSales = [...salesData].sort((a, b) => {
                const dateA = new Date(a.timestamp || a.date || a.created_at || 0);
                const dateB = new Date(b.timestamp || b.date || b.created_at || 0);
                return dateB.getTime() - dateA.getTime();
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            const searchTerm = document.getElementById('invoicesSearchInput')?.value.toLowerCase() || '';
            const filteredSales = searchTerm 
                ? sortedSales.filter(sale => 
                    (sale.invoice_id && sale.invoice_id.toLowerCase().includes(searchTerm)) ||
                    (sale.customer_name && sale.customer_name.toLowerCase().includes(searchTerm)) ||
                    (sale.payment_method && sale.payment_method.toLowerCase().includes(searchTerm)) ||
                    (sale.created_by_name && sale.created_by_name.toLowerCase().includes(searchTerm))
                  )
                : sortedSales;
            
            tbody.innerHTML = filteredSales.map(sale => {
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                const createdByName = sale.created_by_name || sale.created_by || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                const createdByRole = sale.created_by_role || (sale.created_by === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…');
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                const isInstallmentInvoice = sale.payment_type === 'Ø£Ù‚Ø³Ø§Ø·';
                
                let actionButtons = `
                    <button class="action-btn view-btn" onclick="showInvoiceDetails('${sale.invoice_id}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn view-btn" onclick="${isInstallmentInvoice ? `printInvoiceFromDetails('${sale.invoice_id}', true)` : `printInvoice('${sale.invoice_id}')`}" title="Ø·Ø¨Ø§Ø¹Ø©">
                        <i class="fas fa-print"></i>
                    </button>
                `;
                
                // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                if (window.securityManager && window.securityManager.hasPermission('invoices_delete')) {
                    actionButtons += `
                        <button class="action-btn delete-btn" 
                                onclick="if(window.securityManager.checkPermission('invoices_delete')) confirmDeleteInvoice('${sale.invoice_id}', '${sale.customer_name || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ'}')" 
                                title="Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©"
                                data-permission="invoices_delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                }
                
                return `
                    <tr>
                        <td>${sale.invoice_id}</td>
                        <td>${new Date(sale.timestamp).toLocaleDateString('ar-IQ')}</td>
                        <td>${sale.customer_name || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ'}</td>
                        <td>${formatCurrency(sale.final_total)}</td>
                        <td>
                            <span style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-${sale.payment_method === 'Ù†Ù‚Ø¯ÙŠ' ? 'money-bill-wave' : 'credit-card'}"></i>
                                ${sale.payment_type || sale.payment_method}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.3rem;">
                                <i class="fas fa-user" style="color: #666; font-size: 0.9em;"></i>
                                <span style="font-weight: 500;">${createdByName}</span>
                                <span style="color: #999; font-size: 0.85em;">(${createdByRole})</span>
                            </div>
                        </td>
                        <td>
                            ${actionButtons}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ†
        // Ù…ØªØºÙŠØ± Ø¹Ø§Ù… Ù„Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        let currentDebtFilter = 'all';
        
        function renderDebtsTable() {
            const tbody = document.getElementById('debtsTableBody');
            if (!tbody) return;
            
            console.log('Rendering debts:', debtsData);
            console.log('Current filter:', currentDebtFilter);
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
            const sortedDebts = [...debtsData].sort((a, b) => {
                const dateA = new Date(a.timestamp || a.date || a.created_at || 0);
                const dateB = new Date(b.timestamp || b.date || b.created_at || 0);
                return dateB.getTime() - dateA.getTime();
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†
            const searchTerm = document.getElementById('debtsSearchInput')?.value.toLowerCase() || '';
            let filteredDebts = searchTerm 
                ? sortedDebts.filter(debt => 
                    (debt.customer_name && debt.customer_name.toLowerCase().includes(searchTerm)) ||
                    (debt.customer_phone && debt.customer_phone.toLowerCase().includes(searchTerm)) ||
                    (debt.customer_address && debt.customer_address.toLowerCase().includes(searchTerm))
                  )
                : sortedDebts;
            
            // ğŸ”¥ ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©
            if (currentDebtFilter !== 'all') {
                filteredDebts = filteredDebts.filter(debt => {
                    // Ø­Ø³Ø§Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙŠÙ†
                    let paidAmount = 0;
                    let totalMonths = 0;
                    let paidMonths = 0;
                    
                    if (debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                        totalMonths = debt.installments.length;
                        debt.installments.forEach(inst => {
                            if (inst.status === 'paid') {
                                paidAmount += parseFloat(inst.paid_amount || inst.amount || 0);
                                paidMonths++;
                            }
                        });
                    } else if (debt.paid_amount !== undefined && debt.paid_amount !== null) {
                        paidAmount = parseFloat(debt.paid_amount) || 0;
                        totalMonths = debt.installment_months || 0;
                    }
                    
                    const totalAmount = debt.total_amount || debt.final_total || 0;
                    const remainingAmount = totalAmount - paidAmount;
                    const isPaid = paidMonths === totalMonths && totalMonths > 0;
                    const isOverdue = new Date(debt.due_date) < new Date() && remainingAmount > 0;
                    
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                    if (currentDebtFilter === 'paid') {
                        return isPaid;
                    } else if (currentDebtFilter === 'overdue') {
                        return isOverdue;
                    } else if (currentDebtFilter === 'active') {
                        return !isPaid && !isOverdue;
                    }
                    
                    return true;
                });
            }
            
            console.log('Filtered debts:', filteredDebts.length);
            
            tbody.innerHTML = filteredDebts.map(debt => {
                console.log('Debt data:', debt);
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                const totalAmount = debt.total_amount || debt.final_total || 0;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                let paidAmount = 0;
                let paidMonths = 0;
                
                if (debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                    debt.installments.forEach(inst => {
                        if (inst.status === 'paid') {
                            paidAmount += parseFloat(inst.paid_amount || inst.amount || 0);
                            paidMonths++;
                        }
                    });
                } else if (debt.paid_amount !== undefined && debt.paid_amount !== null) {
                    paidAmount = parseFloat(debt.paid_amount) || 0;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                let remainingAmount = totalAmount - paidAmount;
                if (remainingAmount < 0) remainingAmount = 0;
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
                let monthlyAmount = debt.monthly_amount || 0;
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù‚Ø³Ø· Ø´Ù‡Ø±ÙŠ Ù…Ø­Ø³ÙˆØ¨ØŒ Ø§Ø­Ø³Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                if (!monthlyAmount && totalAmount > 0 && debt.installment_months > 0) {
                    monthlyAmount = totalAmount / debt.installment_months;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
                let totalMonths = debt.installment_months || 0;
                if (debt.installments && Array.isArray(debt.installments)) {
                    totalMonths = debt.installments.length;
                }
                
                let isPaid = paidMonths === totalMonths && totalMonths > 0;
                
                const isOverdue = new Date(debt.due_date) < new Date();
                
                console.log('Debt:', debt.customer_name, '- Total:', totalAmount, 'Paid:', paidAmount, 'Remaining:', remainingAmount, 'Monthly:', monthlyAmount);
                console.log('Paid months:', paidMonths, '/', totalMonths, 'isPaid:', isPaid);
                
                let status = `${paidMonths}/${totalMonths} Ø´Ù‡Ø±`;
                let statusClass = 'debt-status active';
                
                if (isPaid) {
                    status = 'Ù…Ø³Ø¯Ø¯';
                    statusClass = 'debt-status paid';
                } else if (isOverdue) {
                    status = `Ù…ØªØ£Ø®Ø± (${paidMonths}/${totalMonths})`;
                    statusClass = 'debt-status overdue';
                }
                
                return `
                    <tr data-debt-id="${debt.id || debt.__backendId}">
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-user"></i>
                                ${debt.customer_name}
                                ${debt.merge_count && debt.merge_count > 0 ? `
                                    <span class="merge-badge" title="ØªÙ… Ø¯Ù…Ø¬ ${debt.merge_count} ${debt.merge_count === 1 ? 'Ø¯ÙŠÙ†' : 'Ø¯ÙŠÙˆÙ†'} Ø¥Ø¶Ø§ÙÙŠØ©">
                                        <i class="fas fa-layer-group"></i>
                                        ${debt.merge_count}
                                    </span>
                                ` : ''}
                            </div>
                        </td>
                        <td>${debt.customer_phone}</td>
                        <td>${formatCurrency(paidAmount)}</td>
                        <td>${formatCurrency(remainingAmount)}</td>
                        <td>${formatCurrency(monthlyAmount)}</td>
                        <td>${new Date(debt.due_date).toLocaleDateString('ar-IQ')}</td>
                        <td>
                            <span class="${statusClass}">${status}</span>
                        </td>
                        <td>
                            ${window.securityManager && window.securityManager.hasPermission('debts_view_details') ? `
                            <button class="action-btn view-btn" onclick="if(window.securityManager.checkPermission('debts_view_details')) showDebtDetails('${debt.id || debt.__backendId || debt.debt_id}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„" data-permission="debts_view_details">
                                <i class="fas fa-eye"></i>
                            </button>
                            ` : ''}
                            ${!isPaid && window.securityManager && window.securityManager.hasPermission('debts_edit') ? `
                            <button class="action-btn edit-btn" onclick="if(window.securityManager.checkPermission('debts_edit')) showEditDebtModal('${debt.id || debt.__backendId || debt.debt_id}')" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†" data-permission="debts_edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            ` : ''}
                            ${!isPaid && window.securityManager && window.securityManager.hasPermission('debts_payment') ? `
                                <button class="action-btn edit-btn" onclick="if(window.securityManager.checkPermission('debts_payment')) showQuickPayModal('${debt.id || debt.__backendId || debt.debt_id}')" title="ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø·" data-permission="debts_payment">
                                    <i class="fas fa-money-bill-wave"></i>
                                </button>
                            ` : ''}
                            ${window.securityManager && window.securityManager.hasPermission('debts_delete') ? `
                            <button class="action-btn delete-btn" onclick="if(window.securityManager.checkPermission('debts_delete')) confirmDeleteDebt('${debt.id || debt.__backendId || debt.debt_id}', '${debt.customer_name}')" title="Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†" data-permission="debts_delete">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // ğŸ”¥ Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
        function filterDebtsByStatus(status) {
            console.log('ğŸ” ØªØ·Ø¨ÙŠÙ‚ ÙÙ„ØªØ±:', status);
            currentDebtFilter = status;
            
            // ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            document.querySelectorAll('#debts .stat-card').forEach(card => {
                card.style.transform = 'scale(1)';
                card.style.boxShadow = '';
            });
            
            // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            const activeCard = event?.currentTarget;
            if (activeCard) {
                activeCard.style.transform = 'scale(1.05)';
                activeCard.style.boxShadow = '0 8px 24px rgba(0,0,0,0.15)';
            }
            
            renderDebtsTable();
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
            const filterMessages = {
                'all': 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ†',
                'paid': 'Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© ÙÙ‚Ø·',
                'overdue': 'Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ÙÙ‚Ø·',
                'active': 'Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù†Ø´Ø·Ø© ÙÙ‚Ø·'
            };
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        
        // âœ… ==== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª ====
        
        // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©
        let mergedReceiptsBatches = JSON.parse(localStorage.getItem('mergedReceiptsBatches') || '[]');
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
        function updateReceiptsStats() {
            const totalReceipts = salesData.length;
            const cashReceipts = salesData.filter(s => s.payment_method === 'Ù†Ù‚Ø¯ÙŠ' || s.payment_type === 'Ù†Ù‚Ø¯ÙŠ');
            const installmentReceipts = salesData.filter(s => s.payment_method === 'Ø£Ù‚Ø³Ø§Ø·' || s.payment_type === 'Ø£Ù‚Ø³Ø§Ø·');
            
            const totalCash = cashReceipts.reduce((sum, s) => sum + (s.final_total || s.total || 0), 0);
            const totalInstallment = installmentReceipts.reduce((sum, s) => sum + (s.final_total || s.total || 0), 0);
            const totalAmount = totalCash + totalInstallment;
            
            const totalReceiptsEl = document.getElementById('totalReceipts');
            const totalCashReceiptsEl = document.getElementById('totalCashReceipts');
            const totalInstallmentReceiptsEl = document.getElementById('totalInstallmentReceipts');
            const totalReceiptsAmountEl = document.getElementById('totalReceiptsAmount');
            
            if (totalReceiptsEl) totalReceiptsEl.textContent = toEnglishDigits(totalReceipts);
            if (totalCashReceiptsEl) totalCashReceiptsEl.textContent = toEnglishDigits(formatCurrency(totalCash));
            if (totalInstallmentReceiptsEl) totalInstallmentReceiptsEl.textContent = toEnglishDigits(formatCurrency(totalInstallment));
            if (totalReceiptsAmountEl) totalReceiptsAmountEl.textContent = toEnglishDigits(formatCurrency(totalAmount));
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
        function renderReceiptsTable() {
            const tableBody = document.getElementById('receiptsTableBody');
            if (!tableBody) return;
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const searchInput = document.getElementById('receiptsSearchInput');
            const dateFilterSelect = document.getElementById('receiptsDateFilter');
            const typeFilterSelect = document.getElementById('receiptsTypeFilter');
            const userFilterSelect = document.getElementById('receiptsUserFilter');
            
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const dateFilter = dateFilterSelect ? dateFilterSelect.value : 'all';
            const typeFilter = typeFilterSelect ? typeFilterSelect.value : 'all';
            const userFilter = userFilterSelect ? userFilterSelect.value : 'all';
            
            let filteredReceipts = [...salesData];
            
            // ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø«
            if (searchTerm) {
                filteredReceipts = filteredReceipts.filter(receipt => {
                    const searchableText = `
                        ${receipt.invoice_id || ''}
                        ${receipt.customer_name || ''}
                        ${receipt.created_by_name || ''}
                    `.toLowerCase();
                    return searchableText.includes(searchTerm);
                });
            }
            
            // ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
            if (dateFilter !== 'all') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                filteredReceipts = filteredReceipts.filter(receipt => {
                    const receiptDate = new Date(receipt.timestamp || receipt.created_at || receipt.date);
                    receiptDate.setHours(0, 0, 0, 0);
                    
                    switch(dateFilter) {
                        case 'today':
                            return receiptDate.getTime() === today.getTime();
                        case 'yesterday':
                            const yesterday = new Date(today);
                            yesterday.setDate(yesterday.getDate() - 1);
                            return receiptDate.getTime() === yesterday.getTime();
                        case 'thisWeek':
                            const weekStart = new Date(today);
                            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
                            return receiptDate >= weekStart;
                        case 'thisMonth':
                            return receiptDate.getMonth() === today.getMonth() && 
                                   receiptDate.getFullYear() === today.getFullYear();
                        default:
                            return true;
                    }
                });
            }
            
            // ÙÙ„ØªØ± Ø§Ù„Ù†ÙˆØ¹
            if (typeFilter !== 'all') {
                filteredReceipts = filteredReceipts.filter(receipt => 
                    receipt.payment_method === typeFilter || receipt.payment_type === typeFilter
                );
            }
            
            // ÙÙ„ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (userFilter !== 'all') {
                filteredReceipts = filteredReceipts.filter(receipt => 
                    receipt.created_by === userFilter
                );
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙÙ„ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            updateUsersFilter();
            
            // ØªØ±ØªÙŠØ¨ Ø¹ÙƒØ³ÙŠ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            filteredReceipts.sort((a, b) => {
                const dateA = new Date(a.timestamp || a.created_at || a.date);
                const dateB = new Date(b.timestamp || b.created_at || b.date);
                return dateB - dateA;
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ HTML
            const html = filteredReceipts.map(receipt => {
                const receiptDate = new Date(receipt.timestamp || receipt.created_at || receipt.date);
                const dateStr = toEnglishDigits(receiptDate.toLocaleDateString('ar-IQ'));
                const timeStr = toEnglishDigits(receiptDate.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit' }));
                const type = receipt.payment_method || receipt.payment_type || 'Ù†Ù‚Ø¯ÙŠ';
                const typeClass = type === 'Ù†Ù‚Ø¯ÙŠ' ? 'badge-success' : 'badge-warning';
                const isMerged = receipt.merged_batch_id ? true : false;
                const mergedIcon = isMerged ? '<i class="fas fa-check-circle" style="color: #10b981;"></i>' : '<i class="fas fa-times-circle" style="color: #ef4444;"></i>';
                
                return `
                    <tr>
                        <td><strong>${toEnglishDigits(receipt.invoice_id || 'N/A')}</strong></td>
                        <td>${dateStr}</td>
                        <td>${timeStr}</td>
                        <td>${receipt.customer_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td><strong>${toEnglishDigits(formatCurrency(receipt.final_total || receipt.total || 0))}</strong></td>
                        <td><span class="badge ${typeClass}">${type}</span></td>
                        <td>${receipt.created_by_name || receipt.created_by || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        <td style="text-align: center;">${mergedIcon}</td>
                        <td>
                            <button class="action-btn view-btn" onclick="viewReceiptDetails('${receipt.invoice_id}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit-btn" onclick="printReceipt('${receipt.invoice_id}')" title="Ø·Ø¨Ø§Ø¹Ø©">
                                <i class="fas fa-print"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tableBody.innerHTML = html || '<tr><td colspan="9" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠØµØ§Ù„Ø§Øª</td></tr>';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateReceiptsStats();
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙÙ„ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function updateUsersFilter() {
            const userFilter = document.getElementById('receiptsUserFilter');
            if (!userFilter) return;
            
            const users = new Set();
            salesData.forEach(receipt => {
                const user = receipt.created_by || 'unknown';
                const userName = receipt.created_by_name || user;
                users.add(JSON.stringify({id: user, name: userName}));
            });
            
            const currentValue = userFilter.value;
            userFilter.innerHTML = '<option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</option>';
            
            Array.from(users).forEach(userStr => {
                const user = JSON.parse(userStr);
                const userName = user.name === 'unknown' || user.name === user.id ? 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' : user.name;
                userFilter.innerHTML += `<option value="${user.id}">${userName}</option>`;
            });
            
            userFilter.value = currentValue;
        }
        
        // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª
        function filterReceipts() {
            renderReceiptsTable();
        }
        
        // Ø¯Ù…Ø¬ Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…
        function mergeReceipts() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayStr = today.toISOString().split('T')[0];
            
            // ÙÙ„ØªØ±Ø© Ø¥ÙŠØµØ§Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…
            const todayReceipts = salesData.filter(receipt => {
                const receiptDate = new Date(receipt.timestamp || receipt.created_at || receipt.date);
                receiptDate.setHours(0, 0, 0, 0);
                return receiptDate.getTime() === today.getTime() && !receipt.merged_batch_id;
            });
            
            if (todayReceipts.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ù…Ø¬
            if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¯Ù…Ø¬ ${toEnglishDigits(todayReceipts.length)} Ø¥ÙŠØµØ§Ù„ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØŸ`)) {
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©
            const batchId = 'batch_' + Date.now();
            const batchDate = today.toISOString();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            let cashTotal = 0;
            let installmentTotal = 0;
            let cashCount = 0;
            let installmentCount = 0;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠØµØ§Ù„Ø§Øª Ø¨Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙØ¹Ø©
            todayReceipts.forEach(receipt => {
                receipt.merged_batch_id = batchId;
                receipt.merged_date = batchDate;
                
                const total = receipt.final_total || receipt.total || 0;
                if (receipt.payment_method === 'Ù†Ù‚Ø¯ÙŠ' || receipt.payment_type === 'Ù†Ù‚Ø¯ÙŠ') {
                    cashTotal += total;
                    cashCount++;
                } else {
                    installmentTotal += total;
                    installmentCount++;
                }
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø©
            const mergedBatch = {
                batch_id: batchId,
                date: batchDate,
                receipts_count: todayReceipts.length,
                cash_total: cashTotal,
                cash_count: cashCount,
                installment_total: installmentTotal,
                installment_count: installmentCount,
                grand_total: cashTotal + installmentTotal,
                created_at: Date.now(),
                created_by: window.securityManager ? window.securityManager.getCurrentUsername() : 'unknown'
            };
            
            // Ø­ÙØ¸ Ø§Ù„Ø¯ÙØ¹Ø©
            mergedReceiptsBatches.push(mergedBatch);
            localStorage.setItem('mergedReceiptsBatches', JSON.stringify(mergedReceiptsBatches));
            
            // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙŠ salesData
            if (typeof saveToLocalStorage === 'function') {
                saveToLocalStorage('salesData', salesData);
            }
            
            // ØªØ­Ø¯ÙŠØ« dataSdk Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
            if (window.dataSdk) {
                todayReceipts.forEach(async receipt => {
                    try {
                        await window.dataSdk.update(receipt.id || receipt.__backendId, receipt);
                    } catch (error) {
                        console.error('Error updating receipt:', error);
                    }
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            renderReceiptsTable();
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø¥ÙŠØµØ§Ù„
        function viewReceiptDetails(invoiceId) {
            const receipt = salesData.find(s => s.invoice_id === invoiceId);
            if (!receipt) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const items = receipt.items ? JSON.parse(receipt.items) : [];
            const itemsHtml = items.map(item => `â€¢ ${item.product_name}: ${formatCurrency(item.product_price)} Ã— ${item.quantity}`).join('\n');
            
            alert(`ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ÙŠØµØ§Ù„\n\n` +
                  `Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoiceId}\n` +
                  `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(receipt.timestamp || receipt.created_at).toLocaleString('ar-IQ')}\n` +
                  `Ø§Ù„Ø¹Ù…ÙŠÙ„: ${receipt.customer_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n` +
                  `Ø§Ù„Ù…Ø¨Ù„Øº: ${formatCurrency(receipt.final_total || receipt.total || 0)}\n` +
                  `Ø§Ù„Ù†ÙˆØ¹: ${receipt.payment_method || receipt.payment_type}\n` +
                  `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${receipt.created_by_name || receipt.created_by || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n\n` +
                  `Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n${itemsHtml || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª'}`);
        }
        
        // Ø·Ø¨Ø§Ø¹Ø© Ø¥ÙŠØµØ§Ù„
        function printReceipt(invoiceId) {
            const receipt = salesData.find(s => s.invoice_id === invoiceId);
            if (!receipt) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (typeof printInvoice === 'function') {
                printInvoice(receipt);
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const totalProducts = products.length;
            const totalValue = products.reduce((sum, p) => sum + (p.stock_quantity * p.product_cost_retail), 0);
            const lowStockItems = products.filter(p => p.stock_quantity <= p.min_stock).length;
            const totalCategories = categories.length;
            
            updateElement('totalProducts', totalProducts);
            updateElement('totalValue', formatCurrency(totalValue));
            updateElement('lowStockItems', lowStockItems);
            updateElement('totalCategories', totalCategories);
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            const totalCost = products.reduce((sum, p) => sum + (p.stock_quantity * p.product_cost_retail), 0);
            const totalProfit = products.reduce((sum, p) => sum + (p.stock_quantity * (p.product_price_retail - p.product_cost_retail)), 0);
            const profitMargin = totalCost > 0 ? ((totalProfit / totalCost) * 100).toFixed(1) : 0;
            
            updateElement('totalCost', formatCurrency(totalCost));
            updateElement('totalProfit', formatCurrency(totalProfit));
            updateElement('profitMargin', profitMargin + '%');
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            const totalInvoices = salesData.length;
            const totalSales = salesData.reduce((sum, s) => sum + s.final_total, 0);
            const today = new Date().toDateString();
            const todaySales = salesData
                .filter(s => new Date(s.timestamp).toDateString() === today)
                .reduce((sum, s) => sum + s.final_total, 0);
            
            updateElement('totalInvoices', totalInvoices);
            updateElement('totalSales', formatCurrency(totalSales));
            updateElement('todaySales', formatCurrency(todaySales));
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† - Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (Ø§Ù„Ù…ØªÙ†Ø§Ù‚Øµ)
            console.log('Calculating debt statistics from:', debtsData);
            const totalDebts = debtsData.reduce((sum, d) => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                let paidAmount = 0;
                if (d.installments && Array.isArray(d.installments) && d.installments.length > 0) {
                    d.installments.forEach(inst => {
                        if (inst.status === 'paid') {
                            paidAmount += parseFloat(inst.paid_amount || inst.amount || 0);
                        }
                    });
                } else if (d.paid_amount !== undefined && d.paid_amount !== null) {
                    paidAmount = parseFloat(d.paid_amount) || 0;
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                const totalAmount = d.total_amount || d.final_total || 0;
                const remainingAmount = totalAmount - paidAmount;
                
                console.log('Debt:', d.customer_name, 'Total:', totalAmount, 'Paid:', paidAmount, 'Remaining:', remainingAmount);
                return sum + (remainingAmount > 0 ? remainingAmount : 0);
            }, 0);
            console.log('Total remaining debts calculated:', totalDebts);
            const debtCustomers = [...new Set(debtsData.map(d => d.customer_phone))].length;
            const overdueDebts = debtsData.filter(d => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ£Ø®ÙŠØ±
                let paidAmount = 0;
                if (d.installments && Array.isArray(d.installments)) {
                    d.installments.forEach(inst => {
                        if (inst.status === 'paid') {
                            paidAmount += parseFloat(inst.paid_amount || inst.amount || 0);
                        }
                    });
                }
                const totalAmount = d.total_amount || d.final_total || 0;
                const remaining = totalAmount - paidAmount;
                return new Date(d.due_date) < new Date() && remaining > 0;
            }).length;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ø³Ø¯Ø¯Ø©)
            const paidDebts = debtsData.filter(d => {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                if (d.installments && Array.isArray(d.installments) && d.installments.length > 0) {
                    // Ù…Ø³Ø¯Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ = Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ø¯ÙÙˆØ¹Ø©
                    return d.installments.every(inst => inst.status === 'paid');
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ø·ØŒ Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                    const remaining = d.remaining_amount !== undefined ? d.remaining_amount : (d.total_amount || d.final_total || 0);
                    return remaining <= 0;
                }
            }).length;
            
            console.log('Debts statistics - Total:', totalDebts, 'Customers:', debtCustomers, 'Overdue:', overdueDebts, 'Paid:', paidDebts);
            
            updateElement('totalDebts', formatCurrency(totalDebts));
            updateElement('debtCustomers', debtCustomers);
            updateElement('overdueDebts', overdueDebts);
            updateElement('paidDebts', paidDebts);
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        function showInstallmentForm() {
            document.getElementById('installmentForm').style.display = 'block';
            calculateInstallment();
        }
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†
        function searchDebtCustomers(query) {
            console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„Ø§Ø¡:', query);
            
            const resultsContainer = document.getElementById('customerSearchResults');
            if (!resultsContainer) return;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±ØºØ§Ù‹
            if (!query || query.trim().length < 2) {
                resultsContainer.classList.remove('active');
                resultsContainer.innerHTML = '';
                return;
            }
            
            const searchTerm = query.trim().toLowerCase();
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            const matchingCustomers = debtsData.filter(debt => {
                const name = (debt.customer_name || '').toLowerCase();
                const phone = (debt.customer_phone || '').toLowerCase();
                
                return name.includes(searchTerm) || phone.includes(searchTerm);
            });
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª (Ù†ÙØ³ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù„Ù‡ Ø¹Ø¯Ø© Ø¯ÙŠÙˆÙ†)
            const uniqueCustomers = [];
            const seenPhones = new Set();
            
            matchingCustomers.forEach(debt => {
                const phone = debt.customer_phone || debt.customer_name;
                if (!seenPhones.has(phone)) {
                    seenPhones.add(phone);
                    
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¯ÙŠÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„
                    const customerDebts = debtsData.filter(d => 
                        d.customer_phone === debt.customer_phone || 
                        (d.customer_name === debt.customer_name && !d.customer_phone)
                    );
                    
                    const totalRemaining = customerDebts.reduce((sum, d) => {
                        const totalAmount = parseFloat(d.total_amount || d.final_total || 0);
                        const paidAmount = parseFloat(d.paid_amount || 0);
                        const remaining = totalAmount - paidAmount;
                        return sum + (remaining > 0 ? remaining : 0);
                    }, 0);
                    
                    uniqueCustomers.push({
                        name: debt.customer_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        phone: debt.customer_phone || '',
                        address: debt.customer_address || '',
                        totalRemaining: totalRemaining,
                        debtsCount: customerDebts.length
                    });
                }
            });
            
            console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:', uniqueCustomers.length);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            if (uniqueCustomers.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="customer-search-empty">
                        <i class="fas fa-search"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>
                    </div>
                `;
                resultsContainer.classList.add('active');
            } else {
                resultsContainer.innerHTML = uniqueCustomers.map(customer => `
                    <div class="customer-search-item" onclick="selectExistingCustomer('${escapeHtml(customer.name)}', '${escapeHtml(customer.phone)}', '${escapeHtml(customer.address)}')">
                        <div class="customer-search-name">
                            <i class="fas fa-user"></i>
                            ${customer.name}
                        </div>
                        <div class="customer-search-info">
                            <span>
                                <i class="fas fa-phone"></i>
                                ${customer.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}
                            </span>
                            ${customer.address ? `
                            <span>
                                <i class="fas fa-map-marker-alt"></i>
                                ${customer.address}
                            </span>
                            ` : ''}
                        </div>
                        <div class="customer-search-debt">
                            <i class="fas fa-exclamation-circle"></i>
                            Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatCurrency(customer.totalRemaining)}
                            (${customer.debtsCount} ${customer.debtsCount === 1 ? 'Ø¯ÙŠÙ†' : 'Ø¯ÙŠÙˆÙ†'})
                        </div>
                    </div>
                `).join('');
                resultsContainer.classList.add('active');
            }
        }
        
        // Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯
        function selectExistingCustomer(name, phone, address) {
            console.log('âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„:', { name, phone, address });
            
            // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„
            const customerNameInput = document.getElementById('customerName');
            const customerPhoneInput = document.getElementById('customerPhone');
            const customerAddressInput = document.getElementById('customerAddress');
            const searchInput = document.getElementById('searchExistingCustomer');
            
            if (customerNameInput) customerNameInput.value = name;
            if (customerPhoneInput) customerPhoneInput.value = phone;
            if (customerAddressInput) customerAddressInput.value = address;
            if (searchInput) searchInput.value = '';
            
            // Ø¥Ø®ÙØ§Ø¡ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
            const resultsContainer = document.getElementById('customerSearchResults');
            if (resultsContainer) {
                resultsContainer.classList.remove('active');
                resultsContainer.innerHTML = '';
            }
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ¬Ù†Ø¨ XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        function calculateInstallment() {
            const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
            const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
            const discountAmount = subtotal * (discountPercent / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxRate = parseFloat(getCurrentTaxRate()) / 100;
            const taxAmount = afterDiscount * taxRate;
            const originalAmount = afterDiscount + taxAmount;
            
            const months = parseInt(document.getElementById('installmentMonths')?.value) || 12;
            const additionalAmount = parseFloat(document.getElementById('additionalAmount')?.value) || 0;
            const downPayment = parseFloat(document.getElementById('downPayment')?.value) || 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const totalBeforeDown = originalAmount + additionalAmount;
            
            // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const remainingAmount = totalBeforeDown - downPayment;
            
            // Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ = Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ / Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
            const monthlyPayment = remainingAmount > 0 ? remainingAmount / months : 0;
            
            updateElement('originalAmount', formatCurrency(originalAmount));
            updateElement('addedProfit', formatCurrency(additionalAmount));
            updateElement('totalInstallmentAmount', formatCurrency(totalBeforeDown));
            updateElement('monthlyPayment', formatCurrency(monthlyPayment));
            
            // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const downPaymentRow = document.getElementById('downPaymentRow');
            if (downPayment > 0) {
                downPaymentRow.style.display = 'flex';
                updateElement('downPaymentDisplay', formatCurrency(downPayment));
            } else {
                downPaymentRow.style.display = 'none';
            }
        }

        // ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        function toggleAdvancedEditMode() {
            const checkbox = document.getElementById('advancedEditMode');
            const advancedFields = document.getElementById('advancedEditFields');
            
            if (checkbox.checked) {
                console.log('âœ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·');
                advancedFields.style.display = 'block';
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
                const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
                const discountAmount = subtotal * (discountPercent / 100);
                const afterDiscount = subtotal - discountAmount;
                const taxRate = parseFloat(getCurrentTaxRate()) / 100;
                const taxAmount = afterDiscount * taxRate;
                const originalAmount = afterDiscount + taxAmount;
                
                const additionalAmount = parseFloat(document.getElementById('additionalAmount')?.value) || 0;
                const downPayment = parseFloat(document.getElementById('downPayment')?.value) || 0;
                const totalBeforeDown = originalAmount + additionalAmount;
                const remainingAmount = totalBeforeDown - downPayment;
                const months = parseInt(document.getElementById('installmentMonths')?.value) || 12;
                const monthlyPayment = remainingAmount > 0 ? remainingAmount / months : 0;
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ (ÙƒÙ‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© - placeholder)
                document.getElementById('customOriginalAmount').placeholder = formatNumber(originalAmount);
                document.getElementById('customTotalAmount').placeholder = formatNumber(totalBeforeDown);
                document.getElementById('customMonthlyAmount').placeholder = formatNumber(monthlyPayment);
                
                // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£ØµÙ„ÙŠØ©
                window.installmentOriginalValues = {
                    originalAmount,
                    totalAmount: totalBeforeDown,
                    monthlyAmount: monthlyPayment,
                    months
                };
            } else {
                console.log('âŒ Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…');
                advancedFields.style.display = 'none';
                
                // Ù…Ø³Ø­ Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                document.getElementById('customOriginalAmount').value = '';
                document.getElementById('customTotalAmount').value = '';
                document.getElementById('customMonthlyAmount').value = '';
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                calculateInstallment();
            }
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
        function recalculateFromOriginal() {
            const customOriginal = parseFloat(document.getElementById('customOriginalAmount').value);
            if (!customOriginal || customOriginal <= 0) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙØ§Ø±ØºØ§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                calculateInstallment();
                return;
            }
            
            console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ:', customOriginal);
            
            const additionalAmount = parseFloat(document.getElementById('additionalAmount')?.value) || 0;
            const downPayment = parseFloat(document.getElementById('downPayment')?.value) || 0;
            const months = parseInt(document.getElementById('installmentMonths')?.value) || 12;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            const totalAmount = customOriginal + additionalAmount;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
            const remainingAmount = totalAmount - downPayment;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            const monthlyAmount = remainingAmount > 0 ? remainingAmount / months : 0;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            updateElement('originalAmount', formatCurrency(customOriginal));
            updateElement('addedProfit', formatCurrency(additionalAmount));
            updateElement('totalInstallmentAmount', formatCurrency(totalAmount));
            updateElement('monthlyPayment', formatCurrency(monthlyAmount));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰
            document.getElementById('customTotalAmount').value = '';
            document.getElementById('customTotalAmount').placeholder = formatNumber(totalAmount);
            document.getElementById('customMonthlyAmount').value = '';
            document.getElementById('customMonthlyAmount').placeholder = formatNumber(monthlyAmount);
            
            // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const downPaymentRow = document.getElementById('downPaymentRow');
            if (downPayment > 0) {
                downPaymentRow.style.display = 'flex';
                updateElement('downPaymentDisplay', formatCurrency(downPayment));
            } else {
                downPaymentRow.style.display = 'none';
            }
            
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸
            window.customInstallmentValues = {
                originalAmount: customOriginal,
                totalAmount,
                monthlyAmount,
                remainingAmount
            };
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        function recalculateFromTotal() {
            const customTotal = parseFloat(document.getElementById('customTotalAmount').value);
            if (!customTotal || customTotal <= 0) {
                calculateInstallment();
                return;
            }
            
            console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:', customTotal);
            
            const downPayment = parseFloat(document.getElementById('downPayment')?.value) || 0;
            const months = parseInt(document.getElementById('installmentMonths')?.value) || 12;
            const additionalAmount = parseFloat(document.getElementById('additionalAmount')?.value) || 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¹ÙƒØ³ÙŠ)
            const originalAmount = customTotal - additionalAmount;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
            const remainingAmount = customTotal - downPayment;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            const monthlyAmount = remainingAmount > 0 ? remainingAmount / months : 0;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            updateElement('originalAmount', formatCurrency(originalAmount));
            updateElement('addedProfit', formatCurrency(additionalAmount));
            updateElement('totalInstallmentAmount', formatCurrency(customTotal));
            updateElement('monthlyPayment', formatCurrency(monthlyAmount));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰
            document.getElementById('customOriginalAmount').value = '';
            document.getElementById('customOriginalAmount').placeholder = formatNumber(originalAmount);
            document.getElementById('customMonthlyAmount').value = '';
            document.getElementById('customMonthlyAmount').placeholder = formatNumber(monthlyAmount);
            
            // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const downPaymentRow = document.getElementById('downPaymentRow');
            if (downPayment > 0) {
                downPaymentRow.style.display = 'flex';
                updateElement('downPaymentDisplay', formatCurrency(downPayment));
            } else {
                downPaymentRow.style.display = 'none';
            }
            
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸
            window.customInstallmentValues = {
                originalAmount,
                totalAmount: customTotal,
                monthlyAmount,
                remainingAmount
            };
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
        function recalculateFromMonthly() {
            const customMonthly = parseFloat(document.getElementById('customMonthlyAmount').value);
            if (!customMonthly || customMonthly <= 0) {
                calculateInstallment();
                return;
            }
            
            console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:', customMonthly);
            
            const downPayment = parseFloat(document.getElementById('downPayment')?.value) || 0;
            const additionalAmount = parseFloat(document.getElementById('additionalAmount')?.value) || 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
            const cartTotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
            const originalAmount = cartTotal;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            const totalAmount = originalAmount + additionalAmount;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const remainingAmount = totalAmount - downPayment;
            
            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            const calculatedMonths = Math.ceil(remainingAmount / customMonthly);
            
            console.log('ğŸ“Š Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:');
            console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ:', originalAmount);
            console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ:', additionalAmount);
            console.log('  Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:', totalAmount);
            console.log('  Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©:', downPayment);
            console.log('  Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:', remainingAmount);
            console.log('  Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:', customMonthly);
            console.log('  Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø­Ø³ÙˆØ¨:', calculatedMonths);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
            document.getElementById('installmentMonths').value = calculatedMonths;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            updateElement('originalAmount', formatCurrency(originalAmount));
            updateElement('addedProfit', formatCurrency(additionalAmount));
            updateElement('totalInstallmentAmount', formatCurrency(totalAmount));
            updateElement('monthlyPayment', formatCurrency(customMonthly));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø®Ø±Ù‰
            document.getElementById('customOriginalAmount').value = '';
            document.getElementById('customOriginalAmount').placeholder = formatNumber(originalAmount);
            document.getElementById('customTotalAmount').value = '';
            document.getElementById('customTotalAmount').placeholder = formatNumber(totalAmount);
            
            // Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            const downPaymentRow = document.getElementById('downPaymentRow');
            if (downPayment > 0) {
                downPaymentRow.style.display = 'flex';
                updateElement('downPaymentDisplay', formatCurrency(downPayment));
            } else {
                downPaymentRow.style.display = 'none';
            }
            
            // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸
            window.customInstallmentValues = {
                originalAmount,
                totalAmount,
                monthlyAmount: customMonthly,
                remainingAmount,
                installmentMonths: calculatedMonths
            };
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¨Ø¯ÙˆÙ† Ø¹Ù…Ù„Ø©
        function formatNumber(num) {
            if (isNaN(num) || num === null || num === undefined) return '0';
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        async function processCashPayment(customFinalAmount = null) {
            console.log('ğŸ›’ Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ...');
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cart.length);
            console.log('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµØµ:', customFinalAmount);
            
            if (cart.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµØµ Ù…Ø¤Ù‚ØªØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if (customFinalAmount !== null && customFinalAmount > 0) {
                window.customCashAmount = customFinalAmount;
            }
            
            const success = await processPayment('Ù†Ù‚Ø¯ÙŠ', 'Ù†Ù‚Ø¯ÙŠ');
            
            if (success) {
                console.log('âœ… ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                // Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ ÙÙ‚Ø·
                if (window.lastSaleInvoiceId) {
                    printInvoice(window.lastSaleInvoiceId, true);
                }
                closeModal('paymentModal');
                resetInstallmentForm();
                
                // Ù…Ø³Ø­ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµØµ
                window.customCashAmount = null;
            } else {
                console.log('âŒ ÙØ´Ù„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ');
            }
        }

        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        function showCashPaymentModal() {
            console.log('ğŸªŸ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©');
            
            if (cart.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
            const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
            const discountAmount = subtotal * (discountPercent / 100);
            const afterDiscount = subtotal - discountAmount;
            const taxRate = parseFloat(getCurrentTaxRate()) / 100;
            const taxAmount = afterDiscount * taxRate;
            const finalTotal = afterDiscount + taxAmount;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById('cashModalItemCount').textContent = cart.length;
            document.getElementById('cashModalOriginalTotal').textContent = formatCurrency(finalTotal);
            document.getElementById('cashModalFinalAmount').textContent = formatCurrency(finalTotal);
            document.getElementById('cashModalFinalPrice').value = '';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚
            document.getElementById('cashPriceDifferenceDisplay').style.display = 'none';
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
            window.cashModalOriginalAmount = finalTotal;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
            showModal('cashPaymentModal');
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        function updateCashPaymentPreview() {
            const finalPriceInput = document.getElementById('cashModalFinalPrice');
            const finalPriceValue = parseFloat(finalPriceInput.value) || 0;
            const originalAmount = window.cashModalOriginalAmount || 0;
            
            const differenceDisplay = document.getElementById('cashPriceDifferenceDisplay');
            const differenceLabel = document.getElementById('cashDifferenceLabel');
            const differenceAmount = document.getElementById('cashDifferenceAmount');
            const finalAmountDisplay = document.getElementById('cashModalFinalAmount');
            
            if (finalPriceValue > 0) {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚
                const difference = finalPriceValue - originalAmount;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                finalAmountDisplay.textContent = formatCurrency(finalPriceValue);
                
                // Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚
                differenceDisplay.style.display = 'block';
                
                if (difference > 0) {
                    // Ø²ÙŠØ§Ø¯Ø©
                    differenceDisplay.style.background = 'rgba(244, 67, 54, 0.1)';
                    differenceDisplay.style.border = '2px solid rgba(244, 67, 54, 0.3)';
                    differenceLabel.innerHTML = '<i class="fas fa-arrow-up"></i> Ø²ÙŠØ§Ø¯Ø©:';
                    differenceLabel.style.color = 'var(--danger-color)';
                    differenceAmount.textContent = formatCurrency(difference);
                    differenceAmount.style.color = 'var(--danger-color)';
                } else if (difference < 0) {
                    // Ø®ØµÙ…
                    differenceDisplay.style.background = 'rgba(76, 175, 80, 0.1)';
                    differenceDisplay.style.border = '2px solid rgba(76, 175, 80, 0.3)';
                    differenceLabel.innerHTML = '<i class="fas fa-arrow-down"></i> Ø®ØµÙ…:';
                    differenceLabel.style.color = 'var(--success-color)';
                    differenceAmount.textContent = formatCurrency(Math.abs(difference));
                    differenceAmount.style.color = 'var(--success-color)';
                } else {
                    // Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±Ù‚
                    differenceDisplay.style.display = 'none';
                }
            } else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
                finalAmountDisplay.textContent = formatCurrency(originalAmount);
                differenceDisplay.style.display = 'none';
            }
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        function closeCashPaymentModal() {
            closeModal('cashPaymentModal');
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…
            document.getElementById('cashModalFinalPrice').value = '';
            document.getElementById('cashPriceDifferenceDisplay').style.display = 'none';
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ
        async function confirmCashPayment() {
            const finalPriceInput = document.getElementById('cashModalFinalPrice');
            const finalPriceValue = parseFloat(finalPriceInput.value) || 0;
            const originalAmount = window.cashModalOriginalAmount || 0;
            
            console.log('âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ');
            console.log('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ:', originalAmount);
            console.log('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµØµ:', finalPriceValue);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            closeCashPaymentModal();
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ Ù…Ø¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø®ØµØµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if (finalPriceValue > 0) {
                await processCashPayment(finalPriceValue);
            } else {
                await processCashPayment(null);
            }
        }


        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¯ÙØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        async function processInstallmentPayment() {
            console.log('ğŸ›’ Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·...');
            console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©:', cart.length);
            
            if (cart.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            
            if (!customerName || !customerPhone) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const customerAddress = document.getElementById('customerAddress')?.value.trim() || '';
            let newInstallmentMonths = parseInt(document.getElementById('installmentMonths')?.value) || 12;
            const additionalAmount = parseFloat(document.getElementById('additionalAmount')?.value) || 0;
            const downPayment = parseFloat(document.getElementById('downPayment')?.value) || 0;
            const installmentStartDate = document.getElementById('installmentStartDate')?.value || null;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ… Ù…Ø®ØµØµØ© Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            let newTotalAmount, newRemainingAmount, newMonthlyAmount, finalTotal;
            
            if (window.customInstallmentValues && 
                window.customInstallmentValues.totalAmount > 0 && 
                window.customInstallmentValues.monthlyAmount > 0) {
                console.log('âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØµØµØ© Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…');
                console.log('Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØµØµØ©:', window.customInstallmentValues);
                
                finalTotal = window.customInstallmentValues.originalAmount || 0;
                newTotalAmount = window.customInstallmentValues.totalAmount;
                newRemainingAmount = window.customInstallmentValues.remainingAmount;
                newMonthlyAmount = window.customInstallmentValues.monthlyAmount;
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (window.customInstallmentValues.installmentMonths) {
                    newInstallmentMonths = window.customInstallmentValues.installmentMonths;
                    console.log('ğŸ“… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø­Ø³ÙˆØ¨:', newInstallmentMonths);
                }
                
                // Ù…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØµØµØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                window.customInstallmentValues = null;
            } else {
                console.log('ğŸ“Š Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„Ø³Ù„Ø© (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ)');
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Ø§Ù„Ø³Ù„Ø©
                const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
                const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
                const discountAmount = subtotal * (discountPercent / 100);
                const afterDiscount = subtotal - discountAmount;
                const taxRate = parseFloat(getCurrentTaxRate()) / 100;
                const taxAmount = afterDiscount * taxRate;
                finalTotal = afterDiscount + taxAmount;

                // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                if (additionalAmount > 0 && cart.length > 0) {
                    const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
                    const perUnitDiff = additionalAmount / totalQuantity;
                    let distributed = 0;
                    cart.forEach((item, idx) => {
                        let addForThis = perUnitDiff * item.quantity;
                        if (idx === cart.length - 1) {
                            addForThis += additionalAmount - (perUnitDiff * totalQuantity);
                        }
                        item.product_price = Math.round((item.product_price + addForThis / item.quantity));
                        distributed += addForThis;
                    });
                }

                // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ = Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ + Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
                newTotalAmount = finalTotal + additionalAmount;
                // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
                newRemainingAmount = newTotalAmount - downPayment;
                // Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ = Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ / Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
                newMonthlyAmount = newRemainingAmount / newInstallmentMonths;
            }
            
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:', { customerName, customerPhone, customerAddress });
            console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', { 
                finalTotal,
                additionalAmount,
                downPayment,
                newTotalAmount, 
                newRemainingAmount,
                newMonthlyAmount, 
                newInstallmentMonths
            });
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (isNaN(newTotalAmount) || newTotalAmount <= 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            if (isNaN(newMonthlyAmount) || newMonthlyAmount <= 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¯ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„
            const existingDebt = debtsData.find(debt => 
                debt.customer_phone === customerPhone && 
                debt.status === 'Ù†Ø´Ø·'
            );
            
            if (existingDebt) {
                console.log('ğŸ“‹ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¯ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„ - Ø³ÙŠØªÙ… Ø§Ù„Ø¯Ù…Ø¬');
                console.log('Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ:', existingDebt);
                // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ù…Ø¬
                const confirmMerge = confirm(
                    `Ù„Ø¯Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ "${customerName}" Ø¯ÙŠÙ† Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.\n\n` +
                    `Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${formatCurrency(existingDebt.remaining_amount || 0)}\n` +
                    `Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${getUnpaidInstallmentsCount(existingDebt)} Ø´Ù‡Ø±\n\n` +
                    `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠØŸ\n` +
                    `(Ø³ÙŠØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯)`
                );
                if (!confirmMerge) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                // Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                const success = await mergeDebtToExisting(
                    existingDebt,
                    {
                        newTotalAmount,
                        newRemainingAmount,
                        newMonthlyAmount,
                        newInstallmentMonths,
                        additionalAmount,
                        downPayment,
                        customerAddress,
                        cart: [...cart],
                        finalTotal: newTotalAmount - downPayment, // ğŸ”¥ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„ØµØ­ÙŠØ­ (Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø®ØµÙ…)
                        originalSubtotal: finalTotal, // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
                        start_date: installmentStartDate
                    }
                );
                // Ù…Ù„Ø§Ø­Ø¸Ø©: window.lastSaleInvoiceId ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¯Ø§Ø®Ù„ mergeDebtToExisting Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                // Ù„Ø§ Ù†Ø³ØªØ¨Ø¯Ù„Ù‡ Ù‡Ù†Ø§ Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                if (success) {
                    // âœ… ÙÙ‚Ø· Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹ (Ø¨Ø¯ÙˆÙ† Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯)
                    if (window.lastSaleInvoiceId) {
                        printInstallmentInvoice(window.lastSaleInvoiceId, true, {
                            customer_name: customerName,
                            customer_phone: customerPhone,
                            customer_address: customerAddress,
                            installment_months: newInstallmentMonths,
                            monthly_amount: newMonthlyAmount,
                            down_payment: downPayment,
                            additional_amount: additionalAmount,
                            remaining_amount: newRemainingAmount,
                            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                            new_items: [...cart],
                            new_subtotal: cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0),
                            new_final_total: newTotalAmount - downPayment // ğŸ”¥ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„ØµØ­ÙŠØ­ (Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø®ØµÙ…)
                        });
                    }
                    closeModal('paymentModal');
                    resetInstallmentForm();
                } else {
                    console.log('âŒ ÙØ´Ù„ Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙ†');
                }
            } else {
                console.log('ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ù…ÙŠÙ„');
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯
                const success = await processPayment('Ø£Ù‚Ø³Ø§Ø·', 'Ø£Ù‚Ø³Ø§Ø·', {
                    customer_name: customerName,
                    customer_phone: customerPhone,
                    customer_address: customerAddress,
                    installment_months: newInstallmentMonths,
                    additional_amount: additionalAmount,
                    down_payment: downPayment,
                    monthly_amount: newMonthlyAmount,
                    total_amount: newTotalAmount,
                    remaining_amount: newRemainingAmount,
                    start_date: installmentStartDate,
                    advanced_control_used: window.customInstallmentValues ? true : false,
                    debt_date: new Date().toISOString()
                });
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø±Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø£Ù‚Ø³Ø§Ø·
                if (Array.isArray(salesData) && salesData.length > 0) {
                    // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø© Ø£Ù‚Ø³Ø§Ø· ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„
                    const lastInstallmentSale = salesData.filter(s => s.customer_phone === customerPhone && s.payment_type === 'Ø£Ù‚Ø³Ø§Ø·').sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
                    if (lastInstallmentSale && lastInstallmentSale.invoice_id) {
                        window.lastSaleInvoiceId = lastInstallmentSale.invoice_id;
                    }
                }
                if (success) {
                    // âœ… ÙÙ‚Ø· Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹ (Ø¨Ø¯ÙˆÙ† Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯)
                    if (window.lastSaleInvoiceId) {
                        printInstallmentInvoice(window.lastSaleInvoiceId, true, {
                            customer_name: customerName,
                            customer_phone: customerPhone,
                            customer_address: customerAddress,
                            installment_months: newInstallmentMonths,
                            monthly_amount: newMonthlyAmount,
                            down_payment: downPayment,
                            additional_amount: additionalAmount,
                            remaining_amount: newRemainingAmount
                        });
                    }
                    console.log('âœ… ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­');
                    closeModal('paymentModal');
                    resetInstallmentForm();
                } else {
                    console.log('âŒ ÙØ´Ù„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·');
                }
            }
// Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ· Ù…ÙØµÙ„Ø© (Ù†Ø·Ø§Ù‚ Ø¹Ø§Ù…)
function printInstallmentInvoice(invoiceId, silent = false, extraData = {}) {
    window.printInstallmentInvoice = printInstallmentInvoice;
    (async () => {
        const settings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
        let sale = null;
        let foundSource = '';
        console.log('ğŸ–¨ï¸ Ø¨Ø¯Ø¡ Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:', invoiceId);
        console.log('ğŸ“¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:', extraData);

        // 1. Ø¬Ù„Ø¨ Ù…Ù† salesData
        if (typeof salesData !== 'undefined' && Array.isArray(salesData)) {
            sale = salesData.find(s => s.invoice_id === invoiceId);
            if (sale) foundSource = 'salesData';
        }
        // 2. Ø¬Ù„Ø¨ Ù…Ù† window.dataSdk (Ù…ØªØ²Ø§Ù…Ù† Ø£Ùˆ ØºÙŠØ± Ù…ØªØ²Ø§Ù…Ù†)
        if ((!sale || !sale.items) && window.dataSdk && typeof window.dataSdk.getAll === 'function') {
            let allSales = [];
            try {
                const result = window.dataSdk.getAll();
                if (result && typeof result.then === 'function') {
                    allSales = await result;
                } else {
                    allSales = result;
                }
            } catch {}
            if (Array.isArray(allSales)) {
                const found = allSales.find(s => s.invoice_id === invoiceId);
                if (found) { sale = found; foundSource = 'dataSdk'; }
            }
        }
        // 3. Ø¬Ù„Ø¨ Ù…Ù† window.invoicesDB (ÙˆØ§Ø¬Ù‡Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
        if ((!sale || !sale.items) && window.invoicesDB && typeof window.invoicesDB.getById === 'function') {
            try {
                const invoice = await window.invoicesDB.getById(invoiceId);
                if (invoice) { sale = invoice; foundSource = 'invoicesDB'; }
            } catch {}
        }
        // 4. Ø¬Ù„Ø¨ Ù…Ù† extraData (Ø¥Ø°Ø§ Ø§Ø­ØªÙˆÙ‰ Ø¹Ù„Ù‰ ÙƒÙ„ Ø´ÙŠØ¡)
        if (!sale && extraData && extraData.items && extraData.final_total) {
            sale = { ...extraData, invoice_id: invoiceId };
            foundSource = 'extraData';
        }
        if (!sale) {
            console.error('âŒ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø£ÙŠ Ù…ØµØ¯Ø±:', invoiceId);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù†:', foundSource, sale);

        // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† items Ù…ØµÙÙˆÙØ©
        if (typeof sale.items === 'string') {
            try { sale.items = JSON.parse(sale.items); } catch { sale.items = []; }
        }
        if (!Array.isArray(sale.items)) sale.items = [];

        // Ø¯Ù…Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª extraData ÙÙˆÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª sale (Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ø£Ø­Ø¯Ø«)
        if (extraData && typeof extraData === 'object') {
            for (const key of Object.keys(extraData)) {
                if (extraData[key] !== undefined && extraData[key] !== null && extraData[key] !== '') {
                    sale[key] = extraData[key];
                }
            }
        }

        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const requiredFields = ['customer_name','installment_months','monthly_amount','final_total'];
        for (const field of requiredFields) {
            if (!sale[field]) {
                console.warn('âš ï¸ Ø§Ù„Ø­Ù‚Ù„ Ù†Ø§Ù‚Øµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©:', field, sale);
            }
        }

        // ØªÙˆÙ„ÙŠØ¯ HTML Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        const receiptContent = generateInstallmentInvoiceReceipt(sale, settings);
        const printHtml = `<!DOCTYPE html><html dir="rtl" lang="ar"><head><meta charset="UTF-8"><title>ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ· ${sale.invoice_id}</title><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet"><style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Cairo', sans-serif; direction: rtl; background: white; } @media print { body { margin: 0; } @page { margin: 0; } }</style></head><body>${receiptContent}</body></html>`;

        // Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµØ§Ù…ØªØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§
        if (typeof window.safePrintInvoice === 'function') {
            window.safePrintInvoice(printHtml, {
                silent: true,
                pageSize: 'A4',
                printBackground: true
            });
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } else {
            // fallback: Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø§Ø¯ÙŠØ©
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printHtml);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => { printWindow.print(); }, 500);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        if (typeof updatePrintStats === 'function') updatePrintStats();
    })();
}
// ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯Ø§Ù„Ø© ÙÙŠ window Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø§Ù„Ø©
if (typeof window !== 'undefined') {
  window.printInstallmentInvoice = printInstallmentInvoice;
}
        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªÙ‚Ø³ÙŠØ·
        function generateInstallmentInvoiceReceipt(sale, settings) {
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø³Ø§Ø¹Ø©
            const saleDate = new Date(sale.timestamp || sale.created_at || Date.now());
            const dateStr = saleDate.toLocaleDateString('ar-IQ', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            });
            const timeStr = saleDate.toLocaleTimeString('ar-IQ', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true
            });
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ù† installment_details Ø£Ùˆ Ù…Ù† Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            const installmentDetails = sale.installment_details || {};
            const originalSubtotal = installmentDetails.original_subtotal || sale.subtotal || 0;
            const additionalAmount = installmentDetails.additional_amount || sale.additional_amount || 0;
            const downPayment = installmentDetails.down_payment || sale.down_payment || 0;
            const totalBeforeDiscount = originalSubtotal + additionalAmount;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            let finalTotal = originalSubtotal; // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
            if (additionalAmount > 0) finalTotal += additionalAmount; // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
            if (downPayment > 0) finalTotal -= downPayment; // Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
            
            const remainingAmount = installmentDetails.remaining_amount || sale.remaining_amount || (totalBeforeDiscount - downPayment);
            const monthlyAmount = installmentDetails.monthly_amount || sale.monthly_amount || 0;
            const installmentMonths = installmentDetails.installment_months || sale.installment_months || 0;
            const startDate = installmentDetails.start_date || sale.start_date || null;
            const advancedControlUsed = installmentDetails.advanced_control_used || installmentDetails.custom_values_used || false;
            
            let html = `<div style="width:210mm;min-height:297mm;margin:0 auto;padding:12mm 10mm;font-family:'Cairo',sans-serif;background:#fff;color:#222;line-height:1.4;font-size:11px;box-sizing:border-box;">
            
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù† -->
            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;padding-bottom:6px;border-bottom:2px solid #6366f1;">
                <!-- Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ -->
                <div style="flex:0 0 35%;">
                    <h1 style="margin:0;font-size:1.3rem;font-weight:bold;color:#2d3748;">${settings?.store_name || 'ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø§Ø¬Ù‡Ø²Ù‡ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠÙ‡'}</h1>
                </div>
                <!-- Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù‡Ø§ØªÙ -->
                <div style="flex:0 0 60%;text-align:left;">
                    <div style="font-size:0.95rem;color:#374151;font-weight:600;margin-bottom:2px;">${settings?.store_address || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠÙ‡ Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ù‡ Ø§Ù„ÙƒØ±Ø§Ø±'}</div>
                    <div style="font-size:0.9rem;color:#6366f1;font-weight:600;">ğŸ“ ${settings?.store_phone || '07803092185'}</div>
                </div>
            </div>
            
            <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ø§ -->
            <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:6px;padding:6px 10px;margin-bottom:8px;color:#fff;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div>
                        <div style="font-size:1.05rem;font-weight:bold;">ğŸ“‹ ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ·</div>
                        <div style="font-size:0.85rem;opacity:0.95;">Ø±Ù‚Ù…: ${sale.invoice_id || ''}</div>
                    </div>
                    <div style="text-align:left;font-size:0.85rem;">
                        <div>ğŸ“… ${dateStr}</div>
                        <div>ğŸ• ${timeStr}</div>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ - ØµÙ ÙˆØ§Ø­Ø¯ -->
            <div style="background:#f8fafc;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #e2e8f0;">
                <div style="font-weight:bold;color:#1e293b;margin-bottom:4px;font-size:0.95rem;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:0.9rem;">
                    <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${sale.customer_name || ''}</div>
                    <div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${sale.customer_phone || ''}</div>
                    <div><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${sale.customer_address || ''}</div>
                </div>
            </div>
            
            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· - Ù…Ø¶ØºÙˆØ· -->
            <div style="background:#f0f9ff;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #bae6fd;">
                <div style="font-weight:bold;color:#0c4a6e;margin-bottom:4px;font-size:0.95rem;">ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</div>
                <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:4px;font-size:0.85rem;">
                    <div style="background:#dbeafe;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#1e40af;font-size:0.8rem;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</div>
                        <div style="font-weight:bold;color:#1e3a8a;">${originalSubtotal.toLocaleString()}</div>
                    </div>
                    ${additionalAmount > 0 ? `<div style="background:#fce7f3;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#9f1239;font-size:0.8rem;">Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ</div>
                        <div style="font-weight:bold;color:#be123c;">${additionalAmount.toLocaleString()}</div>
                    </div>` : ''}
                    ${downPayment > 0 ? `<div style="background:#d1fae5;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#065f46;font-size:0.8rem;">Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©</div>
                        <div style="font-weight:bold;color:#047857;">${downPayment.toLocaleString()}</div>
                    </div>` : ''}
                    <div style="background:#fee2e2;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#7f1d1d;font-size:0.8rem;">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                        <div style="font-weight:bold;color:#991b1b;">${remainingAmount.toLocaleString()}</div>
                    </div>
                    <div style="background:#fef3c7;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#78350f;font-size:0.8rem;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</div>
                        <div style="font-weight:bold;color:#92400e;">${installmentMonths}</div>
                    </div>
                    <div style="background:#ffedd5;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#7c2d12;font-size:0.8rem;">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                        <div style="font-weight:bold;color:#9a3412;">${monthlyAmount.toLocaleString()}</div>
                    </div>
                    ${startDate ? `<div style="background:#e0e7ff;padding:4px;border-radius:4px;text-align:center;">
                        <div style="font-weight:600;color:#3730a3;font-size:0.8rem;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
                        <div style="font-weight:bold;color:#4338ca;font-size:0.8rem;">${new Date(startDate).toLocaleDateString('ar-IQ')}</div>
                    </div>` : ''}
                    ${advancedControlUsed ? `<div style="background:#ede9fe;padding:4px;border-radius:4px;text-align:center;grid-column:1/-1;">
                        <div style="font-weight:600;color:#5b21b6;font-size:0.8rem;">âš™ï¸ ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…</div>
                    </div>` : ''}
                </div>
            </div>
            
            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ù…Ø¶ØºÙˆØ· -->
            <div style="margin-bottom:8px;">
                <table style="width:100%;border-collapse:collapse;font-size:0.9rem;border:1px solid #e5e7eb;">
                <thead>
                    <tr style="background:#6366f1;color:#fff;">
                        <th style="padding:4px 6px;width:6%;text-align:center;border:1px solid rgba(255,255,255,0.2);">#</th>
                        <th style="padding:4px 6px;width:44%;text-align:right;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th style="padding:4px 6px;width:12%;text-align:center;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th style="padding:4px 6px;width:18%;text-align:center;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„Ø³Ø¹Ø±</th>
                        <th style="padding:4px 6px;width:20%;text-align:center;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                    </tr>
                </thead>
                <tbody>`;
            
            let items = sale.items;
            if (typeof items === 'string') {
                try { items = JSON.parse(items); } catch { items = []; }
            }
            
            items.forEach((item, index) => {
                const name = item.product_name || item.name || 'â€”';
                const price = item.product_price || item.price || 0;
                const qty = item.quantity || 1;
                const total = price * qty;
                html += `<tr style="background:${index%2===0?'#fff':'#f9fafb'};">
                    <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:600;">${index+1}</td>
                    <td style="padding:4px 6px;text-align:right;border:1px solid #e5e7eb;">${name}</td>
                    <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:600;">${qty}</td>
                    <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:600;">${price.toLocaleString()}</td>
                    <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:bold;color:#10b981;">${total.toLocaleString()}</td>
                </tr>`;
            });
            
            html += `</tbody></table></div>
            
            <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ù„Øº - Ù…Ø¶ØºÙˆØ· -->
            <div style="background:#fef3c7;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #fde68a;">
                <div style="font-weight:bold;color:#78350f;margin-bottom:4px;font-size:0.95rem;">ğŸ’° Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.9rem;">
                    <div style="display:flex;justify-content:space-between;padding:3px 6px;background:#e0f2fe;border-radius:4px;">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:</span>
                        <strong>${originalSubtotal.toLocaleString()}</strong>
                    </div>
                    ${additionalAmount > 0 ? `<div style="display:flex;justify-content:space-between;padding:3px 6px;background:#fce7f3;border-radius:4px;">
                        <span>Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ:</span>
                        <strong style="color:#be123c;">+${additionalAmount.toLocaleString()}</strong>
                    </div>` : ''}
                    ${downPayment > 0 ? `<div style="display:flex;justify-content:space-between;padding:3px 6px;background:#d1fae5;border-radius:4px;">
                        <span>Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©:</span>
                        <strong style="color:#047857;">-${downPayment.toLocaleString()}</strong>
                    </div>` : ''}
                    <div style="grid-column:1/-1;display:flex;justify-content:space-between;padding:6px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:4px;color:#fff;">
                        <span style="font-size:1rem;font-weight:bold;">ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                        <strong style="font-size:1.1rem;">${finalTotal.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</strong>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø¶ØºÙˆØ·Ø© -->
            <div style="background:#fffbeb;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #fbbf24;">
                <div style="font-weight:bold;color:#b91c1c;margin-bottom:4px;font-size:0.9rem;">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</div>
                <ol style="font-size:0.8rem;padding-right:18px;margin:0;line-height:1.5;">
                    <li>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ùˆ ÙˆØµÙ„ Ø£Ù…Ø§Ù†Ø©</li>
                    <li>Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù…ÙŠ 24 Ø³Ø§Ø¹Ø©</li>
                    <li>Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù„Ø§ ÙŠØ±Ø¬Ø¹ ÙˆÙ„Ø§ ÙŠØ¨Ø¯Ù„</li>
                    <li>Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ù‡Ùˆ Ù…Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø·Ø±ÙÙŠÙ†</li>
                    <li>Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¶Ù…Ø§Ù†</li>
                    <li>ÙƒØ³Ø± Ø§Ù„Ø´Ø§Ø´Ø© ØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø¨Ø§Ù„Ø¶Ù…Ø§Ù†</li>
                    <li style="margin-top:4px;">
                        <div style="background:#e0f2fe;padding:4px 6px;border-radius:4px;border:1px solid #bae6fd;">
                            <strong style="color:#0c4a6e;">ğŸ‘¨â€ğŸ”§ Ø§Ù„ØµÙŠØ§Ù†Ø©:</strong> Ø­Ù…Ø²Ù‡ Ø§Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡ - ØµÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø¨Ø§Ù„Øª
                            <div style="direction:ltr;text-align:left;font-weight:bold;color:#0c4a6e;margin-top:2px;">
                                ğŸ“± <span style="letter-spacing:1px;">+964 785 570 6118</span>
                            </div>
                        </div>
                    </li>
                </ol>
            </div>
            
            <!-- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª -->
            <div style="display:flex;justify-content:space-between;gap:30px;margin-top:10px;">
                <div style="flex:1;text-align:center;">
                    <div style="font-size:0.9rem;font-weight:bold;margin-bottom:15px;">âœï¸ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
                    <div style="border-bottom:1px dashed #9ca3af;"></div>
                </div>
                <div style="flex:1;text-align:center;">
                    <div style="font-size:0.9rem;font-weight:bold;margin-bottom:15px;">âœï¸ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                    <div style="border-bottom:1px dashed #9ca3af;"></div>
                </div>
            </div>
            
            <!-- Ø§Ù„Ø®ØªØ§Ù… -->
            <div style="text-align:center;margin-top:10px;padding-top:6px;border-top:2px solid #e5e7eb;">
                <p style="margin:2px 0;font-size:0.95rem;font-weight:bold;color:#6366f1;">ğŸŒŸ Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§ ğŸŒŸ</p>
                <p style="margin:2px 0;font-size:0.85rem;color:#6b7280;">Ù†ØªØ·Ù„Ø¹ Ù„Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
            </div>
            </div>`;
            return html;
        }
         }
        
        // Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
        async function mergeDebtToExisting(existingDebt, newDebtData) {
            console.log('ğŸ”— Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙˆÙ†...');
            
            try {
                setLoading(true);
                
                // Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹
                const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
                const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
                const discountAmount = subtotal * (discountPercent / 100);
                const afterDiscount = subtotal - discountAmount;
                const taxRate = parseFloat(getCurrentTaxRate()) / 100;
                const taxAmount = afterDiscount * taxRate;
                
                // Always use a deep copy of the latest cart for the new sale
                const latestCart = Array.isArray(newDebtData.cart) ? JSON.parse(JSON.stringify(newDebtData.cart)) : (Array.isArray(cart) ? JSON.parse(JSON.stringify(cart)) : []);
                
                // ğŸ”¥ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
                // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† = Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ + Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ - Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
                const correctFinalTotal = newDebtData.finalTotal || (newDebtData.newTotalAmount - newDebtData.downPayment);
                
                const saleData = {
                    type: 'sale',
                    invoice_id: 'INV-' + Date.now(),
                    items: JSON.stringify(latestCart),
                    subtotal: subtotal,
                    tax: taxAmount,
                    discount: discountAmount,
                    final_total: correctFinalTotal, // ğŸ”¥ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„ØµØ­ÙŠØ­
                    payment_method: 'Ø£Ù‚Ø³Ø§Ø·',
                    payment_type: 'Ø£Ù‚Ø³Ø§Ø·',
                    timestamp: new Date().toISOString(),
                    customer_name: existingDebt.customer_name,
                    customer_phone: existingDebt.customer_phone,
                    customer_address: newDebtData.customerAddress || existingDebt.customer_address,
                    linked_debt_id: existingDebt.id || existingDebt.invoice_id,
                    // ğŸ”¥ Ø­ÙØ¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                    installment_months: newDebtData.newInstallmentMonths,
                    monthly_amount: newDebtData.newMonthlyAmount,
                    additional_amount: newDebtData.additionalAmount || 0,
                    down_payment: newDebtData.downPayment || 0,
                    remaining_amount: newDebtData.newRemainingAmount,
                    start_date: newDebtData.start_date,
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    created_by: window.securityManager ? window.securityManager.getCurrentUsername() : 'unknown',
                    created_by_name: window.securityManager ? window.securityManager.getCurrentUserFullName() : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    created_by_role: window.securityManager && window.securityManager.currentUser ? window.securityManager.currentUser.role : 'unknown',
                    created_at: new Date().toISOString()
                };
                
                console.log('ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...');
                const saleResult = await window.dataSdk.create(saleData);
                let newInvoiceId = saleData.invoice_id;
                if (!saleResult.isOk) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    setLoading(false);
                    return false;
                }
                // Ensure the new invoice id is available for printing
                window.lastSaleInvoiceId = newInvoiceId;
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', newInvoiceId);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                console.log('ğŸ“¦ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†...');
                await updateProductStock();
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©
                const unpaidInstallments = (existingDebt.installments || []).filter(
                    inst => inst.status === 'pending'
                );
                
                console.log('ğŸ“Š Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©:', unpaidInstallments.length);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
                const currentRemainingAmount = parseFloat(existingDebt.remaining_amount) || 0;
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const mergedTotalAmount = parseFloat(existingDebt.total_amount) + newDebtData.newTotalAmount;
                const mergedRemainingAmount = currentRemainingAmount + newDebtData.newRemainingAmount;
                
                // Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©)
                const oldMonthlyAmount = unpaidInstallments.length > 0 
                    ? parseFloat(unpaidInstallments[0].amount) 
                    : parseFloat(existingDebt.monthly_amount) || 0;
                
                // Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ù† Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯)
                const newMonthlyAmount = newDebtData.newMonthlyAmount;
                
                // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ÙÙŠÙ‡Ø§ (Ø§Ù„Ø£Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯)
                const overlappingMonths = Math.min(unpaidInstallments.length, newDebtData.newInstallmentMonths);
                
                // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ù† Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø£Ø·ÙˆÙ„)
                const remainingOldMonths = unpaidInstallments.length - overlappingMonths;
                const remainingNewMonths = newDebtData.newInstallmentMonths - overlappingMonths;
                
                console.log('ğŸ§® Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© (Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ©):');
                console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…:', existingDebt.total_amount);
                console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', newDebtData.newTotalAmount);
                console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ù…Ø¬:', mergedTotalAmount);
                console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:', currentRemainingAmount);
                console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', newDebtData.newRemainingAmount);
                console.log('  Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ù…Ø¯Ù…Ø¬:', mergedRemainingAmount);
                console.log('  Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…:', oldMonthlyAmount);
                console.log('  Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', newMonthlyAmount);
                console.log('  Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:', unpaidInstallments.length);
                console.log('  Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:', newDebtData.newInstallmentMonths);
                console.log('  Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© (Ù‚Ø³Ø· Ù…Ø²Ø¯ÙˆØ¬):', overlappingMonths);
                console.log('  Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø¯ÙŠÙ…:', remainingOldMonths);
                console.log('  Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:', remainingNewMonths);
                
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
                const totalMonths = overlappingMonths + Math.max(remainingOldMonths, remainingNewMonths);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø¯Ù…Ø¬ (Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ©)
                const mergedInstallments = [];
                
                // 1. Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ)
                const paidInstallments = (existingDebt.installments || []).filter(
                    inst => inst.status === 'paid'
                );
                
                mergedInstallments.push(...paidInstallments);
                
                let monthCounter = paidInstallments.length + 1;
                
                // 2. Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© (Ù‚Ø³Ø· Ù‚Ø¯ÙŠÙ… + Ù‚Ø³Ø· Ø¬Ø¯ÙŠØ¯)
                for (let i = 0; i < overlappingMonths; i++) {
                    const oldInstallment = unpaidInstallments[i];
                    const dueDate = oldInstallment.due_date || new Date(Date.now() + (monthCounter * 30 * 24 * 60 * 60 * 1000)).toISOString();
                    
                    mergedInstallments.push({
                        month: monthCounter,
                        amount: oldMonthlyAmount + newMonthlyAmount, // âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ø·ÙŠÙ†
                        old_amount: oldMonthlyAmount,
                        new_amount: newMonthlyAmount,
                        due_date: dueDate,
                        status: 'pending',
                        paid_date: null,
                        paid_amount: 0,
                        installment_type: 'merged', // Ù‚Ø³Ø· Ù…Ø¯Ù…Ø¬
                        merge_info: `${formatCurrency(oldMonthlyAmount)} + ${formatCurrency(newMonthlyAmount)}`,
                        added_at: new Date().toISOString()
                    });
                    
                    monthCounter++;
                }
                
                // 3. Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ø¥Ù† ÙˆØ¬Ø¯Øª)
                for (let i = overlappingMonths; i < unpaidInstallments.length; i++) {
                    const oldInstallment = unpaidInstallments[i];
                    const dueDate = oldInstallment.due_date || new Date(Date.now() + (monthCounter * 30 * 24 * 60 * 60 * 1000)).toISOString();
                    
                    mergedInstallments.push({
                        month: monthCounter,
                        amount: oldMonthlyAmount, // âœ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙÙ‚Ø·
                        due_date: dueDate,
                        status: 'pending',
                        paid_date: null,
                        paid_amount: 0,
                        installment_type: 'old_only', // Ù…Ù† Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙÙ‚Ø·
                        original_debt: 'Ù…ÙˆØ¬ÙˆØ¯',
                        added_at: new Date().toISOString()
                    });
                    
                    monthCounter++;
                }
                
                // 4. Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¥Ù† ÙˆØ¬Ø¯Øª)
                for (let i = overlappingMonths; i < newDebtData.newInstallmentMonths; i++) {
                    const dueDate = new Date(Date.now() + (monthCounter * 30 * 24 * 60 * 60 * 1000));
                    
                    mergedInstallments.push({
                        month: monthCounter,
                        amount: newMonthlyAmount, // âœ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·
                        due_date: dueDate.toISOString(),
                        status: 'pending',
                        paid_date: null,
                        paid_amount: 0,
                        installment_type: 'new_only', // Ù…Ù† Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·
                        original_debt: 'Ø¬Ø¯ÙŠØ¯',
                        added_at: new Date().toISOString()
                    });
                    
                    monthCounter++;
                }
                
                console.log('ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø¯Ù…Ø¬:');
                console.log('  Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©:', paidInstallments.length);
                console.log('  Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© (Ù‚Ø¯ÙŠÙ…+Ø¬Ø¯ÙŠØ¯):', overlappingMonths);
                console.log('  Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙ‚Ø·:', remainingOldMonths);
                console.log('  Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·:', remainingNewMonths);
                console.log('  Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:', mergedInstallments.length);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
                const linkedInvoices = Array.isArray(existingDebt.linked_invoices) ? [...existingDebt.linked_invoices] : [existingDebt.invoice_id];
                if (!linkedInvoices.includes(newInvoiceId)) linkedInvoices.push(newInvoiceId);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                const updatedDebtData = {
                    total_amount: mergedTotalAmount,
                    final_total: mergedTotalAmount,
                    remaining_amount: mergedRemainingAmount,
                    paid_amount: parseFloat(existingDebt.paid_amount) + newDebtData.downPayment,
                    monthly_amount: oldMonthlyAmount, // Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø§Ù„Ø£ØµÙ„ÙŠ (Ù„Ù„Ù…Ø±Ø¬Ø¹)
                    new_monthly_amount: newMonthlyAmount, // Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¶Ø§Ù
                    installment_months: totalMonths,
                    additional_amount: parseFloat(existingDebt.additional_amount) + newDebtData.additionalAmount,
                    installments: mergedInstallments,
                    customer_address: newDebtData.customerAddress || existingDebt.customer_address,
                    linked_invoices: linkedInvoices,
                    last_updated: new Date().toISOString(),
                    merge_count: (existingDebt.merge_count || 0) + 1,
                    merge_method: 'addition' // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© (ÙˆÙ„ÙŠØ³ Ø§Ù„ØªÙˆØ­ÙŠØ¯)
                };
                
                console.log('ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙŠÙ†...');
                const updateResult = await window.dataSdk.update(existingDebt.id, updatedDebtData);
                
                if (updateResult.isOk) {
                    console.log('âœ… ØªÙ… Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                    
                    // Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù…ÙØµÙ„Ø©
                    let message = `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!\n\n`;
                    message += `ğŸ“Š Ø§Ù„ØªÙØ§ØµÙŠÙ„:\n`;
                    message += `Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${formatCurrency(mergedRemainingAmount)}\n`;
                    message += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø´Ù‡Ø±: ${totalMonths} Ø´Ù‡Ø±\n\n`;
                    
                    if (overlappingMonths > 0) {
                        const mergedAmount = oldMonthlyAmount + newMonthlyAmount;
                        message += `ğŸ’° Ø§Ù„Ø£Ø´Ù‡Ø± ${paidInstallments.length + 1}-${paidInstallments.length + overlappingMonths}:\n`;
                        message += `   ${formatCurrency(oldMonthlyAmount)} + ${formatCurrency(newMonthlyAmount)} = ${formatCurrency(mergedAmount)}\n\n`;
                    }
                    
                    if (remainingOldMonths > 0) {
                        message += `ğŸ’° Ø§Ù„Ø£Ø´Ù‡Ø± ${paidInstallments.length + overlappingMonths + 1}-${paidInstallments.length + overlappingMonths + remainingOldMonths}:\n`;
                        message += `   ${formatCurrency(oldMonthlyAmount)} (Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙÙ‚Ø·)\n\n`;
                    }
                    
                    if (remainingNewMonths > 0) {
                        const startMonth = paidInstallments.length + overlappingMonths + remainingOldMonths + 1;
                        message += `ğŸ’° Ø§Ù„Ø£Ø´Ù‡Ø± ${startMonth}-${startMonth + remainingNewMonths - 1}:\n`;
                        message += `   ${formatCurrency(newMonthlyAmount)} (Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙ‚Ø·)\n`;
                    }
                    
                    showSuccessMessage(message);
                    
                    clearCart();
                    updateQuickStats();
                    setLoading(false);
                    return true;
                } else {
                    console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙŠÙ†');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    setLoading(false);
                    return false;
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¯Ù…Ø¬ Ø§Ù„Ø¯ÙŠÙˆÙ†:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                setLoading(false);
                return false;
            }
        }
        
        // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©
        function getUnpaidInstallmentsCount(debt) {
            if (!debt.installments || !Array.isArray(debt.installments)) {
                return debt.installment_months || 0;
            }
            return debt.installments.filter(inst => inst.status === 'pending').length;
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        function resetInstallmentForm() {
            const installmentForm = document.getElementById('installmentForm');
            if (installmentForm) {
                installmentForm.style.display = 'none';
            }
            
            // Ù…Ø³Ø­ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„
            const customerName = document.getElementById('customerName');
            const customerPhone = document.getElementById('customerPhone');
            const customerAddress = document.getElementById('customerAddress');
            const additionalAmount = document.getElementById('additionalAmount');
            const downPayment = document.getElementById('downPayment');
            const installmentMonths = document.getElementById('installmentMonths');
            
            if (customerName) customerName.value = '';
            if (customerPhone) customerPhone.value = '';
            if (customerAddress) customerAddress.value = '';
            if (additionalAmount) additionalAmount.value = '0';
            if (downPayment) downPayment.value = '0';
            if (installmentMonths) installmentMonths.value = '12';
            
            // Ù…Ø³Ø­ Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
            const advancedEditMode = document.getElementById('advancedEditMode');
            const customOriginalAmount = document.getElementById('customOriginalAmount');
            const customTotalAmount = document.getElementById('customTotalAmount');
            const customMonthlyAmount = document.getElementById('customMonthlyAmount');
            const advancedEditFields = document.getElementById('advancedEditFields');
            
            if (advancedEditMode) advancedEditMode.checked = false;
            if (customOriginalAmount) customOriginalAmount.value = '';
            if (customTotalAmount) customTotalAmount.value = '';
            if (customMonthlyAmount) customMonthlyAmount.value = '';
            if (advancedEditFields) advancedEditFields.style.display = 'none';
            
            // Ù…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØµØµØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            window.customInstallmentValues = null;
            
            console.log('ğŸ”„ ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹
        async function processPayment(paymentMethod, paymentType, extraData = {}) {
            console.log('ğŸ’° Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹...');
            console.log('Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:', paymentMethod);
            console.log('Ù†ÙˆØ¹ Ø§Ù„Ø¯ÙØ¹:', paymentType);
            console.log('Ø§Ù„Ø³Ù„Ø©:', cart);
            
            if (cart.length === 0) {
                console.error('âŒ Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!');
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return false;
            }
            
            if (isLoading) {
                console.warn('âš ï¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° Ø¨Ø§Ù„ÙØ¹Ù„');
                return false;
            }
            
            setLoading(true);
            
            try {
                const subtotal = cart.reduce((sum, item) => sum + (item.product_price * item.quantity), 0);
                const discountPercent = parseFloat(document.getElementById('discountInput')?.value) || 0;
                const discountAmount = subtotal * (discountPercent / 100);
                const afterDiscount = subtotal - discountAmount;
                const taxRate = parseFloat(getCurrentTaxRate()) / 100;
                const taxAmount = afterDiscount * taxRate;
                let finalTotal = afterDiscount + taxAmount;
                let additionalDiscount = 0;

                // --- ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
                let priceDifference = 0;
                let shouldDistribute = false;
                let newFinalTotal = finalTotal;
                if (window.customCashAmount && window.customCashAmount > 0 && paymentType === 'Ù†Ù‚Ø¯ÙŠ') {
                    // Ø¨ÙŠØ¹ Ù†Ù‚Ø¯ÙŠ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                    const originalTotal = finalTotal;
                    newFinalTotal = window.customCashAmount;
                    priceDifference = newFinalTotal - originalTotal;
                    additionalDiscount = originalTotal - newFinalTotal;
                    shouldDistribute = priceDifference !== 0;
                    finalTotal = newFinalTotal;
                } else if (paymentType === 'Ø£Ù‚Ø³Ø§Ø·') {
                    // Ø¨ÙŠØ¹ ØªÙ‚Ø³ÙŠØ· Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº
                    const additionalAmount = parseFloat(extraData.additional_amount) || 0;
                    const downPayment = parseFloat(extraData.down_payment) || 0;
                    newFinalTotal = finalTotal + additionalAmount - downPayment;
                    priceDifference = newFinalTotal - finalTotal;
                    shouldDistribute = priceDifference !== 0;
                    finalTotal = newFinalTotal;
                }

                if (shouldDistribute && cart.length > 0) {
                    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ±Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ
                    const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
                    const perUnitDiff = priceDifference / totalQuantity;
                    let distributed = 0;
                    cart.forEach((item, idx) => {
                        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙØ±Ù‚ Ø¹Ù„Ù‰ ÙƒÙ„ ÙˆØ­Ø¯Ø©
                        let addForThis = perUnitDiff * item.quantity;
                        // ÙÙŠ Ø¢Ø®Ø± Ù…Ù†ØªØ¬ØŒ Ø¹Ø§Ù„Ø¬ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø¹Ù† Ø§Ù„ÙƒØ³ÙˆØ±
                        if (idx === cart.length - 1) {
                            addForThis += priceDifference - (perUnitDiff * totalQuantity);
                        }
                        item.product_price = Math.round((item.product_price + addForThis / item.quantity));
                        distributed += addForThis;
                    });
                }

                console.log('ğŸ“Š Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:');
                console.log('  Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:', subtotal);
                console.log('  Ø§Ù„Ø®ØµÙ…:', discountAmount);
                console.log('  Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ:', additionalDiscount);
                console.log('  Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:', taxAmount);
                console.log('  Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:', finalTotal);

                const saleData = {
                    type: 'sale',
                    invoice_id: 'INV-' + Date.now(),
                    items: JSON.stringify(cart),
                    subtotal: subtotal,
                    tax: taxAmount,
                    discount: discountAmount,
                    additional_discount: additionalDiscount,
                    final_total: finalTotal, // ğŸ”¥ Ù‡Ø°Ø§ Ø§Ù„Ø¢Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
                    payment_method: paymentMethod,
                    payment_type: paymentType,
                    timestamp: new Date().toISOString(),
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                    created_by: window.securityManager ? window.securityManager.getCurrentUsername() : 'unknown',
                    created_by_name: window.securityManager ? window.securityManager.getCurrentUserFullName() : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    created_by_role: window.securityManager && window.securityManager.currentUser ? window.securityManager.currentUser.role : 'unknown',
                    created_at: new Date().toISOString(),
                    // Ø­ÙØ¸ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„ÙƒØ§Ù…Ù„Ø© - Ù…Ø­Ø¯Ø«
                    installment_details: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? {
                        // Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                        original_subtotal: subtotal,
                        original_total: subtotal + taxAmount - discountAmount, // Ø§Ù„Ù…Ø¨Ù„Øº Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„Ø¯ÙØ¹Ø©
                        total_amount: extraData.total_amount || (subtotal + taxAmount - discountAmount + (extraData.additional_amount || 0)),
                        additional_amount: extraData.additional_amount || 0,
                        down_payment: extraData.down_payment || 0,
                        remaining_amount: extraData.remaining_amount || 0,
                        
                        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                        installment_months: extraData.installment_months || 0,
                        monthly_amount: extraData.monthly_amount || 0,
                        start_date: extraData.start_date || null,
                        debt_date: extraData.debt_date || null,
                        
                        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
                        advanced_control_used: extraData.advanced_control_used || false,
                        custom_values_used: window.customInstallmentValues ? true : false,
                        
                        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                        customer_name: extraData.customer_name || '',
                        customer_phone: extraData.customer_phone || '',
                        customer_address: extraData.customer_address || '',
                        
                        // Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    } : null,
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ù„Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·)
                    customer_name: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.customer_name : undefined,
                    customer_phone: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.customer_phone : undefined,
                    customer_address: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.customer_address : undefined,
                    installment_months: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.installment_months : undefined,
                    monthly_amount: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.monthly_amount : undefined,
                    additional_amount: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.additional_amount : undefined,
                    down_payment: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.down_payment : undefined,
                    remaining_amount: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.remaining_amount : undefined,
                    start_date: paymentType === 'Ø£Ù‚Ø³Ø§Ø·' ? extraData.start_date : undefined,
                    ...extraData
                };

                console.log('ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙŠØ¹:', saleData);

                if (window.dataSdk) {
                    console.log('ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    const result = await window.dataSdk.create(saleData);

                    if (result.isOk) {
                        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­');

                        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ¹ Ù…Ø¹ Firestore
                        if (window.syncSaleToFirestore) {
                            const saleWithId = { ...saleData, id: result.id };
                            window.syncSaleToFirestore(saleWithId).catch(e => console.warn('âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ¹:', e));
                        }

                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                        console.log('ğŸ“¦ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†...');
                        await updateProductStock();
                        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†');

                        // Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                        if (paymentType === 'Ø£Ù‚Ø³Ø§Ø·') {
                            console.log('ğŸ’³ Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¯ÙŠÙ†...');
                            console.log('=== Creating Debt Record ===');
                            console.log('finalTotal:', finalTotal);
                            console.log('extraData:', extraData);

                            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† extraData (ØªÙ… Ø­Ø³Ø§Ø¨Ù‡Ø§ ÙÙŠ processInstallmentPayment)
                            const totalAmount = parseFloat(extraData.total_amount) || parseFloat(finalTotal) || 0;
                            const monthlyAmount = parseFloat(extraData.monthly_amount) || 0;
                            const installmentMonths = parseInt(extraData.installment_months) || 1;
                            const remainingAmount = parseFloat(extraData.remaining_amount) || totalAmount;
                            const downPayment = parseFloat(extraData.down_payment) || 0;
                            const additionalAmount = parseFloat(extraData.additional_amount) || 0;

                            console.log('Parsed values:');
                            console.log('  totalAmount:', totalAmount);
                            console.log('  monthlyAmount:', monthlyAmount);
                            console.log('  installmentMonths:', installmentMonths);
                            console.log('  remainingAmount:', remainingAmount);
                            console.log('  downPayment:', downPayment);
                            console.log('  additionalAmount:', additionalAmount);

                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            if (totalAmount === 0 || monthlyAmount === 0 || installmentMonths === 0) {
                                console.error('âŒ Invalid debt data!');
                                console.error('  totalAmount:', totalAmount);
                                console.error('  monthlyAmount:', monthlyAmount);
                                console.error('  installmentMonths:', installmentMonths);
                                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                                setLoading(false);
                                return false;
                            }

                            // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                            const installments = [];
                            // Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ØŒ ÙˆØ¥Ù„Ø§ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
                            const startDate = extraData.start_date ? new Date(extraData.start_date) : new Date();
                            
                            for (let i = 1; i <= installmentMonths; i++) {
                                const dueDate = new Date(startDate);
                                dueDate.setMonth(dueDate.getMonth() + (i - 1));
                                installments.push({
                                    month: i,
                                    amount: monthlyAmount,
                                    due_date: dueDate.toISOString(),
                                    status: 'pending',
                                    paid_date: null,
                                    paid_amount: 0
                                });
                            }

                            const debtData = {
                                type: 'debt',
                                invoice_id: saleData.invoice_id,
                                customer_name: extraData.customer_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                                customer_phone: extraData.customer_phone || '',
                                customer_address: extraData.customer_address || '',
                                total_amount: totalAmount,
                                final_total: finalTotal, // ğŸ”¥ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„ØµØ­ÙŠØ­
                                remaining_amount: remainingAmount,
                                paid_amount: downPayment,
                                monthly_amount: monthlyAmount,
                                installment_months: installmentMonths,
                                additional_amount: additionalAmount,
                                down_payment: downPayment,
                                installments: installments,
                                start_date: extraData.start_date || null,
                                due_date: installments[0].due_date,
                                status: 'Ù†Ø´Ø·',
                                timestamp: extraData.debt_date ? new Date(extraData.debt_date).toISOString() : new Date().toISOString(),
                                created_at: extraData.debt_date ? new Date(extraData.debt_date).toISOString() : new Date().toISOString()
                            };

                            console.log('âœ… Final debt data to be saved:', debtData);
                            console.log('Installments array:', installments);

                            const savedDebt = await window.dataSdk.create(debtData);
                            console.log('âœ… Debt saved successfully:', savedDebt);

                            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙŠÙ† Ù…Ø¹ Firestore
                            if (window.syncDebtToFirestore && savedDebt.isOk) {
                                const debtWithId = { ...debtData, id: savedDebt.id };
                                window.syncDebtToFirestore(debtWithId).catch(e => console.warn('âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯ÙŠÙ†:', e));
                            }

                            console.log('=========================');
                        }

                        console.log('ğŸ‰ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­...');
                        showSuccessMessage('ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!');

                        console.log('ğŸ›’ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©...');
                        clearCart();
                        console.log('âœ… ØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©');

                        console.log('ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
                        updateQuickStats();

                        // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø© ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
                        window.lastSaleInvoiceId = saleData.invoice_id;

                        setLoading(false);
                        console.log('âœ… ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                        return true;

                    } else {
                        console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ¹:', result);
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        setLoading(false);
                        return false;
                    }
                } else {
                    console.error('âŒ dataSdk ØºÙŠØ± Ù…ØªÙˆÙØ±');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    setLoading(false);
                    return false;
                }

            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                setLoading(false);
                return false;
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        async function updateProductStock() {
            for (const item of cart) {
                const product = products.find(p => p.product_id === item.product_id);
                if (product && window.dataSdk && product.id) {
                    const newQuantity = (product.stock_quantity || product.product_quantity || 0) - item.quantity;
                    await window.dataSdk.update(product.id, { 
                        stock_quantity: newQuantity,
                        product_quantity: newQuantity
                    });
                }
            }
        }

        // Ø­Ø°Ù Ù…Ù†ØªØ¬
        async function deleteProduct(productId) {
            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            if (!window.securityManager.checkPermission('products_delete')) {
                return;
            }
            
            const product = products.find(p => p.product_id === productId);
            
            if (!product) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬: ${product.product_name}ØŸ`)) {
                return;
            }
            
            if (window.dataSdk && product.id) {
                const result = await window.dataSdk.delete(product.id);
                if (result.isOk) {
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                    window.securityManager.logOperation('Ø­Ø°Ù Ù…Ù†ØªØ¬', {
                        productId: product.product_id,
                        productName: product.product_name,
                        barcode: product.product_barcode
                    });
                    
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    updateQuickStats();
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
        function showProductDetails(productId) {
            const product = products.find(p => p.product_id === productId);
            const category = categories.find(c => c.category_id === product.product_category);
            
            if (product) {
                const content = `
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</span>
                        <span class="detail-value">${product.product_name}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</span>
                        <span class="detail-value">${product.product_barcode || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„ØªØµÙ†ÙŠÙ:</span>
                        <span class="detail-value">${category ? category.category_name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ù…ÙˆØ±Ø¯:</span>
                        <span class="detail-value">${product.supplier || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (Ù…ÙØ±Ø¯):</span>
                        <span class="detail-value">${formatCurrency(product.product_cost_retail)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ù…ÙØ±Ø¯):</span>
                        <span class="detail-value">${formatCurrency(product.product_price_retail)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                        <span class="detail-value">${product.stock_quantity}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†:</span>
                        <span class="detail-value">${product.min_stock}</span>
                    </div>
                `;
                
                document.getElementById('productDetailsContent').innerHTML = content;
                showModal('productDetailsModal');
            }
        }

        // Helper functions
        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }).catch(err => {
                    console.error('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®:', err);
                });
            } else {
                // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } catch (err) {
                    console.error('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®:', err);
                }
                document.body.removeChild(textarea);
            }
        }

        function formatCurrency(amount) {
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù‚ÙŠÙ… ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø©
            const num = parseFloat(amount) || 0;
            // Always show numbers in English
            return toEnglishDigits(new Intl.NumberFormat('en-US', {
                style: 'decimal',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(num)) + ' Ø¯ÙŠÙ†Ø§Ø±';
        }

        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                // Always show numbers in English
                if (typeof value === 'number' || (typeof value === 'string' && /[0-9Ù -Ù©]/.test(value))) {
                    element.textContent = toEnglishDigits(value);
                } else {
                    element.textContent = value;
                }
            }
        }

        function getCurrentTaxRate() {
            return document.getElementById('taxRate')?.textContent || '0';
        }

        function setLoading(loading) {
            isLoading = loading;
        }

        function clearCart() {
            console.log('ğŸ§¹ Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©...');
            console.log('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥ÙØ±Ø§Øº:', cart.length);
            
            cart = [];
            
            console.log('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ÙØ±Ø§Øº:', cart.length);
            console.log('ğŸ“‹ ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©...');
            
            renderCart();
            updateCartSummary();
            updateCartCount();
            
            // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹
            const checkoutBtn = document.getElementById('checkoutBtn');
            if (checkoutBtn) {
                checkoutBtn.disabled = true;
                console.log('ğŸ”’ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹');
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®ØµÙ…
            const discountInput = document.getElementById('discountInput');
            if (discountInput) {
                discountInput.value = '0';
            }
            
            console.log('âœ… ØªÙ… Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }

        function showSuccessMessage(message) {
            const successMsg = document.getElementById('successMessage');
            if (successMsg) {
                successMsg.style.display = 'block';
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
            }
        }

        function showWelcomeMessage() {
            const welcomeHTML = `
                <div class="welcome-overlay">
                    <div class="welcome-card">
                        <div class="welcome-header">
                            <h2>ğŸ‰ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹</h2>
                        </div>
                        <div class="welcome-body">
                            <p>âœ¨ Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</p>
                            <div class="welcome-features">
                                <div class="welcome-feature">
                                    <span>ğŸ“¦</span>
                                    <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†</p>
                                </div>
                                <div class="welcome-feature">
                                    <span>ğŸ’°</span>
                                    <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±</p>
                                </div>
                                <div class="welcome-feature">
                                    <span>ğŸ‘¥</span>
                                    <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ÙˆØ§Ù„Ø¯ÙŠÙˆÙ†</p>
                                </div>
                                <div class="welcome-feature">
                                    <span>ğŸ“Š</span>
                                    <p>ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
                                </div>
                                <div class="welcome-feature">
                                    <span>ğŸ¨</span>
                                    <p>12 Ø«ÙŠÙ… Ù…Ø¹ ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</p>
                                </div>
                                <div class="welcome-feature">
                                    <span>ğŸŒ</span>
                                    <p>Ø¯Ø¹Ù… Ø«Ù„Ø§Ø« Ù„ØºØ§Øª</p>
                                </div>
                            </div>
                            <p class="welcome-note">ğŸ’¡ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø¨Ø¯Ø¡</p>
                            <p class="welcome-hint">ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°ÙÙ‡Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â†’ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹</p>
                        </div>
                        <div class="welcome-footer">
                            <button class="welcome-btn" onclick="closeWelcome()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', welcomeHTML);
        }
        
        function closeWelcome() {
            const overlay = document.querySelector('.welcome-overlay');
            if (overlay) {
                overlay.classList.add('fade-out');
                setTimeout(() => overlay.remove(), 300);
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø´Ø§Ù…Ù„
        function handleGlobalSearch(event) {
            const searchTerm = event.target.value.trim().toLowerCase();
            const searchResults = document.getElementById('searchResults');
            
            if (searchTerm.length === 0) {
                searchResults.classList.remove('active');
                return;
            }
            
            if (searchTerm.length < 2) {
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const results = {
                products: [],
                sales: [],
                debts: [],
                categories: []
            };
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            products.forEach(product => {
                if ((product.name && product.name.toLowerCase().includes(searchTerm)) ||
                    (product.barcode && product.barcode.toLowerCase().includes(searchTerm)) ||
                    (product.supplier && product.supplier.toLowerCase().includes(searchTerm))) {
                    results.products.push(product);
                }
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            salesData.forEach(sale => {
                if ((sale.invoice_id && sale.invoice_id.toLowerCase().includes(searchTerm)) ||
                    (sale.customer_name && sale.customer_name.toLowerCase().includes(searchTerm)) ||
                    (sale.payment_method && sale.payment_method.toLowerCase().includes(searchTerm))) {
                    results.sales.push(sale);
                }
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†
            debtsData.forEach(debt => {
                if ((debt.customer_name && debt.customer_name.toLowerCase().includes(searchTerm)) ||
                    (debt.customer_phone && debt.customer_phone.toLowerCase().includes(searchTerm)) ||
                    (debt.customer_address && debt.customer_address.toLowerCase().includes(searchTerm))) {
                    results.debts.push(debt);
                }
            });
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
            categories.forEach(category => {
                if (category.name && category.name.toLowerCase().includes(searchTerm)) {
                    results.categories.push(category);
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            renderSearchResults(results, searchTerm);
        }
        
        // Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        function renderSearchResults(results, searchTerm) {
            const searchResults = document.getElementById('searchResults');
            let html = '';
            
            const totalResults = results.products.length + results.sales.length + 
                               results.debts.length + results.categories.length;
            
            if (totalResults === 0) {
                html = `
                    <div class="search-empty">
                        <i class="fas fa-search-minus"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† "<strong>${searchTerm}</strong>"</p>
                        <small style="opacity: 0.7; margin-top: 0.5rem; display: block;">Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡</small>
                    </div>
                `;
            } else {
                // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                html += `
                    <div class="search-header">
                        <span><i class="fas fa-search"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</span>
                        <span class="search-total">${totalResults} Ù†ØªÙŠØ¬Ø©</span>
                    </div>
                `;
                
                // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                if (results.products.length > 0) {
                    html += '<div class="search-category">';
                    html += `
                        <div class="search-category-title">
                            <i class="fas fa-box"></i>
                            <span>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                            <span class="count">${results.products.length}</span>
                        </div>
                    `;
                    results.products.slice(0, 5).forEach(product => {
                        const stockStatus = product.stock_quantity <= product.min_stock ? 
                            '<span class="search-result-badge" style="background: #fee; color: #c33;">Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶</span>' : '';
                        html += `
                            <div class="search-result-item" onclick="goToProductDetails('${product.product_id}')">
                                <div class="search-result-icon">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div class="search-result-info">
                                    <div class="search-result-title">${product.name}</div>
                                    <div class="search-result-subtitle">
                                        <span><i class="fas fa-barcode"></i> ${product.barcode || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯'}</span>
                                        <span><i class="fas fa-tag"></i> ${formatCurrency(product.selling_price)}</span>
                                        <span><i class="fas fa-boxes"></i> ${product.stock_quantity} Ù‚Ø·Ø¹Ø©</span>
                                        ${stockStatus}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    if (results.products.length > 5) {
                        html += `<div style="padding: 0.75rem 1.25rem; text-align: center; color: var(--theme-text-secondary); font-size: 0.85rem;">Ùˆ ${results.products.length - 5} Ù†ØªØ§Ø¦Ø¬ Ø£Ø®Ø±Ù‰...</div>`;
                    }
                    html += '</div>';
                }
                
                // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                if (results.sales.length > 0) {
                    html += '<div class="search-category">';
                    html += `
                        <div class="search-category-title">
                            <i class="fas fa-receipt"></i>
                            <span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span>
                            <span class="count">${results.sales.length}</span>
                        </div>
                    `;
                    results.sales.slice(0, 5).forEach(sale => {
                        const paymentBadge = sale.payment_method === 'Ù†Ù‚Ø¯ÙŠ' ? 
                            '<span class="search-result-badge" style="background: #e6ffe6; color: #2d7a2d;">Ù†Ù‚Ø¯ÙŠ</span>' : 
                            '<span class="search-result-badge" style="background: #fff4e6; color: #b36200;">Ù‚Ø³Ø·</span>';
                        html += `
                            <div class="search-result-item" onclick="goToInvoiceDetails('${sale.sale_id}')">
                                <div class="search-result-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <div class="search-result-info">
                                    <div class="search-result-title">ÙØ§ØªÙˆØ±Ø© #${sale.invoice_id || sale.sale_id.substring(0, 8)}</div>
                                    <div class="search-result-subtitle">
                                        <span><i class="fas fa-user"></i> ${sale.customer_name || 'Ø²Ø¨ÙˆÙ† Ø¹Ø§Ù…'}</span>
                                        <span><i class="fas fa-money-bill"></i> ${formatCurrency(sale.total_amount)}</span>
                                        <span><i class="fas fa-calendar"></i> ${new Date(sale.sale_date).toLocaleDateString('ar-EG')}</span>
                                        ${paymentBadge}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    if (results.sales.length > 5) {
                        html += `<div style="padding: 0.75rem 1.25rem; text-align: center; color: var(--theme-text-secondary); font-size: 0.85rem;">Ùˆ ${results.sales.length - 5} ÙØ§ØªÙˆØ±Ø© Ø£Ø®Ø±Ù‰...</div>`;
                    }
                    html += '</div>';
                }
                
                // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¯ÙŠÙˆÙ†
                if (results.debts.length > 0) {
                    html += '<div class="search-category">';
                    html += `
                        <div class="search-category-title">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>Ø§Ù„Ø¯ÙŠÙˆÙ†</span>
                            <span class="count">${results.debts.length}</span>
                        </div>
                    `;
                    results.debts.slice(0, 5).forEach(debt => {
                        const isOverdue = debt.due_date && new Date(debt.due_date) < new Date();
                        const statusBadge = debt.remaining_amount <= 0 ? 
                            '<span class="search-result-badge" style="background: #e6ffe6; color: #2d7a2d;">Ù…Ø³Ø¯Ø¯</span>' :
                            isOverdue ? 
                            '<span class="search-result-badge" style="background: #ffe6e6; color: #c33;">Ù…ØªØ£Ø®Ø±</span>' :
                            '<span class="search-result-badge" style="background: #fff4e6; color: #b36200;">Ù†Ø´Ø·</span>';
                        html += `
                            <div class="search-result-item" onclick="goToDebtDetails('${debt.debt_id}')">
                                <div class="search-result-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="search-result-info">
                                    <div class="search-result-title">${debt.customer_name}</div>
                                    <div class="search-result-subtitle">
                                        <span><i class="fas fa-phone"></i> ${debt.customer_phone || 'Ø¨Ø¯ÙˆÙ† Ù‡Ø§ØªÙ'}</span>
                                        <span><i class="fas fa-dollar-sign"></i> ${formatCurrency(debt.remaining_amount)} Ù…ØªØ¨Ù‚ÙŠ</span>
                                        ${statusBadge}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    if (results.debts.length > 5) {
                        html += `<div style="padding: 0.75rem 1.25rem; text-align: center; color: var(--theme-text-secondary); font-size: 0.85rem;">Ùˆ ${results.debts.length - 5} Ø¯ÙŠÙ† Ø¢Ø®Ø±...</div>`;
                    }
                    html += '</div>';
                }
                
                // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                if (results.categories.length > 0) {
                    html += '<div class="search-category">';
                    html += `
                        <div class="search-category-title">
                            <i class="fas fa-tags"></i>
                            <span>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</span>
                            <span class="count">${results.categories.length}</span>
                        </div>
                    `;
                    results.categories.slice(0, 3).forEach(category => {
                        const categoryProducts = products.filter(p => p.category_id === category.category_id);
                        html += `
                            <div class="search-result-item" onclick="goToCategory('${category.category_id}')">
                                <div class="search-result-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                    <i class="${category.icon || 'fas fa-tag'}"></i>
                                </div>
                                <div class="search-result-info">
                                    <div class="search-result-title">${category.name}</div>
                                    <div class="search-result-subtitle">
                                        <span><i class="fas fa-box"></i> ${categoryProducts.length} Ù…Ù†ØªØ¬</span>
                                        <span>${category.description || 'ØªØµÙ†ÙŠÙ Ù…Ù†ØªØ¬Ø§Øª'}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    if (results.categories.length > 3) {
                        html += `<div style="padding: 0.75rem 1.25rem; text-align: center; color: var(--theme-text-secondary); font-size: 0.85rem;">Ùˆ ${results.categories.length - 3} ØªØµÙ†ÙŠÙØ§Øª Ø£Ø®Ø±Ù‰...</div>`;
                    }
                    html += '</div>';
                }
            }
            
            searchResults.innerHTML = html;
            searchResults.classList.add('active');
        }
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        function goToProductDetails(productId) {
            hideSearchResults();
            navigateTo('products');
            setTimeout(() => showProductDetails(productId), 100);
        }
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        function goToInvoiceDetails(saleId) {
            hideSearchResults();
            navigateTo('invoices');
            setTimeout(() => showInvoiceDetails(saleId), 100);
        }
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        function goToDebtDetails(debtId) {
            hideSearchResults();
            navigateTo('debts');
            setTimeout(() => showDebtDetails(debtId), 100);
        }
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØªØµÙ†ÙŠÙ Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        function goToCategory(categoryId) {
            hideSearchResults();
            navigateTo('pos');
            currentCategory = categoryId;
            renderProducts();
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù†Ø´Ø·
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === categoryId) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        function hideSearchResults() {
            const searchResults = document.getElementById('searchResults');
            searchResults.classList.remove('active');
            document.getElementById('globalSearchInput').value = '';
        }


        function updateInvoicePreview(config) {
            if (!config) return; // Ø­Ù…Ø§ÙŠØ© Ù…Ù† config ÙØ§Ø±Øº
            
            const elements = {
                'previewStoreName': config.store_name,
                'previewStoreAddress': config.store_address,
                'previewStorePhone': config.store_phone
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                updateElement(id, value);
            });
        }

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function showInvoiceDetails(invoiceId) {
            const sale = salesData.find(s => s.invoice_id === invoiceId);
            if (!sale) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const content = document.getElementById('invoiceDetailsContent');
            if (!content) return;
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† items Ù…ØµÙÙˆÙØ©
            let items = [];
            if (sale.items && Array.isArray(sale.items)) {
                items = sale.items;
            } else if (typeof sale.items === 'string') {
                try {
                    items = JSON.parse(sale.items);
                } catch (e) {
                    items = [];
                }
            }
            
            const itemsHTML = items.length > 0 ? items.map(item => {
                const price = item.product_price || item.price || 0;
                const quantity = item.quantity || 1;
                const total = quantity * price;
                return `
                <tr>
                    <td>${item.product_name || item.name || 'Ù…Ù†ØªØ¬'}</td>
                    <td style="text-align: center;">${quantity}</td>
                    <td>${formatCurrency(price)}</td>
                    <td style="font-weight: bold; color: var(--primary-color);">${formatCurrency(total)}</td>
                </tr>
                `;
            }).join('') : '<tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            const installmentDetails = sale.installment_details || {};
            const originalSubtotal = installmentDetails.original_subtotal || sale.subtotal || 0;
            const additionalAmount = installmentDetails.additional_amount || sale.additional_amount || 0;
            const downPayment = installmentDetails.down_payment || sale.down_payment || 0;
            const remainingAmount = installmentDetails.remaining_amount || sale.remaining_amount || 0;
            const monthlyAmount = installmentDetails.monthly_amount || sale.monthly_amount || 0;
            const installmentMonths = installmentDetails.installment_months || sale.installment_months || 0;
            const startDate = installmentDetails.start_date || sale.start_date || null;
            const advancedControlUsed = installmentDetails.advanced_control_used || installmentDetails.custom_values_used || false;
            
            content.innerHTML = `
                <div style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: var(--theme-bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--theme-text-secondary); font-size: 14px; margin-bottom: 5px;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
                            <div style="font-size: 18px; font-weight: bold;">${sale.invoice_id}</div>
                        </div>
                        <div style="background: var(--theme-bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--theme-text-secondary); font-size: 14px; margin-bottom: 5px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
                            <div style="font-size: 16px; font-weight: 500;">${new Date(sale.timestamp).toLocaleString('ar-IQ')}</div>
                        </div>
                        <div style="background: var(--theme-bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--theme-text-secondary); font-size: 14px; margin-bottom: 5px;">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                            <div style="font-size: 16px; font-weight: 500;">${sale.customer_name || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ'}</div>
                        </div>
                        <div style="background: var(--theme-bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--theme-text-secondary); font-size: 14px; margin-bottom: 5px;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
                            <div style="font-size: 16px; font-weight: 500;">
                                <i class="fas fa-${sale.payment_method === 'Ù†Ù‚Ø¯ÙŠ' ? 'money-bill-wave' : 'credit-card'}"></i>
                                ${sale.payment_type || sale.payment_method}
                            </div>
                        </div>
                    </div>
                    
                    ${sale.customer_phone ? `
                    <div style="background: var(--theme-bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="color: var(--theme-text-secondary); font-size: 14px; margin-bottom: 5px;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
                        <div style="font-size: 16px; font-weight: 500;">${sale.customer_phone}</div>
                    </div>
                    ` : ''}
                    
                    ${sale.customer_address ? `
                    <div style="background: var(--theme-bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="color: var(--theme-text-secondary); font-size: 14px; margin-bottom: 5px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>
                        <div style="font-size: 16px; font-weight: 500;">${sale.customer_address}</div>
                    </div>
                    ` : ''}
                    
                    ${sale.payment_type === 'Ø£Ù‚Ø³Ø§Ø·' ? `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 15px 0; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-calendar-alt"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</div>
                                <div style="font-size: 18px; font-weight: bold;">${formatCurrency(originalSubtotal)}</div>
                            </div>
                            ${additionalAmount > 0 ? `
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">â• Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ</div>
                                <div style="font-size: 18px; font-weight: bold;">${formatCurrency(additionalAmount)}</div>
                            </div>
                            ` : ''}
                            ${downPayment > 0 ? `
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ğŸ’µ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©</div>
                                <div style="font-size: 18px; font-weight: bold;">${formatCurrency(downPayment)}</div>
                            </div>
                            ` : ''}
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ğŸ’³ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                                <div style="font-size: 18px; font-weight: bold;">${formatCurrency(remainingAmount)}</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ğŸ“… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</div>
                                <div style="font-size: 18px; font-weight: bold;">${installmentMonths} Ø´Ù‡Ø±</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ğŸ“Š Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                                <div style="font-size: 18px; font-weight: bold;">${formatCurrency(monthlyAmount)}</div>
                            </div>
                            ${startDate ? `
                            <div style="background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">ğŸ“† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
                                <div style="font-size: 16px; font-weight: bold;">${new Date(startDate).toLocaleDateString('ar-IQ')}</div>
                            </div>
                            ` : ''}
                            ${advancedControlUsed ? `
                            <div style="background: rgba(139, 92, 246, 0.3); padding: 12px; border-radius: 8px; grid-column: 1/-1; text-align: center;">
                                <div style="font-size: 14px; font-weight: bold;"><i class="fas fa-cog"></i> ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    <h4 style="margin: 20px 0 10px 0; color: var(--primary-color);"><i class="fas fa-shopping-cart"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--theme-bg-secondary);">
                                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid var(--primary-color);">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid var(--primary-color);">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid var(--primary-color);">Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th style="padding: 10px; text-align: right; border-bottom: 2px solid var(--primary-color);">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHTML || '<tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: var(--theme-bg-secondary); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                            <span style="font-weight: bold;">${formatCurrency(sale.subtotal || 0)}</span>
                        </div>
                        ${additionalAmount > 0 && sale.payment_type === 'Ø£Ù‚Ø³Ø§Ø·' ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: #be123c;">
                            <span>Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ:</span>
                            <span style="font-weight: bold;">+${formatCurrency(additionalAmount)}</span>
                        </div>
                        ` : ''}
                        ${downPayment > 0 && sale.payment_type === 'Ø£Ù‚Ø³Ø§Ø·' ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: var(--success-color);">
                            <span>Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©:</span>
                            <span style="font-weight: bold;">-${formatCurrency(downPayment)}</span>
                        </div>
                        ` : ''}
                        ${(sale.discount_amount || sale.discount) ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; color: var(--success-color);">
                            <span>Ø§Ù„Ø®ØµÙ…:</span>
                            <span style="font-weight: bold;">-${formatCurrency(sale.discount_amount || sale.discount || 0)}</span>
                        </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                            <span style="font-weight: bold;">${formatCurrency(sale.tax_amount || sale.tax || 0)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 2px solid var(--primary-color); font-size: 20px; font-weight: bold; color: var(--primary-color);">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                            <span>${formatCurrency(sale.final_total || 0)}</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="printInvoiceFromDetails('${sale.invoice_id}', ${sale.payment_type === 'Ø£Ù‚Ø³Ø§Ø·' ? 'true' : 'false'})">
                            <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                        </button>
                        <button class="btn btn-secondary" onclick="closeModal('invoiceDetailsModal')" style="margin-right: 10px;">
                            <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                        </button>
                    </div>
                </div>
            `;
            
            showModal('invoiceDetailsModal');
        }
        
        // Ø¯Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„
        function printInvoiceFromDetails(invoiceId, isInstallment) {
            console.log('ğŸ–¨ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„:', invoiceId, 'Ø£Ù‚Ø³Ø§Ø·:', isInstallment);
            if (isInstallment) {
                let sale = null;
                if (typeof salesData !== 'undefined' && Array.isArray(salesData)) {
                    sale = salesData.find(s => s.invoice_id === invoiceId);
                }
                // Ø¬Ù„Ø¨ Ù…Ù† window.dataSdk Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ÙÙŠ salesData
                if (!sale && window.dataSdk && typeof window.dataSdk.getAll === 'function') {
                    const allSales = window.dataSdk.getAll();
                    sale = allSales.find(s => s.invoice_id === invoiceId);
                }
                if (!sale) {
                    console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', invoiceId);
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:', sale);
                printInstallmentInvoice(invoiceId, true, sale); // Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ©
            } else {
                console.log('âœ… Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ù†Ù‚Ø¯ÙŠØ©:', invoiceId);
                printInvoice(invoiceId, true); // Ø·Ø¨Ø§Ø¹Ø© ØµØ§Ù…ØªØ©
            }
        }

        // ========================================
        // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        // ========================================

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultPrinterSettings = {
            printerType: 'default',
            printMode: 'preview',
            paperSize: '80mm',
            storeTitleSize: 24,
            storeInfoSize: 14,
            invoiceTextSize: 13,
            tableTextSize: 12,
            totalTextSize: 16,
            footerTextSize: 11,
            lineHeight: 1.4,
            sidePadding: 15,
            topBottomPadding: 15,
            borderStyle: 'dashed',
            borderWidth: 1,
            titleAlign: 'center',
            showLogo: false,
            showDateTime: true,
            showInvoiceNumber: true,
            showProductsTable: true,
            showFooter: true,
            customFooter: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…\nÙ†ØªØ·Ù„Ø¹ Ù„Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'
        };

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function loadPrinterSettings() {
            const saved = localStorage.getItem('printerSettings');
            const settings = saved ? JSON.parse(saved) : defaultPrinterSettings;
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            if (document.getElementById('printerType')) {
                document.getElementById('printerType').value = settings.printerType || 'default';
                document.getElementById('paperSize').value = settings.paperSize || '80mm';
                
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø·ÙˆØ·
                document.getElementById('storeTitleSize').value = settings.storeTitleSize || 24;
                document.getElementById('storeTitleSizeValue').textContent = settings.storeTitleSize || 24;
                
                document.getElementById('storeInfoSize').value = settings.storeInfoSize || 14;
                document.getElementById('storeInfoSizeValue').textContent = settings.storeInfoSize || 14;
                
                document.getElementById('invoiceTextSize').value = settings.invoiceTextSize || 13;
                document.getElementById('invoiceTextSizeValue').textContent = settings.invoiceTextSize || 13;
                
                document.getElementById('tableTextSize').value = settings.tableTextSize || 12;
                document.getElementById('tableTextSizeValue').textContent = settings.tableTextSize || 12;
                
                document.getElementById('totalTextSize').value = settings.totalTextSize || 16;
                document.getElementById('totalTextSizeValue').textContent = settings.totalTextSize || 16;
                
                document.getElementById('footerTextSize').value = settings.footerTextSize || 11;
                document.getElementById('footerTextSizeValue').textContent = settings.footerTextSize || 11;
                
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
                document.getElementById('lineHeight').value = settings.lineHeight || 1.4;
                document.getElementById('lineHeightValue').textContent = settings.lineHeight || 1.4;
                
                document.getElementById('sidePadding').value = settings.sidePadding || 15;
                document.getElementById('sidePaddingValue').textContent = settings.sidePadding || 15;
                
                document.getElementById('topBottomPadding').value = settings.topBottomPadding || 15;
                document.getElementById('topBottomPaddingValue').textContent = settings.topBottomPadding || 15;
                
                document.getElementById('borderStyle').value = settings.borderStyle || 'dashed';
                document.getElementById('borderWidth').value = settings.borderWidth || 1;
                document.getElementById('borderWidthValue').textContent = settings.borderWidth || 1;
                
                document.getElementById('titleAlign').value = settings.titleAlign || 'center';
                
                // Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                document.getElementById('showLogo').checked = settings.showLogo || false;
                document.getElementById('showDateTime').checked = settings.showDateTime !== false;
                document.getElementById('showInvoiceNumber').checked = settings.showInvoiceNumber !== false;
                document.getElementById('showProductsTable').checked = settings.showProductsTable !== false;
                document.getElementById('showFooter').checked = settings.showFooter !== false;
                document.getElementById('customFooter').value = settings.customFooter || '';
                
                // ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
                const printMode = settings.printMode || 'preview';
                document.querySelector(`input[name="printMode"][value="${printMode}"]`).checked = true;
                
                // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
                updatePrinterStats();
            }
            
            return settings;
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
        function savePrinterSettings() {
            const settings = {
                printerType: document.getElementById('printerType').value,
                printMode: document.querySelector('input[name="printMode"]:checked').value,
                paperSize: document.getElementById('paperSize').value,
                storeTitleSize: parseInt(document.getElementById('storeTitleSize').value),
                storeInfoSize: parseInt(document.getElementById('storeInfoSize').value),
                invoiceTextSize: parseInt(document.getElementById('invoiceTextSize').value),
                tableTextSize: parseInt(document.getElementById('tableTextSize').value),
                totalTextSize: parseInt(document.getElementById('totalTextSize').value),
                footerTextSize: parseInt(document.getElementById('footerTextSize').value),
                lineHeight: parseFloat(document.getElementById('lineHeight').value),
                sidePadding: parseInt(document.getElementById('sidePadding').value),
                topBottomPadding: parseInt(document.getElementById('topBottomPadding').value),
                borderStyle: document.getElementById('borderStyle').value,
                borderWidth: parseInt(document.getElementById('borderWidth').value),
                titleAlign: document.getElementById('titleAlign').value,
                showLogo: document.getElementById('showLogo').checked,
                showDateTime: document.getElementById('showDateTime').checked,
                showInvoiceNumber: document.getElementById('showInvoiceNumber').checked,
                showProductsTable: document.getElementById('showProductsTable').checked,
                showFooter: document.getElementById('showFooter').checked,
                customFooter: document.getElementById('customFooter').value
            };
            
            localStorage.setItem('printerSettings', JSON.stringify(settings));
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            updatePrinterStats();
        }

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        function resetPrinterSettings() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) {
                localStorage.setItem('printerSettings', JSON.stringify(defaultPrinterSettings));
                loadPrinterSettings();
                updatePreview();
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
        function updatePrinterStats() {
            const settings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
            const printerTypeNames = {
                'default': 'Ø¹Ø§Ø¯ÙŠØ©',
                'thermal': 'Ø­Ø±Ø§Ø±ÙŠØ© 80mm',
                'thermal-58': 'Ø­Ø±Ø§Ø±ÙŠØ© 58mm'
            };
            
            if (document.getElementById('activePrinterType')) {
                document.getElementById('activePrinterType').textContent = 
                    printerTypeNames[settings.printerType] || 'Ø¹Ø§Ø¯ÙŠØ©';
            }
            if (document.getElementById('activePaperSize')) {
                document.getElementById('activePaperSize').textContent = settings.paperSize || '80mm';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
        function updatePreview() {
            const settings = {
                printerType: document.getElementById('printerType')?.value || 'default',
                paperSize: document.getElementById('paperSize')?.value || '80mm',
                storeTitleSize: parseInt(document.getElementById('storeTitleSize')?.value || 24),
                storeInfoSize: parseInt(document.getElementById('storeInfoSize')?.value || 14),
                invoiceTextSize: parseInt(document.getElementById('invoiceTextSize')?.value || 13),
                tableTextSize: parseInt(document.getElementById('tableTextSize')?.value || 12),
                totalTextSize: parseInt(document.getElementById('totalTextSize')?.value || 16),
                footerTextSize: parseInt(document.getElementById('footerTextSize')?.value || 11),
                lineHeight: parseFloat(document.getElementById('lineHeight')?.value || 1.4),
                sidePadding: parseInt(document.getElementById('sidePadding')?.value || 15),
                topBottomPadding: parseInt(document.getElementById('topBottomPadding')?.value || 15),
                borderStyle: document.getElementById('borderStyle')?.value || 'dashed',
                borderWidth: parseInt(document.getElementById('borderWidth')?.value || 1),
                titleAlign: document.getElementById('titleAlign')?.value || 'center',
                showLogo: document.getElementById('showLogo')?.checked || false,
                showDateTime: document.getElementById('showDateTime')?.checked !== false,
                showInvoiceNumber: document.getElementById('showInvoiceNumber')?.checked !== false,
                showProductsTable: document.getElementById('showProductsTable')?.checked !== false,
                showFooter: document.getElementById('showFooter')?.checked !== false,
                customFooter: document.getElementById('customFooter')?.value || ''
            };
            
            const preview = document.getElementById('receiptPreview');
            if (!preview) return;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„ÙˆØ±Ù‚
            let receiptWidth = '80mm';
            if (settings.paperSize === '58mm' || settings.printerType === 'thermal-58') {
                receiptWidth = '58mm';
            } else if (settings.paperSize === 'A4') {
                receiptWidth = '210mm';
            } else if (settings.paperSize === 'A5') {
                receiptWidth = '148mm';
            }
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
            const storeName = localStorage.getItem('storeName') || 'Ù…ØªØ¬Ø± Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©';
            const storeAddress = localStorage.getItem('storeAddress') || 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„Ù…Ù†ØµÙˆØ±';
            const storePhone = localStorage.getItem('storePhone') || '07803092185';
            
            // ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            const now = new Date();
            const dateStr = now.toLocaleDateString('ar-IQ');
            const timeStr = now.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit' });
            
            // Ø¨Ù†Ø§Ø¡ HTML Ø§Ù„Ø¥ÙŠØµØ§Ù„
            let receiptHTML = `
                <div style="
                    width: ${receiptWidth};
                    padding: ${settings.topBottomPadding}px ${settings.sidePadding}px;
                    font-family: 'Cairo', sans-serif;
                    line-height: ${settings.lineHeight};
                    font-size: ${settings.invoiceTextSize}px;
                ">
            `;
            
            // Ø§Ù„Ø´Ø¹Ø§Ø± (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹)
            if (settings.showLogo) {
                // Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ù…Ø³Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙƒÙ…Ø§ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
                let logoSrc = document.getElementById('storeLogo')?.value?.trim() || 'yaqoub_logo.png';
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø± base64 Ø£Ùˆ Ø§Ø³Ù… Ù…Ù„Ù
                if (!logoSrc.startsWith('data:') && !logoSrc.startsWith('http') && !logoSrc.startsWith('./') && !logoSrc.startsWith('/')) {
                    logoSrc = './' + logoSrc;
                }
                receiptHTML += `
                    <div style="text-align: ${settings.titleAlign}; margin-bottom: 10px;">
                        <img src="${logoSrc}" alt="Logo" style="max-width:90px;max-height:90px;display:inline-block;vertical-align:middle;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:8px;" />
                    </div>
                `;
            }
            
            // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø±
            receiptHTML += `
                <div style="text-align: ${settings.titleAlign}; margin-bottom: 15px;">
                    <h2 style="
                        margin: 0 0 8px 0;
                        font-size: ${settings.storeTitleSize}px;
                        font-weight: bold;
                    ">${storeName}</h2>
                    <p style="margin: 4px 0; font-size: ${settings.storeInfoSize}px;">${storeAddress}</p>
                    <p style="margin: 4px 0; font-size: ${settings.storeInfoSize}px;">ğŸ“ ${storePhone}</p>
                </div>
            `;
            
            // Ø®Ø· ÙØ§ØµÙ„ Ø¹Ù„ÙˆÙŠ
            receiptHTML += `
                <div style="
                    border-top: ${settings.borderWidth}px ${settings.borderStyle} #000;
                    margin: 15px 0;
                "></div>
            `;
            
            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            receiptHTML += `<div style="margin: 10px 0; font-size: ${settings.invoiceTextSize}px;">`;
            
            if (settings.showInvoiceNumber) {
                receiptHTML += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</span>
                        <span style="font-weight: bold;">INV-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}</span>
                    </div>
                `;
            }
            
            if (settings.showDateTime) {
                receiptHTML += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                        <span>${dateStr}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Ø§Ù„ÙˆÙ‚Øª:</span>
                        <span>${timeStr}</span>
                    </div>
                `;
            }
            
            receiptHTML += `</div>`;
            
            // Ø®Ø· ÙØ§ØµÙ„
            receiptHTML += `
                <div style="
                    border-top: ${settings.borderWidth}px ${settings.borderStyle} #000;
                    margin: 15px 0;
                "></div>
            `;
            
            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            if (settings.showProductsTable) {
                receiptHTML += `
                    <table style="
                        width: 100%;
                        border-collapse: collapse;
                        font-size: ${settings.tableTextSize}px;
                        margin: 10px 0;
                    ">
                        <thead>
                            <tr style="border-bottom: ${settings.borderWidth}px solid #000;">
                                <th style="text-align: right; padding: 5px 0; font-weight: bold;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th style="text-align: center; padding: 5px 0; font-weight: bold;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th style="text-align: left; padding: 5px 0; font-weight: bold;">Ø§Ù„Ø³Ø¹Ø±</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 8px 0; border-bottom: 1px dotted #ccc;">Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ 1</td>
                                <td style="text-align: center; padding: 8px 0; border-bottom: 1px dotted #ccc;">2</td>
                                <td style="text-align: left; padding: 8px 0; border-bottom: 1px dotted #ccc;">20,000</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px 0; border-bottom: 1px dotted #ccc;">Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ 2</td>
                                <td style="text-align: center; padding: 8px 0; border-bottom: 1px dotted #ccc;">1</td>
                                <td style="text-align: left; padding: 8px 0; border-bottom: 1px dotted #ccc;">15,000</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px 0;">Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ 3</td>
                                <td style="text-align: center; padding: 8px 0;">3</td>
                                <td style="text-align: left; padding: 8px 0;">45,000</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }
            
            // Ø®Ø· ÙØ§ØµÙ„
            receiptHTML += `
                <div style="
                    border-top: ${settings.borderWidth}px ${settings.borderStyle} #000;
                    margin: 15px 0;
                "></div>
            `;
            
            // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            receiptHTML += `
                <div style="
                    font-size: ${settings.totalTextSize}px;
                    font-weight: bold;
                    margin: 15px 0;
                ">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:</span>
                        <span>80,000 Ø¯ÙŠÙ†Ø§Ø±</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Ø§Ù„Ø®ØµÙ…:</span>
                        <span style="color: #10b981;">- 5,000 Ø¯ÙŠÙ†Ø§Ø±</span>
                    </div>
                    <div style="
                        display: flex;
                        justify-content: space-between;
                        padding-top: 8px;
                        border-top: 2px solid #000;
                    ">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                        <span>75,000 Ø¯ÙŠÙ†Ø§Ø±</span>
                    </div>
                </div>
            `;
            
            // Ø§Ù„ØªØ°ÙŠÙŠÙ„
            if (settings.showFooter) {
                const footerText = settings.customFooter || 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…\nÙ†ØªØ·Ù„Ø¹ Ù„Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                const footerLines = footerText.split('\n');
                
                receiptHTML += `
                    <div style="
                        text-align: center;
                        margin-top: 20px;
                        font-size: ${settings.footerTextSize}px;
                        color: #666;
                    ">
                `;
                
                footerLines.forEach(line => {
                    receiptHTML += `<p style="margin: 4px 0;">${line}</p>`;
                });
                
                receiptHTML += `
                        <p style="margin-top: 10px;">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</p>
                    </div>
                `;
            }
            
            receiptHTML += `</div>`;
            
            preview.innerHTML = receiptHTML;
        }

        // Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© ÙØ¹Ù„ÙŠØ©
        function printInvoice(invoiceId, silent = false) {
            const settings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
            // Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ù…Ù† salesData
            let sale = null;
            // Always fetch the latest sale from both memory and persistent storage
            if (typeof salesData !== 'undefined' && Array.isArray(salesData)) {
                sale = salesData.find(s => s.invoice_id === invoiceId);
            }
            if (window.dataSdk && window.dataSdk.getAll) {
                const allSales = window.dataSdk.getAll();
                // Prefer the most recent sale with this invoice_id
                const found = allSales.find(s => s.invoice_id === invoiceId);
                if (found) sale = found;
            }
            if (!sale) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            // Always parse items to ensure latest products are shown
            if (typeof sale.items === 'string') {
                try { sale.items = JSON.parse(sale.items); } catch { sale.items = []; }
            }
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹
            let receiptContent;
            const paymentMethod = sale.payment_method || sale.payment_type || '';
            const isInstallment = paymentMethod === 'Ø£Ù‚Ø³Ø§Ø·' || paymentMethod === 'ØªÙ‚Ø³ÙŠØ·' || sale.installment_months > 0;
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ù…Ù„Ù yaqoub-invoice-templates.js
            if (isInstallment) {
                // ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ·
                receiptContent = typeof window.generateYaqoubInstallmentReceipt === 'function'
                    ? window.generateYaqoubInstallmentReceipt(sale, settings)
                    : generateInstallmentInvoiceReceipt(sale, settings); // fallback
            } else {
                // ÙØ§ØªÙˆØ±Ø© Ù†Ù‚Ø¯
                receiptContent = typeof window.generateYaqoubCashReceipt === 'function'
                    ? window.generateYaqoubCashReceipt(sale, settings)
                    : generateInvoiceReceipt(sale, settings); // fallback
            }
            
            // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            let printerName = '';
            try {
                const printerSettings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
                printerName = printerSettings.selectedPrinter || printerSettings.printerName || '';
            } catch {}

            // Ø·Ø¨Ø§Ø¹Ø© Ø¢Ù…Ù†Ø© ØªØ¶Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¯Ø§Ø¦Ù…Ø§Ù‹
            if (typeof window.safePrintInvoice === 'function') {
                window.safePrintInvoice(receiptContent, {
                    silent: true,
                    pageSize: 'A4',
                    printBackground: true,
                    printerName: printerName
                });
            } else {
                // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©
                const printWindow = window.open('', '_blank');
                printWindow.document.write(receiptContent);
                printWindow.document.close();
                printWindow.focus();
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            if (typeof updatePrintStats === 'function') updatePrintStats();
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ù†Ø³Ø®Ø© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© - Ø§ØªØ¬Ø§Ù‡ LTR)
        function generateInvoiceReceipt(sale, settings) {
                    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
                    // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© toEnglishDigits
            // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            const storeName = 'Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©';
            const storeAddress = 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±';
            const storePhone = localStorage.getItem('storePhone') || '07803092185';

            // Ù‚Ø§Ù„Ø¨ A4 Ø¯Ø§Ø¦Ù…Ù‹Ø§
            let receiptWidth = '210mm';

            // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
            let saleDate = sale.date ? new Date(sale.date) : (sale.timestamp ? new Date(sale.timestamp) : new Date());
            if (typeof saleDate === 'string') saleDate = new Date(saleDate);
            const dateStr = saleDate.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = saleDate.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

            let html = `
            <div style="
                width: ${receiptWidth};
                margin: 0 auto;
                padding: 32px 32px;
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #222;
                border: 1px solid #e5e7eb;
                border-radius: 12px;
                box-shadow: 0 4px 24px rgba(0,0,0,0.08);
                line-height: 1.7;
                font-size: 18px;
                direction: rtl;
                text-align: right;
            ">
            `;

            // Ø±Ø£Ø³ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            html += `
            <div style="text-align: center; margin-bottom: 24px; direction: rtl;">
                <h1 style="margin: 0 0 8px 0; font-size: 2.5rem; font-weight: bold; color: #2d3748; letter-spacing: 2px;">${storeName}</h1>
                <div style="font-size: 1.2rem; color: #374151; margin-bottom: 4px;">${storeAddress}</div>
                <div style="font-size: 1.1rem; color: #6366f1;">ğŸ“ ${storePhone}</div>
                <div style="width:100%;text-align:center;margin:12px 0 0 0;">
                                <img src="${(function(){
                                    let logoSrc = document.getElementById('storeLogo')?.value?.trim() || 'yaqoub_logo.png';
                                    if (!logoSrc.startsWith('data:') && !logoSrc.startsWith('http') && !logoSrc.startsWith('./') && !logoSrc.startsWith('/')) {
                                        logoSrc = './' + logoSrc;
                                    }
                                    return logoSrc;
                                })()}" alt="Logo" style="max-width:120px;max-height:120px;display:inline-block;vertical-align:middle;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:8px;" />
                </div>
            </div>
            <div style="border-top: 2px solid #6366f1; margin: 24px 0 16px 0;"></div>
            `;

            // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            html += `
            <div style="display: flex; justify-content: flex-start; gap: 48px; margin-bottom: 18px; font-size: 1.1rem; direction: ltr;">
                <div><b>Invoice No.:</b> ${toEnglishDigits(sale.invoice_id)}</div>
                <div><b>Date:</b> ${toEnglishDigits(dateStr)}</div>
                <div><b>Time:</b> ${toEnglishDigits(timeStr)}</div>
            </div>
            <div style="border-top: 1px dashed #bbb; margin: 18px 0 18px 0;"></div>
            `;

            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            let items = sale.items;
            if (typeof items === 'string') {
            try {
                items = JSON.parse(items);
            } catch {
                items = [];
            }
            }
            if (items && items.length > 0) {
            html += `
                <table style="width: 100%; border-collapse: collapse; font-size: 1.1rem; margin: 18px 0; background: #f9fafb; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.03); direction: ltr;">
                <thead>
                    <tr style="background: #6366f1; color: #fff;">
                    <th style="padding: 12px 0;">#</th>
                    <th style="padding: 12px 0;">Product Name</th>
                    <th style="padding: 12px 0;">Qty</th>
                    <th style="padding: 12px 0;">Unit Price</th>
                    <th style="padding: 12px 0;">Total</th>
                    </tr>
                </thead>
                <tbody>
            `;
            items.forEach((item, index) => {
                const name = item.product_name || item.name || 'â€”';
                const price = item.product_price || item.price || 0;
                html += `
                <tr style="background: ${index % 2 === 0 ? '#fff' : '#f3f4f6'}; text-align: center; direction: ltr;">
                    <td style="padding: 10px 0;">${toEnglishDigits(index + 1)}</td>
                    <td style="padding: 10px 0; text-align: left;">${name}</td>
                    <td style="padding: 10px 0;">${toEnglishDigits(item.quantity)}</td>
                    <td style="padding: 10px 0;">${toEnglishDigits(price.toLocaleString('en'))}</td>
                    <td style="padding: 10px 0; font-weight: bold; color: #10b981;">${toEnglishDigits((price * item.quantity).toLocaleString('en'))}</td>
                </tr>
                `;
            });
            html += `</tbody></table>`;
            }

            html += `<div style="border-top: 2px solid #6366f1; margin: 24px 0 16px 0;"></div>`;

            // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
            const additionalDiscount = sale.additional_discount || 0;
            const totalDiscount = (sale.discount || 0) + additionalDiscount;
            
            html += `
            <div style="font-size: 1.3rem; font-weight: bold; margin: 32px 0 12px 0; text-align: right; direction: rtl;">
                <div style="display: flex; justify-content: flex-start; gap: 48px; margin-bottom: 10px;">
                <div><span style="color:#374151;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:</span> <span>${toEnglishDigits((sale.total_amount || 0).toLocaleString('en'))}</span></div>
                ${sale.discount ? `<div><span style="color:#374151;">Ø§Ù„Ø®ØµÙ…:</span> <span style="color: #10b981;">- ${toEnglishDigits(sale.discount.toLocaleString('en'))}</span></div>` : ''}
                ${additionalDiscount > 0 ? `<div><span style="color:#374151;">Ø®ØµÙ… Ø¥Ø¶Ø§ÙÙŠ:</span> <span style="color: #10b981;">- ${toEnglishDigits(additionalDiscount.toLocaleString('en'))}</span></div>` : ''}
                </div>
                ${totalDiscount > 0 ? `<div style="display: flex; justify-content: flex-start; gap: 48px; margin-bottom: 10px; padding: 8px; background: #f0fdf4; border-radius: 6px;">
                    <div><span style="color:#15803d;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…:</span> <span style="color: #15803d; font-weight: bold;">- ${toEnglishDigits(totalDiscount.toLocaleString('en'))}</span></div>
                </div>` : ''}
                <div style="display: flex; justify-content: flex-start; gap: 48px; border-top: 2px solid #6366f1; padding-top: 12px; margin-top: 8px;">
                <div><span style="color:#2d3748;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> <span style="color:#e11d48; font-size:1.5rem;">${toEnglishDigits((sale.final_total || sale.total_amount || 0).toLocaleString('en'))}</span></div>
                </div>
            </div>
            `;

            // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
            const notes = [
                'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ<br>Ù‡Ùˆ ÙˆØµÙ„ Ø£Ù…Ø§Ù†Ø© Ø¹Ù„ÙŠÙƒÙ….',
                'Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù…ÙŠ Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø© Ù…Ù† ÙˆÙ‚Øª Ø§Ù„Ø´Ø±Ø§Ø¡.',
                'Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù„Ø§ ÙŠØ±Ø¬Ø¹ ÙˆÙ„Ø§ ÙŠØ¨Ø¯Ù„.',
                'Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ù‡Ùˆ Ù…Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø·Ø±ÙÙŠÙ†.',
                'Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© Ù‡ÙŠ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¶Ù…Ø§Ù† ÙˆÙ„ÙŠØ³ Ø´Ø±ÙƒØªÙ†Ø§.',
                'ÙƒØ³Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø£Ùˆ ÙƒØ³Ø± Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø¨Ø§Ù„Ø¶Ù…Ø§Ù†.',
                'Ù…Ø³Ø¤ÙˆÙ„ ØµÙŠØ§Ù†Ø© ÙˆØªÙ†ØµÙŠØ¨ Ø§Ù„Ø³Ø¨Ø§Ù„Øª: Ø­Ù…Ø²Ù‡ Ø£Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡ - Ù‡Ø§ØªÙ: <span dir="ltr" style="unicode-bidi: embed;">+964 785 570 6118</span> <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Flag_of_Iraq.svg" alt="Iraq Flag" style="height: 1em; vertical-align: middle; margin-right: 4px;" />'
            ];
            html += `
            <div style="margin-top:28px; padding:16px 12px; background:#fffbe7; border-radius:8px; border:1px solid #ffe082;">
                <div style="font-size:1.05rem; font-weight:bold; color:#c62828; margin-bottom:6px; text-align:right; direction:rtl;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</div>
                <ol style="font-size:1rem; padding-right:22px; margin:0; text-align:right; direction:rtl;">
                ${notes.map(n => `<li>${toEnglishDigits(n)}</li>`).join('')}
                </ol>
            </div>
            `;

            // Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            html += `<div style="text-align: center; margin-top: 40px; font-size: 1.1rem; color: #666; direction: rtl;">
            <p style="margin: 4px 0;">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹ Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</p>
            <p style="margin: 4px 0;">Ù†ØªØ·Ù„Ø¹ Ù„Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
            <p style="margin-top: 18px; color: #6366f1; font-size: 1.2rem;">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</p>
            </div>`;
            html += `</div>`;
            return html;
        }

        // ==========================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        // ==========================================

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØµÙ„Ø©
        async function refreshPrintersList() {
            const container = document.getElementById('connectedPrintersList');
            if (!container) return;
            
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª...</p>
                </div>
            `;
            
            try {
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
                let printers = [];
                
                if (window.electronAPI && window.electronAPI.getPrinters) {
                    printers = await window.electronAPI.getPrinters();
                } else {
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ù‚Ø§Ø¦Ù…Ø© Ø·Ø§Ø¨Ø¹Ø§Øª Ù„Ù„ØªØ¬Ø±Ø¨Ø© (Ù„Ù„Ù…ØªØµÙØ­)
                    printers = [
                        { name: 'Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', isDefault: true, status: 'ready' },
                        { name: 'Microsoft Print to PDF', isDefault: false, status: 'ready' }
                    ];
                }
                
                if (printers.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 1rem; color: #f59e0b;"></i>
                            <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ø§Ø¨Ø¹Ø§Øª Ù…ØªØµÙ„Ø©</p>
                        </div>
                    `;
                    return;
                }
                
                // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª
                let html = '<div style="display: grid; gap: 1rem;">';
                
                printers.forEach((printer, index) => {
                    const isDefault = printer.isDefault;
                    const status = printer.status === 'ready' || printer.status === 'idle' ? 'Ø¬Ø§Ù‡Ø²Ø©' : 'ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø©';
                    const statusColor = printer.status === 'ready' || printer.status === 'idle' ? '#10b981' : '#ef4444';
                    
                    html += `
                        <div style="
                            padding: 1rem;
                            background: var(--bg-secondary);
                            border-radius: 8px;
                            border: 2px solid ${isDefault ? '#6366f1' : 'var(--border-color)'};
                            display: flex;
                            align-items: center;
                            gap: 1rem;
                        ">
                            <div style="
                                width: 40px;
                                height: 40px;
                                background: ${isDefault ? '#6366f1' : '#64748b'};
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                            ">
                                <i class="fas fa-print"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">
                                    ${printer.name}
                                    ${isDefault ? '<span style="color: #6366f1; font-size: 0.75rem; margin-right: 0.5rem;">(Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)</span>' : ''}
                                </div>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                    Ø§Ù„Ø­Ø§Ù„Ø©: <span style="color: ${statusColor};">${status}</span>
                                </div>
                            </div>
                            <button 
                                onclick="selectPrinter('${printer.name.replace(/'/g, "\\'")}')"
                                style="
                                    padding: 0.5rem 1rem;
                                    background: #6366f1;
                                    color: white;
                                    border: none;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 0.875rem;
                                "
                            >
                                Ø§Ø®ØªÙŠØ§Ø±
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
                
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                const select = document.getElementById('selectedPrinter');
                if (select) {
                    select.innerHTML = '<option value="">Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</option>';
                    printers.forEach(printer => {
                        const option = document.createElement('option');
                        option.value = printer.name;
                        option.textContent = printer.name + (printer.isDefault ? ' (Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)' : '');
                        if (printer.isDefault) option.selected = true;
                        select.appendChild(option);
                    });
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª</p>
                    </div>
                `;
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ø¨Ø¹Ø©
        function selectPrinter(printerName) {
            const select = document.getElementById('selectedPrinter');
            if (select) {
                select.value = printerName;
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
        function updateReceiptPreview() {
            const templateType = document.getElementById('receiptTemplate')?.value || 'cash';
            const printerType = document.getElementById('printerType')?.value || 'a4';
            
            // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            const settings = {
                templateType: templateType,
                printerType: printerType,
                storeTitleSize: parseInt(document.getElementById('storeTitleSize')?.value || 24),
                storeInfoSize: parseInt(document.getElementById('storeInfoSize')?.value || 14),
                invoiceTextSize: parseInt(document.getElementById('invoiceTextSize')?.value || 13),
                tableTextSize: parseInt(document.getElementById('tableTextSize')?.value || 12),
                totalTextSize: parseInt(document.getElementById('totalTextSize')?.value || 16),
                lineHeight: parseFloat(document.getElementById('lineHeight')?.value || 1.4),
                sidePadding: parseInt(document.getElementById('sidePadding')?.value || 15),
                showDateTime: document.getElementById('showDateTime')?.checked !== false,
                showInvoiceNumber: document.getElementById('showInvoiceNumber')?.checked !== false,
                customFooter: document.getElementById('customFooter')?.value || ''
            };
            
            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ÙØ§ØªÙˆØ±Ø©
            const sampleInvoice = {
                invoice_id: 'INV-' + Math.floor(Math.random() * 10000),
                timestamp: new Date().toISOString(),
                customer_name: templateType === 'installment' ? 'Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ' : 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ',
                customer_phone: templateType === 'installment' ? '07803092185' : '',
                customer_address: templateType === 'installment' ? 'Ø¨ØºØ¯Ø§Ø¯ - Ø§Ù„Ù…Ù†ØµÙˆØ±' : '',
                items: [
                    { product_name: 'Ø«Ù„Ø§Ø¬Ø© Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬', quantity: 1, price: 800000, total: 800000 },
                    { product_name: 'ØºØ³Ø§Ù„Ø© LG', quantity: 1, price: 600000, total: 600000 }
                ],
                subtotal: 1400000,
                discount: 50000,
                tax: 0,
                final_total: 1350000,
                payment_method: templateType === 'installment' ? 'ØªÙ‚Ø³ÙŠØ·' : 'Ù†Ù‚Ø¯ÙŠ'
            };
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªÙ‚Ø³ÙŠØ·ØŒ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            if (templateType === 'installment') {
                sampleInvoice.installment_months = 12;
                sampleInvoice.down_payment = 350000;
                sampleInvoice.monthly_amount = 83334;
                sampleInvoice.remaining_amount = 1000000;
                sampleInvoice.installments = [];
                
                // ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                for (let i = 1; i <= 12; i++) {
                    const dueDate = new Date();
                    dueDate.setMonth(dueDate.getMonth() + i);
                    sampleInvoice.installments.push({
                        month: i,
                        due_date: dueDate.toISOString().split('T')[0],
                        amount: 83334,
                        status: i <= 3 ? 'paid' : 'pending'
                    });
                }
            }
            
            // ØªÙˆÙ„ÙŠØ¯ HTML Ø§Ù„Ø¥ÙŠØµØ§Ù„
            let receiptHTML;
            if (templateType === 'cash') {
                receiptHTML = generateCashReceiptPreview(sampleInvoice, settings);
            } else {
                receiptHTML = generateInstallmentReceiptPreview(sampleInvoice, settings);
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            const preview = document.getElementById('receiptPreview');
            if (preview) {
                preview.innerHTML = receiptHTML;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            if (document.getElementById('activeTemplateType')) {
                document.getElementById('activeTemplateType').textContent = 
                    templateType === 'cash' ? 'Ù†Ù‚Ø¯ÙŠ' : 'ØªÙ‚Ø³ÙŠØ·';
            }
            if (document.getElementById('activePrinterType')) {
                const typeNames = {
                    'a4': 'A4',
                    'thermal-80': 'Ø­Ø±Ø§Ø±ÙŠ 80mm',
                    'thermal-58': 'Ø­Ø±Ø§Ø±ÙŠ 58mm'
                };
                document.getElementById('activePrinterType').textContent = typeNames[printerType] || 'A4';
            }
        }

        // ØªÙˆÙ„ÙŠØ¯ HTML Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥ÙŠØµØ§Ù„ Ù†Ù‚Ø¯ÙŠ
        function generateCashReceiptPreview(sale, settings) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            if (typeof window.generateYaqoubCashReceipt === 'function') {
                return window.generateYaqoubCashReceipt(sale, settings);
            }
            
            // Fallback Ù„Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù‚Ø¯ÙŠÙ…
            const storeName = localStorage.getItem('storeName') || 'Ù…ØªØ¬Ø± ÙŠØ¹Ù‚ÙˆØ¨ Ø¨Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©';
            const storeAddress = localStorage.getItem('storeAddress') || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±';
            const storePhone = localStorage.getItem('storePhone') || '07803092185';
            
            // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„
            let receiptWidth = '210mm'; // A4
            if (settings.printerType === 'thermal-80') {
                receiptWidth = '80mm';
            } else if (settings.printerType === 'thermal-58') {
                receiptWidth = '58mm';
            }
            
            const dateStr = new Date(sale.timestamp).toLocaleDateString('ar-IQ', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
            const timeStr = new Date(sale.timestamp).toLocaleTimeString('ar-IQ', {
                hour: '2-digit', minute: '2-digit'
            });
            
            return `
                <div style="
                    width: ${receiptWidth};
                    padding: ${settings.sidePadding}px;
                    font-family: 'Cairo', 'Segoe UI', Arial, sans-serif;
                    line-height: ${settings.lineHeight};
                    font-size: ${settings.invoiceTextSize}px;
                    color: black;
                    background: white;
                ">
                    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø± -->
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h2 style="margin: 0 0 8px 0; font-size: ${settings.storeTitleSize}px; font-weight: bold;">
                            ${storeName}
                        </h2>
                        <p style="margin: 4px 0; font-size: ${settings.storeInfoSize}px;">${storeAddress}</p>
                        <p style="margin: 4px 0; font-size: ${settings.storeInfoSize}px;">ğŸ“ ${storePhone}</p>
                    </div>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div style="margin: 10px 0; font-size: ${settings.invoiceTextSize}px;">
                        ${settings.showInvoiceNumber ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: 600;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</span>
                            <span style="font-weight: bold;">${sale.invoice_id}</span>
                        </div>` : ''}
                        ${settings.showDateTime ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                            <span>${dateStr}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Ø§Ù„ÙˆÙ‚Øª:</span>
                            <span>${timeStr}</span>
                        </div>` : ''}
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>Ø§Ù„Ø¹Ù…ÙŠÙ„:</span>
                            <span style="font-weight: 600;">${sale.customer_name || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ'}</span>
                        </div>
                    </div>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                    <table style="width: 100%; border-collapse: collapse; font-size: ${settings.tableTextSize}px; margin: 10px 0;">
                        <thead>
                            <tr style="border-bottom: 1px solid #000;">
                                <th style="text-align: right; padding: 5px 0;">Ø§Ù„ØµÙ†Ù</th>
                                <th style="text-align: center; padding: 5px 5px;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th style="text-align: left; padding: 5px 0;">Ø§Ù„Ø³Ø¹Ø±</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Array.isArray(sale.items) ? sale.items.map(item => `
                                <tr>
                                    <td style="text-align: right; padding: 8px 0;">${item.product_name || item.name}</td>
                                    <td style="text-align: center; padding: 8px 5px;">${item.quantity}</td>
                                    <td style="text-align: left; padding: 8px 0;">${formatCurrency(item.total || (item.quantity * item.price))}</td>
                                </tr>
                            `).join('') : ''}
                        </tbody>
                    </table>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª -->
                    <div style="font-size: ${settings.totalTextSize}px; margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                            <span>${formatCurrency(sale.subtotal || 0)}</span>
                        </div>
                        ${sale.discount > 0 ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; color: #10b981;">
                            <span>Ø§Ù„Ø®ØµÙ…:</span>
                            <span>-${formatCurrency(sale.discount)}</span>
                        </div>` : ''}
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: ${settings.totalTextSize + 2}px; margin-top: 10px; padding-top: 10px; border-top: 2px solid #000;">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span>${formatCurrency(sale.final_total || 0)}</span>
                        </div>
                    </div>
                    
                    ${settings.customFooter ? `
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
                    <div style="text-align: center; font-size: ${settings.storeInfoSize - 1}px; color: #666; margin-top: 15px;">
                        ${settings.customFooter}
                    </div>` : ''}
                </div>
            `;
        }

        // ØªÙˆÙ„ÙŠØ¯ HTML Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¥ÙŠØµØ§Ù„ ØªÙ‚Ø³ÙŠØ·
        function generateInstallmentReceiptPreview(sale, settings) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            if (typeof window.generateYaqoubInstallmentReceipt === 'function') {
                return window.generateYaqoubInstallmentReceipt(sale, settings);
            }
            
            // Fallback Ù„Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù‚Ø¯ÙŠÙ…
            const storeName = localStorage.getItem('storeName') || 'Ù…ØªØ¬Ø± ÙŠØ¹Ù‚ÙˆØ¨ Ø¨Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©';
            const storeAddress = localStorage.getItem('storeAddress') || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±';
            const storePhone = localStorage.getItem('storePhone') || '07803092185';
            
            // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØµØ§Ù„
            let receiptWidth = '210mm'; // A4
            if (settings.printerType === 'thermal-80') {
                receiptWidth = '80mm';
            } else if (settings.printerType === 'thermal-58') {
                receiptWidth = '58mm';
            }
            
            const dateStr = new Date(sale.timestamp).toLocaleDateString('ar-IQ', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
            
            return `
                <div style="
                    width: ${receiptWidth};
                    padding: ${settings.sidePadding}px;
                    font-family: 'Cairo', 'Segoe UI', Arial, sans-serif;
                    line-height: ${settings.lineHeight};
                    font-size: ${settings.invoiceTextSize}px;
                    color: black;
                    background: white;
                ">
                    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØªØ¬Ø± -->
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h2 style="margin: 0 0 8px 0; font-size: ${settings.storeTitleSize}px; font-weight: bold;">
                            ${storeName}
                        </h2>
                        <p style="margin: 4px 0; font-size: ${settings.storeInfoSize}px;">${storeAddress}</p>
                        <p style="margin: 4px 0; font-size: ${settings.storeInfoSize}px;">ğŸ“ ${storePhone}</p>
                    </div>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ù†ÙˆØ¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div style="text-align: center; background: #ffe4e6; padding: 8px; margin-bottom: 10px; border-radius: 4px;">
                        <strong style="color: #dc2626; font-size: ${settings.invoiceTextSize + 1}px;">ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ·</strong>
                    </div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„ -->
                    <div style="margin: 10px 0; font-size: ${settings.invoiceTextSize}px;">
                        ${settings.showInvoiceNumber ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: 600;">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</span>
                            <span style="font-weight: bold;">${sale.invoice_id}</span>
                        </div>` : ''}
                        ${settings.showDateTime ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                            <span>${dateStr}</span>
                        </div>` : ''}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span>Ø§Ù„Ø¹Ù…ÙŠÙ„:</span>
                            <span style="font-weight: 600;">${sale.customer_name}</span>
                        </div>
                        ${sale.customer_phone ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span>Ø§Ù„Ù‡Ø§ØªÙ:</span>
                            <span>${sale.customer_phone}</span>
                        </div>` : ''}
                        ${sale.customer_address ? `
                        <div style="display: flex; justify-content: space-between;">
                            <span>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                            <span>${sale.customer_address}</span>
                        </div>` : ''}
                    </div>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                    <table style="width: 100%; border-collapse: collapse; font-size: ${settings.tableTextSize}px; margin: 10px 0;">
                        <thead>
                            <tr style="border-bottom: 1px solid #000;">
                                <th style="text-align: right; padding: 5px 0;">Ø§Ù„ØµÙ†Ù</th>
                                <th style="text-align: center; padding: 5px 5px;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th style="text-align: left; padding: 5px 0;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Array.isArray(sale.items) ? sale.items.map(item => `
                                <tr>
                                    <td style="text-align: right; padding: 8px 0;">${item.product_name || item.name}</td>
                                    <td style="text-align: center; padding: 8px 5px;">${item.quantity}</td>
                                    <td style="text-align: left; padding: 8px 0;">${formatCurrency(item.total || (item.quantity * item.price))}</td>
                                </tr>
                            `).join('') : ''}
                        </tbody>
                    </table>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚Ø³ÙŠØ· -->
                    <div style="background: #f0f9ff; padding: 10px; border-radius: 4px; margin: 10px 0; font-size: ${settings.invoiceTextSize}px;">
                        <div style="text-align: center; font-weight: bold; margin-bottom: 8px; color: #0284c7;">
                            Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚Ø³ÙŠØ·
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº:</span>
                            <span style="font-weight: bold;">${formatCurrency(sale.final_total || 0)}</span>
                        </div>
                        ${sale.down_payment > 0 ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; color: #10b981;">
                            <span>Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:</span>
                            <span style="font-weight: bold;">${formatCurrency(sale.down_payment)}</span>
                        </div>` : ''}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px; padding-top: 5px; border-top: 1px dashed #0284c7;">
                            <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</span>
                            <span style="font-weight: bold;">${formatCurrency(sale.remaining_amount || sale.final_total)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</span>
                            <span style="font-weight: bold;">${sale.installment_months} Ø´Ù‡Ø±</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 4px; margin-top: 8px;">
                            <span style="color: #0284c7; font-weight: bold;">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</span>
                            <span style="font-weight: bold; color: #0284c7; font-size: ${settings.totalTextSize}px;">${formatCurrency(sale.monthly_amount)}</span>
                        </div>
                    </div>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· -->
                    <div style="margin: 15px 0;">
                        <div style="text-align: center; font-weight: bold; margin-bottom: 10px; font-size: ${settings.invoiceTextSize + 1}px;">
                            Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                        </div>
                        <table style="width: 100%; border-collapse: collapse; font-size: ${settings.tableTextSize - 1}px;">
                            <thead>
                                <tr style="background: #f3f4f6; border-bottom: 1px solid #000;">
                                    <th style="padding: 6px 4px; text-align: center;">Ø§Ù„Ø´Ù‡Ø±</th>
                                    <th style="padding: 6px 4px; text-align: center;">Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                                    <th style="padding: 6px 4px; text-align: center;">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th style="padding: 6px 4px; text-align: center;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Array.isArray(sale.installments) ? sale.installments.slice(0, 6).map(inst => `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 6px 4px; text-align: center;">${inst.month}</td>
                                        <td style="padding: 6px 4px; text-align: center;">${new Date(inst.due_date).toLocaleDateString('ar-IQ', {month: 'numeric', day: 'numeric'})}</td>
                                        <td style="padding: 6px 4px; text-align: center;">${formatCurrency(inst.amount)}</td>
                                        <td style="padding: 6px 4px; text-align: center;">
                                            <span style="color: ${inst.status === 'paid' ? '#10b981' : '#ef4444'}; font-weight: bold;">
                                                ${inst.status === 'paid' ? 'âœ“' : 'âœ—'}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('') : ''}
                                ${sale.installments && sale.installments.length > 6 ? `
                                    <tr>
                                        <td colspan="4" style="padding: 6px; text-align: center; color: #6b7280; font-style: italic;">
                                            ... ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                                        </td>
                                    </tr>
                                ` : ''}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© -->
                    <div style="background: #fef3c7; padding: 10px; border-radius: 4px; font-size: ${settings.tableTextSize}px; margin-top: 10px;">
                        <div style="font-weight: bold; margin-bottom: 5px; color: #d97706;">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:</div>
                        <ul style="margin: 5px 0; padding-right: 20px;">
                            <li>ÙŠØ¬Ø¨ ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø· ÙÙŠ Ù…ÙˆØ¹Ø¯Ù‡ Ø§Ù„Ù…Ø­Ø¯Ø¯</li>
                            <li>Ø§Ù„ØªØ£Ø®ÙŠØ± ÙÙŠ Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙŠØªØ±ØªØ¨ Ø¹Ù„ÙŠÙ‡ ØºØ±Ø§Ù…Ø©</li>
                            <li>Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</li>
                        </ul>
                    </div>
                    
                    ${settings.customFooter ? `
                    <!-- Ø®Ø· ÙØ§ØµÙ„ -->
                    <div style="border-top: 2px dashed #000; margin: 15px 0;"></div>
                    
                    <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
                    <div style="text-align: center; font-size: ${settings.storeInfoSize - 1}px; color: #666; margin-top: 15px;">
                        ${settings.customFooter}
                    </div>` : ''}
                    
                    <!-- ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
                    <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid #ccc;">
                        <div style="display: flex; justify-content: space-between; font-size: ${settings.tableTextSize}px;">
                            <div style="text-align: center;">
                                <div style="border-top: 1px solid #000; width: 150px; margin-bottom: 5px;"></div>
                                <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="border-top: 1px solid #000; width: 150px; margin-bottom: 5px;"></div>
                                <div>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
        function savePrinterSettings() {
            const settings = {
                receiptTemplate: document.getElementById('receiptTemplate')?.value || 'cash',
                selectedPrinter: document.getElementById('selectedPrinter')?.value || '',
                printerType: document.getElementById('printerType')?.value || 'a4',
                storeTitleSize: parseInt(document.getElementById('storeTitleSize')?.value || 24),
                storeInfoSize: parseInt(document.getElementById('storeInfoSize')?.value || 14),
                invoiceTextSize: parseInt(document.getElementById('invoiceTextSize')?.value || 13),
                tableTextSize: parseInt(document.getElementById('tableTextSize')?.value || 12),
                totalTextSize: parseInt(document.getElementById('totalTextSize')?.value || 16),
                lineHeight: parseFloat(document.getElementById('lineHeight')?.value || 1.4),
                sidePadding: parseInt(document.getElementById('sidePadding')?.value || 15),
                showDateTime: document.getElementById('showDateTime')?.checked !== false,
                showInvoiceNumber: document.getElementById('showInvoiceNumber')?.checked !== false,
                customFooter: document.getElementById('customFooter')?.value || '',
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
                store_name: document.getElementById('storeName')?.value || 'Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©',
                store_address: document.getElementById('storeAddress')?.value || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±',
                store_phone: document.getElementById('storePhone')?.value || '07803092185',
                store_logo: document.getElementById('storeLogo')?.value || 'yaqoub_logo.png',
                show_logo: document.getElementById('showLogo')?.checked !== false,
                // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                note1: document.getElementById('note1')?.value || '',
                note2: document.getElementById('note2')?.value || '',
                note3: document.getElementById('note3')?.value || '',
                note4: document.getElementById('note4')?.value || '',
                note5: document.getElementById('note5')?.value || '',
                note6: document.getElementById('note6')?.value || '',
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
                maintenance_name: document.getElementById('maintenanceName')?.value || 'Ø­Ù…Ø²Ù‡ Ø§Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡',
                maintenance_service: document.getElementById('maintenanceService')?.value || 'ØµÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø¨Ø§Ù„Øª',
                maintenance_phone: document.getElementById('maintenancePhone')?.value || '+964 785 570 6118',
                show_maintenance: document.getElementById('showMaintenance')?.checked !== false
            };
            
            localStorage.setItem('printerSettings', JSON.stringify(settings));
            // Ø­ÙØ¸ ÙÙŠ localStorage Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
            localStorage.setItem('storeName', settings.store_name);
            localStorage.setItem('storeAddress', settings.store_address);
            localStorage.setItem('storePhone', settings.store_phone);
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©:', settings);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
        function loadPrinterSettings() {
            try {
                const settings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
                
                if (document.getElementById('receiptTemplate')) document.getElementById('receiptTemplate').value = settings.receiptTemplate || 'cash';
                if (document.getElementById('selectedPrinter')) document.getElementById('selectedPrinter').value = settings.selectedPrinter || '';
                if (document.getElementById('printerType')) document.getElementById('printerType').value = settings.printerType || 'a4';
                if (document.getElementById('storeTitleSize')) document.getElementById('storeTitleSize').value = settings.storeTitleSize || 24;
                if (document.getElementById('storeInfoSize')) document.getElementById('storeInfoSize').value = settings.storeInfoSize || 14;
                if (document.getElementById('invoiceTextSize')) document.getElementById('invoiceTextSize').value = settings.invoiceTextSize || 13;
                if (document.getElementById('tableTextSize')) document.getElementById('tableTextSize').value = settings.tableTextSize || 12;
                if (document.getElementById('totalTextSize')) document.getElementById('totalTextSize').value = settings.totalTextSize || 16;
                if (document.getElementById('lineHeight')) document.getElementById('lineHeight').value = settings.lineHeight || 1.4;
                if (document.getElementById('sidePadding')) document.getElementById('sidePadding').value = settings.sidePadding || 15;
                if (document.getElementById('showDateTime')) document.getElementById('showDateTime').checked = settings.showDateTime !== false;
                if (document.getElementById('showInvoiceNumber')) document.getElementById('showInvoiceNumber').checked = settings.showInvoiceNumber !== false;
                if (document.getElementById('customFooter')) document.getElementById('customFooter').value = settings.customFooter || '';
                
                // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
                if (document.getElementById('storeName')) document.getElementById('storeName').value = settings.store_name || 'Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©';
                if (document.getElementById('storeAddress')) document.getElementById('storeAddress').value = settings.store_address || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±';
                if (document.getElementById('storePhone')) document.getElementById('storePhone').value = settings.store_phone || '07803092185';
                if (document.getElementById('storeLogo')) document.getElementById('storeLogo').value = settings.store_logo || 'yaqoub_logo.png';
                if (document.getElementById('showLogo')) document.getElementById('showLogo').checked = settings.show_logo !== false;
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                if (document.getElementById('note1')) document.getElementById('note1').value = settings.note1 || 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ùˆ ÙˆØµÙ„ Ø£Ù…Ø§Ù†Ø©';
                if (document.getElementById('note2')) document.getElementById('note2').value = settings.note2 || 'Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù…ÙŠ 24 Ø³Ø§Ø¹Ø©';
                if (document.getElementById('note3')) document.getElementById('note3').value = settings.note3 || 'Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù„Ø§ ÙŠØ±Ø¬Ø¹ ÙˆÙ„Ø§ ÙŠØ¨Ø¯Ù„';
                if (document.getElementById('note4')) document.getElementById('note4').value = settings.note4 || 'Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ù‡Ùˆ Ù…Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø·Ø±ÙÙŠÙ†';
                if (document.getElementById('note5')) document.getElementById('note5').value = settings.note5 || 'Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¶Ù…Ø§Ù†';
                if (document.getElementById('note6')) document.getElementById('note6').value = settings.note6 || 'ÙƒØ³Ø± Ø§Ù„Ø´Ø§Ø´Ø© ØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø¨Ø§Ù„Ø¶Ù…Ø§Ù†';
                
                // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
                if (document.getElementById('maintenanceName')) document.getElementById('maintenanceName').value = settings.maintenance_name || 'Ø­Ù…Ø²Ù‡ Ø§Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡';
                if (document.getElementById('maintenanceService')) document.getElementById('maintenanceService').value = settings.maintenance_service || 'ØµÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø¨Ø§Ù„Øª';
                if (document.getElementById('maintenancePhone')) document.getElementById('maintenancePhone').value = settings.maintenance_phone || '+964 785 570 6118';
                if (document.getElementById('showMaintenance')) document.getElementById('showMaintenance').checked = settings.show_maintenance !== false;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
                if (document.getElementById('storeTitleSizeValue')) document.getElementById('storeTitleSizeValue').textContent = settings.storeTitleSize || 24;
                if (document.getElementById('storeInfoSizeValue')) document.getElementById('storeInfoSizeValue').textContent = settings.storeInfoSize || 14;
                if (document.getElementById('invoiceTextSizeValue')) document.getElementById('invoiceTextSizeValue').textContent = settings.invoiceTextSize || 13;
                if (document.getElementById('tableTextSizeValue')) document.getElementById('tableTextSizeValue').textContent = settings.tableTextSize || 12;
                if (document.getElementById('totalTextSizeValue')) document.getElementById('totalTextSizeValue').textContent = settings.totalTextSize || 16;
                if (document.getElementById('lineHeightValue')) document.getElementById('lineHeightValue').textContent = settings.lineHeight || 1.4;
                if (document.getElementById('sidePaddingValue')) document.getElementById('sidePaddingValue').textContent = settings.sidePadding || 15;
                
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©:', error);
            }
        }

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        function resetPrinterSettings() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) {
                const defaultSettings = {
                    receiptTemplate: 'cash',
                    selectedPrinter: '',
                    printerType: 'a4',
                    storeTitleSize: 24,
                    storeInfoSize: 14,
                    invoiceTextSize: 13,
                    tableTextSize: 12,
                    totalTextSize: 16,
                    lineHeight: 1.4,
                    sidePadding: 15,
                    showDateTime: true,
                    showInvoiceNumber: true,
                    customFooter: ''
                };
                
                localStorage.setItem('printerSettings', JSON.stringify(defaultSettings));
                loadPrinterSettings();
                updateReceiptPreview();
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ø·Ø¨Ø§Ø¹Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function testPrintReceipt() {
            const templateType = document.getElementById('receiptTemplate')?.value || 'cash';
            const settings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
            
            // ØªØ­Ø¯ÙŠØ« settings Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            settings.templateType = templateType;
            settings.printerType = document.getElementById('printerType')?.value || 'a4';
            settings.storeTitleSize = parseInt(document.getElementById('storeTitleSize')?.value || 24);
            settings.storeInfoSize = parseInt(document.getElementById('storeInfoSize')?.value || 14);
            settings.invoiceTextSize = parseInt(document.getElementById('invoiceTextSize')?.value || 13);
            settings.tableTextSize = parseInt(document.getElementById('tableTextSize')?.value || 12);
            settings.totalTextSize = parseInt(document.getElementById('totalTextSize')?.value || 16);
            settings.lineHeight = parseFloat(document.getElementById('lineHeight')?.value || 1.4);
            settings.sidePadding = parseInt(document.getElementById('sidePadding')?.value || 15);
            settings.showDateTime = document.getElementById('showDateTime')?.checked !== false;
            settings.showInvoiceNumber = document.getElementById('showInvoiceNumber')?.checked !== false;
            settings.customFooter = document.getElementById('customFooter')?.value || '';
            
            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            const testInvoice = {
                invoice_id: 'TEST-' + Date.now(),
                timestamp: new Date().toISOString(),
                customer_name: templateType === 'installment' ? 'Ø¹Ù…ÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ' : 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ',
                customer_phone: templateType === 'installment' ? '07900000000' : '',
                customer_address: templateType === 'installment' ? 'Ø¨ØºØ¯Ø§Ø¯' : '',
                items: [
                    { product_name: 'Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ 1', quantity: 2, price: 50000, total: 100000 },
                    { product_name: 'Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ 2', quantity: 1, price: 75000, total: 75000 }
                ],
                subtotal: 175000,
                discount: 5000,
                final_total: 170000,
                payment_method: templateType === 'installment' ? 'ØªÙ‚Ø³ÙŠØ·' : 'Ù†Ù‚Ø¯ÙŠ'
            };
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø³ÙŠØ· Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            if (templateType === 'installment') {
                testInvoice.installment_months = 6;
                testInvoice.down_payment = 50000;
                testInvoice.monthly_amount = 20000;
                testInvoice.remaining_amount = 120000;
                testInvoice.installments = [];
                
                for (let i = 1; i <= 6; i++) {
                    const dueDate = new Date();
                    dueDate.setMonth(dueDate.getMonth() + i);
                    testInvoice.installments.push({
                        month: i,
                        due_date: dueDate.toISOString().split('T')[0],
                        amount: 20000,
                        status: 'pending'
                    });
                }
            }
            
            // ØªÙˆÙ„ÙŠØ¯ HTML Ø§Ù„Ø¥ÙŠØµØ§Ù„
            const receiptHTML = templateType === 'cash' 
                ? generateCashReceiptPreview(testInvoice, settings)
                : generateInstallmentReceiptPreview(testInvoice, settings);
            
            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>Ø·Ø¨Ø§Ø¹Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Cairo', sans-serif; }
                        @media print {
                            body { margin: 0; }
                            @page { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    ${receiptHTML}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            
            // Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            setTimeout(() => {
                printWindow.print();
            }, 500);
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function initPrinterPage() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            loadPrinterSettings();
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª
            refreshPrintersList();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            updateReceiptPreview();
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            const totalPrints = parseInt(localStorage.getItem('totalPrints') || '0');
            const todayPrints = parseInt(localStorage.getItem('todayPrints') || '0');
            
            if (document.getElementById('totalPrints')) {
                document.getElementById('totalPrints').textContent = totalPrints;
            }
            if (document.getElementById('todayPrints')) {
                document.getElementById('todayPrints').textContent = todayPrints;
            }
            
            console.log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©');
        }

        // ==========================================
        // Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
        // ==========================================

        // ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function confirmDeleteInvoice(invoiceId, customerName) {
            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
            if (!window.securityManager.checkPermission('invoices_delete')) {
                return;
            }
            
            const confirmed = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ\n\nØ±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoiceId}\nØ§Ù„Ø¹Ù…ÙŠÙ„: ${customerName}\n\nâš ï¸ ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`);
            
            if (confirmed) {
                deleteInvoice(invoiceId);
            }
        }

        // Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        async function deleteInvoice(invoiceId) {
            // ÙØ­Øµ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            if (!window.securityManager.checkPermission('invoices_delete')) {
                return;
            }
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                const saleIndex = salesData.findIndex(s => s.invoice_id === invoiceId);
                
                if (saleIndex === -1) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                
                const sale = salesData[saleIndex];
                
                // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ…ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                let items = [];
                if (typeof sale.items === 'string') {
                    try {
                        items = JSON.parse(sale.items);
                    } catch (e) {
                        items = sale.items || [];
                    }
                } else {
                    items = sale.items || [];
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
                if (Array.isArray(items)) {
                    for (const item of items) {
                        const product = products.find(p => p.product_id === item.product_id);
                        if (product) {
                            product.stock_quantity = (product.stock_quantity || 0) + (item.quantity || 0);
                            
                            // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            if (window.dataSdk && (product.id || product.__backendId)) {
                                const updateId = product.id || product.__backendId;
                                await window.dataSdk.update(updateId, {
                                    stock_quantity: product.stock_quantity
                                });
                            }
                        }
                    }
                }
                
                // Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (window.dataSdk && (sale.id || sale.__backendId)) {
                    const deleteId = sale.id || sale.__backendId;
                    await window.dataSdk.delete(deleteId);
                }
                
                // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                salesData.splice(saleIndex, 1);
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                window.securityManager.logOperation('Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø©', {
                    invoiceId: invoiceId,
                    customerName: sale.customer_name || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ',
                    totalAmount: sale.final_total
                });
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                renderInvoicesTable();
                updateStatistics();
                
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø©:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        function updatePrintStats() {
            let totalPrints = parseInt(localStorage.getItem('totalPrints') || '0');
            totalPrints++;
            localStorage.setItem('totalPrints', totalPrints);
            
            const today = new Date().toDateString();
            const lastPrintDate = localStorage.getItem('lastPrintDate');
            let todayPrints = parseInt(localStorage.getItem('todayPrints') || '0');
            
            if (lastPrintDate !== today) {
                todayPrints = 1;
                localStorage.setItem('lastPrintDate', today);
            } else {
                todayPrints++;
            }
            localStorage.setItem('todayPrints', todayPrints);
            
            if (document.getElementById('totalPrints')) {
                document.getElementById('totalPrints').textContent = totalPrints;
            }
            if (document.getElementById('todayPrints')) {
                document.getElementById('todayPrints').textContent = todayPrints;
            }
        }

        function showDebtDetails(debtId) {
            console.log('=== Show Debt Details ===');
            console.log('Looking for debt ID:', debtId);
            console.log('Available debts:', debtsData);
            
            const debt = debtsData.find(d => 
                d.id == debtId || 
                d.__backendId == debtId || 
                d.debt_id == debtId
            );
            
            if (!debt) {
                console.log('âŒ Debt not found!');
                console.log('Searched ID:', debtId);
                console.log('Available debt IDs:', debtsData.map(d => ({
                    id: d.id,
                    __backendId: d.__backendId,
                    debt_id: d.debt_id
                })));
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            console.log('âœ… Found debt:', debt);
            console.log('Debt properties:');
            console.log('  - total_amount:', debt.total_amount);
            console.log('  - final_total:', debt.final_total);
            console.log('  - remaining_amount:', debt.remaining_amount);
            console.log('  - paid_amount:', debt.paid_amount);
            console.log('  - monthly_amount:', debt.monthly_amount);
            console.log('  - installment_months:', debt.installment_months);
            console.log('  - installments:', debt.installments);
            console.log('  - invoice_id:', debt.invoice_id);
            
            // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ
            window.currentDebtId = debtId;
            window.currentDebt = debt;
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†
            navigateTo('debtDetailsPage');
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
            const relatedSale = salesData.find(s => s.invoice_id === debt.invoice_id);
            console.log('Related sale:', relatedSale);
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
            renderDebtCustomerInfo(debt);
            
            // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙŠÙ†
            renderDebtSummary(debt);
            
            // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            renderDebtInvoiceDetails(relatedSale);
            
            // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            renderInstallmentsTable(debt, relatedSale);
            
            // Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
            renderPaymentsHistory(debt);
            
            console.log('======================');
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
        function renderDebtCustomerInfo(debt) {
            const container = document.getElementById('debtCustomerInfo');
            if (!container) return;
            
            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
            let paidMonths = 0;
            let remainingMonths = 0;
            let isPaid = false;
            
            if (debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                paidMonths = debt.installments.filter(inst => inst.status === 'paid').length;
                remainingMonths = debt.installments.length - paidMonths;
                isPaid = remainingMonths === 0;
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ø·ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                const remainingAmount = debt.remaining_amount !== undefined ? debt.remaining_amount : (debt.total_amount || debt.final_total || 0);
                isPaid = remainingAmount <= 0;
                remainingMonths = isPaid ? 0 : (debt.installment_months || 0);
            }
            
            const isOverdue = new Date(debt.due_date) < new Date() && !isPaid;
            
            console.log('Customer info - Paid months:', paidMonths, 'Remaining:', remainingMonths, 'isPaid:', isPaid);
            
            let statusColor = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            let statusText = `${paidMonths} Ù…Ù† ${debt.installment_months || 0} Ø´Ù‡Ø±`;
            let statusIcon = 'clock';
            
            if (isPaid) {
                statusColor = 'var(--success-gradient)';
                statusText = 'Ù…Ø³Ø¯Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„';
                statusIcon = 'check-double';
            } else if (isOverdue) {
                statusColor = 'var(--danger-gradient)';
                statusText = `Ù…ØªØ£Ø®Ø± - ${paidMonths}/${debt.installment_months || 0} Ø´Ù‡Ø±`;
                statusIcon = 'exclamation-triangle';
            }
            
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-user"></i></div>
                    <div class="stat-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                    <div class="stat-value" style="font-size: 1.5rem;">${debt.customer_name}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-phone"></i></div>
                    <div class="stat-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
                    <div class="stat-value" style="font-size: 1.5rem;">${debt.customer_phone}</div>
                </div>
                <div class="stat-card" style="background: ${statusColor}; color: white;">
                    <div class="stat-icon"><i class="fas fa-${statusIcon}"></i></div>
                    <div class="stat-label">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                    <div class="stat-value">${statusText}</div>
                </div>
            `;
        }
        
        // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙŠÙ†
        function renderDebtSummary(debt) {
            const container = document.getElementById('debtSummaryCard');
            if (!container) {
                console.error('âŒ debtSummaryCard container not found!');
                return;
            }
            
            console.log('=== Rendering Debt Summary ===');
            console.log('Raw debt object:', JSON.stringify(debt, null, 2));
            console.log('Debt.total_amount:', debt.total_amount, typeof debt.total_amount);
            console.log('Debt.final_total:', debt.final_total, typeof debt.final_total);
            console.log('Debt.remaining_amount:', debt.remaining_amount, typeof debt.remaining_amount);
            console.log('Debt.paid_amount:', debt.paid_amount, typeof debt.paid_amount);
            console.log('Debt.installments:', debt.installments);
            console.log('Debt.invoice_id:', debt.invoice_id);
            console.log('Debt.linked_invoices:', debt.linked_invoices);
            
            // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­ Ø¬Ø¯ÙŠØ¯: Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
            let totalAmount = 0;
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 1: Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© (Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰)
            if (debt.linked_invoices && Array.isArray(debt.linked_invoices) && debt.linked_invoices.length > 0) {
                console.log('ğŸ” Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©:', debt.linked_invoices);
                
                debt.linked_invoices.forEach(invoiceId => {
                    const relatedSale = salesData.find(s => s.invoice_id === invoiceId);
                    if (relatedSale && relatedSale.final_total) {
                        const invoiceTotal = parseFloat(relatedSale.final_total);
                        totalAmount += invoiceTotal;
                        console.log(`  âœ“ ÙØ§ØªÙˆØ±Ø© ${invoiceId}: ${invoiceTotal}`);
                    }
                });
                
                console.log('âœ“ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©:', totalAmount);
            }
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 2: Ù…Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙ‚Ø·
            else if (debt.invoice_id) {
                const relatedSale = salesData.find(s => s.invoice_id === debt.invoice_id);
                if (relatedSale && relatedSale.final_total) {
                    totalAmount = parseFloat(relatedSale.final_total);
                    console.log('âœ“ Got total from main invoice:', totalAmount);
                }
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 3: Ù…Ù† Ø­Ù‚Ù„ final_total ÙÙŠ Ø§Ù„Ø¯ÙŠÙ†
            if (!totalAmount && debt.final_total !== undefined && debt.final_total !== null) {
                totalAmount = parseFloat(debt.final_total);
                console.log('âœ“ Got total from debt.final_total:', totalAmount);
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 4: Ù…Ù† Ø­Ù‚Ù„ total_amount ÙÙŠ Ø§Ù„Ø¯ÙŠÙ†
            if (!totalAmount && debt.total_amount !== undefined && debt.total_amount !== null) {
                totalAmount = parseFloat(debt.total_amount);
                console.log('âœ“ Got total from debt.total_amount:', totalAmount);
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 5: Ù…Ù† Ø­Ù‚Ù„ remaining_amount (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø¯ÙÙˆØ¹ Ø´ÙŠØ¡)
            if (!totalAmount && debt.remaining_amount !== undefined && debt.remaining_amount !== null) {
                totalAmount = parseFloat(debt.remaining_amount);
                console.log('âœ“ Got total from debt.remaining_amount:', totalAmount);
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 6: Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            if (!totalAmount && debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                totalAmount = debt.installments.reduce((sum, inst) => sum + parseFloat(inst.amount || 0), 0);
                console.log('âœ“ Calculated total from installments:', totalAmount);
            }
            
            // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© 7: Ù…Ù† Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
            if (!totalAmount && debt.monthly_amount && debt.installment_months) {
                totalAmount = parseFloat(debt.monthly_amount) * parseInt(debt.installment_months);
                console.log('âœ“ Calculated total from monthly Ã— months:', totalAmount);
            }
            
            console.log('Final totalAmount:', totalAmount);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù† Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            let paidAmount = 0;
            let paidMonths = 0;
            
            console.log('=== Calculating Paid Amount ===');
            console.log('Installments array:', debt.installments);
            console.log('Is array?', Array.isArray(debt.installments));
            console.log('Length:', debt.installments?.length);
            
            if (debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                console.log('Calculating from installments:');
                debt.installments.forEach((inst, index) => {
                    console.log(`  Installment ${index + 1}:`, JSON.stringify(inst, null, 2));
                    console.log(`    Status: "${inst.status}" (type: ${typeof inst.status})`);
                    console.log(`    Paid amount: ${inst.paid_amount} (type: ${typeof inst.paid_amount})`);
                    console.log(`    Amount: ${inst.amount} (type: ${typeof inst.amount})`);
                    
                    if (inst.status === 'paid') {
                        const instAmount = parseFloat(inst.paid_amount || inst.amount || 0);
                        console.log(`    âœ“ PAID - Adding amount: ${instAmount}`);
                        paidAmount += instAmount;
                        paidMonths++;
                    } else {
                        console.log(`    âœ— NOT PAID - Status is "${inst.status}"`);
                    }
                });
            } else if (debt.paid_amount !== undefined && debt.paid_amount !== null) {
                paidAmount = parseFloat(debt.paid_amount) || 0;
                console.log('Using debt.paid_amount:', paidAmount);
            } else {
                console.log('âš ï¸ No installments found and no paid_amount field!');
            }
            
            console.log('=== Paid Amount Calculation Complete ===');
            console.log('Total Paid Amount:', paidAmount);
            console.log('Paid Months:', paidMonths);
            
            console.log('Final calculations:');
            console.log('  Total Amount:', totalAmount);
            console.log('  Paid Amount:', paidAmount);
            console.log('  Paid Months:', paidMonths);
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            totalAmount = parseFloat(totalAmount) || 0;
            paidAmount = parseFloat(paidAmount) || 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
            let remainingAmount = totalAmount - paidAmount;
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ø§ ÙŠÙƒÙˆÙ† Ø³Ø§Ù„Ø¨
            if (remainingAmount < 0) remainingAmount = 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù…Ø¹ Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ØµÙØ±
            let percentage = 0;
            if (totalAmount > 0 && !isNaN(totalAmount) && !isNaN(paidAmount)) {
                percentage = ((paidAmount / totalAmount) * 100).toFixed(1);
            }
            
            console.log('Summary Results:');
            console.log('  Total:', totalAmount);
            console.log('  Paid:', paidAmount);
            console.log('  Remaining:', remainingAmount);
            console.log('  Percentage:', percentage + '%');
            
            if (totalAmount === 0) {
                console.warn('âš ï¸ WARNING: Total amount is 0! This will cause display issues.');
                console.log('Debt object keys:', Object.keys(debt));
                console.log('All debt values:', debt);
            }
            
            console.log('==========================');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <div style="color: var(--theme-text-secondary); font-size: var(--font-size-base); margin-bottom: 5px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary-color);">${formatCurrency(totalAmount)}</div>
                    </div>
                    <div>
                        <div style="color: var(--theme-text-secondary); font-size: var(--font-size-base); margin-bottom: 5px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</div>
                        <div style="font-size: 24px; font-weight: bold; color: var(--success-color);">${formatCurrency(paidAmount)}</div>
                    </div>
                    <div>
                        <div style="color: var(--theme-text-secondary); font-size: var(--font-size-base); margin-bottom: 5px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                        <div style="font-size: 24px; font-weight: bold; color: var(--danger-color);">${formatCurrency(remainingAmount)}</div>
                    </div>
                    <div>
                        <div style="color: var(--theme-text-secondary); font-size: var(--font-size-base); margin-bottom: 5px;">Ù†Ø³Ø¨Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯</div>
                        <div style="font-size: 24px; font-weight: bold;">${percentage}%</div>
                        <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 10px; overflow: hidden;">
                            <div style="width: ${percentage}%; height: 100%; background: var(--success-gradient); transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        function renderDebtInvoiceDetails(relatedSale) {
            const container = document.getElementById('debtInvoiceDetails');
            if (!container) return;
            
            const debt = window.currentDebt;
            
            // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
            const invoiceIds = debt.linked_invoices || [debt.invoice_id];
            console.log('ğŸ“‹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©:', invoiceIds);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            const allInvoices = invoiceIds.map(invoiceId => {
                const sale = salesData.find(s => s.invoice_id === invoiceId);
                return sale;
            }).filter(sale => sale); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ§Ø±ØºØ©
            
            console.log('âœ… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§:', allInvoices.length);
            
            if (allInvoices.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--theme-text-secondary); padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø±ØªØ¨Ø·Ø©</p>';
                return;
            }
            
            // Ø¨Ù†Ø§Ø¡ HTML Ù„ÙƒÙ„ ÙØ§ØªÙˆØ±Ø©
            const invoicesHTML = allInvoices.map((sale, index) => {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† items Ù…ØµÙÙˆÙØ©
                let items = [];
                if (sale.items && Array.isArray(sale.items)) {
                    items = sale.items;
                } else if (typeof sale.items === 'string') {
                    try {
                        items = JSON.parse(sale.items);
                    } catch (e) {
                        items = [];
                    }
                }
                
                const itemsHTML = items.length > 0 ? items.map(item => {
                    const price = item.product_price || item.price || 0;
                    const quantity = item.quantity || 1;
                    const total = quantity * price;
                    return `
                    <tr>
                        <td>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-box"></i>
                                ${item.product_name || item.name || 'Ù…Ù†ØªØ¬'}
                            </div>
                        </td>
                        <td style="text-align: center;">${quantity}</td>
                        <td>${formatCurrency(price)}</td>
                        <td style="font-weight: bold; color: var(--primary-color);">${formatCurrency(total)}</td>
                    </tr>
                    `;
                }).join('') : '<tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
                
                const isFirst = index === 0;
                const badgeColor = isFirst ? 'var(--primary-color)' : 'var(--warning-color)';
                const badgeText = isFirst ? 'Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©' : `ÙØ§ØªÙˆØ±Ø© Ù…Ø¶Ø§ÙØ© #${index}`;
                
                return `
                <div class="invoice-card" style="background: var(--theme-bg-secondary); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid ${badgeColor};">
                    <!-- Ø´Ø§Ø±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div style="display: inline-block; background: ${badgeColor}; color: white; padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; margin-bottom: 15px;">
                        <i class="fas ${isFirst ? 'fa-file-invoice' : 'fa-plus-circle'}"></i>
                        ${badgeText}
                    </div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <div style="color: var(--theme-text-secondary); font-size: var(--font-size-sm);">
                                <i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                            </div>
                            <div style="font-size: var(--font-size-lg); font-weight: bold; margin-top: 5px; color: ${badgeColor};">
                                ${sale.invoice_id}
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--theme-text-secondary); font-size: var(--font-size-sm);">
                                <i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                            </div>
                            <div style="font-size: var(--font-size-base); font-weight: 600; margin-top: 5px;">
                                ${new Date(sale.timestamp).toLocaleDateString('ar-IQ', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                })}
                            </div>
                            <div style="font-size: var(--font-size-sm); color: var(--theme-text-secondary);">
                                ${new Date(sale.timestamp).toLocaleTimeString('ar-IQ')}
                            </div>
                        </div>
                        <div>
                            <div style="color: var(--theme-text-secondary); font-size: var(--font-size-sm);">
                                <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                            </div>
                            <div style="font-size: var(--font-size-base); font-weight: 500; margin-top: 5px;">
                                <i class="fas fa-calendar-alt"></i> ${sale.payment_type || 'Ø£Ù‚Ø³Ø§Ø·'}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                    <div class="table-container" style="margin-top: 15px;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th style="text-align: center;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHTML}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div style="margin-top: 15px; padding: 15px; background: var(--theme-bg-card); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--theme-text-secondary);">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                            <span style="font-weight: 600;">${formatCurrency(sale.subtotal || 0)}</span>
                        </div>
                        ${(sale.discount_amount || sale.discount) ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--success-color);">
                            <span>Ø§Ù„Ø®ØµÙ…:</span>
                            <span style="font-weight: 600;">-${formatCurrency(sale.discount_amount || sale.discount || 0)}</span>
                        </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--theme-text-secondary);">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                            <span style="font-weight: 600;">${formatCurrency(sale.tax_amount || sale.tax || 0)}</span>
                        </div>
                        ${sale.additional_amount ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--warning-color);">
                            <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ:</span>
                            <span style="font-weight: 600;">+${formatCurrency(sale.additional_amount)}</span>
                        </div>
                        ` : ''}
                        ${sale.down_payment ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; color: var(--success-color);">
                            <span>Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©:</span>
                            <span style="font-weight: 600;">${formatCurrency(sale.down_payment)}</span>
                        </div>
                        ` : ''}
                        ${sale.installment_months ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--theme-text-secondary);">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</span>
                            <span style="font-weight: 600;">${sale.installment_months} Ø´Ù‡Ø±</span>
                        </div>
                        ` : ''}
                        ${sale.monthly_amount ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--theme-text-secondary);">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ:</span>
                            <span style="font-weight: 600;">${formatCurrency(sale.monthly_amount)}</span>
                        </div>
                        ` : ''}
                        ${sale.start_date ? `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: var(--theme-text-secondary);">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:</span>
                            <span style="font-weight: 600;">${new Date(sale.start_date).toLocaleDateString('ar-IQ')}</span>
                        </div>
                        ` : ''}
                        ${sale.installment_details?.advanced_control_used || sale.installment_details?.custom_values_used ? `
                        <div style="display: flex; align-items: center; gap: 8px; margin-top: 12px; padding: 10px; background: rgba(139, 92, 246, 0.1); border-radius: 6px; border: 1px solid rgba(139, 92, 246, 0.3);">
                            <i class="fas fa-cog" style="color: #8b5cf6;"></i>
                            <span style="color: #8b5cf6; font-weight: 600; font-size: 0.9rem;">ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</span>
                        </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 2px solid ${badgeColor}; font-size: var(--font-size-lg); font-weight: bold; color: ${badgeColor};">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span>${formatCurrency(sale.final_total || 0)}</span>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            const grandTotal = allInvoices.reduce((sum, sale) => sum + (parseFloat(sale.final_total) || 0), 0);
            
            container.innerHTML = `
                <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù… -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                    <h3 style="margin: 0; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-file-invoice-dollar" style="color: var(--primary-color);"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                        <span style="background: var(--primary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">
                            ${allInvoices.length} ${allInvoices.length === 1 ? 'ÙØ§ØªÙˆØ±Ø©' : 'ÙÙˆØ§ØªÙŠØ±'}
                        </span>
                    </h3>
                </div>
                
                <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
                ${invoicesHTML}
                
                <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† ÙØ§ØªÙˆØ±Ø©) -->
                ${allInvoices.length > 1 ? `
                <div style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); padding: 20px; border-radius: 12px; color: white; margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: var(--font-size-sm); opacity: 0.9; margin-bottom: 5px;">
                                <i class="fas fa-calculator"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                            </div>
                            <div style="font-size: var(--font-size-3xl); font-weight: bold;">
                                ${formatCurrency(grandTotal)}
                            </div>
                        </div>
                        <div style="font-size: 3rem; opacity: 0.3;">
                            <i class="fas fa-receipt"></i>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        function renderInstallmentsTable(debt, relatedSale) {
            const tbody = document.getElementById('installmentsTableBody');
            if (!tbody) {
                console.error('âŒ installmentsTableBody not found!');
                return;
            }
            
            console.log('=== Rendering Installments Table ===');
            console.log('Debt:', debt);
            console.log('Related Sale:', relatedSale);
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±
            const months = parseInt(debt.installment_months || relatedSale?.installment_months || 12);
            console.log('Total months:', months);
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            let monthlyAmount = parseFloat(debt.monthly_amount || relatedSale?.monthly_amount || 0);
            console.log('Monthly amount from debt:', monthlyAmount);
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            let totalAmount = parseFloat(debt.total_amount || debt.final_total || relatedSale?.final_total || debt.remaining_amount || 0);
            console.log('Total amount:', totalAmount);
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† monthlyAmount ÙŠØ³Ø§ÙˆÙŠ 0ØŒ Ø§Ø­Ø³Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if (monthlyAmount === 0 && totalAmount > 0 && months > 0) {
                monthlyAmount = totalAmount / months;
                console.log('Calculated monthly amount:', monthlyAmount);
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† totalAmount ÙŠØ³Ø§ÙˆÙŠ 0ØŒ Ø§Ø­Ø³Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
            if (totalAmount === 0 && monthlyAmount > 0 && months > 0) {
                totalAmount = monthlyAmount * months;
                console.log('Calculated total amount:', totalAmount);
            }
            
            console.log('Final values - Months:', months, 'Monthly:', monthlyAmount, 'Total:', totalAmount);
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§
            let installments = [];
            
            if (debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                installments = debt.installments;
                console.log('âœ“ Using existing installments:', installments);
            } else {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
                console.log('Creating new installments array');
                const startDate = new Date(debt.timestamp || relatedSale?.timestamp || Date.now());
                
                for (let i = 0; i < months; i++) {
                    const dueDate = new Date(startDate);
                    dueDate.setMonth(dueDate.getMonth() + i + 1);
                    
                    installments.push({
                        month: i + 1,
                        due_date: dueDate.toISOString(),
                        amount: monthlyAmount,
                        status: 'pending',
                        paid_date: null,
                        paid_amount: 0
                    });
                }
                console.log('âœ“ Created installments:', installments);
            }
            
            if (installments.length === 0) {
                console.warn('âš ï¸ No installments to display!');
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ø·</td></tr>';
                return;
            }
            
            const now = new Date();
            tbody.innerHTML = installments.map((inst, index) => {
                const dueDate = new Date(inst.due_date);
                const isPaid = inst.status === 'paid';
                const isOverdue = dueDate < now && !isPaid;
                
                const amount = parseFloat(inst.amount || monthlyAmount || 0);
                const paidAmount = parseFloat(inst.paid_amount || 0);
                
                console.log(`Installment ${inst.month}:`, {
                    amount,
                    paidAmount,
                    status: inst.status,
                    isPaid,
                    isOverdue
                });
                
                let statusClass = 'installment-status pending';
                let statusText = 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                let statusIcon = 'clock';
                
                if (isPaid) {
                    statusClass = 'installment-status paid';
                    statusText = 'Ù…Ø³Ø¯Ø¯';
                    statusIcon = 'check-circle';
                } else if (isOverdue) {
                    statusClass = 'installment-status overdue';
                    statusText = 'Ù…ØªØ£Ø®Ø±';
                    statusIcon = 'exclamation-triangle';
                }
                
                return `
                    <tr>
                        <td><strong>Ø§Ù„Ø´Ù‡Ø± ${inst.month}</strong></td>
                        <td>${dueDate.toLocaleDateString('ar-IQ')}</td>
                        <td style="font-weight: bold; color: var(--primary-color);">${formatCurrency(amount)}</td>
                        <td>
                            <span class="${statusClass}">
                                <i class="fas fa-${statusIcon}"></i> ${statusText}
                            </span>
                        </td>
                        <td>${inst.paid_date ? new Date(inst.paid_date).toLocaleDateString('ar-IQ') : '-'}</td>
                        <td>
                            ${!isPaid ? `
                                <button class="payment-btn" onclick="payInstallment('${debt.id || debt.__backendId}', ${inst.month})">
                                    <i class="fas fa-money-check-alt"></i> ØªØ³Ø¯ÙŠØ¯
                                </button>
                            ` : `
                                <span style="color: var(--success-color); font-weight: bold;">
                                    <i class="fas fa-check-double"></i> Ù…Ø³Ø¯Ø¯
                                </span>
                            `}
                        </td>
                    </tr>
                `;
            }).join('');
            
            console.log('âœ… Installments table rendered successfully');
            console.log('=====================================');
        }
        
        // Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
        function renderPaymentsHistory(debt) {
            const tbody = document.getElementById('paymentsHistoryBody');
            if (!tbody) return;
            
            const payments = debt.payments || [];
            
            if (payments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</td></tr>';
                return;
            }
            
            tbody.innerHTML = payments.map(payment => `
                <tr>
                    <td>${new Date(payment.date).toLocaleString('ar-IQ')}</td>
                    <td style="font-weight: bold; color: var(--success-color);">${formatCurrency(payment.amount)}</td>
                    <td><strong>Ø§Ù„Ø´Ù‡Ø± ${payment.month}</strong></td>
                    <td>${payment.notes || '-'}</td>
                </tr>
            `).join('');
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø· Ø´Ù‡Ø±ÙŠ
        function payInstallment(debtId, monthNumber) {
            const debt = debtsData.find(d => 
                d.id == debtId || 
                d.__backendId == debtId || 
                d.debt_id == debtId
            );
            
            if (!debt) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
            const relatedSale = salesData.find(s => s.invoice_id === debt.invoice_id);
            
            if (!debt.installments || debt.installments.length === 0) {
                const months = debt.installment_months || relatedSale?.installment_months || 12;
                let monthlyAmount = parseFloat(debt.monthly_amount || relatedSale?.monthly_amount || 0);
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† monthlyAmount ÙŠØ³Ø§ÙˆÙŠ 0ØŒ Ø§Ø­Ø³Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                if (monthlyAmount === 0) {
                    const totalAmount = parseFloat(debt.total_amount || debt.final_total || debt.remaining_amount || relatedSale?.final_total || 0);
                    monthlyAmount = totalAmount / months;
                }
                
                console.log('Creating installments - Months:', months, 'Monthly Amount:', monthlyAmount);
                
                debt.installments = [];
                const startDate = new Date(debt.timestamp || relatedSale?.timestamp || Date.now());
                for (let i = 0; i < months; i++) {
                    const dueDate = new Date(startDate);
                    dueDate.setMonth(dueDate.getMonth() + i + 1);
                    
                    debt.installments.push({
                        month: i + 1,
                        due_date: dueDate.toISOString(),
                        amount: monthlyAmount,
                        status: 'pending',
                        paid_date: null,
                        paid_amount: 0
                    });
                }
                
                console.log('âœ… Created installments:', debt.installments);
            }
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø·
            const installment = debt.installments.find(inst => inst.month === monthNumber);
            if (!installment) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            if (installment.status === 'paid') {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            console.log('Installment to pay:', installment);
            console.log('Installment amount:', installment.amount);
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentInstallmentDebtId = debtId;
            currentInstallmentMonth = monthNumber;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù…Ø¹ fallback options
            let monthlyAmount = parseFloat(installment.amount) || 0;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¨Ù„Øº 0ØŒ Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ø£Ø®Ø±Ù‰
            if (monthlyAmount === 0) {
                monthlyAmount = parseFloat(debt.monthly_amount) || 0;
                console.log('Got amount from debt.monthly_amount:', monthlyAmount);
            }
            
            // Ø¥Ø°Ø§ Ù„Ø§ ÙŠØ²Ø§Ù„ 0ØŒ Ø§Ø­Ø³Ø¨Ù‡ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            if (monthlyAmount === 0) {
                const totalAmount = parseFloat(debt.total_amount || debt.final_total) || 0;
                const months = parseInt(debt.installment_months) || debt.installments.length || 1;
                monthlyAmount = totalAmount / months;
                console.log('Calculated from total:', totalAmount, '/', months, '=', monthlyAmount);
            }
            
            console.log('Final monthly amount:', monthlyAmount);
            
            // Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            document.getElementById('installmentMonthDisplay').value = `Ø§Ù„Ø´Ù‡Ø± ${monthNumber}`;
            const amountValue = Math.round(monthlyAmount); // ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØµØ­ÙŠØ­
            const amountInput = document.getElementById('installmentAmountInput');
            amountInput.value = amountValue;
            document.getElementById('installmentNotes').value = '';
            
            console.log('âœ… Amount field filled with:', amountValue);
            
            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            showModal('payInstallmentModal');
            
            // ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            setTimeout(() => {
                if (amountInput) {
                    amountInput.focus();
                    amountInput.select(); // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙˆÙ‚Ù‡
                }
            }, 300);
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
        async function handlePayInstallment(event) {
            event.preventDefault();
            
            const paidAmountInput = document.getElementById('installmentAmountInput').value;
            const paidAmount = parseFloat(paidAmountInput) || 0;
            const notes = document.getElementById('installmentNotes').value.trim();
            
            if (paidAmount <= 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const debt = debtsData.find(d => 
                d.id == currentInstallmentDebtId || 
                d.__backendId == currentInstallmentDebtId || 
                d.debt_id == currentInstallmentDebtId
            );
            
            if (!debt) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø·
            const installment = debt.installments.find(inst => inst.month === currentInstallmentMonth);
            if (!installment) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø³Ø· Ø¨Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„
            installment.status = 'paid';
            installment.paid_date = new Date().toISOString();
            installment.paid_amount = paidAmount;
            
            console.log('=== Processing Installment Payment ===');
            console.log('Month:', currentInstallmentMonth);
            console.log('Original amount:', installment.amount);
            console.log('Paid amount:', paidAmount);
            console.log('Notes:', notes);
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ù„Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
            if (!debt.payments) {
                debt.payments = [];
            }
            
            debt.payments.push({
                date: new Date().toISOString(),
                amount: paidAmount,
                month: currentInstallmentMonth,
                notes: notes || `ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø±Ù‚Ù… ${currentInstallmentMonth}`
            });
            
            console.log('Payment record added:', debt.payments[debt.payments.length - 1]);
            console.log('Payment record added:', debt.payments[debt.payments.length - 1]);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
            const totalAmount = debt.total_amount || debt.final_total || 0;
            const currentPaid = debt.paid_amount || 0;
            debt.paid_amount = currentPaid + paidAmount;
            
            const currentRemaining = debt.remaining_amount !== undefined ? debt.remaining_amount : totalAmount;
            debt.remaining_amount = currentRemaining - paidAmount;
            if (debt.remaining_amount < 0) debt.remaining_amount = 0;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ø°Ø§ ØªÙ… Ø³Ø¯Ø§Ø¯ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
            const allPaid = debt.installments.every(inst => inst.status === 'paid');
            if (allPaid) {
                debt.status = 'Ù…Ø³Ø¯Ø¯';
            }
            
            console.log('Payment processed - Paid:', debt.paid_amount, 'Remaining:', debt.remaining_amount);
            
            // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (window.dataSdk && debt.id) {
                const updateData = {
                    installments: debt.installments,
                    payments: debt.payments,
                    remaining_amount: debt.remaining_amount,
                    paid_amount: debt.paid_amount,
                    total_amount: totalAmount,
                    status: debt.status
                };
                
                console.log('=== Saving to database ===');
                console.log('Debt ID:', debt.id);
                console.log('Update data:', JSON.stringify(updateData, null, 2));
                
                await window.dataSdk.update(debt.id, updateData);
                console.log('âœ… Successfully saved to database');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const allData = await window.dataSdk.query();
                if (allData.isOk) {
                    debtsData = allData.data.filter(item => item.type === 'debt');
                    updateStatistics();
                    updateQuickStats();
                }
            }
            
            // âœ… Ø·Ø¨Ø§Ø¹Ø© Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø· ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø¯ÙØ¹ Ù‚Ø³Ø· (ÙˆÙ„ÙŠØ³ Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø§Ù‚Ø³Ø§Ø·)
            try {
                let storeSettings = {};
                try {
                    storeSettings = JSON.parse(localStorage.getItem('storeSettings') || '{}');
                } catch {}
                const receiptHtml = generateInstallmentPaymentReceipt({
                    debt,
                    paidInstallment: installment,
                    storeSettings
                });
                const printHtml = `<!DOCTYPE html><html dir="rtl" lang="ar"><head><meta charset="UTF-8"><title>Ø¥ÙŠØµØ§Ù„ ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø·</title><link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet"><style>@media print { body { margin: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; } }</style></head><body>${receiptHtml}</body></html>`;
                if (window.electronAPI && window.electronAPI.printInvoiceHtml) {
                    await window.electronAPI.printInvoiceHtml(printHtml, {silent:true, pageSize:'A4', printBackground:true, margins: { top: 10, bottom: 10, left: 10, right: 10 }});
                } else {
                    const win = window.open('', '_blank');
                    win.document.write(printHtml);
                    win.print();
                }
            } catch (err) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯:', err);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
            closeModal('payInstallmentModal');
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            showDebtDetails(currentInstallmentDebtId);
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ³Ø¯ÙŠØ¯ Ø³Ø±ÙŠØ¹ Ù…Ù† ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†
        function showQuickPayModal(debtId) {
            const debt = debtsData.find(d => 
                d.id == debtId || 
                d.__backendId == debtId || 
                d.debt_id == debtId
            );
            
            if (!debt) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ù‚Ø³Ø· ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹
            let nextUnpaidInstallment = null;
            let nextUnpaidMonth = null;
            
            if (debt.installments && Array.isArray(debt.installments) && debt.installments.length > 0) {
                for (let inst of debt.installments) {
                    if (inst.status !== 'paid') {
                        nextUnpaidInstallment = inst;
                        nextUnpaidMonth = inst.month;
                        break;
                    }
                }
            }
            
            if (!nextUnpaidInstallment) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ù„Ù„Ù‚Ø³Ø· ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹
            payInstallment(debtId, nextUnpaidMonth);
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†
        function confirmDeleteDebt(debtId, customerName) {
            // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙŠÙ†
            debtToDelete = debtId;
            
            // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById('deleteDebtCustomerName').textContent = customerName;
            
            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯
            showModal('confirmDeleteModal');
        }
        
        // ØªÙ†ÙÙŠØ° Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯
        function executeDeleteDebt() {
            if (debtToDelete) {
                closeModal('confirmDeleteModal');
                deleteDebt(debtToDelete);
                debtToDelete = null;
            }
        }
        
        // Ø­Ø°Ù Ø§Ù„Ø¯ÙŠÙ†
        async function deleteDebt(debtId) {
            try {
                const debt = debtsData.find(d => 
                    d.id == debtId || 
                    d.__backendId == debtId || 
                    d.debt_id == debtId
                );
                
                if (!debt) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }
                
                // Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (window.dataSdk && (debt.id || debt.__backendId)) {
                    const deleteId = debt.id || debt.__backendId;
                    const result = await window.dataSdk.delete(deleteId);
                    
                    if (result.isOk) {
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        const allData = await window.dataSdk.query();
                        if (allData.isOk) {
                            debtsData = allData.data.filter(item => item.type === 'debt');
                            
                            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                            renderDebtsTable();
                            updateStatistics();
                            updateQuickStats();
                            
                            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        }
                    } else {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    }
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            } catch (error) {
                console.error('Error deleting debt:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ ÙÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
        function filterPOSProducts() {
            renderProducts();
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        function filterInvoices() {
            renderInvoicesTable();
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function filterProducts() {
            renderProductsTable();
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        function filterInventory() {
            renderInventoryTable();
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ†
        function filterDebts() {
            renderDebtsTable();
        }
        
        // âœ… Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¥ÙŠØµØ§Ù„ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
        function showTodaySalesReport() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
            const todaySales = salesData.filter(sale => {
                const saleDate = sale.timestamp || sale.created_at || sale.date;
                if (!saleDate) return false;
                const saleDateStr = new Date(saleDate).toISOString().split('T')[0];
                return saleDateStr === todayStr;
            });
            
            // Ø­Ø³Ø§Ø¨ Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠ ÙˆØ£Ù‚Ø³Ø§Ø·
            let cashTotal = 0;
            let installmentTotal = 0;
            let cashCount = 0;
            let installmentCount = 0;
            
            todaySales.forEach(sale => {
                const total = sale.final_total || sale.total || 0;
                if (sale.payment_method === 'Ù†Ù‚Ø¯ÙŠ' || sale.payment_type === 'Ù†Ù‚Ø¯ÙŠ') {
                    cashTotal += total;
                    cashCount++;
                } else if (sale.payment_method === 'Ø£Ù‚Ø³Ø§Ø·' || sale.payment_type === 'Ø£Ù‚Ø³Ø§Ø·') {
                    installmentTotal += total;
                    installmentCount++;
                }
            });
            
            const grandTotal = cashTotal + installmentTotal;
            
            // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„Ø¥ÙŠØµØ§Ù„
            const dateStr = toEnglishDigits(today.toLocaleDateString('ar-IQ'));
            const timeStr = toEnglishDigits(today.toLocaleTimeString('ar-IQ', { hour: '2-digit', minute: '2-digit' }));
            const dayName = today.toLocaleDateString('ar-IQ', { weekday: 'long' });
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
            const savedSettings = localStorage.getItem('storeSettings');
            let storeName = 'Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨';
            let storeAddress = 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ©';
            let storePhone = '07803092185';
            
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                storeName = settings.storeName || storeName;
                storeAddress = settings.storeAddress || storeAddress;
                storePhone = settings.storePhone || storePhone;
            }
            
            const html = `<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥ÙŠØµØ§Ù„ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
    font-family: 'Cairo', sans-serif; 
    font-size: 11px; 
    line-height: 1.3;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
}
.page { 
    width: 210mm; 
    max-width: 100%; 
    margin: 0; 
    padding: 8mm;
    page-break-after: always;
    background: #fff;
}
.header { 
    text-align: center; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    color: #fff; 
    padding: 12px; 
    border-radius: 8px;
    margin-bottom: 10px;
}
.header h1 { font-size: 20px; margin-bottom: 5px; }
.header .info { font-size: 10px; }
.date-info { 
    background: #f8f9fa; 
    padding: 10px; 
    border-radius: 6px; 
    margin-bottom: 10px;
    text-align: center;
    border: 2px solid #dee2e6;
}
.date-info .day { font-size: 14px; font-weight: 700; color: #667eea; margin-bottom: 3px; }
.date-info .date { font-size: 12px; color: #6c757d; }
.sales-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 10px; 
    margin-bottom: 10px; 
}
.sales-card { 
    padding: 12px; 
    border-radius: 8px; 
    text-align: center; 
    border: 2px solid;
}
.sales-card.cash { 
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); 
    border-color: #11998e;
    color: #fff;
}
.sales-card.installment { 
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
    border-color: #f093fb;
    color: #fff;
}
.sales-card .label { font-size: 10px; opacity: 0.9; margin-bottom: 5px; }
.sales-card .amount { font-size: 18px; font-weight: 900; margin-bottom: 3px; }
.sales-card .count { font-size: 9px; opacity: 0.85; }
.total-box { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
    color: #fff; 
    padding: 15px; 
    border-radius: 8px;
    text-align: center;
    margin-bottom: 10px;
}
.total-box .label { font-size: 12px; opacity: 0.9; margin-bottom: 5px; }
.total-box .amount { font-size: 24px; font-weight: 900; }
.footer { 
    text-align: center; 
    background: #f8f9fa; 
    padding: 10px; 
    border-radius: 6px;
    border: 2px solid #dee2e6;
    font-size: 9px;
    color: #6c757d;
}
@media print {
    body { margin: 0; }
    .page { margin: 0; padding: 8mm; }
}
</style>
</head>
<body>
<div class="page">
    <div class="header">
        <h1>ğŸ“Š Ø¥ÙŠØµØ§Ù„ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h1>
        <div class="info"><strong>${storeName}</strong> â€¢ ${storeAddress} â€¢ ${storePhone}</div>
    </div>
    
    <div class="date-info">
        <div class="day">${dayName}</div>
        <div class="date">${dateStr} - ${timeStr}</div>
    </div>
    
    <div class="sales-grid">
        <div class="sales-card cash">
            <div class="label">ğŸ’µ Ù…Ø¨ÙŠØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠ</div>
            <div class="amount">${toEnglishDigits(cashTotal.toLocaleString('en'))}</div>
            <div class="count">${toEnglishDigits(cashCount)} Ø¹Ù…Ù„ÙŠØ©</div>
        </div>
        
        <div class="sales-card installment">
            <div class="label">ğŸ“… Ù…Ø¨ÙŠØ¹Ø§Øª Ø£Ù‚Ø³Ø§Ø·</div>
            <div class="amount">${toEnglishDigits(installmentTotal.toLocaleString('en'))}</div>
            <div class="count">${toEnglishDigits(installmentCount)} Ø¹Ù…Ù„ÙŠØ©</div>
        </div>
    </div>
    
    <div class="total-box">
        <div class="label">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ ÙÙŠ Ø§Ù„ÙƒØ§Ø´ÙŠØ±</div>
        <div class="amount">${toEnglishDigits(grandTotal.toLocaleString('en'))} Ø¯.Ø¹</div>
    </div>
    
    <div class="footer">
        <div style="font-weight:700;margin-bottom:3px;">Ù†Ø¸Ø§Ù… ÙƒØ§Ø´ Ø¨Ø±Ùˆ - Digital Creativity</div>
        <div>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ: ${dateStr} - ${timeStr}</div>
    </div>
</div>
</body>
</html>`;
            
            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(html);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.print();
                }, 500);
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }
        
        function showPayDebtModal(debtId) {
            console.log('Show pay debt modal:', debtId);
        }

        function handlePayDebt(event) {
            event.preventDefault();
            console.log('Handle pay debt');
        }

        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©
        function showSettingsPage(pageName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = ''; // Ø¥Ø²Ø§Ù„Ø© inline style
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const targetPage = document.getElementById(`settings-${pageName}`);
            if (targetPage) {
                targetPage.style.display = ''; // Ø¥Ø²Ø§Ù„Ø© inline style
                targetPage.classList.add('active');
                setTimeout(() => {
                    targetPage.classList.add('animate__animated', 'animate__fadeIn');
                }, 10);
            }
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
        function saveStoreSettings() {
            const storeSettings = {
                storeName: document.getElementById('settingsStoreName')?.value || '',
                ownerName: document.getElementById('settingsOwnerName')?.value || '',
                commercialReg: document.getElementById('settingsCommercialReg')?.value || '',
                taxNumber: document.getElementById('settingsTaxNumber')?.value || '',
                address: document.getElementById('settingsStoreAddress')?.value || '',
                phone1: document.getElementById('settingsStorePhone1')?.value || '',
                phone2: document.getElementById('settingsStorePhone2')?.value || '',
                email: document.getElementById('settingsStoreEmail')?.value || '',
                whatsapp: document.getElementById('settingsWhatsapp')?.value || '',
                website: document.getElementById('settingsWebsite')?.value || '',
                taxRate: parseFloat(document.getElementById('settingsTaxRate')?.value) || 0,
                currency: document.getElementById('settingsDefaultCurrency')?.value || 'IQD',
                minDebtAmount: parseFloat(document.getElementById('settingsMinDebtAmount')?.value) || 0,
                openTime: document.getElementById('settingsOpenTime')?.value || '09:00',
                closeTime: document.getElementById('settingsCloseTime')?.value || '22:00',
                closedFriday: document.getElementById('closedFriday')?.checked || false,
                closedSaturday: document.getElementById('closedSaturday')?.checked || false
            };

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±
            const logoInput = document.getElementById('settingsStoreLogo');
            if (logoInput && logoInput.files && logoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    storeSettings.logo = e.target.result;
                    localStorage.setItem('storeSettings', JSON.stringify(storeSettings));
                    applyStoreSettings(storeSettings);
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                };
                reader.readAsDataURL(logoInput.files[0]);
            } else {
                const savedSettings = JSON.parse(localStorage.getItem('storeSettings') || '{}');
                if (savedSettings.logo) {
                    storeSettings.logo = savedSettings.logo;
                }
                localStorage.setItem('storeSettings', JSON.stringify(storeSettings));
                applyStoreSettings(storeSettings);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function applyStoreSettings(settings) {
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù…Ø§ÙƒÙ†
            document.querySelectorAll('.store-name-display').forEach(el => {
                el.textContent = settings.storeName || 'Ø§Ù„Ù…ØªØ¬Ø±';
            });
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø´Ø¹Ø§Ø±
            if (settings.logo) {
                document.querySelectorAll('.store-logo').forEach(img => {
                    img.src = settings.logo;
                });
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            window.currentCurrency = settings.currency || 'IQD';
            
            // ØªØ·Ø¨ÙŠÙ‚ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
            window.defaultTaxRate = settings.taxRate || 0;
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¯ÙŠÙ†
            window.minDebtAmount = settings.minDebtAmount || 0;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
        function loadStoreSettings() {
            const savedSettings = localStorage.getItem('storeSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                if (document.getElementById('settingsStoreName')) document.getElementById('settingsStoreName').value = settings.storeName || '';
                if (document.getElementById('settingsOwnerName')) document.getElementById('settingsOwnerName').value = settings.ownerName || '';
                if (document.getElementById('settingsCommercialReg')) document.getElementById('settingsCommercialReg').value = settings.commercialReg || '';
                if (document.getElementById('settingsTaxNumber')) document.getElementById('settingsTaxNumber').value = settings.taxNumber || '';
                if (document.getElementById('settingsStoreAddress')) document.getElementById('settingsStoreAddress').value = settings.address || '';
                if (document.getElementById('settingsStorePhone1')) document.getElementById('settingsStorePhone1').value = settings.phone1 || '';
                if (document.getElementById('settingsStorePhone2')) document.getElementById('settingsStorePhone2').value = settings.phone2 || '';
                if (document.getElementById('settingsStoreEmail')) document.getElementById('settingsStoreEmail').value = settings.email || '';
                if (document.getElementById('settingsWhatsapp')) document.getElementById('settingsWhatsapp').value = settings.whatsapp || '';
                if (document.getElementById('settingsWebsite')) document.getElementById('settingsWebsite').value = settings.website || '';
                if (document.getElementById('settingsTaxRate')) document.getElementById('settingsTaxRate').value = settings.taxRate || 0;
                if (document.getElementById('settingsDefaultCurrency')) document.getElementById('settingsDefaultCurrency').value = settings.currency || 'IQD';
                if (document.getElementById('settingsMinDebtAmount')) document.getElementById('settingsMinDebtAmount').value = settings.minDebtAmount || 0;
                if (document.getElementById('settingsOpenTime')) document.getElementById('settingsOpenTime').value = settings.openTime || '09:00';
                if (document.getElementById('settingsCloseTime')) document.getElementById('settingsCloseTime').value = settings.closeTime || '22:00';
                if (document.getElementById('closedFriday')) document.getElementById('closedFriday').checked = settings.closedFriday || false;
                if (document.getElementById('closedSaturday')) document.getElementById('closedSaturday').checked = settings.closedSaturday || false;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                applyStoreSettings(settings);
            }
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function saveSystemSettings() {
            const systemSettings = {
                theme: document.getElementById('themeSelect')?.value || 'dark',
                colorScheme: document.getElementById('colorSchemeSelect')?.value || 'default',
                fontSize: document.getElementById('fontSizeSelect')?.value || 'medium',
                compactMode: document.getElementById('compactModeCheck')?.checked || false,
                language: document.getElementById('languageSelect')?.value || 'ar',
                dateFormat: document.getElementById('dateFormatSelect')?.value || 'DD/MM/YYYY',
                timeFormat: document.getElementById('timeFormatSelect')?.value || '12',
                itemsPerPage: document.getElementById('itemsPerPageSelect')?.value || 25,
                animations: document.getElementById('animationsCheck')?.checked !== false,
                autosave: document.getElementById('autosaveCheck')?.checked !== false,
                barcodeSound: document.getElementById('barcodeSound')?.checked !== false,
                autoPrint: document.getElementById('autoPrint')?.checked || false,
                clearCartAfterSale: document.getElementById('clearCartAfterSale')?.checked !== false
            };

            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙˆØ±Ø§Ù‹
            applySystemSettings(systemSettings);
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function applySystemSettings(settings) {
            console.log('âš™ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:', settings);
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ…
            applyTheme(settings.theme || 'dark');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            if (settings.colorScheme) {
                const colors = colorSchemes[settings.colorScheme] || colorSchemes.default;
                applyCustomColors(colors);
            } else {
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØµØµØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                const savedColors = localStorage.getItem('customColors');
                if (savedColors) {
                    applyCustomColors(JSON.parse(savedColors));
                }
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
            applyFontSize(settings.fontSize || 'medium');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ©
            applyLanguage(settings.language || 'ar');
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¶ØºÙˆØ·
            if (settings.compactMode) {
                document.body.classList.add('compact-mode');
                console.log('ğŸ“¦ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¶ØºÙˆØ·');
            } else {
                document.body.classList.remove('compact-mode');
                console.log('ğŸ“¦ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¶ØºÙˆØ·');
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
            if (!settings.animations) {
                document.body.classList.add('no-animations');
                console.log('ğŸ¬ ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©');
            } else {
                document.body.classList.remove('no-animations');
                console.log('ğŸ¬ ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©');
            }
            
            console.log('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ…
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('currentTheme', theme);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠØ©
            const animatedBg = document.querySelector('.animated-bg');
            if (animatedBg) {
                if (theme === 'light') {
                    animatedBg.style.background = 'var(--theme-bg-primary)';
                } else {
                    animatedBg.style.background = 'var(--theme-bg-primary)';
                }
            }
            
            console.log('ğŸ¨ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ…:', theme);
        }

        // ÙˆØ¸ÙŠÙØ© ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        function changeTheme(theme) {
            applyTheme(theme);
            
            const themeNames = {
                'dark': 'ğŸŒ™ Ø§Ù„Ø¯Ø§ÙƒÙ† Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ',
                'light': 'â˜€ï¸ Ø§Ù„ÙØ§ØªØ­ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ',
                'blue-dark': 'ğŸ”µ Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ø¯Ø§ÙƒÙ†',
                'green-dark': 'ğŸ’š Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø¯Ø§ÙƒÙ†',
                'orange-dark': 'ğŸ§¡ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø§ÙƒÙ†',
                'purple-dark': 'ğŸ’œ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ Ø§Ù„Ø¯Ø§ÙƒÙ†',
                'red-dark': 'â¤ï¸ Ø§Ù„Ø£Ø­Ù…Ø± Ø§Ù„Ø¯Ø§ÙƒÙ†',
                'cyan-light': 'ğŸ©µ Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ Ø§Ù„ÙØ§ØªØ­',
                'gold-light': 'ğŸŸ¡ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„ÙØ§ØªØ­',
                'pink-light': 'ğŸŒ¸ Ø§Ù„ÙˆØ±Ø¯ÙŠ Ø§Ù„ÙØ§ØªØ­',
                'olive': 'ğŸŸ¢ Ø§Ù„Ø²ÙŠØªÙˆÙ†ÙŠ',
                'royal-blue': 'ğŸ”´ Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„Ù…Ù„ÙƒÙŠ'
            };
            
            const themeName = themeNames[theme] || theme;
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¨ÙŠÙ† Ø§Ù„Ø«ÙŠÙ…Ø§Øª
        function toggleThemeQuick() {
            const themes = [
                'dark', 'light', 'blue-dark', 'green-dark', 'orange-dark', 
                'purple-dark', 'red-dark', 'cyan-light', 'gold-light', 
                'pink-light', 'olive', 'royal-blue'
            ];
            
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            const nextTheme = themes[nextIndex];
            
            changeTheme(nextTheme);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = nextTheme;
            }
        }

        // Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
        const colorSchemes = {
            default: {
                primary: '#6366f1',
                secondary: '#8b5cf6',
                success: '#10b981',
                warning: '#f59e0b',
                danger: '#ef4444',
                info: '#3b82f6'
            },
            blue: {
                primary: '#3b82f6',
                secondary: '#2563eb',
                success: '#10b981',
                warning: '#f59e0b',
                danger: '#ef4444',
                info: '#0ea5e9'
            },
            green: {
                primary: '#10b981',
                secondary: '#059669',
                success: '#22c55e',
                warning: '#f59e0b',
                danger: '#ef4444',
                info: '#3b82f6'
            },
            orange: {
                primary: '#f97316',
                secondary: '#ea580c',
                success: '#10b981',
                warning: '#fb923c',
                danger: '#ef4444',
                info: '#3b82f6'
            },
            red: {
                primary: '#ef4444',
                secondary: '#dc2626',
                success: '#10b981',
                warning: '#f59e0b',
                danger: '#f87171',
                info: '#3b82f6'
            },
            purple: {
                primary: '#a855f7',
                secondary: '#9333ea',
                success: '#10b981',
                warning: '#f59e0b',
                danger: '#ef4444',
                info: '#3b82f6'
            },
            cyan: {
                primary: '#06b6d4',
                secondary: '#0891b2',
                success: '#10b981',
                warning: '#f59e0b',
                danger: '#ef4444',
                info: '#0ea5e9'
            },
            amber: {
                primary: '#f59e0b',
                secondary: '#d97706',
                success: '#10b981',
                warning: '#fbbf24',
                danger: '#ef4444',
                info: '#3b82f6'
            },
            teal: {
                primary: '#14b8a6',
                secondary: '#0d9488',
                success: '#10b981',
                warning: '#f59e0b',
                danger: '#ef4444',
                info: '#3b82f6'
            }
        };

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        function previewColorScheme(scheme) {
            const colors = colorSchemes[scheme] || colorSchemes.default;
            applyCustomColors(colors);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØµØµØ©
        function applyCustomColors(colors) {
            const root = document.documentElement;
            
            root.style.setProperty('--primary-color', colors.primary);
            root.style.setProperty('--secondary-color', colors.secondary);
            root.style.setProperty('--success-color', colors.success);
            root.style.setProperty('--warning-color', colors.warning);
            root.style.setProperty('--danger-color', colors.danger);
            root.style.setProperty('--info-color', colors.info);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª
            root.style.setProperty('--primary-gradient', `linear-gradient(135deg, ${colors.primary} 0%, ${colors.secondary} 100%)`);
            root.style.setProperty('--success-gradient', `linear-gradient(135deg, ${colors.success} 0%, ${adjustColor(colors.success, -20)} 100%)`);
            root.style.setProperty('--warning-gradient', `linear-gradient(135deg, ${colors.warning} 0%, ${adjustColor(colors.warning, -20)} 100%)`);
            root.style.setProperty('--danger-gradient', `linear-gradient(135deg, ${colors.danger} 0%, ${adjustColor(colors.danger, -20)} 100%)`);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            updateColorInputs(colors);
            
            // Ø­ÙØ¸ ÙÙŠ localStorage
            localStorage.setItem('customColors', JSON.stringify(colors));
            
            console.log('ğŸ¨ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø®ØµØµØ©:', colors);
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        function updateColorInputs(colors) {
            if (document.getElementById('primaryColorPicker')) {
                document.getElementById('primaryColorPicker').value = colors.primary;
                document.getElementById('primaryColorInput').value = colors.primary;
            }
            if (document.getElementById('secondaryColorPicker')) {
                document.getElementById('secondaryColorPicker').value = colors.secondary;
                document.getElementById('secondaryColorInput').value = colors.secondary;
            }
            if (document.getElementById('successColorPicker')) {
                document.getElementById('successColorPicker').value = colors.success;
                document.getElementById('successColorInput').value = colors.success;
            }
            if (document.getElementById('warningColorPicker')) {
                document.getElementById('warningColorPicker').value = colors.warning;
                document.getElementById('warningColorInput').value = colors.warning;
            }
            if (document.getElementById('dangerColorPicker')) {
                document.getElementById('dangerColorPicker').value = colors.danger;
                document.getElementById('dangerColorInput').value = colors.danger;
            }
            if (document.getElementById('infoColorPicker')) {
                document.getElementById('infoColorPicker').value = colors.info;
                document.getElementById('infoColorInput').value = colors.info;
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ¹Ø¯ÙŠÙ„ Ø³Ø·ÙˆØ¹ Ø§Ù„Ù„ÙˆÙ†
        function adjustColor(color, amount) {
            const num = parseInt(color.replace('#', ''), 16);
            const r = Math.max(0, Math.min(255, (num >> 16) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
            const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
            return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        function resetDefaultColors() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) {
                applyCustomColors(colorSchemes.default);
                const colorSchemeSelect = document.getElementById('colorSchemeSelect');
                if (colorSchemeSelect) colorSchemeSelect.value = 'default';
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        function setupColorPickers() {
            // Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
            ['primaryColorPicker', 'primaryColorInput'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const value = this.value;
                        document.getElementById('primaryColorPicker').value = value;
                        document.getElementById('primaryColorInput').value = value;
                        updateSingleColor('primary', value);
                    });
                }
            });

            // Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ
            ['secondaryColorPicker', 'secondaryColorInput'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const value = this.value;
                        document.getElementById('secondaryColorPicker').value = value;
                        document.getElementById('secondaryColorInput').value = value;
                        updateSingleColor('secondary', value);
                    });
                }
            });

            // Ù„ÙˆÙ† Ø§Ù„Ù†Ø¬Ø§Ø­
            ['successColorPicker', 'successColorInput'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const value = this.value;
                        document.getElementById('successColorPicker').value = value;
                        document.getElementById('successColorInput').value = value;
                        updateSingleColor('success', value);
                    });
                }
            });

            // Ù„ÙˆÙ† Ø§Ù„ØªØ­Ø°ÙŠØ±
            ['warningColorPicker', 'warningColorInput'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const value = this.value;
                        document.getElementById('warningColorPicker').value = value;
                        document.getElementById('warningColorInput').value = value;
                        updateSingleColor('warning', value);
                    });
                }
            });

            // Ù„ÙˆÙ† Ø§Ù„Ø®Ø·Ø±
            ['dangerColorPicker', 'dangerColorInput'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const value = this.value;
                        document.getElementById('dangerColorPicker').value = value;
                        document.getElementById('dangerColorInput').value = value;
                        updateSingleColor('danger', value);
                    });
                }
            });

            // Ù„ÙˆÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            ['infoColorPicker', 'infoColorInput'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        const value = this.value;
                        document.getElementById('infoColorPicker').value = value;
                        document.getElementById('infoColorInput').value = value;
                        updateSingleColor('info', value);
                    });
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† ÙˆØ§Ø­Ø¯
        function updateSingleColor(colorType, value) {
            const root = document.documentElement;
            root.style.setProperty(`--${colorType}-color`, value);
            
            // Ø­ÙØ¸ ÙÙŠ localStorage
            const savedColors = JSON.parse(localStorage.getItem('customColors') || '{}');
            savedColors[colorType] = value;
            localStorage.setItem('customColors', JSON.stringify(savedColors));
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
        function applyFontSize(size) {
            const root = document.documentElement;
            switch(size) {
                case 'small':
                    root.style.fontSize = '13px';
                    break;
                case 'large':
                    root.style.fontSize = '17px';
                    break;
                default: // medium
                    root.style.fontSize = '15px';
            }
            console.log('ğŸ“ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·:', size);
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ©
        function applyLanguage(lang) {
            // Ø­ÙØ¸ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            localStorage.setItem('currentLanguage', lang);
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø§ØªØ¬Ø§Ù‡
            if (lang === 'ar' || lang === 'ku') {
                document.documentElement.setAttribute('dir', 'rtl');
                document.body.classList.add('rtl');
                document.body.classList.remove('ltr');
            } else {
                document.documentElement.setAttribute('dir', 'ltr');
                document.body.classList.add('ltr');
                document.body.classList.remove('rtl');
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
            updateUILanguage(lang);
        }

        // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUILanguage(lang) {
            const translations = {
                ar: {
                    // Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    pos: 'Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹',
                    products: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                    inventory: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†',
                    invoices: 'Ø§Ù„ÙÙˆØ§ØªÙŠØ±',
                    debts: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†',
                    printer: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©',
                    settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©',
                    
                    // Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
                    search: 'Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...',
                    total: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
                    discount: 'Ø§Ù„Ø®ØµÙ…',
                    finalTotal: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ',
                    checkout: 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹',
                    clearCart: 'Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©',
                    cart: 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚',
                    addToCart: 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©',
                    
                    // Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    save: 'Ø­ÙØ¸',
                    cancel: 'Ø¥Ù„ØºØ§Ø¡',
                    delete: 'Ø­Ø°Ù',
                    edit: 'ØªØ¹Ø¯ÙŠÙ„',
                    add: 'Ø¥Ø¶Ø§ÙØ©',
                    back: 'Ø±Ø¬ÙˆØ¹',
                    
                    // Ø§Ù„Ø­Ù‚ÙˆÙ„
                    name: 'Ø§Ù„Ø§Ø³Ù…',
                    price: 'Ø§Ù„Ø³Ø¹Ø±',
                    quantity: 'Ø§Ù„ÙƒÙ…ÙŠØ©',
                    category: 'Ø§Ù„ÙØ¦Ø©',
                    barcode: 'Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯',
                    description: 'Ø§Ù„ÙˆØµÙ'
                },
                en: {
                    // Main Menus
                    pos: 'Point of Sale',
                    products: 'Products Management',
                    inventory: 'Inventory Management',
                    invoices: 'Invoices',
                    debts: 'Debts Management',
                    printer: 'Printer Settings',
                    settings: 'General Settings',
                    
                    // Point of Sale
                    search: 'Search for product...',
                    total: 'Total',
                    discount: 'Discount',
                    finalTotal: 'Final Total',
                    checkout: 'Checkout',
                    clearCart: 'Clear Cart',
                    cart: 'Shopping Cart',
                    addToCart: 'Add to Cart',
                    
                    // Buttons
                    save: 'Save',
                    cancel: 'Cancel',
                    delete: 'Delete',
                    edit: 'Edit',
                    add: 'Add',
                    back: 'Back',
                    
                    // Fields
                    name: 'Name',
                    price: 'Price',
                    quantity: 'Quantity',
                    category: 'Category',
                    barcode: 'Barcode',
                    description: 'Description'
                },
                ku: {
                    // Ù„ÛŒØ³ØªÛŒ Ø³Û•Ø±Û•Ú©ÛŒ
                    pos: 'Ø®Ø§ÚµÛŒ ÙØ±Û†Ø´ØªÙ†',
                    products: 'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø±Ù‡Û•Ù…Û•Ú©Ø§Ù†',
                    inventory: 'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ú©Û†Ú¯Ø§',
                    invoices: 'ÙˆÛ•Ø³ÚµÛ•Ú©Ø§Ù†',
                    debts: 'Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù‚Û•Ø±Ø²Û•Ú©Ø§Ù†',
                    printer: 'Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ú†Ø§Ù¾Ú©Û•Ø±',
                    settings: 'Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†ÛŒ Ú¯Ø´ØªÛŒ',
                    
                    // Ø®Ø§ÚµÛŒ ÙØ±Û†Ø´ØªÙ†
                    search: 'Ú¯Û•Ú•Ø§Ù† Ø¨Û† Ø¨Û•Ø±Ù‡Û•Ù…...',
                    total: 'Ú©Û†ÛŒ Ú¯Ø´ØªÛŒ',
                    discount: 'Ø¯Ø§Ø´Ú©Ø§Ù†Ø¯Ù†',
                    finalTotal: 'Ú©Û†ÛŒ Ú©Û†ØªØ§ÛŒÛŒ',
                    checkout: 'ØªÛ•ÙˆØ§ÙˆÚ©Ø±Ø¯Ù†ÛŒ ÙØ±Û†Ø´ØªÙ†',
                    clearCart: 'Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø³Û•Ø¨Û•ØªÛ•',
                    cart: 'Ø³Û•Ø¨Û•ØªÛ•ÛŒ Ú©Ú•ÛŒÙ†',
                    addToCart: 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù† Ø¨Û† Ø³Û•Ø¨Û•ØªÛ•',
                    
                    // Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù†
                    save: 'Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†',
                    cancel: 'Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•',
                    delete: 'Ø³Ú•ÛŒÙ†Û•ÙˆÛ•',
                    edit: 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†',
                    add: 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†',
                    back: 'Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•',
                    
                    // Ø®Ø§Ù†Û•Ú©Ø§Ù†
                    name: 'Ù†Ø§Ùˆ',
                    price: 'Ù†Ø±Ø®',
                    quantity: 'Ø¨Ú•',
                    category: 'Ø¬Û†Ø±',
                    barcode: 'Ø¨Ø§Ø±Ú©Û†Ø¯',
                    description: 'ÙˆÛ•Ø³Ù'
                }
            };
            
            const texts = translations[lang] || translations.ar;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ
            const titleElement = document.getElementById('currentPageTitle');
            if (titleElement) {
                const currentPage = document.querySelector('.page.active')?.id;
                if (currentPage && texts[currentPage]) {
                    titleElement.textContent = texts[currentPage];
                }
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            document.querySelectorAll('.nav-link').forEach(link => {
                const onclick = link.getAttribute('onclick');
                if (onclick) {
                    const pageMatch = onclick.match(/showPage\('([^']+)'\)/);
                    if (pageMatch && texts[pageMatch[1]]) {
                        const span = link.querySelector('span');
                        if (span) span.textContent = texts[pageMatch[1]];
                    }
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« placeholder Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
            const searchInput = document.getElementById('productSearchInput');
            if (searchInput && texts.search) {
                searchInput.placeholder = texts.search;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù†ØµÙˆØµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
            document.querySelectorAll('button').forEach(btn => {
                const text = btn.textContent.trim();
                if (text.includes('Ø­ÙØ¸') || text.includes('Save')) {
                    const icon = btn.querySelector('i');
                    btn.innerHTML = '';
                    if (icon) btn.appendChild(icon.cloneNode(true));
                    btn.appendChild(document.createTextNode(' ' + texts.save));
                } else if (text.includes('Ø¥Ù„ØºØ§Ø¡') || text.includes('Cancel')) {
                    const icon = btn.querySelector('i');
                    btn.innerHTML = '';
                    if (icon) btn.appendChild(icon.cloneNode(true));
                    btn.appendChild(document.createTextNode(' ' + texts.cancel));
                }
            });
            
            console.log('ğŸŒ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ØºØ©:', lang);
        }


        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        function savePrintingSettings() {
            const printingSettings = {
                defaultPrinter: document.getElementById('defaultPrinterSelect')?.value || '',
                paperSize: document.getElementById('paperSizeSelect')?.value || '80mm',
                fontSize: document.getElementById('invoiceFontSize')?.value || 'medium',
                showLogo: document.getElementById('showLogoOnInvoice')?.checked !== false,
                showBarcode: document.getElementById('showBarcodeOnInvoice')?.checked !== false,
                showTax: document.getElementById('showTaxOnInvoice')?.checked !== false,
                footerNote: document.getElementById('invoiceFooterNote')?.value || '',
                autoPrint: document.getElementById('autoPrintInvoice')?.checked || false,
                printCopies: document.getElementById('printCopies')?.checked || false,
                openCashDrawer: document.getElementById('openCashDrawer')?.checked || false
            };

            localStorage.setItem('printingSettings', JSON.stringify(printingSettings));
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            applyPrintingSettings(printingSettings);
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        function applyPrintingSettings(settings) {
            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
            window.printingSettings = settings;
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
        function saveSecuritySettings() {
            const securitySettings = {
                passwordEnabled: document.getElementById('enablePassword')?.checked || false,
                requirePasswordForDelete: document.getElementById('requirePasswordForDelete')?.checked !== false,
                requirePasswordForReports: document.getElementById('requirePasswordForReports')?.checked || false,
                requirePasswordForSettings: document.getElementById('requirePasswordForSettings')?.checked !== false,
                activityLogEnabled: document.getElementById('enableActivityLog')?.checked !== false,
                logRetentionPeriod: document.getElementById('logRetentionPeriod')?.value || 90
            };

            localStorage.setItem('securitySettings', JSON.stringify(securitySettings));
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
            applySecuritySettings(securitySettings);
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
        function applySecuritySettings(settings) {
            // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
            window.securitySettings = settings;
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        function saveBackupSettings() {
            const backupSettings = {
                autoBackupEnabled: document.getElementById('autoBackupEnabled')?.checked || false,
                frequency: document.getElementById('autoBackupFrequency')?.value || 'daily',
                location: document.getElementById('backupLocation')?.value || ''
            };

            localStorage.setItem('backupSettings', JSON.stringify(backupSettings));
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø©
        async function createFullBackup() {
            try {
                const backupData = {
                    version: '1.0.0',
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleString('ar-IQ'),
                    type: 'full',
                    data: {
                        products: products || [],
                        categories: categories || [],
                        suppliers: suppliers || [],
                        sales: salesData || [],
                        debts: debtsData || [],
                        settings: {
                            store: JSON.parse(localStorage.getItem('storeSettings') || '{}'),
                            system: JSON.parse(localStorage.getItem('systemSettings') || '{}'),
                            printing: JSON.parse(localStorage.getItem('printingSettings') || '{}'),
                            security: JSON.parse(localStorage.getItem('securitySettings') || '{}'),
                            backup: JSON.parse(localStorage.getItem('backupSettings') || '{}')
                        }
                    },
                    stats: {
                        totalProducts: (products || []).length,
                        totalCategories: (categories || []).length,
                        totalSuppliers: (suppliers || []).length,
                        totalSales: (salesData || []).length,
                        totalDebts: (debtsData || []).length
                    }
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const fileName = `Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_ÙƒØ§Ù…Ù„Ø©_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Electron API Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹
                if (window.electronAPI && window.electronAPI.saveFile) {
                    const backupSettings = JSON.parse(localStorage.getItem('backupSettings') || '{}');
                    const result = await window.electronAPI.saveFile({
                        defaultPath: backupSettings.location || '',
                        fileName: fileName,
                        content: dataStr
                    });
                    
                    if (result.success) {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    } else {
                        throw new Error('Failed to save via Electron');
                    }
                } else {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                    const dataBlob = new Blob([dataStr], {type: 'application/json'});
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
                
                console.log('ğŸ“¦ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', backupData.stats);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
        function createDataBackup() {
            try {
                const backupData = {
                    version: '1.0.0',
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleString('ar-IQ'),
                    type: 'data',
                    data: {
                        products: products || [],
                        categories: categories || [],
                        suppliers: suppliers || [],
                        sales: salesData || [],
                        debts: debtsData || []
                    },
                    stats: {
                        totalProducts: (products || []).length,
                        totalSales: (salesData || []).length,
                        totalDebts: (debtsData || []).length
                    }
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Ù†Ø³Ø®Ø©_Ø¨ÙŠØ§Ù†Ø§Øª_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                console.log('ğŸ“¦ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', backupData.stats);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙ‚Ø·
        function createSettingsBackup() {
            try {
                const backupData = {
                    version: '1.0.0',
                    timestamp: new Date().toISOString(),
                    date: new Date().toLocaleString('ar-IQ'),
                    type: 'settings',
                    data: {
                        store: JSON.parse(localStorage.getItem('storeSettings') || '{}'),
                        system: JSON.parse(localStorage.getItem('systemSettings') || '{}'),
                        printing: JSON.parse(localStorage.getItem('printingSettings') || '{}'),
                        security: JSON.parse(localStorage.getItem('securitySettings') || '{}'),
                        backup: JSON.parse(localStorage.getItem('backupSettings') || '{}')
                    }
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Ù†Ø³Ø®Ø©_Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª_${new Date().toISOString().split('T')[0]}_${Date.now()}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                console.log('ğŸ“¦ ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        function handleBackupRestore(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø©ØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©!')) return;

                    // 1. Ø§Ø³ØªØ¹Ø§Ø¯Ø© localStorage
                    if (backupData.localStorage) {
                        localStorage.clear();
                        for (const key in backupData.localStorage) {
                            try { localStorage.setItem(key, backupData.localStorage[key]); } catch (e) {}
                        }
                    }

                    // 2. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª elementSdk
                    if (backupData.elementConfig && window.elementSdk && typeof window.elementSdk.importConfig === 'function') {
                        await window.elementSdk.importConfig(JSON.stringify(backupData.elementConfig));
                    }

                    // 3. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª indexedDB (dataSdk)
                    if (backupData.indexedDB && window.dataSdk && typeof window.dataSdk.importData === 'function') {
                        // Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø§Ù„Ù†Ø³Ø®Ø©: ÙƒØ§Ù…Ù„Ø© Ø£Ù… Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠØ©
                        let dataArr = [];
                        if (backupData.indexedDB.all) {
                            dataArr = backupData.indexedDB.all;
                        } else {
                            // Ø§Ù†ØªÙ‚Ø§Ø¦ÙŠØ©: Ø¯Ù…Ø¬ ÙƒÙ„ Ù…Ø§ Ù‡Ùˆ Ù…ÙˆØ¬ÙˆØ¯
                            ['products','invoices','debts','payments'].forEach(type => {
                                if (Array.isArray(backupData.indexedDB[type])) dataArr = dataArr.concat(backupData.indexedDB[type]);
                            });
                        }
                        if (dataArr.length > 0) {
                            await window.dataSdk.clearAll();
                            await window.dataSdk.importData(JSON.stringify(dataArr));
                        }
                    }

                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    setTimeout(() => location.reload(), 1500);
                } catch (error) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹ - Ø­Ø°Ù Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function confirmFactoryReset() {
            const confirmText = 'âš ï¸ ØªØ­Ø°ÙŠØ± Ø®Ø·ÙŠØ± Ø¬Ø¯Ø§Ù‹!\n\n' +
                               'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n' +
                               'ğŸ—‘ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù:\n' +
                               'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª\n' +
                               'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†\n' +
                               'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±\n' +
                               'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·\n' +
                               'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªØ®ØµÙŠØµØ§Øª\n' +
                               'â€¢ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ù…Ø³ÙˆØ¯Ø§Øª\n' +
                               'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n' +
                               'âœ… Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù€:\n' +
                               'â€¢ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (UID + Secret)\n' +
                               'â€¢ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ\n' +
                               'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n' +
                               'âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©!\n\n' +
                               'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ 100% Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ';
            
            if (!confirm(confirmText)) return;
            if (!confirm('âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø«Ø§Ù†ÙŠ:\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ\nØ³ÙŠØµØ¨Ø­ Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙØ§Ø±ØºØ§Ù‹ ØªÙ…Ø§Ù…Ø§Ù‹!')) return;
            if (!confirm('âš ï¸ ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠ:\n\nØ¢Ø®Ø± ÙØ±ØµØ© Ù„Ù„ØªØ±Ø§Ø¬Ø¹!\nØ§Ø¶ØºØ· Ù…ÙˆØ§ÙÙ‚ Ù„Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡ Ø§Ù„Ø¢Ù†!')) return;
            
            try {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø°Ù
                const savedUID = localStorage.getItem('app_uid');
                const savedSecret = localStorage.getItem('app_secret');
                
                if (!savedUID) {
                    throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ø³ØªØ®Ø¯Ù…! ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.');
                }
                
                console.log('ğŸ’¾ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨: UID Ù…ÙˆØ¬ÙˆØ¯');
                
                // 1. Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase (Ù…Ø¹ Timeout)
                const isOnline = navigator.onLine;
                console.log('Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:', isOnline ? 'âœ… Ù…ØªØµÙ„' : 'âš ï¸ ØºÙŠØ± Ù…ØªØµÙ„');
                
                if (isOnline && window.database) {
                    console.log('ğŸ—‘ï¸ Ø¨Ø¯Ø¡ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase...');
                    
                    try {
                        // Ø¥Ø¶Ø§ÙØ© timeout Ù„Ù„Ø­Ø°Ù Ù…Ù† Firebase (5 Ø«ÙˆØ§Ù†ÙŠ)
                        await Promise.race([
                            (async () => {
                                // Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ù…Ù† ÙˆØ¹ÙˆØ¯ Ø§Ù„Ø­Ø°Ù
                                const deletePromises = [
                                    database.ref(`users/${savedUID}/products`).remove(),
                                    database.ref(`users/${savedUID}/sales`).remove(),
                                    database.ref(`users/${savedUID}/debts`).remove(),
                                    database.ref(`users/${savedUID}/activities`).remove(),
                                    database.ref(`users/${savedUID}/suppliers`).remove(),
                                    database.ref(`users/${savedUID}/categories`).remove(),
                                    database.ref(`users/${savedUID}/settings`).remove()
                                ];
                                
                                // Ø§Ù†ØªØ¸Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù
                                await Promise.all(deletePromises);
                                
                                console.log('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase Ø¨Ù†Ø¬Ø§Ø­');
                                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                            })(),
                            new Promise((_, reject) => 
                                setTimeout(() => reject(new Error('timeout')), 5000)
                            )
                        ]);
                        
                    } catch (firebaseError) {
                        if (firebaseError.message === 'timeout') {
                            console.warn('âš ï¸ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø­Ø°Ù Ù…Ù† Firebase - Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ');
                            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        } else {
                            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', firebaseError);
                            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        }
                        // Ù†Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ Firebase
                    }
                } else {
                    if (!isOnline) {
                        console.warn('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª - Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·');
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    } else {
                        console.warn('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØ§Ø­ - Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·');
                    }
                }
                
                // 2. Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                console.log('ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª...');
                products = [];
                categories = [];
                suppliers = [];
                salesData = [];
                debtsData = [];
                cart = [];
                cartItems = [];
                
                // 3. Ø­Ø°Ù **Ø¬Ù…ÙŠØ¹** Ù…ÙØ§ØªÙŠØ­ LocalStorage Ù…Ø§ Ø¹Ø¯Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                console.log('ğŸ—‘ï¸ ØªÙ†Ø¸ÙŠÙ LocalStorage Ø¨Ø§Ù„ÙƒØ§Ù…Ù„...');
                const keysToKeep = ['app_uid', 'app_secret'];
                
                // Ø­Ø°Ù ÙƒÙ„ Ù…ÙØªØ§Ø­ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª
                Object.keys(localStorage).forEach(key => {
                    if (!keysToKeep.includes(key)) {
                        console.log(`   â”œâ”€ Ø­Ø°Ù: ${key}`);
                        localStorage.removeItem(key);
                    }
                });
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„ØªØ£ÙƒÙŠØ¯
                if (savedUID) localStorage.setItem('app_uid', savedUID);
                if (savedSecret) localStorage.setItem('app_secret', savedSecret);
                
                // Ø­ÙØ¸ Ø§Ù„Ù…ØµÙÙˆÙØ§Øª Ø§Ù„ÙØ§Ø±ØºØ© Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­
                localStorage.setItem('products', '[]');
                localStorage.setItem('categories', '[]');
                localStorage.setItem('suppliers', '[]');
                localStorage.setItem('salesData', '[]');
                localStorage.setItem('debtsData', '[]');
                localStorage.setItem('cartItems', '[]');
                localStorage.setItem('cart', '[]');
                
                // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø£Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ (Ù„Ù…Ù†Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©)
                localStorage.setItem('appInitialized', 'true');
                localStorage.setItem('factoryResetDone', 'true');
                
                console.log('âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ LocalStorage Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨');
                
                // 4. Ø­Ø°Ù **Ø¬Ù…ÙŠØ¹** Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª IndexedDB Ø¨Ø´ÙƒÙ„ Ø´Ø§Ù…Ù„
                console.log('ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª IndexedDB...');
                
                try {
                    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    if (indexedDB.databases) {
                        const allDatabases = await indexedDB.databases();
                        console.log(`ğŸ“‹ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${allDatabases.length} Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª`);
                        
                        for (const db of allDatabases) {
                            if (db.name) {
                                console.log(`   â”œâ”€ Ø­Ø°Ù Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${db.name}`);
                                await new Promise((resolve) => {
                                    const deleteRequest = indexedDB.deleteDatabase(db.name);
                                    
                                    // Ø¥Ø¶Ø§ÙØ© timeout Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù (3 Ø«ÙˆØ§Ù†ÙŠ Ù„ÙƒÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª)
                                    const timeout = setTimeout(() => {
                                        console.warn(`   âš ï¸ timeout: ${db.name}`);
                                        resolve();
                                    }, 3000);
                                    
                                    deleteRequest.onsuccess = () => {
                                        clearTimeout(timeout);
                                        console.log(`   âœ… ØªÙ… Ø­Ø°Ù: ${db.name}`);
                                        resolve();
                                    };
                                    deleteRequest.onerror = () => {
                                        clearTimeout(timeout);
                                        console.warn(`   âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù: ${db.name}`);
                                        resolve();
                                    };
                                    deleteRequest.onblocked = () => {
                                        clearTimeout(timeout);
                                        console.warn(`   âš ï¸ Ù…Ø­Ø¬ÙˆØ¨: ${db.name}`);
                                        resolve();
                                    };
                                });
                            }
                        }
                    } else {
                        // Ø®Ø·Ø© Ø¨Ø¯ÙŠÙ„Ø©: Ø­Ø°Ù Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
                        const knownDatabases = [
                            'POSSystemDB', 'POSDatabase', 'posDB', 'productsDB', 'salesDB', 'debtsDB', 
                            'categoriesDB', 'suppliersDB', 'cashierDB', 'invoicesDB',
                            'localforage', 'firebaseLocalStorageDb', '_pouch_', 'PouchDB'
                        ];
                        
                        for (const dbName of knownDatabases) {
                            await new Promise((resolve) => {
                                const deleteRequest = indexedDB.deleteDatabase(dbName);
                                
                                // Ø¥Ø¶Ø§ÙØ© timeout
                                const timeout = setTimeout(() => resolve(), 3000);
                                
                                deleteRequest.onsuccess = () => {
                                    clearTimeout(timeout);
                                    console.log(`   âœ… ØªÙ… Ø­Ø°Ù: ${dbName}`);
                                    resolve();
                                };
                                deleteRequest.onerror = () => {
                                    clearTimeout(timeout);
                                    resolve();
                                };
                                deleteRequest.onblocked = () => {
                                    clearTimeout(timeout);
                                    resolve();
                                };
                            });
                        }
                    }
                    
                    console.log('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª IndexedDB');
                    
                } catch (error) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù IndexedDB:', error);
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø©: Ø­Ø°Ù Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©
                    const databases = ['POSSystemDB', 'POSDatabase', 'posDB', 'productsDB', 'salesDB', 'debtsDB', 'categoriesDB', 'suppliersDB'];
                    
                    for (const dbName of databases) {
                        try {
                            await new Promise((resolve) => {
                                const deleteRequest = indexedDB.deleteDatabase(dbName);
                                
                                // timeout Ù„ÙƒÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª
                                const timeout = setTimeout(() => resolve(), 3000);
                                
                                deleteRequest.onsuccess = () => {
                                    clearTimeout(timeout);
                                    console.log(`âœ… ØªÙ… Ø­Ø°Ù: ${dbName}`);
                                    resolve();
                                };
                                deleteRequest.onerror = () => {
                                    clearTimeout(timeout);
                                    console.warn(`âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù ${dbName}`);
                                    resolve();
                                };
                                deleteRequest.onblocked = () => {
                                    console.warn(`âš ï¸ ${dbName} Ù…Ø­Ø¬ÙˆØ¨`);
                                    resolve();
                                };
                            });
                        } catch (error) {
                            console.warn(`âš ï¸ Ø§Ø³ØªØ«Ù†Ø§Ø¡ ÙÙŠ Ø­Ø°Ù ${dbName}:`, error);
                        }
                    }
                }
                
                // 5. Ø­Ø°Ù SessionStorage
                console.log('ğŸ—‘ï¸ Ø­Ø°Ù SessionStorage...');
                sessionStorage.clear();
                
                // 6. Ø­Ø°Ù Cache API
                console.log('ğŸ—‘ï¸ Ø­Ø°Ù Cache...');
                if ('caches' in window) {
                    try {
                        const cacheNames = await caches.keys();
                        await Promise.all(cacheNames.map(name => caches.delete(name)));
                        console.log('âœ… ØªÙ… Ø­Ø°Ù Cache');
                    } catch (error) {
                        console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Cache:', error);
                    }
                }
                
                // 7. ØªÙ†Ø¸ÙŠÙ DOM ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                console.log('ğŸ—‘ï¸ ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„...');
                
                // ØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                document.querySelectorAll('input[type="text"], input[type="search"], input[type="number"]').forEach(input => {
                    if (input.id !== 'app_uid' && input.id !== 'app_secret') {
                        input.value = '';
                    }
                });
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ù„Ø©
                const cartSection = document.querySelector('.cart-items');
                if (cartSection) cartSection.innerHTML = '';
                
                // ØªÙ†Ø¸ÙŠÙ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const productsGrid = document.querySelector('.products-grid');
                if (productsGrid) productsGrid.innerHTML = '';
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                const totalEl = document.getElementById('totalPrice');
                if (totalEl) totalEl.textContent = '0';
                
                // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ ØµÙØ±
                document.querySelectorAll('[id$="Count"]').forEach(el => {
                    el.textContent = '0';
                });
                
                console.log('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ');
                
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                
                // Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ù†Ù‡Ø§Ø¦ÙŠØ©
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!\n\n' +
                      'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n' +
                      'ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù:\n' +
                      'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„ÙØ¦Ø§Øª (Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© ÙˆØ§Ù„Ù…Ø­Ù„ÙŠØ©)\n' +
                      'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ±\n' +
                      'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·\n' +
                      'â€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©\n\n' +
                      'âœ… ØªÙ… Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰:\n' +
                      'â€¢ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ\n' +
                      'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n' +
                      'ğŸ”„ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù†');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                window.location.href = window.location.href.split('?')[0];
                location.reload(true);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹:\n\n' + 
                      error.message + '\n\n' +
                      'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ');
            }
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙ‚Ø·
        async function clearSampleData() {
            if (confirm('ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ø¨ØªØ·Ø¨ÙŠÙ‚ Ù†Ø¸ÙŠÙØŸ\n\nâœ… Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨')) {
                try {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    
                    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨
                    const savedUID = localStorage.getItem('app_uid');
                    const savedSecret = localStorage.getItem('app_secret');
                    
                    // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase (Ù…Ø¹ Timeout)
                    const isOnline = navigator.onLine;
                    
                    if (isOnline && savedUID && window.database) {
                        console.log('ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase...');
                        
                        try {
                            // Ø¥Ø¶Ø§ÙØ© timeout Ù„Ù„Ø­Ø°Ù Ù…Ù† Firebase (5 Ø«ÙˆØ§Ù†ÙŠ)
                            await Promise.race([
                                (async () => {
                                    await database.ref(`users/${savedUID}/products`).remove();
                                    await database.ref(`users/${savedUID}/sales`).remove();
                                    await database.ref(`users/${savedUID}/debts`).remove();
                                    await database.ref(`users/${savedUID}/activities`).remove();
                                    await database.ref(`users/${savedUID}/suppliers`).remove();
                                    await database.ref(`users/${savedUID}/categories`).remove();
                                    console.log('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase');
                                })(),
                                new Promise((_, reject) => 
                                    setTimeout(() => reject(new Error('timeout')), 5000)
                                )
                            ]);
                        } catch (error) {
                            if (error.message === 'timeout') {
                                console.warn('âš ï¸ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø­Ø°Ù Ù…Ù† Firebase');
                            } else {
                                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', error);
                            }
                            // Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¨Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ
                        }
                    } else {
                        if (!isOnline) {
                            console.warn('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ - Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·');
                        }
                    }
                    
                    // Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ù† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
                    products = [];
                    categories = [];
                    suppliers = [];
                    salesData = [];
                    debtsData = [];
                    cartItems = [];
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ© ÙÙŠ LocalStorage
                    localStorage.setItem('products', JSON.stringify([]));
                    localStorage.setItem('categories', JSON.stringify([]));
                    localStorage.setItem('suppliers', JSON.stringify([]));
                    localStorage.setItem('salesData', JSON.stringify([]));
                    localStorage.setItem('debtsData', JSON.stringify([]));
                    localStorage.setItem('cartItems', JSON.stringify([]));
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    updateAllViews();
                    renderCart();
                    
                    console.log('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    
                    setTimeout(() => {
                        alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!\n\n' +
                              'ğŸ“ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¢Ù† Ù†Ø¸ÙŠÙ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…\n' +
                              'âš™ï¸ ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨');
                        location.reload();
                    }, 1000);
                    
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ©
        function refreshPrinters() {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
        }

        async function chooseBackupLocation() {
            if (window.electronAPI && window.electronAPI.selectDirectory) {
                const result = await window.electronAPI.selectDirectory();
                if (result && !result.canceled) {
                    const locationInput = document.getElementById('backupLocation');
                    if (locationInput) {
                        locationInput.value = result.filePaths[0];
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    }
                }
            } else {
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ØªÙˆÙØ± Electron API
                const locationInput = document.getElementById('backupLocation');
                if (locationInput) {
                    const path = prompt('Ø£Ø¯Ø®Ù„ Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:', locationInput.value || 'C:\\Backups');
                    if (path) {
                        locationInput.value = path;
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    }
                }
            }
        }

        function printTestPage() {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            window.print();
        }

        function changePassword() {
            const current = document.getElementById('currentPassword')?.value;
            const newPass = document.getElementById('newPassword')?.value;
            const confirm = document.getElementById('confirmPassword')?.value;

            if (!current || !newPass || !confirm) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            if (newPass !== confirm) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            // Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ÙŠØ¬Ø¨ ØªØ´ÙÙŠØ±Ù‡Ø§ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ)
            localStorage.setItem('appPassword', newPass);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        function viewActivityLog() {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
        }

        // Ù…Ø¹Ø§Ù„Ø¬ Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙ†Ø©
        function setupLogoPreview() {
            const logoInput = document.getElementById('settingsStoreLogo');
            if (logoInput) {
                logoInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø©
                            let preview = document.querySelector('.logo-preview');
                            if (!preview) {
                                preview = document.createElement('div');
                                preview.className = 'logo-preview';
                                preview.style.cssText = 'margin-top: 1rem; padding: 1rem; background: var(--theme-bg-hover); border-radius: 8px; text-align: center;';
                                logoInput.parentElement.appendChild(preview);
                            }
                            preview.innerHTML = `
                                <img src="${event.target.result}" style="max-width: 200px; max-height: 100px; border-radius: 8px;">
                                <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--success-color);">
                                    <i class="fas fa-check-circle"></i> ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­
                                </p>
                            `;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }

        // ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        document.addEventListener('DOMContentLoaded', async () => {
            const enablePasswordCheck = document.getElementById('enablePassword');
            const passwordFields = document.getElementById('passwordFields');
            
            if (enablePasswordCheck && passwordFields) {
                enablePasswordCheck.addEventListener('change', function() {
                    passwordFields.style.display = this.checked ? 'block' : 'none';
                });
            }

            // ØªØ­Ù…ÙŠÙ„ ÙˆØªØ·Ø¨ÙŠÙ‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            loadAllSettings();
            
            // ØªÙØ¹ÙŠÙ„ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±
            setupLogoPreview();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù†ØªÙ‚ÙŠØ§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            setupColorPickers();
            
            // Ø¥ØµÙ„Ø§Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            if (typeof fixDebtsData === 'function' && debtsData && debtsData.length > 0) {
                console.log('ğŸ”§ Running automatic debt data repair...');
                await fixDebtsData();
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function loadAllSettings() {
            loadStoreSettings();
            loadSystemSettings();
            loadPrintingSettings();
            loadSecuritySettings();
            loadBackupSettings();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function loadSystemSettings() {
            const savedSettings = localStorage.getItem('systemSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
                if (document.getElementById('themeSelect')) document.getElementById('themeSelect').value = settings.theme || 'dark';
                if (document.getElementById('colorSchemeSelect')) document.getElementById('colorSchemeSelect').value = settings.colorScheme || 'default';
                if (document.getElementById('fontSizeSelect')) document.getElementById('fontSizeSelect').value = settings.fontSize || 'medium';
                if (document.getElementById('compactModeCheck')) document.getElementById('compactModeCheck').checked = settings.compactMode || false;
                if (document.getElementById('languageSelect')) document.getElementById('languageSelect').value = settings.language || 'ar';
                if (document.getElementById('dateFormatSelect')) document.getElementById('dateFormatSelect').value = settings.dateFormat || 'DD/MM/YYYY';
                if (document.getElementById('timeFormatSelect')) document.getElementById('timeFormatSelect').value = settings.timeFormat || '12';
                if (document.getElementById('itemsPerPageSelect')) document.getElementById('itemsPerPageSelect').value = settings.itemsPerPage || 25;
                if (document.getElementById('animationsCheck')) document.getElementById('animationsCheck').checked = settings.animations !== false;
                if (document.getElementById('autosaveCheck')) document.getElementById('autosaveCheck').checked = settings.autosave !== false;
                if (document.getElementById('barcodeSound')) document.getElementById('barcodeSound').checked = settings.barcodeSound !== false;
                if (document.getElementById('autoPrint')) document.getElementById('autoPrint').checked = settings.autoPrint || false;
                if (document.getElementById('clearCartAfterSale')) document.getElementById('clearCartAfterSale').checked = settings.clearCartAfterSale !== false;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                applySystemSettings(settings);
            }
        }


        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        function loadPrintingSettings() {
            const savedSettings = localStorage.getItem('printingSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                if (document.getElementById('defaultPrinterSelect')) document.getElementById('defaultPrinterSelect').value = settings.defaultPrinter || '';
                if (document.getElementById('paperSizeSelect')) document.getElementById('paperSizeSelect').value = settings.paperSize || '80mm';
                if (document.getElementById('invoiceFontSize')) document.getElementById('invoiceFontSize').value = settings.fontSize || 'medium';
                if (document.getElementById('showLogoOnInvoice')) document.getElementById('showLogoOnInvoice').checked = settings.showLogo !== false;
                if (document.getElementById('showBarcodeOnInvoice')) document.getElementById('showBarcodeOnInvoice').checked = settings.showBarcode !== false;
                if (document.getElementById('showTaxOnInvoice')) document.getElementById('showTaxOnInvoice').checked = settings.showTax !== false;
                if (document.getElementById('invoiceFooterNote')) document.getElementById('invoiceFooterNote').value = settings.footerNote || '';
                if (document.getElementById('autoPrintInvoice')) document.getElementById('autoPrintInvoice').checked = settings.autoPrint || false;
                if (document.getElementById('printCopies')) document.getElementById('printCopies').checked = settings.printCopies || false;
                if (document.getElementById('openCashDrawer')) document.getElementById('openCashDrawer').checked = settings.openCashDrawer || false;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                applyPrintingSettings(settings);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
        function loadSecuritySettings() {
            const savedSettings = localStorage.getItem('securitySettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                if (document.getElementById('enablePassword')) document.getElementById('enablePassword').checked = settings.passwordEnabled || false;
                if (document.getElementById('requirePasswordForDelete')) document.getElementById('requirePasswordForDelete').checked = settings.requirePasswordForDelete !== false;
                if (document.getElementById('requirePasswordForReports')) document.getElementById('requirePasswordForReports').checked = settings.requirePasswordForReports || false;
                if (document.getElementById('requirePasswordForSettings')) document.getElementById('requirePasswordForSettings').checked = settings.requirePasswordForSettings !== false;
                if (document.getElementById('enableActivityLog')) document.getElementById('enableActivityLog').checked = settings.activityLogEnabled !== false;
                if (document.getElementById('logRetentionPeriod')) document.getElementById('logRetentionPeriod').value = settings.logRetentionPeriod || 90;
                
                // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
                const passwordFields = document.getElementById('passwordFields');
                if (passwordFields) {
                    passwordFields.style.display = settings.passwordEnabled ? 'block' : 'none';
                }
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                applySecuritySettings(settings);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        function loadBackupSettings() {
            const savedSettings = localStorage.getItem('backupSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                if (document.getElementById('autoBackupEnabled')) document.getElementById('autoBackupEnabled').checked = settings.autoBackupEnabled || false;
                if (document.getElementById('autoBackupFrequency')) document.getElementById('autoBackupFrequency').value = settings.frequency || 'daily';
                if (document.getElementById('backupLocation')) document.getElementById('backupLocation').value = settings.location || '';
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ© Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        function createBackup() {
            createFullBackup();
        }

        function restoreBackup() {
            document.getElementById('backupFileInput')?.click();
        }

        function resetSystem() {
            confirmFactoryReset();
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function exportData(type, format) {
            let data = [];
            let filename = '';
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            switch(type) {
                case 'products':
                    data = products;
                    filename = 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª';
                    break;
                case 'inventory':
                    data = products;
                    filename = 'Ø§Ù„Ù…Ø®Ø²ÙˆÙ†';
                    break;
                case 'invoices':
                    data = salesData;
                    filename = 'Ø§Ù„ÙÙˆØ§ØªÙŠØ±';
                    break;
                case 'debts':
                    data = debtsData;
                    filename = 'Ø§Ù„Ø¯ÙŠÙˆÙ†';
                    break;
                default:
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
            }
            
            if (data.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            try {
                switch(format) {
                    case 'json':
                        exportToJSON(data, filename);
                        break;
                    case 'excel':
                        exportToExcel(data, filename, type);
                        break;
                    case 'pdf':
                        exportToPDF(data, filename, type);
                        break;
                    default:
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }
        
        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ JSON
        function exportToJSON(data, filename) {
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        
        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportToExcel(data, filename, type) {
            if (typeof XLSX === 'undefined') {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            let worksheetData = [];
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (type === 'products' || type === 'inventory') {
                worksheetData = data.map(item => ({
                    'Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯': item.product_barcode || '',
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬': item.product_name || '',
                    'Ø§Ù„ØªØµÙ†ÙŠÙ': categories.find(c => c.category_id === item.product_category)?.category_name || '',
                    'Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹': item.product_price_retail || 0,
                    'Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡': item.product_cost_retail || 0,
                    'Ø§Ù„ÙƒÙ…ÙŠØ©': item.stock_quantity || 0,
                    'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰': item.min_stock || 0,
                    'Ø§Ù„Ù…ÙˆØ±Ø¯': item.supplier || ''
                }));
            } else if (type === 'invoices') {
                worksheetData = data.map(item => ({
                    'Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©': item.invoice_id || '',
                    'Ø§Ù„ØªØ§Ø±ÙŠØ®': new Date(item.timestamp).toLocaleDateString('ar-IQ'),
                    'Ø§Ù„Ø¹Ù…ÙŠÙ„': item.customer_name || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ',
                    'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ': item.final_total || 0,
                    'Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹': item.payment_method || '',
                    'Ø§Ù„Ø®ØµÙ…': item.discount || 0,
                    'Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©': item.tax || 0
                }));
            } else if (type === 'debts') {
                worksheetData = data.map(item => ({
                    'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„': item.customer_name || '',
                    'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ': item.customer_phone || '',
                    'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': item.customer_address || '',
                    'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ': item.total_amount || item.final_total || 0,
                    'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ': item.remaining_amount || 0,
                    'Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ': item.monthly_amount || 0,
                    'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·': item.installment_months || 0,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚': new Date(item.due_date).toLocaleDateString('ar-IQ')
                }));
            }
            
            const worksheet = XLSX.utils.json_to_sheet(worksheetData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, filename);
            XLSX.writeFile(workbook, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
        
        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF
        function exportToPDF(data, filename, type) {
            if (typeof jspdf === 'undefined' || typeof jspdf.jsPDF === 'undefined') {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const { jsPDF } = jspdf;
            const doc = new jsPDF();
            
            // Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ© (ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡ Ø¨Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø¹Ø±Ø¨ÙŠ)
            let headers = [];
            let rows = [];
            
            if (type === 'products' || type === 'inventory') {
                headers = [['Barcode', 'Name', 'Category', 'Price', 'Cost', 'Stock', 'Min', 'Supplier']];
                rows = data.map(item => [
                    item.product_barcode || '',
                    item.product_name || '',
                    categories.find(c => c.category_id === item.product_category)?.category_name || '',
                    formatCurrency(item.product_price_retail || 0),
                    formatCurrency(item.product_cost_retail || 0),
                    item.stock_quantity || 0,
                    item.min_stock || 0,
                    item.supplier || ''
                ]);
            } else if (type === 'invoices') {
                headers = [['Invoice', 'Date', 'Customer', 'Total', 'Method', 'Discount', 'Tax']];
                rows = data.map(item => [
                    item.invoice_id || '',
                    new Date(item.timestamp).toLocaleDateString('ar-IQ'),
                    item.customer_name || 'Cash',
                    formatCurrency(item.final_total || 0),
                    item.payment_method || '',
                    formatCurrency(item.discount || 0),
                    formatCurrency(item.tax || 0)
                ]);
            } else if (type === 'debts') {
                headers = [['Customer', 'Phone', 'Total', 'Remaining', 'Monthly', 'Months', 'Due Date']];
                rows = data.map(item => [
                    item.customer_name || '',
                    item.customer_phone || '',
                    formatCurrency(item.total_amount || item.final_total || 0),
                    formatCurrency(item.remaining_amount || 0),
                    formatCurrency(item.monthly_amount || 0),
                    item.installment_months || 0,
                    new Date(item.due_date).toLocaleDateString('ar-IQ')
                ]);
            }
            
            doc.autoTable({
                head: headers,
                body: rows,
                startY: 20,
                styles: { font: 'helvetica', fontSize: 8 }
            });
            
            doc.save(`${filename}_${new Date().toISOString().split('T')[0]}.pdf`);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function importData(type) {
            const fileInputId = `import${type.charAt(0).toUpperCase() + type.slice(1)}File`;
            const fileInput = document.getElementById(fileInputId);
            
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const file = fileInput.files[0];
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            try {
                if (fileExtension === 'json') {
                    await importFromJSON(file, type);
                } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                    await importFromExcel(file, type);
                } else if (fileExtension === 'csv') {
                    await importFromCSV(file, type);
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† input
            fileInput.value = '';
        }
        
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† JSON
        async function importFromJSON(file, type) {
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(jsonData)) {
                        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                        return;
                    }
                    
                    await processImportedData(jsonData, type);
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© JSON:', error);
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            };
            
            reader.readAsText(file);
        }
        
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel
        async function importFromExcel(file, type) {
            if (typeof XLSX === 'undefined') {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                    const convertedData = convertExcelData(jsonData, type);
                    await processImportedData(convertedData, type);
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Excel:', error);
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† CSV
        async function importFromCSV(file, type) {
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const csvData = e.target.result;
                    const lines = csvData.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    const jsonData = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (!lines[i].trim()) continue;
                        
                        const values = lines[i].split(',');
                        const obj = {};
                        
                        headers.forEach((header, index) => {
                            obj[header] = values[index]?.trim() || '';
                        });
                        
                        jsonData.push(obj);
                    }
                    
                    const convertedData = convertExcelData(jsonData, type);
                    await processImportedData(convertedData, type);
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© CSV:', error);
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            };
            
            reader.readAsText(file);
        }
        
        // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Excel/CSV Ø¥Ù„Ù‰ Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        function convertExcelData(excelData, type) {
            const convertedData = [];
            
            if (type === 'products' || type === 'inventory') {
                excelData.forEach(row => {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØµÙ†ÙŠÙ
                    let categoryId = '';
                    const categoryName = row['Ø§Ù„ØªØµÙ†ÙŠÙ'] || row['Category'] || '';
                    if (categoryName) {
                        const foundCategory = categories.find(c => c.category_name === categoryName);
                        categoryId = foundCategory ? foundCategory.category_id : '';
                    }
                    
                    convertedData.push({
                        type: 'product',
                        product_id: row['product_id'] || Date.now().toString() + Math.random().toString(36).substr(2, 9),
                        product_name: row['Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬'] || row['Name'] || row['product_name'] || '',
                        product_barcode: row['Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯'] || row['Barcode'] || row['product_barcode'] || '',
                        product_price_retail: parseFloat(row['Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹'] || row['Price'] || row['product_price_retail'] || 0),
                        product_price_wholesale: parseFloat(row['Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø©'] || row['Wholesale Price'] || row['product_price_wholesale'] || row['Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹'] || row['Price'] || 0),
                        product_cost_retail: parseFloat(row['Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡'] || row['Cost'] || row['product_cost_retail'] || 0),
                        product_cost_wholesale: parseFloat(row['ØªÙƒÙ„ÙØ© Ø§Ù„Ø¬Ù…Ù„Ø©'] || row['Wholesale Cost'] || row['product_cost_wholesale'] || row['Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡'] || row['Cost'] || 0),
                        stock_quantity: parseInt(row['Ø§Ù„ÙƒÙ…ÙŠØ©'] || row['Stock'] || row['stock_quantity'] || 0),
                        min_stock: parseInt(row['Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰'] || row['Min'] || row['min_stock'] || 5),
                        product_category: row['product_category'] || categoryId || '1',
                        supplier: row['Ø§Ù„Ù…ÙˆØ±Ø¯'] || row['Supplier'] || row['supplier'] || '',
                        timestamp: row['timestamp'] || new Date().toISOString()
                    });
                });
            } else if (type === 'invoices') {
                excelData.forEach(row => {
                    convertedData.push({
                        type: 'sale',
                        invoice_id: row['Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©'] || row['Invoice'] || row['invoice_id'] || 'INV-' + Date.now(),
                        customer_name: row['Ø§Ù„Ø¹Ù…ÙŠÙ„'] || row['Customer'] || row['customer_name'] || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ',
                        final_total: parseFloat(row['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'] || row['Total'] || row['final_total'] || 0),
                        payment_method: row['Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹'] || row['Method'] || row['payment_method'] || 'Ù†Ù‚Ø¯ÙŠ',
                        discount: parseFloat(row['Ø§Ù„Ø®ØµÙ…'] || row['Discount'] || row['discount'] || 0),
                        tax: parseFloat(row['Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©'] || row['Tax'] || row['tax'] || 0),
                        items: row['items'] || '[]',
                        timestamp: row['timestamp'] || new Date().toISOString()
                    });
                });
            } else if (type === 'debts') {
                excelData.forEach(row => {
                    const totalAmount = parseFloat(row['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'] || row['Total'] || row['total_amount'] || 0);
                    const installmentMonths = parseInt(row['Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·'] || row['Months'] || row['installment_months'] || 12);
                    const monthlyAmount = parseFloat(row['Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ'] || row['Monthly'] || row['monthly_amount'] || (totalAmount / installmentMonths));
                    
                    convertedData.push({
                        type: 'debt',
                        customer_name: row['Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„'] || row['Customer'] || row['customer_name'] || '',
                        customer_phone: row['Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ'] || row['Phone'] || row['customer_phone'] || '',
                        customer_address: row['Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'] || row['Address'] || row['customer_address'] || '',
                        total_amount: totalAmount,
                        remaining_amount: parseFloat(row['Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ'] || row['Remaining'] || row['remaining_amount'] || totalAmount),
                        monthly_amount: monthlyAmount,
                        installment_months: installmentMonths,
                        due_date: row['due_date'] || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        invoice_id: row['invoice_id'] || 'INV-' + Date.now(),
                        timestamp: row['timestamp'] || new Date().toISOString()
                    });
                });
            }
            
            return convertedData;
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
        async function processImportedData(data, type) {
            if (!window.dataSdk) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }
            
            let successCount = 0;
            let errorCount = 0;
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            
            for (const item of data) {
                try {
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­
                    if (type === 'products' || type === 'inventory') {
                        item.type = 'product';
                    } else if (type === 'invoices') {
                        item.type = 'sale';
                    } else if (type === 'debts') {
                        item.type = 'debt';
                    }
                    
                    const result = await window.dataSdk.create(item);
                    if (result.isOk) {
                        successCount++;
                    } else {
                        errorCount++;
                        console.error('ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù†ØµØ±:', item, result.error);
                    }
                } catch (error) {
                    errorCount++;
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¹Ù†ØµØ±:', item, error);
                }
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await new Promise(resolve => setTimeout(resolve, 500));
            
            if (successCount > 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù†Ø§ÙØ°Ø©
        document.addEventListener('DOMContentLoaded', () => {
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            const cartSection = document.querySelector('.cart-section');
            const cartItems = document.getElementById('cartItems');
            
            if (cartSection && cartItems) {
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø¹Ù†Ø¯ hover Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
                cartSection.addEventListener('mouseenter', () => {
                    scrollCartToTop();
                });
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„ Ø¹Ù†Ø¯ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¤Ø´Ø±
                cartSection.addEventListener('mouseleave', () => {
                    scrollCartToBottom();
                });
            }
            
            // Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            const closeBtn = document.querySelector('.titlebar-btn.close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    if (window.electronAPI && window.electronAPI.windowClose) {
                        window.electronAPI.windowClose();
                    }
                });
            }
            
            // Ø²Ø± Ø§Ù„ØªØµØºÙŠØ±
            const minimizeBtn = document.querySelector('.titlebar-btn.minimize');
            if (minimizeBtn) {
                minimizeBtn.addEventListener('click', () => {
                    if (window.electronAPI && window.electronAPI.windowMinimize) {
                        window.electronAPI.windowMinimize();
                    }
                });
            }
            
            // Ø²Ø± Ø§Ù„ØªÙƒØ¨ÙŠØ±
            const maximizeBtn = document.querySelector('.titlebar-btn.maximize');
            if (maximizeBtn) {
                let isProcessing = false;
                maximizeBtn.addEventListener('click', () => {
                    if (isProcessing) return;
                    isProcessing = true;
                    if (window.electronAPI && window.electronAPI.windowToggleMaximize) {
                        window.electronAPI.windowToggleMaximize();
                    }
                    setTimeout(() => { isProcessing = false; }, 500); // Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹
                });
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø©
                if (window.electronAPI && window.electronAPI.onWindowMaximized) {
                    window.electronAPI.onWindowMaximized((isMaximized) => {
                        maximizeBtn.classList.toggle('is-maximized', isMaximized);
                    });
                }
            }
        });

        
    </script>
    <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ -->
    
    <!-- Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginOverlay" class="login-overlay" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h2 class="login-title">Ù†Ø¸Ø§Ù… Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h2>
                <p class="login-subtitle">Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            </div>
            
            <form class="login-form" onsubmit="event.preventDefault(); window.securityManager.handleLogin();">
                <div class="login-input-group">
                    <label class="login-label" for="loginUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="loginUsername" class="login-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                </div>
                
                <div class="login-input-group">
                    <label class="login-label" for="loginPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="loginPassword" class="login-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                </div>
                
                <button type="submit" class="login-button">
                    <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
            
            <div style="text-align: center; margin-top: 20px; font-size: 12px; color: var(--theme-text-tertiary);">
                Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: admin / admin123
            </div>
            
            <div style="text-align: center; margin-top: 15px;">
                <button type="button" onclick="window.resetSecuritySystem()" style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px;">
                    <i class="fas fa-sync-alt"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
                </button>
                <p style="font-size: 11px; color: var(--theme-text-tertiary); margin-top: 8px;">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p>
            </div>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†
        window.resetSecuritySystem = function() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.')) {
                console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù†...');
                
                // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                localStorage.removeItem('app_users');
                sessionStorage.clear();
                
                console.log('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                alert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
                window.location.reload();
            }
        };
    </script>

    <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù…Ø§Ù† -->
    <div id="securityPanel" class="security-panel">
        <div class="security-content">
            <div class="security-header">
                <h2 class="security-title">
                    <i class="fas fa-shield-alt"></i>
                    Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                </h2>
                <button class="security-close" onclick="window.securityManager.closeSecurityPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="security-tabs">
                <button class="security-tab active" onclick="window.securityManager.switchSecurityTab('users')">
                    <i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                <button class="security-tab" onclick="window.securityManager.switchSecurityTab('permissions')">
                    <i class="fas fa-key"></i> Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                </button>
            </div>

            <div class="security-body">
                <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
                <div id="usersTab" class="tab-content" style="display: block;">
                    <div class="security-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 class="section-title">
                                <i class="fas fa-users"></i>
                                Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†
                            </h3>
                            <button class="btn-add-user" onclick="window.securityManager.openUserModal()">
                                <i class="fas fa-plus"></i>
                                Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                            </button>
                        </div>

                        <div style="overflow-x: auto;">
                            <table class="users-table">
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                        <th>Ø§Ù„Ø¯ÙˆØ±</th>
                                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
                <div id="permissionsTab" class="tab-content" style="display: none;">
                    <div class="security-section">
                        <h3 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            Ø¯Ù„ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                        </h3>
                        
                        <div class="permissions-grid">
                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-tachometer-alt" style="color: #6366f1;"></i>
                                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-bars" style="color: #8b5cf6;"></i>
                                    Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„Ø¯ÙŠÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-boxes" style="color: #10b981;"></i>
                                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø­Ø°Ù Ù…Ù†ØªØ¬</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-warehouse" style="color: #f59e0b;"></i>
                                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²ÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø®Ø²ÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø­Ø°Ù Ù…Ø®Ø²ÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-cash-register" style="color: #ec4899;"></i>
                                    Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„ØªÙ‚Ø³ÙŠØ·</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨ÙŠØ¹</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-credit-card" style="color: #ef4444;"></i>
                                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø·</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø­Ø°Ù Ø¯ÙŠÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø±Ø³Ø§Ù„ ØªØ°ÙƒÙŠØ±Ø§Øª</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-chart-bar" style="color: #3b82f6;"></i>
                                    Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¯ÙŠÙˆÙ†</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
                                </ul>
                            </div>

                            <div class="permission-card">
                                <div class="permission-card-title">
                                    <i class="fas fa-cog" style="color: #64748b;"></i>
                                    Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                                </div>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</li>
                                    <li style="padding: 8px 0; color: var(--theme-text-secondary);">â€¢ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="userModal" class="user-modal">
        <div class="user-modal-content">
            <div class="user-modal-header">
                <h3 class="user-modal-title" id="userModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
            </div>
            
            <div class="user-modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    
                    <div class="form-group">
                        <label class="form-label" for="userName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                        <input type="text" id="userName" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userUsername">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                        <input type="text" id="userUsername" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="userPassword" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        <small style="color: var(--theme-text-tertiary); font-size: 12px;">Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ù„Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="userRole">Ø§Ù„Ø¯ÙˆØ± *</label>
                        <select id="userRole" class="form-select" required>
                            <option value="user">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="admin">Ù…Ø¯ÙŠØ±</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</label>
                        <div class="permissions-grid" style="margin-top: 10px;">
                            <!-- Dashboard -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_products_count" class="permission-checkbox">
                                    <label for="perm_dashboard_products_count" class="permission-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_inventory_value" class="permission-checkbox">
                                    <label for="perm_dashboard_inventory_value" class="permission-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_debts_count" class="permission-checkbox">
                                    <label for="perm_dashboard_debts_count" class="permission-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_debts_value" class="permission-checkbox">
                                    <label for="perm_dashboard_debts_value" class="permission-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_revenue" class="permission-checkbox">
                                    <label for="perm_dashboard_revenue" class="permission-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_profit" class="permission-checkbox">
                                    <label for="perm_dashboard_profit" class="permission-label">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</label>
                                </div>
                            </div>

                            <!-- Sidebar -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_pos" class="permission-checkbox">
                                    <label for="perm_sidebar_pos" class="permission-label">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_invoices" class="permission-checkbox">
                                    <label for="perm_sidebar_invoices" class="permission-label">Ø§Ù„ÙÙˆØ§ØªÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_products" class="permission-checkbox">
                                    <label for="perm_sidebar_products" class="permission-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_inventory" class="permission-checkbox">
                                    <label for="perm_sidebar_inventory" class="permission-label">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_debts" class="permission-checkbox">
                                    <label for="perm_sidebar_debts" class="permission-label">Ø§Ù„Ø¯ÙŠÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_reports" class="permission-checkbox">
                                    <label for="perm_sidebar_reports" class="permission-label">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_printer" class="permission-checkbox">
                                    <label for="perm_sidebar_printer" class="permission-label">Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sidebar_settings" class="permission-checkbox">
                                    <label for="perm_sidebar_settings" class="permission-label">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</label>
                                </div>
                            </div>

                            <!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_sales_view" class="permission-checkbox">
                                    <label for="perm_sales_view" class="permission-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_view" class="permission-checkbox">
                                    <label for="perm_products_view" class="permission-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_view" class="permission-checkbox">
                                    <label for="perm_inventory_view" class="permission-label">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_debts_view" class="permission-checkbox">
                                    <label for="perm_debts_view" class="permission-label">Ø§Ù„Ø¯ÙŠÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_view" class="permission-checkbox">
                                    <label for="perm_reports_view" class="permission-label">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_settings_view" class="permission-checkbox">
                                    <label for="perm_settings_view" class="permission-label">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</label>
                                </div>
                            </div>

                            <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_add" class="permission-checkbox">
                                    <label for="perm_products_add" class="permission-label">Ø¥Ø¶Ø§ÙØ©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_edit" class="permission-checkbox">
                                    <label for="perm_products_edit" class="permission-label">ØªØ¹Ø¯ÙŠÙ„</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_delete" class="permission-checkbox">
                                    <label for="perm_products_delete" class="permission-label">Ø­Ø°Ù</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_export" class="permission-checkbox">
                                    <label for="perm_products_export" class="permission-label">ØªØµØ¯ÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_import" class="permission-checkbox">
                                    <label for="perm_products_import" class="permission-label">Ø§Ø³ØªÙŠØ±Ø§Ø¯</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_add_category" class="permission-checkbox">
                                    <label for="perm_products_add_category" class="permission-label">Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_products_stock_management" class="permission-checkbox">
                                    <label for="perm_products_stock_management" class="permission-label">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                </div>
                            </div>

                            <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_add" class="permission-checkbox">
                                    <label for="perm_inventory_add" class="permission-label">Ø¥Ø¶Ø§ÙØ©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_edit" class="permission-checkbox">
                                    <label for="perm_inventory_edit" class="permission-label">ØªØ¹Ø¯ÙŠÙ„</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_delete" class="permission-checkbox">
                                    <label for="perm_inventory_delete" class="permission-label">Ø­Ø°Ù</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_adjust" class="permission-checkbox">
                                    <label for="perm_inventory_adjust" class="permission-label">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_history" class="permission-checkbox">
                                    <label for="perm_inventory_history" class="permission-label">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_export" class="permission-checkbox">
                                    <label for="perm_inventory_export" class="permission-label">ØªØµØ¯ÙŠØ±</label>
                                </div>
                            </div>

                            <!-- Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_access" class="permission-checkbox">
                                    <label for="perm_pos_access" class="permission-label">Ø§Ù„ÙˆØµÙˆÙ„</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_sell" class="permission-checkbox">
                                    <label for="perm_pos_sell" class="permission-label">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_add_to_cart" class="permission-checkbox">
                                    <label for="perm_pos_add_to_cart" class="permission-label">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_installment" class="permission-checkbox">
                                    <label for="perm_pos_installment" class="permission-label">Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„ØªÙ‚Ø³ÙŠØ·</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_discount" class="permission-checkbox">
                                    <label for="perm_pos_discount" class="permission-label">Ø¥Ø¶Ø§ÙØ© Ø®ØµÙ…</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_print" class="permission-checkbox">
                                    <label for="perm_pos_print" class="permission-label">Ø·Ø¨Ø§Ø¹Ø©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_pos_cancel" class="permission-checkbox">
                                    <label for="perm_pos_cancel" class="permission-label">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨ÙŠØ¹</label>
                                </div>
                            </div>

                            <!-- Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_invoices_view" class="permission-checkbox">
                                    <label for="perm_invoices_view" class="permission-label">Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_invoices_delete" class="permission-checkbox">
                                    <label for="perm_invoices_delete" class="permission-label">Ø­Ø°Ù Ø§Ù„ÙÙˆØ§ØªÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_invoices_export" class="permission-checkbox">
                                    <label for="perm_invoices_export" class="permission-label">ØªØµØ¯ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ±</label>
                                </div>
                            </div>

                            <!-- Ø§Ù„Ø¯ÙŠÙˆÙ† -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_debts_view_details" class="permission-checkbox">
                                    <label for="perm_debts_view_details" class="permission-label">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_debts_payment" class="permission-checkbox">
                                    <label for="perm_debts_payment" class="permission-label">ØªØ³Ø¯ÙŠØ¯</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_debts_delete" class="permission-checkbox">
                                    <label for="perm_debts_delete" class="permission-label">Ø­Ø°Ù</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_debts_export" class="permission-checkbox">
                                    <label for="perm_debts_export" class="permission-label">ØªØµØ¯ÙŠØ±</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_debts_reminders" class="permission-checkbox">
                                    <label for="perm_debts_reminders" class="permission-label">ØªØ°ÙƒÙŠØ±Ø§Øª</label>
                                </div>
                            </div>

                            <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_sales" class="permission-checkbox">
                                    <label for="perm_reports_sales" class="permission-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_inventory" class="permission-checkbox">
                                    <label for="perm_reports_inventory" class="permission-label">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_debts" class="permission-checkbox">
                                    <label for="perm_reports_debts" class="permission-label">Ø§Ù„Ø¯ÙŠÙˆÙ†</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_profit" class="permission-checkbox">
                                    <label for="perm_reports_profit" class="permission-label">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_export" class="permission-checkbox">
                                    <label for="perm_reports_export" class="permission-label">ØªØµØ¯ÙŠØ±</label>
                                </div>
                            </div>

                            <!-- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
                            <div class="permission-card">
                                <div class="permission-card-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_printer_configure" class="permission-checkbox">
                                    <label for="perm_printer_configure" class="permission-label">Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_printer_test" class="permission-checkbox">
                                    <label for="perm_printer_test" class="permission-label">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_settings_edit" class="permission-checkbox">
                                    <label for="perm_settings_edit" class="permission-label">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_settings_backup" class="permission-checkbox">
                                    <label for="perm_settings_backup" class="permission-label">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_settings_restore" class="permission-checkbox">
                                    <label for="perm_settings_restore" class="permission-label">Ø§Ø³ØªØ¹Ø§Ø¯Ø©</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="window.securityManager.closeUserModal()">
                        <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="button" class="btn-primary" onclick="window.securityManager.saveUser()">
                        <i class="fas fa-save"></i> Ø­ÙØ¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="./reports-system.js"></script>
    <script src="./expenses-system.js"></script>
    
    <!-- =============================================== -->
    <!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <!-- =============================================== -->
    
    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† -->
    <div id="editDebtModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†</h2>
                <button class="close-modal" onclick="closeEditDebtModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editDebtForm" onsubmit="saveEditedDebt(event)">
                    <input type="hidden" id="editDebtId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ <span style="color: red;">*</span></label>
                            <input type="text" id="editDebtCustomerName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                            <input type="tel" id="editDebtCustomerPhone" class="form-input">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ <span style="color: red;">*</span></label>
                            <input type="number" id="editDebtTotalAmount" class="form-input" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label>
                            <input type="number" id="editDebtPaidAmount" class="form-input" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</label>
                            <input type="number" id="editDebtMonths" class="form-input" min="1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                            <input type="number" id="editDebtMonthlyPayment" class="form-input" readonly>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="editDebtNotes" class="form-input" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEditDebtModal()">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ Ù…Ø­Ø³Ù‘Ù†Ø© Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
    <div id="addManualDebtModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯</h2>
                <button class="close-modal" onclick="closeAddManualDebtModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addManualDebtForm" onsubmit="saveManualDebt(event)">
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
                    <h3 style="color: var(--primary-color); margin-bottom: 1rem;">
                        <i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ <span style="color: red;">*</span></label>
                            <input type="text" id="manualDebtCustomerName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span style="color: red;">*</span></label>
                            <input type="tel" id="manualDebtPhone" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" id="manualDebtAddress" class="form-input">
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø© -->
                    <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">
                        <i class="fas fa-shopping-cart"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ø§Ø©
                    </h3>
                    <div id="debtProductsContainer">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="debtProductsTable">
                                <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
                            </tbody>
                        </table>
                        <button type="button" class="btn btn-success" onclick="addDebtProductRow()">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                        </button>
                    </div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ -->
                    <h3 style="color: var(--primary-color); margin: 2rem 0 1rem;">
                        <i class="fas fa-money-bill-wave"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ØªÙ‚Ø³ÙŠØ·
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</label>
                            <input type="number" id="manualDebtTotalAmount" class="form-input" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ù…Ù‚Ø¯Ù…Ø§Ù‹</label>
                            <input type="number" id="manualDebtPaidAmount" class="form-input" min="0" step="0.01" value="0" onchange="calculateManualDebtInstallment()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</label>
                            <input type="number" id="manualDebtRemainingAmount" class="form-input" readonly>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±) <span style="color: red;">*</span></label>
                            <input type="number" id="manualDebtInstallmentMonths" class="form-input" required min="1" value="3" onchange="calculateManualDebtInstallment()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                            <input type="number" id="manualDebtMonthlyAmount" class="form-input" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„ Ù‚Ø³Ø·</label>
                            <input type="date" id="manualDebtFirstDate" class="form-input">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="manualDebtNotes" class="form-input" rows="3" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                    </div>
                    
                    <!-- Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                    <div class="form-group">
                        <label class="form-label">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="manualDebtInvoiceId" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø£Ùˆ Ø§ØªØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ" style="flex: 1;">
                            <button type="button" class="btn btn-secondary" onclick="generateInvoiceNumber()" style="white-space: nowrap;">
                                <i class="fas fa-sync-alt"></i> ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù…
                            </button>
                        </div>
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                            <i class="fas fa-info-circle"></i> Ø¥Ø°Ø§ ØªØ±ÙƒØª Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºØ§Ù‹ØŒ Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                        </small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddManualDebtModal()">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
    <div id="productDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
                <button class="close-modal" onclick="closeProductDetailsModal()">&times;</button>
            </div>
            <div class="modal-body" id="productDetailsContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
    <div id="editProductModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
                <button class="close-modal" onclick="closeEditProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProductForm" onsubmit="saveEditedProduct(event)">
                    <input type="hidden" id="editProductId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ <span style="color: red;">*</span></label>
                            <input type="text" id="editProductName" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ <span style="color: red;">*</span></label>
                            <input type="text" id="editProductBarcode" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                            <select id="editProductCategory" class="form-select">
                                <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø³ØªØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                            <input type="number" id="editProductStock" class="form-input" min="0">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</label>
                            <input type="number" id="editProductCost" class="form-input" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
                            <input type="number" id="editProductPrice" class="form-input" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeEditProductModal()">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨ÙŠÙ† Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
    <div id="moveProductCategoryModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2><i class="fas fa-exchange-alt"></i> Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ ØªØµÙ†ÙŠÙ Ø¢Ø®Ø±</h2>
                <button class="close-modal" onclick="closeMoveProductCategoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="moveProductCategoryForm" onsubmit="saveProductCategoryMove(event)">
                    <input type="hidden" id="moveProductId">
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                        <input type="text" id="moveProductName" class="form-input" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                        <input type="text" id="moveProductCurrentCategory" class="form-input" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ <span style="color: red;">*</span></label>
                        <select id="moveProductNewCategory" class="form-select" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯...</option>
                            <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø³ØªØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeMoveProductCategoryModal()">
                            <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- =============================================== -->
    <!-- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <!-- =============================================== -->
    <script>
    
    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
    // ============================================
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†
    function openEditDebtModal(debtId) {
        const debt = debtsData.find(d => d.id === debtId);
        if (!debt) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        document.getElementById('editDebtId').value = debt.id;
        document.getElementById('editDebtCustomerName').value = debt.customer_name || '';
        document.getElementById('editDebtCustomerPhone').value = debt.customer_phone || '';
        document.getElementById('editDebtTotalAmount').value = debt.total_amount || 0;
        document.getElementById('editDebtPaidAmount').value = debt.paid_amount || 0;
        document.getElementById('editDebtMonths').value = debt.installment_months || 1;
        document.getElementById('editDebtMonthlyPayment').value = debt.monthly_installment || 0;
        document.getElementById('editDebtNotes').value = debt.notes || '';
        
        showModal('editDebtModal');
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†
    function closeEditDebtModal_OLD() {
        // Ù†Ø³Ø®Ø© Ù‚Ø¯ÙŠÙ…Ø© - ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©
        closeModal('editDebtModal');
        document.getElementById('editDebtForm').reset();
    }
    
    // Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¯ÙŠÙ†
    async function saveEditedDebt(event) {
        event.preventDefault();
        
        const debtId = document.getElementById('editDebtId').value;
        const customerName = document.getElementById('editDebtCustomerName').value;
        const customerPhone = document.getElementById('editDebtCustomerPhone').value;
        const totalAmount = parseFloat(document.getElementById('editDebtTotalAmount').value) || 0;
        const paidAmount = parseFloat(document.getElementById('editDebtPaidAmount').value) || 0;
        const months = parseInt(document.getElementById('editDebtMonths').value) || 1;
        const notes = document.getElementById('editDebtNotes').value;
        
        const remainingAmount = totalAmount - paidAmount;
        const monthlyPayment = remainingAmount / months;
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†
        const debtIndex = debtsData.findIndex(d => d.id === debtId);
        if (debtIndex === -1) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        debtsData[debtIndex] = {
            ...debtsData[debtIndex],
            customer_name: customerName,
            customer_phone: customerPhone,
            total_amount: totalAmount,
            paid_amount: paidAmount,
            remaining_amount: remainingAmount,
            installment_months: months,
            monthly_installment: monthlyPayment,
            notes: notes,
            updated_at: new Date().toISOString()
        };
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        await saveToLocalStorage('debtsData', debtsData);
        
        closeEditDebtModal();
        updateDebtsView();
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ† Ø¬Ø¯ÙŠØ¯ Ù…Ø­Ø³Ù‘Ù†Ø©
    let debtProductsArray = [];
    
    function showAddManualDebtModal() {
        manualDebtProducts = [];
        document.getElementById('manualDebtProductsTable').innerHTML = '';
        document.getElementById('manualDebtProductsContainer').style.display = 'none';
        
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('manualDebtCustomerName').value = '';
        document.getElementById('manualDebtCustomerPhone').value = '';
        document.getElementById('manualDebtCustomerAddress').value = '';
        document.getElementById('manualDebtDate').valueAsDate = new Date();
        document.getElementById('manualDebtTotalAmount').value = 0;
        document.getElementById('manualDebtDownPayment').value = 0;
        document.getElementById('manualDebtMonths').value = 12;
        document.getElementById('manualDebtAdditionalAmount').value = 0;
        document.getElementById('manualDebtStartDate').valueAsDate = new Date();
        document.getElementById('manualDebtNotes').value = '';
        
        calculateManualDebtInstallments();
        showModal('addManualDebtModal');
    }
    
    function closeAddManualDebtModal() {
        closeModal('addManualDebtModal');
        manualDebtProducts = [];
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('manualDebtCustomerName').value = '';
        document.getElementById('manualDebtPhone').value = '';
        document.getElementById('manualDebtAddress').value = '';
        document.getElementById('manualDebtTotalAmount').value = '';
        document.getElementById('manualDebtPaidAmount').value = '0';
        document.getElementById('manualDebtRemainingAmount').value = '';
        document.getElementById('manualDebtInstallmentMonths').value = '3';
        document.getElementById('manualDebtMonthlyAmount').value = '';
        document.getElementById('manualDebtFirstDate').value = '';
        document.getElementById('manualDebtNotes').value = '';
        document.getElementById('manualDebtInvoiceId').value = '';
        
        // Ù…Ø³Ø­ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        document.getElementById('debtProductsTable').innerHTML = '';
    }
    
    // Ø¥Ø¶Ø§ÙØ© ØµÙ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
    function addDebtProductRow() {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="text" class="form-input debt-product-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" list="productsList" onchange="updateDebtProductPrice(this)">
                <datalist id="productsList">
                    ${products.map(p => `<option value="${p.name}" data-price="${p.price}">${p.name} - ${p.price} Ø¯ÙŠÙ†Ø§Ø±</option>`).join('')}
                </datalist>
            </td>
            <td>
                <input type="number" class="form-input debt-product-price" placeholder="Ø§Ù„Ø³Ø¹Ø±" min="0" step="0.01" onchange="calculateDebtProductTotal(this)">
            </td>
            <td>
                <input type="number" class="form-input debt-product-quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" min="1" value="1" onchange="calculateDebtProductTotal(this)">
            </td>
            <td>
                <input type="number" class="form-input debt-product-total" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" readonly>
            </td>
            <td>
                <button type="button" class="btn btn-danger btn-sm" onclick="removeDebtProductRow(this)">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        document.getElementById('debtProductsTable').appendChild(row);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø±Ù‡
    function updateDebtProductPrice(input) {
        const productName = input.value;
        const product = products.find(p => p.name === productName);
        if (product) {
            const row = input.closest('tr');
            row.querySelector('.debt-product-price').value = product.price;
            calculateDebtProductTotal(row.querySelector('.debt-product-price'));
        }
    }
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬
    function calculateDebtProductTotal(input) {
        const row = input.closest('tr');
        const price = parseFloat(row.querySelector('.debt-product-price').value) || 0;
        const quantity = parseFloat(row.querySelector('.debt-product-quantity').value) || 0;
        const total = price * quantity;
        row.querySelector('.debt-product-total').value = total.toFixed(2);
        
        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙ†
        calculateManualDebtTotal();
    }
    
    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙ†
    function calculateManualDebtTotal() {
        let total = 0;
        document.querySelectorAll('.debt-product-total').forEach(input => {
            total += parseFloat(input.value) || 0;
        });
        
        document.getElementById('manualDebtTotalAmount').value = total.toFixed(2);
        calculateManualDebtInstallment();
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ
    function calculateManualDebtInstallment() {
        const totalAmount = parseFloat(document.getElementById('manualDebtTotalAmount').value) || 0;
        const paidAmount = parseFloat(document.getElementById('manualDebtPaidAmount').value) || 0;
        const months = parseInt(document.getElementById('manualDebtInstallmentMonths').value) || 1;
        
        const remainingAmount = totalAmount - paidAmount;
        const monthlyAmount = remainingAmount / months;
        
        document.getElementById('manualDebtRemainingAmount').value = remainingAmount.toFixed(2);
        document.getElementById('manualDebtMonthlyAmount').value = monthlyAmount.toFixed(2);
    }
    
    // Ø­Ø°Ù ØµÙ Ù…Ù†ØªØ¬
    function removeDebtProductRow(button) {
        button.closest('tr').remove();
        calculateManualDebtTotal();
    }
    
    // Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
    // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ
    function generateInvoiceNumber() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
        
        const invoiceNumber = `INV-${year}${month}${day}-${random}`;
        document.getElementById('manualDebtInvoiceId').value = invoiceNumber;
        
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    
    // Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
    async function saveManualDebt() {
        const customerName = document.getElementById('manualDebtCustomerName').value.trim();
        const customerPhone = document.getElementById('manualDebtPhone').value.trim();
        const customerAddress = document.getElementById('manualDebtAddress').value.trim();
        const totalAmount = parseFloat(document.getElementById('manualDebtTotalAmount').value) || 0;
        const paidAmount = parseFloat(document.getElementById('manualDebtPaidAmount').value) || 0;
        const months = parseInt(document.getElementById('manualDebtInstallmentMonths').value) || 1;
        const firstDate = document.getElementById('manualDebtFirstDate').value;
        const notes = document.getElementById('manualDebtNotes').value.trim();
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const productRows = document.querySelectorAll('#debtProductsTable tr');
        manualDebtProducts = [];
        productRows.forEach((row, index) => {
            const name = row.querySelector('.debt-product-name').value.trim();
            const price = parseFloat(row.querySelector('.debt-product-price').value) || 0;
            const qty = parseFloat(row.querySelector('.debt-product-quantity').value) || 0;
            const total = parseFloat(row.querySelector('.debt-product-total').value) || 0;
            
            if (name && price > 0 && qty > 0) {
                manualDebtProducts.push({
                    id: index + 1,
                    name: name,
                    price: price,
                    qty: qty,
                    total: total
                });
            }
        });
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø£Ùˆ ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        let invoiceId = document.getElementById('manualDebtInvoiceId').value.trim();
        if (!invoiceId) {
            // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            invoiceId = `INV-${year}${month}${day}-${random}`;
        }
        
        if (!customerName || !customerPhone) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        if (totalAmount <= 0) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        if (!manualDebtProducts || manualDebtProducts.length === 0) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        const remaining = totalAmount - paidAmount;
        const monthly = remaining / months;
        const installments = [];
        const startDateObj = firstDate ? new Date(firstDate) : new Date();
        
        for (let i = 0; i < months; i++) {
            const dueDate = new Date(startDateObj);
            dueDate.setMonth(dueDate.getMonth() + i);
            
            installments.push({
                month: i + 1,
                amount: monthly,
                due_date: dueDate.toISOString(),
                status: 'pending',
                paid_date: null,
                paid_amount: 0
            });
        }
        
        const currentDate = new Date().toISOString();
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
        const newDebt = {
            type: 'debt',
            id: 'debt_' + Date.now(),
            invoice_id: invoiceId,
            customer_name: customerName,
            customer_phone: customerPhone,
            customer_address: customerAddress,
            date: new Date().toISOString().split('T')[0],
            total_amount: totalAmount,
            down_payment: paidAmount,
            additional_amount: 0,
            remaining_amount: remaining,
            paid_amount: paidAmount,
            installment_months: months,
            monthly_amount: monthly,
            start_date: firstDate || new Date().toISOString().split('T')[0],
            notes: notes,
            products: manualDebtProducts || [],
            installments: installments,
            status: 'Ù†Ø´Ø·',
            created_at: currentDate,
            updated_at: currentDate,
            timestamp: currentDate
        };
        
        try {
            if (window.dataSdk) {
                console.log('ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                const result = await window.dataSdk.create(newDebt);
                
                if (result.isOk) {
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                    newDebt.id = result.id || newDebt.id;
                    debtsData.push(newDebt);
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ù†ØªØ¬Ø§Øª
                    if (manualDebtProducts && manualDebtProducts.length > 0) {
                        const invoiceData = {
                            type: 'sale',
                            invoice_id: invoiceId,
                            items: JSON.stringify(manualDebtProducts.map(p => ({
                                product_name: p.name,
                                product_price: p.price,
                                quantity: p.qty,
                                product_id: p.id || null
                            }))),
                            subtotal: manualDebtProducts.reduce((sum, p) => sum + p.total, 0),
                            tax: 0,
                            discount: 0,
                            additional_discount: 0,
                            final_total: totalAmount,
                            payment_method: 'Ø£Ù‚Ø³Ø§Ø·',
                            payment_type: 'Ø£Ù‚Ø³Ø§Ø·',
                            customer_name: customerName,
                            customer_phone: customerPhone,
                            customer_address: customerAddress,
                            debt_id: newDebt.id,
                            timestamp: currentDate,
                            created_by: window.securityManager ? window.securityManager.getCurrentUsername() : 'unknown',
                            created_by_name: window.securityManager ? window.securityManager.getCurrentUserFullName() : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            created_at: currentDate
                        };
                        
                        const invoiceResult = await window.dataSdk.create(invoiceData);
                        if (invoiceResult.isOk) {
                            console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¯ÙŠÙ†');
                        }
                    }
                    
                    // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase
                    if (window.database) {
                        await window.database.ref('debts/' + newDebt.id).set(newDebt);
                    }
                    
                    await saveToLocalStorage('debtsData', debtsData);
                    
                    // âœ… Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ localStorage
                    await ensureDebtsInLocalStorage();
                    
                    closeAddManualDebtModal();
                    renderDebtsTable();
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    throw new Error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†');
                }
            } else {
                throw new Error('dataSdk ØºÙŠØ± Ù…ØªÙˆÙØ±');
            }
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†:', error);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
    }
    
    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙŠÙ†
    // ============================================
    
    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø¯ÙŠÙ†
    function searchProductsForDebt(searchTerm) {
        const resultsContainer = document.getElementById('manualDebtProductSearchResults');
        
        if (!searchTerm || searchTerm.trim() === '') {
            resultsContainer.style.display = 'none';
            return;
        }
        
        const filtered = products.filter(p => 
            p.name && p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            p.barcode && p.barcode.includes(searchTerm)
        );
        
        if (filtered.length === 0) {
            resultsContainer.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
            resultsContainer.style.display = 'block';
            return;
        }
        
        resultsContainer.innerHTML = filtered.map(p => `
            <div onclick="selectProductForDebt('${p.id}')" style="padding: 0.75rem; cursor: pointer; border-bottom: 1px solid var(--theme-border-color); transition: all 0.2s;"
                 onmouseover="this.style.background='var(--theme-bg-secondary)'" 
                 onmouseout="this.style.background='transparent'">
                <div style="font-weight: 500; color: var(--theme-text-primary);">${p.name}</div>
                <div style="font-size: 0.85rem; color: var(--theme-text-secondary);">
                    ${p.product_cost_retail ? p.product_cost_retail.toLocaleString() : '0'} Ø¯ÙŠÙ†Ø§Ø±
                </div>
            </div>
        `).join('');
        
        resultsContainer.style.display = 'block';
    }
    
    // Ø¯Ø§Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ Ù…Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
    function selectProductForDebt(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;
        
        document.getElementById('manualDebtProductName').value = product.name;
        document.getElementById('manualDebtProductPrice').value = product.product_cost_retail || 0;
        document.getElementById('manualDebtProductQty').value = 1;
        document.getElementById('manualDebtProductSearchResults').style.display = 'none';
        document.getElementById('manualDebtProductSearch').value = '';
    }
    
    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯ÙŠÙ†
    function addManualDebtProduct() {
        const name = document.getElementById('manualDebtProductName').value.trim();
        const price = parseFloat(document.getElementById('manualDebtProductPrice').value) || 0;
        const qty = parseInt(document.getElementById('manualDebtProductQty').value) || 1;
        
        if (!name || price <= 0 || qty <= 0) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const total = price * qty;
        manualDebtProducts.push({ name, price, qty, total });
        
        renderManualDebtProducts();
        updateManualDebtTotal();
        
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        document.getElementById('manualDebtProductName').value = '';
        document.getElementById('manualDebtProductPrice').value = '';
        document.getElementById('manualDebtProductQty').value = 1;
    }
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function renderManualDebtProducts() {
        const container = document.getElementById('manualDebtProductsContainer');
        const tbody = document.getElementById('manualDebtProductsTable');
        
        if (manualDebtProducts.length === 0) {
            container.style.display = 'none';
            return;
        }
        
        container.style.display = 'block';
        tbody.innerHTML = manualDebtProducts.map((p, index) => `
            <tr>
                <td>${p.name}</td>
                <td>${p.price.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                <td>${p.qty}</td>
                <td>${p.total.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                <td>
                    <button class="action-btn delete-btn" onclick="removeManualDebtProduct(${index})" title="Ø­Ø°Ù">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }
    
    // Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ù…Ù†ØªØ¬
    function removeManualDebtProduct(index) {
        manualDebtProducts.splice(index, 1);
        renderManualDebtProducts();
        updateManualDebtTotal();
    }
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    function updateManualDebtTotal() {
        const total = manualDebtProducts.reduce((sum, p) => sum + p.total, 0);
        document.getElementById('manualDebtTotalAmount').value = total;
        calculateManualDebtInstallments();
    }
    
    // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    function calculateManualDebtInstallments() {
        const totalAmount = parseFloat(document.getElementById('manualDebtTotalAmount').value) || 0;
        const downPayment = parseFloat(document.getElementById('manualDebtDownPayment').value) || 0;
        const months = parseInt(document.getElementById('manualDebtMonths').value) || 1;
        const additionalAmount = parseFloat(document.getElementById('manualDebtAdditionalAmount').value) || 0;
        
        const remaining = totalAmount - downPayment + additionalAmount;
        const monthly = remaining / months;
        const finalTotal = totalAmount + additionalAmount;
        
        document.getElementById('manualDebtRemainingAmount').textContent = remaining.toLocaleString() + ' Ø¯ÙŠÙ†Ø§Ø±';
        document.getElementById('manualDebtMonthlyAmount').textContent = monthly.toLocaleString() + ' Ø¯ÙŠÙ†Ø§Ø±';
        document.getElementById('manualDebtFinalTotal').textContent = finalTotal.toLocaleString() + ' Ø¯ÙŠÙ†Ø§Ø±';
    }
    
    // Ø¯ÙˆØ§Ù„ Ù…Ù…Ø§Ø«Ù„Ø© Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    function searchProductsForEditDebt(searchTerm) {
        const resultsContainer = document.getElementById('editDebtProductSearchResults');
        
        if (!searchTerm || searchTerm.trim() === '') {
            resultsContainer.style.display = 'none';
            return;
        }
        
        const filtered = products.filter(p => 
            p.name && p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            p.barcode && p.barcode.includes(searchTerm)
        );
        
        if (filtered.length === 0) {
            resultsContainer.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--theme-text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
            resultsContainer.style.display = 'block';
            return;
        }
        
        resultsContainer.innerHTML = filtered.map(p => `
            <div onclick="selectProductForEditDebt('${p.id}')" style="padding: 0.75rem; cursor: pointer; border-bottom: 1px solid var(--theme-border-color); transition: all 0.2s;"
                 onmouseover="this.style.background='var(--theme-bg-secondary)'" 
                 onmouseout="this.style.background='transparent'">
                <div style="font-weight: 500; color: var(--theme-text-primary);">${p.name}</div>
                <div style="font-size: 0.85rem; color: var(--theme-text-secondary);">
                    ${p.product_cost_retail ? p.product_cost_retail.toLocaleString() : '0'} Ø¯ÙŠÙ†Ø§Ø±
                </div>
            </div>
        `).join('');
        
        resultsContainer.style.display = 'block';
    }
    
    function selectProductForEditDebt(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;
        
        document.getElementById('editDebtProductName').value = product.name;
        document.getElementById('editDebtProductPrice').value = product.product_cost_retail || 0;
        document.getElementById('editDebtProductQty').value = 1;
        document.getElementById('editDebtProductSearchResults').style.display = 'none';
        document.getElementById('editDebtProductSearch').value = '';
    }
    
    function addEditDebtProduct() {
        const name = document.getElementById('editDebtProductName').value.trim();
        const price = parseFloat(document.getElementById('editDebtProductPrice').value) || 0;
        const qty = parseInt(document.getElementById('editDebtProductQty').value) || 1;
        
        if (!name || price <= 0 || qty <= 0) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const total = price * qty;
        editDebtProducts.push({ name, price, qty, total });
        
        renderEditDebtProducts();
        updateEditDebtTotal();
        
        document.getElementById('editDebtProductName').value = '';
        document.getElementById('editDebtProductPrice').value = '';
        document.getElementById('editDebtProductQty').value = 1;
    }
    
    function renderEditDebtProducts() {
        const container = document.getElementById('editDebtProductsContainer');
        const tbody = document.getElementById('editDebtProductsTable');
        
        if (editDebtProducts.length === 0) {
            container.style.display = 'none';
            return;
        }
        
        container.style.display = 'block';
        tbody.innerHTML = editDebtProducts.map((p, index) => `
            <tr>
                <td>${p.name}</td>
                <td>${p.price.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                <td>${p.qty}</td>
                <td>${p.total.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                <td>
                    <button class="action-btn delete-btn" onclick="removeEditDebtProduct(${index})" title="Ø­Ø°Ù">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }
    
    function removeEditDebtProduct(index) {
        editDebtProducts.splice(index, 1);
        renderEditDebtProducts();
        updateEditDebtTotal();
    }
    
    function updateEditDebtTotal() {
        const total = editDebtProducts.reduce((sum, p) => sum + p.total, 0);
        document.getElementById('editDebtTotalAmount').value = total;
        calculateEditDebtInstallments();
    }
    
    function calculateEditDebtInstallments() {
        const totalAmount = parseFloat(document.getElementById('editDebtTotalAmount').value) || 0;
        const downPayment = parseFloat(document.getElementById('editDebtDownPayment').value) || 0;
        const months = parseInt(document.getElementById('editDebtMonths').value) || 1;
        const additionalAmount = parseFloat(document.getElementById('editDebtAdditionalAmount').value) || 0;
        
        const remaining = totalAmount - downPayment + additionalAmount;
        const monthly = remaining / months;
        const finalTotal = totalAmount + additionalAmount;
        
        document.getElementById('editDebtRemainingAmount').textContent = remaining.toLocaleString() + ' Ø¯ÙŠÙ†Ø§Ø±';
        document.getElementById('editDebtMonthlyAmount').textContent = monthly.toLocaleString() + ' Ø¯ÙŠÙ†Ø§Ø±';
        document.getElementById('editDebtFinalTotal').textContent = finalTotal.toLocaleString() + ' Ø¯ÙŠÙ†Ø§Ø±';
    }
    
    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    async function showEditDebtModal(debtId) {
        console.log('ğŸ” ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†:', debtId, 'Ù†ÙˆØ¹:', typeof debtId);
        currentEditDebtId = debtId;
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ØªØ¯Ø¹Ù… ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª
        const compareIds = (id1, id2) => {
            if (id1 == id2) return true; // Ù…Ù‚Ø§Ø±Ù†Ø© Ø¹Ø§Ø¯ÙŠØ© (== Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† ===)
            if (String(id1) === String(id2)) return true; // Ù…Ù‚Ø§Ø±Ù†Ø© ÙƒÙ†ØµÙˆØµ
            if (Number(id1) === Number(id2)) return true; // Ù…Ù‚Ø§Ø±Ù†Ø© ÙƒØ£Ø±Ù‚Ø§Ù…
            return false;
        };
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ debtsData Ø£ÙˆÙ„Ø§Ù‹
        let debt = debtsData.find(d => {
            const id = d.id || d.__backendId || d.debt_id;
            return compareIds(id, debtId);
        });
        
        console.log('ğŸ“Š Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ debtsData:', debt ? 'ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡' : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ±');
        console.log('ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ debtsData:', debtsData.length);
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡ØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ dataSdk
        if (!debt && window.dataSdk) {
            console.log('ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ dataSdk...');
            const allData = window.dataSdk.getAll();
            console.log('ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ dataSdk:', allData.length);
            
            const allDebts = allData.filter(item => item.type === 'debt');
            console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ dataSdk:', allDebts.length);
            console.log('ğŸ“‹ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø¯ÙŠÙˆÙ†:', allDebts.map(d => ({
                id: d.id,
                __backendId: d.__backendId,
                debt_id: d.debt_id,
                customer: d.customer_name
            })));
            
            debt = allDebts.find(d => {
                const id = d.id || d.__backendId || d.debt_id;
                return compareIds(id, debtId);
            });
            
            if (debt) {
                console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙ† ÙÙŠ dataSdk');
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø¥Ù„Ù‰ debtsData Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                if (!debtsData.find(d => compareIds(d.id || d.__backendId || d.debt_id, debtId))) {
                    debtsData.push(debt);
                    console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙŠÙ† Ø¥Ù„Ù‰ debtsData');
                }
            }
        }
        
        if (!debt) {
            console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙ†:', debtId);
            console.error('ğŸ“‹ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ debtsData:', debtsData.map(d => d.id || d.__backendId || d.debt_id));
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        console.log('âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†:', debt);
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('editDebtCustomerName').value = debt.customer_name || '';
        document.getElementById('editDebtCustomerPhone').value = debt.customer_phone || '';
        document.getElementById('editDebtCustomerAddress').value = debt.customer_address || '';
        document.getElementById('editDebtDate').value = debt.date || new Date().toISOString().split('T')[0];
        document.getElementById('editDebtTotalAmount').value = debt.total_amount || 0;
        document.getElementById('editDebtDownPayment').value = debt.down_payment || debt.paid_amount || 0;
        document.getElementById('editDebtMonths').value = debt.installment_months || 1;
        document.getElementById('editDebtAdditionalAmount').value = debt.additional_amount || 0;
        document.getElementById('editDebtStartDate').value = debt.start_date || '';
        document.getElementById('editDebtNotes').value = debt.notes || '';
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        editDebtProducts = debt.products ? [...debt.products] : [];
        renderEditDebtProducts();
        calculateEditDebtInstallments();
        
        showModal('editDebtModal');
    }
    
    function closeEditDebtModal() {
        closeModal('editDebtModal');
        currentEditDebtId = null;
        editDebtProducts = [];
    }
    
    // Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
    async function updateDebt() {
        if (!currentEditDebtId) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ØªØ¯Ø¹Ù… ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª
        const compareIds = (id1, id2) => {
            if (id1 == id2) return true;
            if (String(id1) === String(id2)) return true;
            if (Number(id1) === Number(id2)) return true;
            return false;
        };
        
        const debtIndex = debtsData.findIndex(d => {
            const id = d.id || d.__backendId || d.debt_id;
            return compareIds(id, currentEditDebtId);
        });
        
        if (debtIndex === -1) {
            console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙ† ÙÙŠ debtsData:', currentEditDebtId);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const customerName = document.getElementById('editDebtCustomerName').value.trim();
        const customerPhone = document.getElementById('editDebtCustomerPhone').value.trim();
        
        if (!customerName || !customerPhone) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const totalAmount = parseFloat(document.getElementById('editDebtTotalAmount').value) || 0;
        const downPayment = parseFloat(document.getElementById('editDebtDownPayment').value) || 0;
        const months = parseInt(document.getElementById('editDebtMonths').value) || 1;
        const additionalAmount = parseFloat(document.getElementById('editDebtAdditionalAmount').value) || 0;
        const startDate = document.getElementById('editDebtStartDate').value;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const remaining = totalAmount - downPayment + additionalAmount;
        const monthly = remaining / months;
        const installments = [];
        const startDateObj = startDate ? new Date(startDate) : new Date();
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
        for (let i = 0; i < months; i++) {
            const dueDate = new Date(startDateObj);
            dueDate.setMonth(dueDate.getMonth() + i);
            
            // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const existingInstallment = debtsData[debtIndex].installments?.[i];
            
            installments.push({
                month: i + 1,
                amount: monthly,
                due_date: dueDate.toISOString(),
                status: existingInstallment?.status || 'pending',
                paid_date: existingInstallment?.paid_date || null,
                paid_amount: existingInstallment?.paid_amount || 0
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙŠÙ†
        const updatedDebt = {
            ...debtsData[debtIndex],
            type: 'debt',
            customer_name: customerName,
            customer_phone: customerPhone,
            customer_address: document.getElementById('editDebtCustomerAddress').value.trim() || '',
            date: document.getElementById('editDebtDate').value || new Date().toISOString().split('T')[0],
            total_amount: totalAmount,
            down_payment: downPayment,
            additional_amount: additionalAmount,
            remaining_amount: remaining,
            paid_amount: downPayment,
            installment_months: months,
            monthly_amount: monthly,
            start_date: startDate || new Date().toISOString().split('T')[0],
            notes: document.getElementById('editDebtNotes').value.trim() || '',
            products: editDebtProducts || [],
            installments: installments,
            status: debtsData[debtIndex].status || 'Ù†Ø´Ø·',
            updated_at: new Date().toISOString(),
            timestamp: debtsData[debtIndex].timestamp || new Date().toISOString()
        };
        
        // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø­Ù‚ÙˆÙ„ undefined
        Object.keys(updatedDebt).forEach(key => {
            if (updatedDebt[key] === undefined) {
                delete updatedDebt[key];
            }
        });
        
        debtsData[debtIndex] = updatedDebt;
        
        // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… dataSdk Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
            if (window.dataSdk && debtsData[debtIndex].id) {
                const result = await window.dataSdk.update(debtsData[debtIndex].id, updatedDebt);
                if (!result.isOk) {
                    console.warn('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« dataSdkØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Firebase...');
                }
            }
            
            if (window.database) {
                const debtRef = window.database.ref('debts/' + currentEditDebtId);
                await debtRef.set(updatedDebt);
            }
            
            await saveToLocalStorage('debtsData', debtsData);
            
            closeEditDebtModal();
            renderDebtsTable();
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª:', error);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© processInstallmentPayment Ù„ØªØ¶Ù…ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ®
    async function processInstallmentPaymentUpdated() {
        const customerName = document.getElementById('customerName').value.trim();
        const customerPhone = document.getElementById('customerPhone').value.trim();
        const customerAddress = document.getElementById('customerAddress').value.trim();
        const months = parseInt(document.getElementById('installmentMonths').value) || 12;
        const additionalAmount = parseFloat(document.getElementById('additionalAmount').value) || 0;
        const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
        const startDate = document.getElementById('installmentStartDate').value;
        
        if (!customerName || !customerPhone) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        if (cart.length === 0) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const totalWithAddition = cartTotal + additionalAmount;
        const remainingAmount = totalWithAddition - downPayment;
        const monthlyPayment = remainingAmount / months;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
        const installments = [];
        const startDateObj = startDate ? new Date(startDate) : new Date();
        
        for (let i = 0; i < months; i++) {
            const dueDate = new Date(startDateObj);
            dueDate.setMonth(dueDate.getMonth() + i);
            
            installments.push({
                month: i + 1,
                amount: monthlyPayment,
                due_date: dueDate.toISOString(),
                status: 'pending',
                paid_date: null,
                paid_amount: 0
            });
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙŠÙ†
        const debt = {
            id: 'debt_' + Date.now(),
            customer_name: customerName,
            customer_phone: customerPhone,
            customer_address: customerAddress,
            total_amount: totalWithAddition,
            down_payment: downPayment,
            remaining_amount: remainingAmount,
            installment_months: months,
            monthly_amount: monthlyPayment,
            additional_amount: additionalAmount,
            start_date: startDate,
            installments: installments,
            products: cart.map(item => ({
                name: item.name,
                price: item.price,
                qty: item.quantity,
                total: item.price * item.quantity
            })),
            date: new Date().toISOString(),
            status: 'active',
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString()
        };
        
        debtsData.push(debt);
        
        // Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        try {
            if (window.database) {
                await window.database.ref('debts/' + debt.id).set(debt);
            }
            
            await saveToLocalStorage('debtsData', debtsData);
            
            cart = [];
            updateCartDisplay();
            closeModal('paymentModal');
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            updateDebtsView();
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯ÙŠÙ†:', error);
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        }
    }
    
    // ============================================
    // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
    // ============================================
    
    // Ø¯ÙˆØ§Ù„ Ø¨Ø­Ø« Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ù…Ù†ØªØ¬
    function findProductById(productId) {
        return products.find(
            p => String(p.id) === String(productId) || String(p.product_id) === String(productId) || String(p.barcode) === String(productId)
        );
    }
    function findProductIndexById(productId) {
        return products.findIndex(
            p => String(p.id) === String(productId) || String(p.product_id) === String(productId) || String(p.barcode) === String(productId)
        );
    }

    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
    function showProductDetails(productId) {
        const product = findProductById(productId);
        if (!product) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const totalCost = (product.cost || 0) * (product.stock || 0);
        const totalValue = (product.price || 0) * (product.stock || 0);
        const expectedProfit = totalValue - totalCost;
        const profitMargin = totalCost > 0 ? ((expectedProfit / totalCost) * 100).toFixed(2) : 0;
        
        const content = `
            <div style="padding: 1rem;">
                <div class="stats-grid" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</div>
                        <div class="stat-value" style="font-size: 1.2rem;">${product.name}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</div>
                        <div class="stat-value" style="font-size: 1.2rem;">${product.barcode}</div>
                    </div>
                </div>
                
                <table class="table">
                    <tbody>
                        <tr>
                            <th><i class="fas fa-layer-group"></i> Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                            <td>${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-warehouse"></i> Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©</th>
                            <td>${product.stock || 0}</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-coins"></i> Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                            <td>${(product.cost || 0).toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-money-bill"></i> Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                            <td>${(product.price || 0).toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-chart-line"></i> Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                            <td>${totalCost.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-dollar-sign"></i> Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th>
                            <td>${totalValue.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-chart-pie"></i> Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
                            <td style="color: ${expectedProfit >= 0 ? 'var(--success-color)' : 'var(--danger-color)'};">
                                ${expectedProfit.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±
                            </td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-percent"></i> Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</th>
                            <td>${profitMargin}%</td>
                        </tr>
                        <tr>
                            <th><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                            <td>${product.created_at ? new Date(product.created_at).toLocaleDateString('ar-IQ') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="closeProductDetailsModal(); openEditProductModal('${product.id}');">
                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                    </button>
                    <button class="btn btn-secondary" onclick="closeProductDetailsModal()">
                        <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                    </button>
                </div>
            </div>
        `;
        
        document.getElementById('productDetailsContent').innerHTML = content;
        showModal('productDetailsModal');
    }
    
    function closeProductDetailsModal() {
        hideModal('productDetailsModal');
    }
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
    function openEditProductModal(productId) {
        const product = findProductById(productId);
        if (!product) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        document.getElementById('editProductId').value = product.id || '';
        document.getElementById('editProductName').value = product.name || '';
        document.getElementById('editProductBarcode').value = product.barcode || '';
        document.getElementById('editProductStock').value = product.stock != null ? product.stock : 0;
        document.getElementById('editProductCost').value = product.cost != null ? product.cost : 0;
        document.getElementById('editProductPrice').value = product.price != null ? product.price : 0;
        // Ù…Ù„Ø¡ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        const categorySelect = document.getElementById('editProductCategory');
        categorySelect.innerHTML = '<option value="">Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ</option>';
        if (Array.isArray(categories) && categories.length > 0) {
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.name;
                if (product.category === cat.name) option.selected = true;
                categorySelect.appendChild(option);
            });
        }
        showModal('editProductModal');
    }
    
    function closeEditProductModal() {
        hideModal('editProductModal');
        document.getElementById('editProductForm').reset();
    }
    
    // Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
    async function saveEditedProduct(event) {
        event.preventDefault();
        
        const productId = document.getElementById('editProductId').value;
        const name = document.getElementById('editProductName').value;
        const barcode = document.getElementById('editProductBarcode').value;
        const category = document.getElementById('editProductCategory').value;
        const stock = parseInt(document.getElementById('editProductStock').value) || 0;
        const cost = parseFloat(document.getElementById('editProductCost').value) || 0;
        const price = parseFloat(document.getElementById('editProductPrice').value) || 0;
        
        const productIndex = findProductIndexById(productId);
        if (productIndex === -1) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        products[productIndex] = {
            ...products[productIndex],
            name: name,
            barcode: barcode,
            category: category,
            stock: stock,
            cost: cost,
            price: price,
            updated_at: new Date().toISOString()
        };
        if (window.dataSdk) {
            await window.dataSdk.save({ ...products[productIndex], type: 'product' });
        }
        closeEditProductModal();
        updateInventoryView();
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    
    // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬
    async function deleteProduct(productId) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!')) {
            return;
        }
        const productIndex = findProductIndexById(productId);
        if (productIndex === -1) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        if (window.dataSdk) {
            await window.dataSdk.delete(productId);
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù (Ø§Ù†ØªØ¸Ø§Ø± ÙØ¹Ù„ÙŠ)
            if (typeof window.dataSdk.getAll === 'function') {
                const allData = await window.dataSdk.getAll();
                products = allData.filter(item => item.type === 'product');
            }
        }
        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
        if (typeof updateAllViews === 'function') {
            updateAllViews();
        } else if (typeof updateInventoryView === 'function') {
            updateInventoryView();
        }
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨ÙŠÙ† Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
    function openMoveProductCategoryModal(productId) {
        const product = findProductById(productId);
        if (!product) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        document.getElementById('moveProductId').value = product.id;
        document.getElementById('moveProductName').value = product.name;
        document.getElementById('moveProductCurrentCategory').value = product.category || 'Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠÙ';
        
        // Ù…Ù„Ø¡ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        const categorySelect = document.getElementById('moveProductNewCategory');
        categorySelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯...</option>';
        categories.forEach(cat => {
            if (cat.name !== product.category) {
                const option = document.createElement('option');
                option.value = cat.name;
                option.textContent = cat.name;
                categorySelect.appendChild(option);
            }
        });
        
        showModal('moveProductCategoryModal');
    }
    
    function closeMoveProductCategoryModal() {
        hideModal('moveProductCategoryModal');
        document.getElementById('moveProductCategoryForm').reset();
    }
    
    // Ø­ÙØ¸ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯
    async function saveProductCategoryMove(event) {
        event.preventDefault();
        
        const productId = document.getElementById('moveProductId').value;
        const newCategory = document.getElementById('moveProductNewCategory').value;
        
        if (!newCategory) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        const productIndex = products.findIndex(p => p.id === productId);
        if (productIndex === -1) {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            return;
        }
        
        products[productIndex].category = newCategory;
        products[productIndex].updated_at = new Date().toISOString();
        
        await dataSDK.save({ ...products[productIndex], type: 'product' });
        
        closeMoveProductCategoryModal();
        updateInventoryView();
        // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
    }
    
    // Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    function printInventoryReport() {
        const storeSettings = JSON.parse(localStorage.getItem('storeSettings') || '{}');
        const storeName = storeSettings.storeName || storeSettings.store_name || 'Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±';
        const today = new Date().toLocaleDateString('ar-IQ');
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        let totalCost = 0;
        let totalValue = 0;
        let totalProfit = 0;
        
        products.forEach(product => {
            const cost = (product.cost || 0) * (product.stock || 0);
            const value = (product.price || 0) * (product.stock || 0);
            totalCost += cost;
            totalValue += value;
        });
        
        totalProfit = totalValue - totalCost;
        const profitMargin = totalCost > 0 ? ((totalProfit / totalCost) * 100).toFixed(2) : 0;
        
        let html = `
        <div style="width:100%;max-width:800px;margin:0 auto;padding:20px;font-family:'Cairo',sans-serif;background:#fff;color:#222;direction:rtl;">
            <div style="text-align:center;margin-bottom:20px;border-bottom:3px solid #6366f1;padding-bottom:15px;">
                <h1 style="margin:0 0 5px 0;font-size:2rem;color:#2d3748;">${storeName}</h1>
                <h2 style="margin:0;font-size:1.5rem;color:#6366f1;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø´Ø§Ù…Ù„</h2>
                <p style="margin:10px 0 0;font-size:1rem;color:#666;">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}</p>
            </div>
            
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:25px;">
                <div style="background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;padding:15px;border-radius:10px;text-align:center;">
                    <div style="font-size:0.9rem;margin-bottom:5px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</div>
                    <div style="font-size:1.5rem;font-weight:bold;">${totalCost.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</div>
                </div>
                <div style="background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:15px;border-radius:10px;text-align:center;">
                    <div style="font-size:0.9rem;margin-bottom:5px;">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</div>
                    <div style="font-size:1.5rem;font-weight:bold;">${totalValue.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</div>
                </div>
                <div style="background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;padding:15px;border-radius:10px;text-align:center;">
                    <div style="font-size:0.9rem;margin-bottom:5px;">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
                    <div style="font-size:1.5rem;font-weight:bold;">${totalProfit.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</div>
                </div>
            </div>
            
            <table style="width:100%;border-collapse:collapse;margin-top:20px;">
                <thead>
                    <tr style="background:#6366f1;color:#fff;">
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">#</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:right;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                        <th style="padding:10px;border:1px solid #ddd;text-align:center;">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th>
                    </tr>
                </thead>
                <tbody>`;
        
        products.forEach((product, index) => {
            const cost = (product.cost || 0) * (product.stock || 0);
            const value = (product.price || 0) * (product.stock || 0);
            
            html += `
                <tr style="background:${index % 2 === 0 ? '#fff' : '#f9fafb'};">
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${index + 1}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:right;">${product.name}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${product.category || '-'}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${product.stock || 0}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${(product.cost || 0).toLocaleString()}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${(product.price || 0).toLocaleString()}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${cost.toLocaleString()}</td>
                    <td style="padding:8px;border:1px solid #ddd;text-align:center;">${value.toLocaleString()}</td>
                </tr>`;
        });
        
        html += `
                </tbody>
            </table>
            
            <div style="margin-top:30px;padding:20px;background:#f9fafb;border-radius:10px;text-align:center;">
                <p style="font-size:1.2rem;color:#6366f1;font-weight:bold;margin:0;">
                    Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${profitMargin}%
                </p>
            </div>
            
            <div style="margin-top:30px;text-align:center;color:#666;font-size:0.9rem;">
                <p style="margin:5px 0;">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</p>
                <p style="margin:5px 0;">Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ - Ø¥Ø¯Ø§Ø±Ø© ÙƒØ±Ø§Ø± Ø§Ù„Ø³Ø¹Ø¨Ø±ÙŠ</p>
            </div>
        </div>`;
        
        if (window.electronAPI && window.electronAPI.printInvoiceHtml) {
            window.electronAPI.printInvoiceHtml(html, { silent: false });
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        } else {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
    const originalUpdateInventoryView = window.updateInventoryView;
    window.updateInventoryView = function() {
        if (originalUpdateInventoryView) {
            originalUpdateInventoryView();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
        const inventoryTableBody = document.getElementById('inventoryTableBody');
        if (inventoryTableBody) {
            const rows = inventoryTableBody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                const product = products[index];
                if (product && row.cells.length < 8) {
                    const actionsCell = row.insertCell(-1);
                    actionsCell.innerHTML = `
                        <div class="action-buttons">
                            <button class="btn-icon btn-info" onclick="showProductDetails('${product.id}')" title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="btn-icon btn-primary" onclick="openEditProductModal('${product.id}')" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-warning" onclick="openMoveProductCategoryModal('${product.id}')" title="Ù†Ù‚Ù„">
                                <i class="fas fa-exchange-alt"></i>
                            </button>
                            <button class="btn-icon btn-danger" onclick="deleteProduct('${product.id}')" title="Ø­Ø°Ù">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                }
            });
        }
    };
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ† Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    const originalUpdateDebtsView = window.updateDebtsView;
    window.updateDebtsView = function() {
        if (originalUpdateDebtsView) {
            originalUpdateDebtsView();
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„ÙƒÙ„ Ø¯ÙŠÙ†
        const debtsTableBody = document.getElementById('debtsTableBody');
        if (debtsTableBody) {
            const rows = debtsTableBody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                const debt = debtsData[index];
                if (debt) {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®Ù„ÙŠØ© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                    const actionsCell = row.cells[row.cells.length - 1];
                    if (actionsCell && !actionsCell.querySelector('.edit-debt-btn')) {
                        const editButton = document.createElement('button');
                        editButton.className = 'btn-icon btn-warning edit-debt-btn';
                        editButton.title = 'ØªØ¹Ø¯ÙŠÙ„';
                        editButton.innerHTML = '<i class="fas fa-edit"></i>';
                        editButton.onclick = () => openEditDebtModal(debt.id);
                        
                        actionsCell.insertBefore(editButton, actionsCell.firstChild);
                    }
                }
            });
        }
    };
    
    // Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø´Ø§Ù…Ù„Ø©
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
    
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ”„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª...');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
        if (typeof updateInventoryView === 'function') {
            updateInventoryView();
        }
        if (typeof updateDebtsView === 'function') {
            updateDebtsView();
        }
    });






    
    
    </script>
    
    <!-- ğŸ’° Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ -->
    <script>
    // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
    (function() {
        'use strict';

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
        let allPayments = [];
        let filteredPayments = [];
        let currentFilters = {
            searchText: '',
            dateFrom: '',
            dateTo: '',
            status: 'all',
            sortBy: 'date_desc'
        };

        /**
         * ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
         */
        window.initPaymentsPage = async function() {
            console.log('ğŸ”§ ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª...');
            await loadAllPayments();
            setupPaymentsEventListeners();
            applyPaymentsFilters();
            updatePaymentsStats();
        };

        /**
         * ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ù…Ù† Ø§Ù„Ø¯ÙŠÙˆÙ†
         */
        async function loadAllPayments() {
            try {
                allPayments = [];
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙŠÙˆÙ†
                const debts = window.dataSdk.query({ type: 'debt' });
                
                if (!debts || debts.length === 0) {
                    console.log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙŠÙˆÙ† Ù…Ø­ÙÙˆØ¸Ø©');
                    return;
                }
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ù† Ø§Ù„Ø¯ÙŠÙˆÙ†
                debts.forEach(debt => {
                    if (debt.installments && Array.isArray(debt.installments)) {
                        debt.installments.forEach((installment, index) => {
                            allPayments.push({
                                id: `${debt.id}_${index}`,
                                debt_id: debt.id,
                                customer_name: debt.customer_name,
                                customer_phone: debt.customer_phone,
                                month: installment.month,
                                amount: installment.amount,
                                due_date: installment.due_date,
                                paid_date: installment.paid_date,
                                status: installment.status || 'pending',
                                notes: installment.notes || '',
                                total_debt: debt.total_amount || debt.final_total,
                                monthly_amount: debt.monthly_amount,
                                installment_months: debt.installment_months,
                                installments: debt.installments // Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            });
                        });
                    }
                });

                console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allPayments.length} ØªØ³Ø¯ÙŠØ¯`);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        }

        /**
         * Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
         */
        function setupPaymentsEventListeners() {
            // Ø§Ù„Ø¨Ø­Ø«
            const searchInput = document.getElementById('paymentsSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    currentFilters.searchText = e.target.value;
                    applyPaymentsFilters();
                });
            }
        }

        /**
         * ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
         */
        window.applyPaymentsFilters = function() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ„Ø§ØªØ± Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
            const dateFrom = document.getElementById('paymentsDateFrom')?.value || '';
            const dateTo = document.getElementById('paymentsDateTo')?.value || '';
            const status = document.getElementById('paymentsStatusFilter')?.value || 'all';
            const sortBy = document.getElementById('paymentsSortFilter')?.value || 'date_desc';
            
            currentFilters.dateFrom = dateFrom;
            currentFilters.dateTo = dateTo;
            currentFilters.status = status;
            currentFilters.sortBy = sortBy;

            filteredPayments = [...allPayments];

            // ÙÙ„ØªØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ
            if (currentFilters.searchText) {
                const searchLower = currentFilters.searchText.toLowerCase();
                filteredPayments = filteredPayments.filter(payment => 
                    payment.customer_name.toLowerCase().includes(searchLower) ||
                    (payment.customer_phone && payment.customer_phone.includes(searchLower))
                );
            }

            // ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù†
            if (currentFilters.dateFrom) {
                const fromDate = new Date(currentFilters.dateFrom);
                filteredPayments = filteredPayments.filter(payment => {
                    const dueDate = new Date(payment.due_date);
                    return dueDate >= fromDate;
                });
            }

            // ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰
            if (currentFilters.dateTo) {
                const toDate = new Date(currentFilters.dateTo);
                filteredPayments = filteredPayments.filter(payment => {
                    const dueDate = new Date(payment.due_date);
                    return dueDate <= toDate;
                });
            }

            // ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©
            if (currentFilters.status !== 'all') {
                if (currentFilters.status === 'overdue') {
                    // Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©: ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù‚Ø¯ Ù…Ø¶Ù‰
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    filteredPayments = filteredPayments.filter(payment => {
                        const dueDate = new Date(payment.due_date);
                        return payment.status !== 'paid' && dueDate < today;
                    });
                } else if (currentFilters.status === 'upcoming') {
                    // Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ØºÙŠØ± Ù…Ø³Ø¯Ø¯Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù„Ù… ÙŠØ£ØªÙ Ø¨Ø¹Ø¯
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    filteredPayments = filteredPayments.filter(payment => {
                        const dueDate = new Date(payment.due_date);
                        return payment.status !== 'paid' && dueDate >= today;
                    });
                } else {
                    filteredPayments = filteredPayments.filter(payment => 
                        payment.status === currentFilters.status
                    );
                }
            }

            // Ø§Ù„ØªØ±ØªÙŠØ¨
            filteredPayments.sort((a, b) => {
                switch (currentFilters.sortBy) {
                    case 'date_desc':
                        return new Date(b.due_date) - new Date(a.due_date);
                    case 'date_asc':
                        return new Date(a.due_date) - new Date(b.due_date);
                    case 'amount_desc':
                        return b.amount - a.amount;
                    case 'amount_asc':
                        return a.amount - b.amount;
                    case 'customer_asc':
                        return a.customer_name.localeCompare(b.customer_name, 'ar');
                    case 'customer_desc':
                        return b.customer_name.localeCompare(a.customer_name, 'ar');
                    default:
                        return 0;
                }
            });

            renderPaymentsTable();
            updatePaymentsStats();
        };

        /**
         * Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
         */
        function renderPaymentsTable() {
            const tbody = document.getElementById('paymentsTableBody');
            const noDataMessage = document.getElementById('noPaymentsMessage');
            
            if (!tbody) return;

            if (filteredPayments.length === 0) {
                tbody.innerHTML = '';
                if (noDataMessage) noDataMessage.style.display = 'block';
                return;
            }

            if (noDataMessage) noDataMessage.style.display = 'none';

            tbody.innerHTML = filteredPayments.map(payment => {
                const statusInfo = getPaymentStatus(payment);
                
                // ØªÙ†Ø³ÙŠÙ‚ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ…
                const dueDate = new Date(payment.due_date);
                const dueDayName = dueDate.toLocaleDateString('ar-IQ', { weekday: 'long' });
                const dueDateStr = dueDate.toLocaleDateString('ar-IQ', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                const dueDateFull = `${dueDayName}<br>${dueDateStr}`;
                
                // ØªÙ†Ø³ÙŠÙ‚ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ…
                let paidDateFull = '-';
                if (payment.paid_date) {
                    const paidDate = new Date(payment.paid_date);
                    const paidDayName = paidDate.toLocaleDateString('ar-IQ', { weekday: 'long' });
                    const paidDateStr = paidDate.toLocaleDateString('ar-IQ', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    paidDateFull = `${paidDayName}<br>${paidDateStr}`;
                }

                return `
                    <tr>
                        <td><span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 16px; border-radius: 20px; font-weight: 700; font-size: 1rem;">Ø§Ù„Ø´Ù‡Ø± ${payment.month}</span></td>
                        <td><strong style="font-size: 1rem;">${payment.customer_name}</strong></td>
                        <td style="direction: ltr; text-align: center;">${payment.customer_phone || '-'}</td>
                        <td><strong style="color: var(--primary-color); font-size: 1.05rem;">${payment.amount.toLocaleString('en')} Ø¯ÙŠÙ†Ø§Ø±</strong></td>
                        <td style="font-size: 0.9rem; line-height: 1.5;">${dueDateFull}</td>
                        <td style="font-size: 0.9rem; line-height: 1.5;">${paidDateFull}</td>
                        <td>
                            <span class="badge ${statusInfo.class}" style="padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 0.95rem;">
                                <i class="${statusInfo.icon}"></i> ${statusInfo.text}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons" style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                                ${payment.status !== 'paid' ? `
                                    <button class="btn-icon btn-success" onclick="payInstallmentFromPaymentsPage('${payment.debt_id}', ${payment.month})" title="ØªØ³Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø³Ø·" style="width: 45px; height: 45px; border-radius: 12px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); transition: all 0.3s;">
                                        <i class="fas fa-check-circle" style="font-size: 1.3rem;"></i>
                                    </button>
                                ` : ''}
                                <button class="btn-icon btn-info" onclick="viewPaymentDetailsFromPaymentsPage('${payment.debt_id}')" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„" style="width: 45px; height: 45px; border-radius: 12px; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); transition: all 0.3s;">
                                    <i class="fas fa-eye" style="font-size: 1.3rem;"></i>
                                </button>
                                ${payment.status === 'paid' ? `
                                    <button class="btn-icon btn-primary" onclick="printPaymentReceiptFromPaymentsPage('${payment.debt_id}', ${payment.month})" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„" style="width: 45px; height: 45px; border-radius: 12px; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); transition: all 0.3s;">
                                        <i class="fas fa-print" style="font-size: 1.3rem;"></i>
                                    </button>
                                ` : ''}
                                ${payment.status === 'paid' ? `
                                    <button class="btn-icon btn-warning" onclick="cancelInstallmentPaymentFromPaymentsPage('${payment.debt_id}', ${payment.month})" title="Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¯ÙŠØ¯" style="width: 45px; height: 45px; border-radius: 12px; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3); transition: all 0.3s;">
                                        <i class="fas fa-undo-alt" style="font-size: 1.3rem;"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        /**
         * Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø³Ø·
         */
        function getPaymentStatus(payment) {
            if (payment.status === 'paid') {
                return {
                    text: 'Ù…Ø³Ø¯Ø¯',
                    class: 'badge-success',
                    icon: 'fas fa-check-circle'
                };
            }

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dueDate = new Date(payment.due_date);
            dueDate.setHours(0, 0, 0, 0);

            if (dueDate < today) {
                return {
                    text: 'Ù…ØªØ£Ø®Ø±',
                    class: 'badge-danger',
                    icon: 'fas fa-exclamation-triangle'
                };
            } else if (dueDate.getTime() === today.getTime()) {
                return {
                    text: 'Ù…Ø³ØªØ­Ù‚ Ø§Ù„ÙŠÙˆÙ…',
                    class: 'badge-warning',
                    icon: 'fas fa-calendar-day'
                };
            } else {
                const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
                if (diffDays <= 7) {
                    return {
                        text: `Ù‚Ø§Ø¯Ù… (${diffDays} Ø£ÙŠØ§Ù…)`,
                        class: 'badge-warning',
                        icon: 'fas fa-clock'
                    };
                } else {
                    return {
                        text: 'Ù‚Ø§Ø¯Ù…',
                        class: 'badge-info',
                        icon: 'fas fa-clock'
                    };
                }
            }
        }

        /**
         * ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
         */
        function updatePaymentsStats() {
            const stats = calculatePaymentsStats();

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª
            document.getElementById('totalPaymentsCount').textContent = stats.total.toLocaleString('en');
            document.getElementById('paidPaymentsCount').textContent = stats.paid.toLocaleString('en');
            document.getElementById('overduePaymentsCount').textContent = stats.overdue.toLocaleString('en');
            document.getElementById('upcomingPaymentsCount').textContent = stats.upcoming.toLocaleString('en');
            document.getElementById('totalPaidAmount').textContent = stats.paidAmount.toLocaleString('en') + ' Ø¯';
            document.getElementById('totalRemainingAmount').textContent = stats.remainingAmount.toLocaleString('en') + ' Ø¯';
        }

        /**
         * Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
         */
        function calculatePaymentsStats() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let stats = {
                total: allPayments.length,
                paid: 0,
                pending: 0,
                overdue: 0,
                upcoming: 0,
                paidAmount: 0,
                remainingAmount: 0
            };

            allPayments.forEach(payment => {
                if (payment.status === 'paid') {
                    stats.paid++;
                    stats.paidAmount += payment.amount;
                } else {
                    stats.remainingAmount += payment.amount;
                    const dueDate = new Date(payment.due_date);
                    dueDate.setHours(0, 0, 0, 0);

                    if (dueDate < today) {
                        stats.overdue++;
                    } else {
                        stats.upcoming++;
                    }
                }
            });

            return stats;
        }

        /**
         * ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
         */
        window.filterPaymentsByStatus = function(status) {
            const statusFilter = document.getElementById('paymentsStatusFilter');
            if (statusFilter) {
                statusFilter.value = status;
                applyPaymentsFilters();
            }
        };

        /**
         * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
         */
        window.resetPaymentsFilters = function() {
            document.getElementById('paymentsSearchInput').value = '';
            document.getElementById('paymentsDateFrom').value = '';
            document.getElementById('paymentsDateTo').value = '';
            document.getElementById('paymentsStatusFilter').value = 'all';
            document.getElementById('paymentsSortFilter').value = 'date_desc';
            
            currentFilters = {
                searchText: '',
                dateFrom: '',
                dateTo: '',
                status: 'all',
                sortBy: 'date_desc'
            };
            
            applyPaymentsFilters();
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        };

        /**
         * ÙÙ„ØªØ±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª (Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹)
         */
        window.filterPayments = function() {
            applyPaymentsFilters();
        };

        /**
         * ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
         */
        window.refreshPaymentsPage = async function() {
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            await loadAllPayments();
            applyPaymentsFilters();
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        };

        /**
         * Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø³Ø·
         */
        window.viewPaymentDetails = function(debtId) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†
            if (typeof showDebtDetails === 'function') {
                showDebtDetails(debtId);
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        };

        /**
         * Ø·Ø¨Ø§Ø¹Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯
         */
        window.printPaymentReceipt = async function(debtId, month) {
            try {
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†
                const debt = window.dataSdk.getById(parseInt(debtId));
                if (!debt) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯
                const paidInstallment = debt.installments.find(inst => inst.month === month);
                if (!paidInstallment) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
                const storeSettings = window.elementSdk.getConfig();

                // ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥ÙŠØµØ§Ù„
                const receiptHtml = generateInstallmentPaymentReceipt({
                    debt,
                    paidInstallment,
                    storeSettings
                });

                // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„
                if (window.electronAPI && window.electronAPI.printInvoiceHtml) {
                    await window.electronAPI.printInvoiceHtml(receiptHtml, {
                        silent: true,
                        pageSize: { width: 80000, height: 297000 }
                    });
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    // Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(receiptHtml);
                    printWindow.document.close();
                    printWindow.print();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        };

        /**
         * ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Excel
         */
        window.exportPaymentsReport = function() {
            if (filteredPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ CSV
            let csv = 'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ,Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø·,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚,Ø§Ù„Ù…Ø¨Ù„Øº,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹,Ø§Ù„Ø­Ø§Ù„Ø©\n';
            
            filteredPayments.forEach(payment => {
                const status = getPaymentStatus(payment).text;
                const paidDate = payment.paid_date ? 
                    new Date(payment.paid_date).toLocaleDateString('ar-IQ') : '-';
                
                csv += `${payment.customer_name},`;
                csv += `${payment.customer_phone || '-'},`;
                csv += `Ø§Ù„Ø´Ù‡Ø± ${payment.month},`;
                csv += `${new Date(payment.due_date).toLocaleDateString('ar-IQ')},`;
                csv += `${payment.amount},`;
                csv += `${paidDate},`;
                csv += `${status}\n`;
            });

            // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        };

        /**
         * Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
         */
        window.printPaymentsReport = function() {
            if (filteredPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            const stats = calculatePaymentsStats();
            const currentDate = new Date().toLocaleDateString('ar-IQ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            let html = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Cairo', sans-serif; padding: 20px; background: white; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #667eea; padding-bottom: 20px; }
                        .header h1 { color: #667eea; font-size: 28px; margin-bottom: 10px; }
                        .header p { color: #666; font-size: 14px; }
                        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
                        .stat-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; text-align: center; }
                        .stat-box .value { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
                        .stat-box .label { font-size: 14px; opacity: 0.9; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { padding: 12px; text-align: right; border: 1px solid #ddd; }
                        th { background: #667eea; color: white; font-weight: 600; }
                        tr:nth-child(even) { background: #f9f9f9; }
                        .badge { padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: 600; }
                        .badge-success { background: #10b981; color: white; }
                        .badge-danger { background: #ef4444; color: white; }
                        .badge-warning { background: #f59e0b; color: white; }
                        .badge-info { background: #06b6d4; color: white; }
                        @media print {
                            body { padding: 10px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø·</h1>
                        <p>${currentDate}</p>
                    </div>

                    <div class="stats">
                        <div class="stat-box">
                            <div class="value">${stats.total}</div>
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.paid}</div>
                            <div class="label">Ø£Ù‚Ø³Ø§Ø· Ù…Ø³Ø¯Ø¯Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.overdue}</div>
                            <div class="label">Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ£Ø®Ø±Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.paidAmount.toLocaleString('en')} Ø¯</div>
                            <div class="label">Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.remainingAmount.toLocaleString('en')} Ø¯</div>
                            <div class="label">Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.upcoming}</div>
                            <div class="label">Ø£Ù‚Ø³Ø§Ø· Ù‚Ø§Ø¯Ù…Ø©</div>
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ù‚Ø³Ø·</th>
                                <th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredPayments.map(payment => {
                                const statusInfo = getPaymentStatus(payment);
                                const paidDate = payment.paid_date ? 
                                    new Date(payment.paid_date).toLocaleDateString('ar-IQ', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    }) : '-';
                                
                                return `
                                    <tr>
                                        <td><strong>${payment.customer_name}</strong></td>
                                        <td>${payment.customer_phone || '-'}</td>
                                        <td>Ø§Ù„Ø´Ù‡Ø± ${payment.month}</td>
                                        <td>${new Date(payment.due_date).toLocaleDateString('ar-IQ', {
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric'
                                        })}</td>
                                        <td><strong>${payment.amount.toLocaleString('en')} Ø¯</strong></td>
                                        <td>${paidDate}</td>
                                        <td><span class="badge ${statusInfo.class}">${statusInfo.text}</span></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>

                    <div style="margin-top: 30px; text-align: center; color: #666; font-size: 12px;">
                        <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ - Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ</p>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©
        const originalShowPage = window.showPage;
        window.showPage = function(page) {
            if (originalShowPage) {
                originalShowPage(page);
            }
            
            if (page === 'payments') {
                setTimeout(() => {
                    initPaymentsPage();
                }, 100);
            }
        };

        /**
         * Ø¯ÙˆØ§Ù„ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
         */
        
        // ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø· Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
        window.payInstallmentFromPaymentsPage = function(debtId, month) {
            if (typeof payInstallment === 'function') {
                payInstallment(parseInt(debtId), month);
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        };

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ† Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
        window.viewPaymentDetailsFromPaymentsPage = function(debtId) {
            if (typeof showDebtDetails === 'function') {
                showDebtDetails(parseInt(debtId));
            } else {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        };

        // Ø·Ø¨Ø§Ø¹Ø© Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ³Ø¯ÙŠØ¯ Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
        window.printPaymentReceiptFromPaymentsPage = async function(debtId, month) {
            try {
                const debt = window.dataSdk.getById(parseInt(debtId));
                if (!debt) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                const paidInstallment = debt.installments.find(inst => inst.month === month);
                if (!paidInstallment) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                const storeSettings = window.elementSdk.getConfig();
                const receiptHtml = generateInstallmentPaymentReceipt({
                    debt,
                    paidInstallment,
                    storeSettings
                });

                if (window.electronAPI && window.electronAPI.printInvoiceHtml) {
                    await window.electronAPI.printInvoiceHtml(receiptHtml, {
                        silent: true,
                        pageSize: { width: 80000, height: 297000 }
                    });
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                } else {
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(receiptHtml);
                    printWindow.document.close();
                    printWindow.print();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        };

        // Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¯ÙŠØ¯ Ù‚Ø³Ø· Ù…Ù† ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª
        window.cancelInstallmentPaymentFromPaymentsPage = async function(debtId, month) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¯ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ø·ØŸ')) {
                return;
            }

            try {
                const debt = window.dataSdk.getById(parseInt(debtId));
                if (!debt) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                const installmentIndex = debt.installments.findIndex(inst => inst.month === month);
                if (installmentIndex === -1) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                const installment = debt.installments[installmentIndex];
                if (installment.status !== 'paid') {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    return;
                }

                // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¯ÙŠØ¯
                installment.status = 'pending';
                installment.paid_date = null;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
                debt.paid_amount = (debt.paid_amount || 0) - installment.amount;
                debt.remaining_amount = (debt.remaining_amount || 0) + installment.amount;

                // Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                const result = await window.dataSdk.update(parseInt(debtId), debt);
                
                if (result.isOk) {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©
                    await refreshPaymentsPage();
                } else {
                    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ³Ø¯ÙŠØ¯:', error);
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            }
        };

        /**
         * Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©
         */

        // Ø·Ø¨Ø§Ø¹Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¹ÙŠÙ†Ø© Ù…Ø¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        window.printSpecificPaymentsReport = function(filterType) {
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const statusFilter = document.getElementById('paymentsStatusFilter');
            if (statusFilter) {
                statusFilter.value = filterType;
                applyPaymentsFilters();
            }

            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ± Ø«Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
            setTimeout(() => {
                printPaymentsReport();
            }, 300);
        };

        // Ø·Ø¨Ø§Ø¹Ø© Ù‚Ø³Ù… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
        window.printPaymentsStat = function(statType) {
            if (allPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            const stats = calculatePaymentsStats();
            const currentDate = new Date().toLocaleDateString('ar-IQ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            let statTitle = '';
            let statValue = '';
            let statDescription = '';

            switch(statType) {
                case 'total':
                    statTitle = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·';
                    statValue = stats.total;
                    statDescription = 'Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…';
                    break;
                case 'paid':
                    statTitle = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©';
                    statValue = stats.paid;
                    statDescription = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„ØªÙŠ ØªÙ… ØªØ³Ø¯ÙŠØ¯Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„';
                    break;
                case 'overdue':
                    statTitle = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©';
                    statValue = stats.overdue;
                    statDescription = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù† Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚Ù‡Ø§';
                    break;
                case 'upcoming':
                    statTitle = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©';
                    statValue = stats.upcoming;
                    statDescription = 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø§Ù„ØªÙŠ Ù„Ù… ØªØ³ØªØ­Ù‚ Ø¨Ø¹Ø¯';
                    break;
                case 'paidAmount':
                    statTitle = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©';
                    statValue = stats.paidAmount.toLocaleString('en') + ' Ø¯ÙŠÙ†Ø§Ø±';
                    statDescription = 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©';
                    break;
                case 'remainingAmount':
                    statTitle = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©';
                    statValue = stats.remainingAmount.toLocaleString('en') + ' Ø¯ÙŠÙ†Ø§Ø±';
                    statDescription = 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©';
                    break;
            }

            const html = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± ${statTitle}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { 
                            font-family: 'Cairo', sans-serif; 
                            padding: 40px; 
                            background: white; 
                            text-align: center;
                        }
                        .header { 
                            border-bottom: 4px solid #667eea; 
                            padding-bottom: 30px; 
                            margin-bottom: 50px; 
                        }
                        .header h1 { 
                            color: #667eea; 
                            font-size: 32px; 
                            margin-bottom: 15px; 
                        }
                        .header p { color: #666; font-size: 16px; }
                        .stat-container {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 60px;
                            border-radius: 20px;
                            margin: 30px auto;
                            max-width: 600px;
                            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                        }
                        .stat-value {
                            font-size: 72px;
                            font-weight: bold;
                            margin: 20px 0;
                        }
                        .stat-label {
                            font-size: 28px;
                            margin-bottom: 15px;
                            opacity: 0.95;
                        }
                        .stat-desc {
                            font-size: 18px;
                            opacity: 0.85;
                            margin-top: 20px;
                        }
                        .footer {
                            margin-top: 60px;
                            padding-top: 30px;
                            border-top: 2px solid #e0e0e0;
                            color: #666;
                            font-size: 14px;
                        }
                        @media print {
                            body { padding: 20px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ${statTitle}</h1>
                        <p>${currentDate}</p>
                    </div>

                    <div class="stat-container">
                        <div class="stat-label">${statTitle}</div>
                        <div class="stat-value">${statValue}</div>
                        <div class="stat-desc">${statDescription}</div>
                    </div>

                    <div class="footer">
                        <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹</p>
                        <p>Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ Â© 2025</p>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        };

        // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØµÙØ­Ø© ÙƒØ§Ù…Ù„Ø© (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª + Ø§Ù„Ø¬Ø¯ÙˆÙ„)
        window.printCompletePaymentsReport = function() {
            if (allPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            const stats = calculatePaymentsStats();
            const currentDate = new Date().toLocaleDateString('ar-IQ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            const html = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Cairo', sans-serif; padding: 20px; background: white; }
                        .header { 
                            text-align: center; 
                            margin-bottom: 30px; 
                            border-bottom: 3px solid #667eea; 
                            padding-bottom: 20px; 
                        }
                        .header h1 { color: #667eea; font-size: 32px; margin-bottom: 10px; }
                        .header p { color: #666; font-size: 16px; }
                        .stats { 
                            display: grid; 
                            grid-template-columns: repeat(3, 1fr); 
                            gap: 20px; 
                            margin-bottom: 30px; 
                        }
                        .stat-box { 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            color: white; 
                            padding: 25px; 
                            border-radius: 15px; 
                            text-align: center; 
                        }
                        .stat-box .value { font-size: 36px; font-weight: bold; margin-bottom: 10px; }
                        .stat-box .label { font-size: 18px; opacity: 0.95; }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 30px; 
                        }
                        th, td { 
                            padding: 14px 8px; 
                            text-align: center; 
                            border: 1px solid #ddd; 
                            font-size: 14px;
                        }
                        th { 
                            background: #667eea; 
                            color: white; 
                            font-weight: 600; 
                        }
                        tr:nth-child(even) { background: #f9f9f9; }
                        .badge { 
                            padding: 6px 12px; 
                            border-radius: 15px; 
                            font-size: 13px; 
                            font-weight: 600; 
                            display: inline-block;
                        }
                        .badge-success { background: #10b981; color: white; }
                        .badge-danger { background: #ef4444; color: white; }
                        .badge-warning { background: #f59e0b; color: white; }
                        .badge-info { background: #06b6d4; color: white; }
                        .footer { 
                            margin-top: 40px; 
                            text-align: center; 
                            color: #666; 
                            font-size: 13px; 
                            padding-top: 20px;
                            border-top: 2px solid #e0e0e0;
                        }
                        @media print {
                            body { padding: 10px; }
                            .stat-box .value { font-size: 28px; }
                            .stat-box .label { font-size: 14px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ø´Ø§Ù…Ù„</h1>
                        <p>${currentDate}</p>
                    </div>

                    <div class="stats">
                        <div class="stat-box">
                            <div class="value">${stats.total}</div>
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.paid}</div>
                            <div class="label">Ø£Ù‚Ø³Ø§Ø· Ù…Ø³Ø¯Ø¯Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.overdue}</div>
                            <div class="label">Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ£Ø®Ø±Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.upcoming}</div>
                            <div class="label">Ø£Ù‚Ø³Ø§Ø· Ù‚Ø§Ø¯Ù…Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.paidAmount.toLocaleString('en')} Ø¯</div>
                            <div class="label">Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</div>
                        </div>
                        <div class="stat-box">
                            <div class="value">${stats.remainingAmount.toLocaleString('en')} Ø¯</div>
                            <div class="label">Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div>
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th>Ø§Ù„Ù‚Ø³Ø·</th>
                                <th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¯ÙŠØ¯</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredPayments.map(payment => {
                                const statusInfo = getPaymentStatus(payment);
                                const dueDate = new Date(payment.due_date);
                                const dueDateStr = dueDate.toLocaleDateString('ar-IQ', {
                                    year: 'numeric',
                                    month: 'short',
                                    day: 'numeric'
                                });
                                const paidDate = payment.paid_date ? 
                                    new Date(payment.paid_date).toLocaleDateString('ar-IQ', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    }) : '-';
                                
                                return `
                                    <tr>
                                        <td><strong>${payment.customer_name}</strong></td>
                                        <td>${payment.customer_phone || '-'}</td>
                                        <td>Ø§Ù„Ø´Ù‡Ø± ${payment.month}</td>
                                        <td>${dueDateStr}</td>
                                        <td><strong>${payment.amount.toLocaleString('en')} Ø¯</strong></td>
                                        <td>${paidDate}</td>
                                        <td><span class="badge ${statusInfo.class}">${statusInfo.text}</span></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>

                    <div class="footer">
                        <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ - Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ</p>
                        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${currentDate}</p>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        };

        /**
         * Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
         */

        // ØªØµØ¯ÙŠØ± ÙƒÙ€ JSON
        window.exportPaymentsAsJSON = function() {
            if (allPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            const dataToExport = allPayments.map(payment => ({
                'Ø±Ù‚Ù… Ø§Ù„Ù‚Ø³Ø·': payment.month,
                'Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„': payment.customer_name,
                'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ': payment.customer_phone || '-',
                'Ø§Ù„Ù…Ø¨Ù„Øº': payment.amount,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚': payment.due_date,
                'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¯ÙŠØ¯': payment.paid_date || '-',
                'Ø§Ù„Ø­Ø§Ù„Ø©': payment.status,
                'Ù…Ø¹Ø±Ù Ø§Ù„Ø¯ÙŠÙ†': payment.debt_id
            }));

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ØªØ³Ø¯ÙŠØ¯Ø§Øª_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        };

        // ØªØµØ¯ÙŠØ± ÙƒÙ€ Excel (CSV)
        window.exportPaymentsAsExcel = function() {
            exportPaymentsReport(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
        };

        // ØªØµØ¯ÙŠØ± ÙƒÙ€ PDF
        window.exportPaymentsAsPDF = function() {
            if (allPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ PDF
            printCompletePaymentsReport();
            // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        };

        /**
         * Ø¯ÙˆØ§Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© - Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©
         */

        // Ø·Ø¨Ø§Ø¹Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ø¹ÙŠÙ†Ø© Ù…Ø¹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
        window.printPaymentsStat = function(statType) {
            if (allPayments.length === 0) {
                // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                return;
            }

            const stats = calculatePaymentsStats();
            const currentDate = new Date().toLocaleDateString('ar-IQ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });

            let statTitle = '';
            let statValue = '';
            let statDescription = '';
            let dataToShow = [];

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            switch(statType) {
                case 'total':
                    statTitle = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·';
                    statValue = stats.total;
                    statDescription = 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…';
                    dataToShow = allPayments;
                    break;
                case 'paid':
                    statTitle = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©';
                    statValue = stats.paid;
                    statDescription = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„ØªÙŠ ØªÙ… ØªØ³Ø¯ÙŠØ¯Ù‡Ø§';
                    dataToShow = allPayments.filter(p => p.status === 'paid');
                    break;
                case 'overdue':
                    statTitle = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©';
                    statValue = stats.overdue;
                    statDescription = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© Ø¹Ù† Ù…ÙˆØ¹Ø¯Ù‡Ø§';
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    dataToShow = allPayments.filter(p => {
                        const dueDate = new Date(p.due_date);
                        return p.status !== 'paid' && dueDate < today;
                    });
                    break;
                case 'upcoming':
                    statTitle = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©';
                    statValue = stats.upcoming;
                    statDescription = 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©';
                    const todayUpcoming = new Date();
                    todayUpcoming.setHours(0, 0, 0, 0);
                    dataToShow = allPayments.filter(p => {
                        const dueDate = new Date(p.due_date);
                        return p.status !== 'paid' && dueDate >= todayUpcoming;
                    });
                    break;
                case 'paidAmount':
                    statTitle = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©';
                    statValue = stats.paidAmount.toLocaleString('en') + ' Ø¯ÙŠÙ†Ø§Ø±';
                    statDescription = 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©';
                    dataToShow = allPayments.filter(p => p.status === 'paid');
                    break;
                case 'remainingAmount':
                    statTitle = 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©';
                    statValue = stats.remainingAmount.toLocaleString('en') + ' Ø¯ÙŠÙ†Ø§Ø±';
                    statDescription = 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©';
                    dataToShow = allPayments.filter(p => p.status !== 'paid');
                    break;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            const html = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± ${statTitle}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { 
                            font-family: 'Cairo', sans-serif; 
                            padding: 30px; 
                            background: white; 
                        }
                        .header { 
                            text-align: center;
                            border-bottom: 4px solid #667eea; 
                            padding-bottom: 25px; 
                            margin-bottom: 40px; 
                        }
                        .header h1 { 
                            color: #667eea; 
                            font-size: 38px; 
                            margin-bottom: 12px;
                            font-weight: 900;
                        }
                        .header p { color: #666; font-size: 17px; }
                        .stat-container {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 50px;
                            border-radius: 20px;
                            margin: 25px auto 40px;
                            max-width: 700px;
                            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
                            text-align: center;
                        }
                        .stat-value {
                            font-size: 80px;
                            font-weight: 900;
                            margin: 25px 0;
                            text-shadow: 0 4px 8px rgba(0,0,0,0.2);
                        }
                        .stat-label {
                            font-size: 32px;
                            margin-bottom: 18px;
                            opacity: 0.95;
                            font-weight: 700;
                        }
                        .stat-desc {
                            font-size: 20px;
                            opacity: 0.85;
                            margin-top: 25px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 30px;
                            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
                        }
                        th, td {
                            padding: 16px 12px;
                            text-align: center;
                            border: 1px solid #e0e0e0;
                            font-size: 15px;
                        }
                        th {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            font-weight: 700;
                            font-size: 16px;
                        }
                        tr:nth-child(even) { background: #f8f9fa; }
                        tr:hover { background: #e8f4fd; }
                        .badge {
                            padding: 6px 14px;
                            border-radius: 15px;
                            font-size: 14px;
                            font-weight: 700;
                            display: inline-block;
                        }
                        .badge-success { background: #10b981; color: white; }
                        .badge-danger { background: #ef4444; color: white; }
                        .badge-warning { background: #f59e0b; color: white; }
                        .badge-info { background: #06b6d4; color: white; }
                        .footer { 
                            margin-top: 50px; 
                            padding-top: 25px; 
                            border-top: 2px solid #e0e0e0; 
                            text-align: center;
                            color: #666; 
                            font-size: 15px; 
                        }
                        @media print {
                            body { padding: 15px; }
                            .stat-value { font-size: 65px; }
                            .stat-label { font-size: 26px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>ğŸ“Š ${statTitle}</h1>
                        <p>${currentDate}</p>
                    </div>

                    <div class="stat-container">
                        <div class="stat-label">${statTitle}</div>
                        <div class="stat-value">${statValue}</div>
                        <div class="stat-desc">${statDescription}</div>
                    </div>

                    ${dataToShow.length > 0 ? `
                        <h2 style="color: #667eea; margin: 30px 0 20px; font-size: 28px; text-align: center;">ØªÙØ§ØµÙŠÙ„ ${statTitle}</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù‚Ø³Ø·</th>
                                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚</th>
                                    <th>Ø§Ù„ØªØ³Ø¯ÙŠØ¯</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${dataToShow.map(payment => {
                                    const statusInfo = getPaymentStatus(payment);
                                    const dueDate = new Date(payment.due_date);
                                    const dueDateStr = dueDate.toLocaleDateString('ar-IQ', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    });
                                    const paidDate = payment.paid_date ? 
                                        new Date(payment.paid_date).toLocaleDateString('ar-IQ', {
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric'
                                        }) : '-';
                                    
                                    return `
                                        <tr>
                                            <td><strong>Ø§Ù„Ø´Ù‡Ø± ${payment.month}</strong></td>
                                            <td><strong>${payment.customer_name}</strong></td>
                                            <td>${payment.customer_phone || '-'}</td>
                                            <td><strong>${payment.amount.toLocaleString('en')} Ø¯</strong></td>
                                            <td>${dueDateStr}</td>
                                            <td>${paidDate}</td>
                                            <td><span class="badge ${statusInfo.class}">${statusInfo.text}</span></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    ` : '<p style="text-align: center; color: #999; font-size: 18px; margin-top: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>'}

                    <div class="footer">
                        <p style="font-weight: 700; margin-bottom: 8px;">ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹</p>
                        <p>Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ Â© 2025</p>
                        <p style="margin-top: 8px; font-size: 13px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${currentDate}</p>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
            printWindow.print();
        };

        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯Ø§Øª');
    })();



    
    </script>
    

    <script src="./reports-system.js"></script>
    <script src="./expenses-system.js"></script>
    
    <!-- Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© -->
    <script>
/**
 * Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© - Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©
 * Ù†Ø³Ø®Ø© Ù…Ø­Ø¯Ø«Ø© Ø¨ØªØµÙ…ÙŠÙ… Ù…Ø¶ØºÙˆØ· ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ
 */

(function() {
    'use strict';
    
    /**
     * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
     */
    function toEnglishDigits(str) {
        if (!str) return str;
        const arabicDigits = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
        const englishDigits = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
        
        let result = String(str);
        for (let i = 0; i < 10; i++) {
            result = result.replace(new RegExp(arabicDigits[i], 'g'), englishDigits[i]);
        }
        return result;
    }
    
    /**
     * Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù†Ù‚Ø¯ÙŠ - ØªØµÙ…ÙŠÙ… Ù…Ø­Ø³Ù†
     */
    window.generateYaqoubCashReceipt = function(sale, settings) {
        // Ø¯Ù…Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù…Ø±Ø±Ø©
        const savedSettings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
        const finalSettings = { ...savedSettings, ...settings };
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        const storeName = finalSettings.store_name || 'Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©';
        const storeAddress = finalSettings.store_address || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ© Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„ÙƒØ±Ø§Ø±';
        const storePhone = finalSettings.store_phone || localStorage.getItem('storePhone') || '07803092185';
        const storeLogo = finalSettings.store_logo || 'yaqoub_logo.png';
        const showLogo = finalSettings.show_logo !== false;

        // Ù‚Ø§Ù„Ø¨ A4 Ø¯Ø§Ø¦Ù…Ù‹Ø§
        let receiptWidth = '210mm';

        // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        let saleDate = sale.date ? new Date(sale.date) : (sale.timestamp ? new Date(sale.timestamp) : new Date());
        if (typeof saleDate === 'string') saleDate = new Date(saleDate);
        const dateStr = saleDate.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' });
        const timeStr = saleDate.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        let html = `
        <div style="
            width: ${receiptWidth};
            margin: 0 auto;
            padding: 32px 32px;
            font-family: 'Cairo', sans-serif;
            background: #fff;
            color: #222;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            line-height: 1.7;
            font-size: 18px;
            direction: rtl;
            text-align: right;
        ">
        `;

        // Ø±Ø£Ø³ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        html += `
        <div style="text-align: center; margin-bottom: 24px; direction: rtl;">
            <h1 style="margin: 0 0 8px 0; font-size: 2.5rem; font-weight: bold; color: #2d3748; letter-spacing: 2px;">${storeName}</h1>
            <div style="font-size: 1.2rem; color: #374151; margin-bottom: 4px;">${storeAddress}</div>
            <div style="font-size: 1.1rem; color: #6366f1;">ğŸ“ ${storePhone}</div>
            ${showLogo ? `<div style="width:100%;text-align:center;margin:12px 0 0 0;">
            <img src="${storeLogo}" alt="Logo" style="max-width:120px;max-height:120px;display:inline-block;vertical-align:middle;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.08);margin-bottom:8px;" />
            </div>` : ''}
        </div>
        <div style="border-top: 2px solid #6366f1; margin: 24px 0 16px 0;"></div>
        `;

        // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        html += `
        <div style="display: flex; justify-content: flex-start; gap: 48px; margin-bottom: 18px; font-size: 1.1rem; direction: ltr;">
            <div><b>Invoice No.:</b> ${toEnglishDigits(sale.invoice_id)}</div>
            <div><b>Date:</b> ${toEnglishDigits(dateStr)}</div>
            <div><b>Time:</b> ${toEnglishDigits(timeStr)}</div>
        </div>
        <div style="border-top: 1px dashed #bbb; margin: 18px 0 18px 0;"></div>
        `;

        // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        let items = sale.items;
        if (typeof items === 'string') {
            try {
                items = JSON.parse(items);
            } catch {
                items = [];
            }
        }
        if (items && items.length > 0) {
            html += `
            <table style="width: 100%; border-collapse: collapse; font-size: 1.1rem; margin: 18px 0; background: #f9fafb; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.03); direction: ltr;">
            <thead>
                <tr style="background: #6366f1; color: #fff;">
                <th style="padding: 12px 0;">#</th>
                <th style="padding: 12px 0;">Product Name</th>
                <th style="padding: 12px 0;">Qty</th>
                <th style="padding: 12px 0;">Unit Price</th>
                <th style="padding: 12px 0;">Total</th>
                </tr>
            </thead>
            <tbody>
        `;
            items.forEach((item, index) => {
                const name = item.product_name || item.name || 'â€”';
                const price = item.product_price || item.price || 0;
                html += `
            <tr style="background: ${index % 2 === 0 ? '#fff' : '#f3f4f6'}; text-align: center; direction: ltr;">
                <td style="padding: 10px 0;">${toEnglishDigits(index + 1)}</td>
                <td style="padding: 10px 0; text-align: left;">${name}</td>
                <td style="padding: 10px 0;">${toEnglishDigits(item.quantity)}</td>
                <td style="padding: 10px 0;">${toEnglishDigits(price.toLocaleString('en'))}</td>
                <td style="padding: 10px 0; font-weight: bold; color: #10b981;">${toEnglishDigits((price * item.quantity).toLocaleString('en'))}</td>
            </tr>
            `;
            });
            html += `</tbody></table>`;
        }

        html += `<div style="border-top: 2px solid #6366f1; margin: 24px 0 16px 0;"></div>`;

        // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
        const additionalDiscount = sale.additional_discount || 0;
        const totalDiscount = (sale.discount || 0) + additionalDiscount;
        
        html += `
        <div style="font-size: 1.3rem; font-weight: bold; margin: 32px 0 12px 0; text-align: right; direction: rtl;">
            <div style="display: flex; justify-content: flex-start; gap: 48px; margin-bottom: 10px;">
            <div><span style="color:#374151;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:</span> <span>${toEnglishDigits((sale.total_amount || 0).toLocaleString('en'))}</span></div>
            ${sale.discount ? `<div><span style="color:#374151;">Ø§Ù„Ø®ØµÙ…:</span> <span style="color: #10b981;">- ${toEnglishDigits(sale.discount.toLocaleString('en'))}</span></div>` : ''}
            ${additionalDiscount > 0 ? `<div><span style="color:#374151;">Ø®ØµÙ… Ø¥Ø¶Ø§ÙÙŠ:</span> <span style="color: #10b981;">- ${toEnglishDigits(additionalDiscount.toLocaleString('en'))}</span></div>` : ''}
            </div>
            ${totalDiscount > 0 ? `<div style="display: flex; justify-content: flex-start; gap: 48px; margin-bottom: 10px; padding: 8px; background: #f0fdf4; border-radius: 6px;">
                <div><span style="color:#15803d;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø®ØµÙ…:</span> <span style="color: #15803d; font-weight: bold;">- ${toEnglishDigits(totalDiscount.toLocaleString('en'))}</span></div>
            </div>` : ''}
            <div style="display: flex; justify-content: flex-start; gap: 48px; border-top: 2px solid #6366f1; padding-top: 12px; margin-top: 8px;">
            <div><span style="color:#2d3748;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> <span style="color:#e11d48; font-size:1.5rem;">${toEnglishDigits((sale.final_total || sale.total_amount || 0).toLocaleString('en'))}</span></div>
            </div>
        </div>
        `;

        // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        const notes = [];
        if (finalSettings.note1) notes.push(finalSettings.note1);
        if (finalSettings.note2) notes.push(finalSettings.note2);
        if (finalSettings.note3) notes.push(finalSettings.note3);
        if (finalSettings.note4) notes.push(finalSettings.note4);
        if (finalSettings.note5) notes.push(finalSettings.note5);
        if (finalSettings.note6) notes.push(finalSettings.note6);
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
        if (finalSettings.show_maintenance !== false) {
            const maintenanceName = finalSettings.maintenance_name || 'Ø­Ù…Ø²Ù‡ Ø£Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡';
            const maintenanceService = finalSettings.maintenance_service || 'ØµÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø¨Ø§Ù„Øª';
            const maintenancePhone = finalSettings.maintenance_phone || '+964 785 570 6118';
            notes.push(`Ù…Ø³Ø¤ÙˆÙ„ ${maintenanceService}: ${maintenanceName} - Ù‡Ø§ØªÙ: <span dir="ltr" style="unicode-bidi: embed;">${maintenancePhone}</span> <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Flag_of_Iraq.svg" alt="Iraq Flag" style="height: 1em; vertical-align: middle; margin-right: 4px;" />`);
        }
        
        if (notes.length > 0) {
            html += `
            <div style="margin-top:28px; padding:16px 12px; background:#fffbe7; border-radius:8px; border:1px solid #ffe082;">
                <div style="font-size:1.05rem; font-weight:bold; color:#c62828; margin-bottom:6px; text-align:right; direction:rtl;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©:</div>
                <ol style="font-size:1rem; padding-right:22px; margin:0; text-align:right; direction:rtl;">
                ${notes.map(n => `<li>${toEnglishDigits(n)}</li>`).join('')}
                </ol>
            </div>
            `;
        }

        // Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        html += `<div style="text-align: center; margin-top: 40px; font-size: 1.1rem; color: #666; direction: rtl;">
        <p style="margin: 4px 0;">Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹ ${storeName}</p>
        <p style="margin: 4px 0;">Ù†ØªØ·Ù„Ø¹ Ù„Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
        <p style="margin-top: 18px; color: #6366f1; font-size: 1.2rem;">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</p>
        </div>`;
        html += `</div>`;
        return html;
    };
    
    /**
     * Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„ØªÙ‚Ø³ÙŠØ· - ØªØµÙ…ÙŠÙ… Ù…Ø¶ØºÙˆØ· Ù…Ø­Ø³Ù†
     */
    window.generateYaqoubInstallmentReceipt = function(sale, settings) {
        // Ø¯Ù…Ø¬ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù…Ø±Ø±Ø©
        const savedSettings = JSON.parse(localStorage.getItem('printerSettings') || '{}');
        const finalSettings = { ...savedSettings, ...settings };
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø³Ø§Ø¹Ø©
        const saleDate = new Date(sale.timestamp || sale.created_at || Date.now());
        const dateStr = saleDate.toLocaleDateString('ar-IQ', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric',
            weekday: 'long'
        });
        const timeStr = saleDate.toLocaleTimeString('ar-IQ', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: true
        });
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ù† installment_details Ø£Ùˆ Ù…Ù† Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        const installmentDetails = sale.installment_details || {};
        const originalSubtotal = installmentDetails.original_subtotal || sale.subtotal || 0;
        const additionalAmount = installmentDetails.additional_amount || sale.additional_amount || 0;
        const downPayment = installmentDetails.down_payment || sale.down_payment || 0;
        const totalBeforeDiscount = originalSubtotal + additionalAmount;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        let finalTotal = originalSubtotal; // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
        if (additionalAmount > 0) finalTotal += additionalAmount; // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ
        if (downPayment > 0) finalTotal -= downPayment; // Ø®ØµÙ… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
        
        const remainingAmount = installmentDetails.remaining_amount || sale.remaining_amount || (totalBeforeDiscount - downPayment);
        const monthlyAmount = installmentDetails.monthly_amount || sale.monthly_amount || 0;
        const installmentMonths = installmentDetails.installment_months || sale.installment_months || 0;
        const startDate = installmentDetails.start_date || sale.start_date || null;
        const advancedControlUsed = installmentDetails.advanced_control_used || installmentDetails.custom_values_used || false;
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        const storeName = finalSettings.store_name || 'ÙŠØ¹Ù‚ÙˆØ¨ Ù„Ù„Ø§Ø¬Ù‡Ø²Ù‡ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠÙ‡';
        const storeAddress = finalSettings.store_address || 'Ø¨Ø§Ø¨ Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠÙ‡ Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ù‡ Ø§Ù„ÙƒØ±Ø§Ø±';
        const storePhone = finalSettings.store_phone || '07803092185';
        
        let html = `<div style="width:210mm;min-height:297mm;margin:0 auto;padding:12mm 10mm;font-family:'Cairo',sans-serif;background:#fff;color:#222;line-height:1.4;font-size:11px;box-sizing:border-box;">
        
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø­Ø³Ù‘Ù† -->
        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;padding-bottom:6px;border-bottom:2px solid #6366f1;">
            <!-- Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ -->
            <div style="flex:0 0 35%;">
                <h1 style="margin:0;font-size:1.3rem;font-weight:bold;color:#2d3748;">${storeName}</h1>
            </div>
            <!-- Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù‡Ø§ØªÙ -->
            <div style="flex:0 0 60%;text-align:left;">
                <div style="font-size:0.95rem;color:#374151;font-weight:600;margin-bottom:2px;">${storeAddress}</div>
                <div style="font-size:0.9rem;color:#6366f1;font-weight:600;">ğŸ“ ${storePhone}</div>
            </div>
        </div>
        
        <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ø§ -->
        <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:6px;padding:6px 10px;margin-bottom:8px;color:#fff;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <div style="font-size:1.05rem;font-weight:bold;">ğŸ“‹ ÙØ§ØªÙˆØ±Ø© ØªÙ‚Ø³ÙŠØ·</div>
                    <div style="font-size:0.85rem;opacity:0.95;">Ø±Ù‚Ù…: ${sale.invoice_id || ''}</div>
                </div>
                <div style="text-align:left;font-size:0.85rem;">
                    <div>ğŸ“… ${dateStr}</div>
                    <div>ğŸ• ${timeStr}</div>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ - ØµÙ ÙˆØ§Ø­Ø¯ -->
        <div style="background:#f8fafc;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #e2e8f0;">
            <div style="font-weight:bold;color:#1e293b;margin-bottom:4px;font-size:0.95rem;">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:0.9rem;">
                <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${sale.customer_name || ''}</div>
                <div><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${sale.customer_phone || ''}</div>
                <div><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${sale.customer_address || ''}</div>
            </div>
        </div>
        
        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· - Ù…Ø¶ØºÙˆØ· -->
        <div style="background:#f0f9ff;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #bae6fd;">
            <div style="font-weight:bold;color:#0c4a6e;margin-bottom:4px;font-size:0.95rem;">ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·</div>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:4px;font-size:0.85rem;">
                <div style="background:#dbeafe;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#1e40af;font-size:0.8rem;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</div>
                    <div style="font-weight:bold;color:#1e3a8a;">${originalSubtotal.toLocaleString()}</div>
                </div>
                ${additionalAmount > 0 ? `<div style="background:#fce7f3;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#9f1239;font-size:0.8rem;">Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ</div>
                    <div style="font-weight:bold;color:#be123c;">${additionalAmount.toLocaleString()}</div>
                </div>` : ''}
                ${downPayment > 0 ? `<div style="background:#d1fae5;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#065f46;font-size:0.8rem;">Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©</div>
                    <div style="font-weight:bold;color:#047857;">${downPayment.toLocaleString()}</div>
                </div>` : ''}
                <div style="background:#fee2e2;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#7f1d1d;font-size:0.8rem;">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                    <div style="font-weight:bold;color:#991b1b;">${remainingAmount.toLocaleString()}</div>
                </div>
                <div style="background:#fef3c7;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#78350f;font-size:0.8rem;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</div>
                    <div style="font-weight:bold;color:#92400e;">${installmentMonths}</div>
                </div>
                <div style="background:#ffedd5;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#7c2d12;font-size:0.8rem;">Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</div>
                    <div style="font-weight:bold;color:#9a3412;">${monthlyAmount.toLocaleString()}</div>
                </div>
                ${startDate ? `<div style="background:#e0e7ff;padding:4px;border-radius:4px;text-align:center;">
                    <div style="font-weight:600;color:#3730a3;font-size:0.8rem;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</div>
                    <div style="font-weight:bold;color:#4338ca;font-size:0.8rem;">${new Date(startDate).toLocaleDateString('ar-IQ')}</div>
                </div>` : ''}
                ${advancedControlUsed ? `<div style="background:#ede9fe;padding:4px;border-radius:4px;text-align:center;grid-column:1/-1;">
                    <div style="font-weight:600;color:#5b21b6;font-size:0.8rem;">âš™ï¸ ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…</div>
                </div>` : ''}
            </div>
        </div>
        
        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ù…Ø¶ØºÙˆØ· -->
        <div style="margin-bottom:8px;">
            <table style="width:100%;border-collapse:collapse;font-size:0.9rem;border:1px solid #e5e7eb;">
            <thead>
                <tr style="background:#6366f1;color:#fff;">
                    <th style="padding:4px 6px;width:6%;text-align:center;border:1px solid rgba(255,255,255,0.2);">#</th>
                    <th style="padding:4px 6px;width:44%;text-align:right;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th style="padding:4px 6px;width:12%;text-align:center;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th style="padding:4px 6px;width:18%;text-align:center;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„Ø³Ø¹Ø±</th>
                    <th style="padding:4px 6px;width:20%;text-align:center;border:1px solid rgba(255,255,255,0.2);">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody>`;
        
        let items = sale.items;
        if (typeof items === 'string') {
            try { items = JSON.parse(items); } catch { items = []; }
        }
        
        items.forEach((item, index) => {
            const name = item.product_name || item.name || 'â€”';
            const price = item.product_price || item.price || 0;
            const qty = item.quantity || 1;
            const total = price * qty;
            html += `<tr style="background:${index%2===0?'#fff':'#f9fafb'};">
                <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:600;">${index+1}</td>
                <td style="padding:4px 6px;text-align:right;border:1px solid #e5e7eb;">${name}</td>
                <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:600;">${qty}</td>
                <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:600;">${price.toLocaleString()}</td>
                <td style="padding:4px 6px;text-align:center;border:1px solid #e5e7eb;font-weight:bold;color:#10b981;">${total.toLocaleString()}</td>
            </tr>`;
        });
        
        html += `</tbody></table></div>
        
        <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ù„Øº - Ù…Ø¶ØºÙˆØ· -->
        <div style="background:#fef3c7;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #fde68a;">
            <div style="font-weight:bold;color:#78350f;margin-bottom:4px;font-size:0.95rem;">ğŸ’° Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px;font-size:0.9rem;">
                <div style="display:flex;justify-content:space-between;padding:3px 6px;background:#e0f2fe;border-radius:4px;">
                    <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ:</span>
                    <strong>${originalSubtotal.toLocaleString()}</strong>
                </div>
                ${additionalAmount > 0 ? `<div style="display:flex;justify-content:space-between;padding:3px 6px;background:#fce7f3;border-radius:4px;">
                    <span>Ù…Ø¨Ù„Øº Ø¥Ø¶Ø§ÙÙŠ:</span>
                    <strong style="color:#be123c;">+${additionalAmount.toLocaleString()}</strong>
                </div>` : ''}
                ${downPayment > 0 ? `<div style="display:flex;justify-content:space-between;padding:3px 6px;background:#d1fae5;border-radius:4px;">
                    <span>Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©:</span>
                    <strong style="color:#047857;">-${downPayment.toLocaleString()}</strong>
                </div>` : ''}
                <div style="grid-column:1/-1;display:flex;justify-content:space-between;padding:6px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:4px;color:#fff;">
                    <span style="font-size:1rem;font-weight:bold;">ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                    <strong style="font-size:1.1rem;">${finalTotal.toLocaleString()} Ø¯ÙŠÙ†Ø§Ø±</strong>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø¶ØºÙˆØ·Ø© -->
        <div style="background:#fffbeb;border-radius:6px;padding:6px 8px;margin-bottom:8px;border:1px solid #fbbf24;">
            <div style="font-weight:bold;color:#b91c1c;margin-bottom:4px;font-size:0.9rem;">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</div>
            <ol style="font-size:0.8rem;padding-right:18px;margin:0;line-height:1.5;">`;
        
        // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        const notes = [];
        if (finalSettings.note1) notes.push(finalSettings.note1);
        if (finalSettings.note2) notes.push(finalSettings.note2);
        if (finalSettings.note3) notes.push(finalSettings.note3);
        if (finalSettings.note4) notes.push(finalSettings.note4);
        if (finalSettings.note5) notes.push(finalSettings.note5);
        if (finalSettings.note6) notes.push(finalSettings.note6);
        
        // Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        if (notes.length === 0) {
            notes.push('Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ùˆ ÙˆØµÙ„ Ø£Ù…Ø§Ù†Ø©');
            notes.push('Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù…ÙŠ 24 Ø³Ø§Ø¹Ø©');
            notes.push('Ø§Ù„Ù…Ø¨Ø§Ø¹ Ù„Ø§ ÙŠØ±Ø¬Ø¹ ÙˆÙ„Ø§ ÙŠØ¨Ø¯Ù„');
            notes.push('Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ø³Ù‡Ùˆ Ù…Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø·Ø±ÙÙŠÙ†');
            notes.push('Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø§Ù„Ø¶Ù…Ø§Ù†');
            notes.push('ÙƒØ³Ø± Ø§Ù„Ø´Ø§Ø´Ø© ØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø¨Ø§Ù„Ø¶Ù…Ø§Ù†');
        }
        
        notes.forEach(note => {
            html += `<li>${note}</li>`;
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
        if (finalSettings.show_maintenance !== false) {
            const maintenanceName = finalSettings.maintenance_name || 'Ø­Ù…Ø²Ù‡ Ø§Ø¨Ùˆ Ø­ÙˆØ±Ø§Ø¡';
            const maintenanceService = finalSettings.maintenance_service || 'ØµÙŠØ§Ù†Ø© Ø§Ù„Ø³Ø¨Ø§Ù„Øª';
            const maintenancePhone = finalSettings.maintenance_phone || '+964 785 570 6118';
            
            html += `<li style="margin-top:4px;">
                    <div style="background:#e0f2fe;padding:4px 6px;border-radius:4px;border:1px solid #bae6fd;">
                        <strong style="color:#0c4a6e;">ğŸ‘¨â€ğŸ”§ ${maintenanceService}:</strong> ${maintenanceName}
                        <div style="direction:ltr;text-align:left;font-weight:bold;color:#0c4a6e;margin-top:2px;">
                            ğŸ“± <span style="letter-spacing:1px;">${maintenancePhone}</span>
                        </div>
                    </div>
                </li>`;
        }
        
        html += `</ol>
        </div>
        
        <!-- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª -->
        <div style="display:flex;justify-content:space-between;gap:30px;margin-top:10px;">
            <div style="flex:1;text-align:center;">
                <div style="font-size:0.9rem;font-weight:bold;margin-bottom:15px;">âœï¸ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
                <div style="border-bottom:1px dashed #9ca3af;"></div>
            </div>
            <div style="flex:1;text-align:center;">
                <div style="font-size:0.9rem;font-weight:bold;margin-bottom:15px;">âœï¸ ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                <div style="border-bottom:1px dashed #9ca3af;"></div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø®ØªØ§Ù… -->
        <div style="text-align:center;margin-top:10px;padding-top:6px;border-top:2px solid #e5e7eb;">
            <p style="margin:2px 0;font-size:0.95rem;font-weight:bold;color:#6366f1;">ğŸŒŸ Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§ ğŸŒŸ</p>
            <p style="margin:2px 0;font-size:0.85rem;color:#6b7280;">Ù†ØªØ·Ù„Ø¹ Ù„Ø®Ø¯Ù…ØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
        </div>
        </div>`;
        return html;
    };
    
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© - Ù…Ø¹Ø±Ø¶ ÙŠØ¹Ù‚ÙˆØ¨');
})();




    </script>
    
    
    <style>
    /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ÙØ§ØªÙŠØ­ */
    .switch-container input[type="checkbox"] {
        position: relative;
        width: 50px;
        height: 26px;
        -webkit-appearance: none;
        appearance: none;
        background: #ccc;
        border-radius: 50px;
        outline: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .switch-container input[type="checkbox"]:checked {
        background: linear-gradient(135deg, #667eea, #764ba2);
    }
    
    .switch-container input[type="checkbox"]::before {
        content: '';
        position: absolute;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: white;
        top: 2px;
        right: 2px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .switch-container input[type="checkbox"]:checked::before {
        transform: translateX(-24px);
    }

    /* ==========================================
       ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 - CSS
       ========================================== */
/* ===================================
   ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v3.0 - CSS Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø­Ø³Ù‘Ù†
   =================================== */

/* ===== Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ top-actions ===== */
.notification-bell-btn {
    position: relative;
    width: 42px;
    height: 42px;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
    margin: 0 8px;
}

.notification-bell-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.35);
}

.notification-bell-btn:active {
    transform: translateY(0);
}

.notification-bell-btn i {
    font-size: 18px;
}

/* ===== Ø´Ø§Ø±Ø© Ø§Ù„Ø¹Ø¯Ø¯ ===== */
.notification-count-badge {
    position: absolute;
    top: -6px;
    left: -6px;
    min-width: 20px;
    height: 20px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border-radius: 10px;
    color: white;
    font-size: 10px;
    font-weight: 700;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 0 5px;
    border: 2px solid white;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
    animation: badge-pulse 2s infinite;
}

.notification-count-badge.visible {
    display: flex;
}

@keyframes badge-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* ===== Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø¹ØªÙ…Ø© (Overlay) ===== */
.notifications-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 99998;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    backdrop-filter: blur(4px);
}

.notifications-modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* ===== Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© ===== */
.notifications-center-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 98%;
    max-width: 850px;
    max-height: 90vh;
    background: white;
    border-radius: 20px;
    box-shadow: 0 25px 70px rgba(0, 0, 0, 0.35);
    z-index: 99999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.notifications-center-modal.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
}

/* ===== Ø±Ø£Ø³ Ø§Ù„Ù„ÙˆØ­Ø© ===== */
.notifications-modal-header {
    padding: 24px 28px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
}

.notifications-modal-title {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 0;
    font-size: 28px;
    font-weight: 800;
}

.notifications-modal-title i {
    font-size: 32px;
}

/* ===== Ø£Ø²Ø±Ø§Ø± Ø±Ø£Ø³ Ø§Ù„Ù„ÙˆØ­Ø© ===== */
.notifications-modal-actions {
    display: flex;
    gap: 8px;
}

.notifications-modal-action-btn {
    width: 38px;
    height: 38px;
    border: none;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    color: white;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.notifications-modal-action-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.05);
}

/* ===== Ø¬Ø³Ù… Ø§Ù„Ù„ÙˆØ­Ø© ===== */
.notifications-modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

/* ===== Ø±Ø³Ø§Ù„Ø© ÙØ§Ø±ØºØ© ===== */
.notifications-empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #9ca3af;
}

.notifications-empty-state i {
    font-size: 72px;
    margin-bottom: 20px;
    opacity: 0.4;
}

.notifications-empty-state p {
    font-size: 16px;
    margin: 0;
    font-weight: 500;
}

/* ===== Ø¹Ù†ØµØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ===== */
.notification-item-card {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 16px;
    border-radius: 14px;
    background: #f9fafb;
    margin-bottom: 12px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    border: 2px solid transparent;
}

.notification-item-card.unread {
    background: linear-gradient(135deg, #eff6ff 0%, #f9fafb 100%);
    border-color: #93c5fd;
}

.notification-item-card:hover {
    background: #f3f4f6;
    transform: translateX(-3px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

/* ===== Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ===== */
.notification-item-icon {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* ===== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ===== */
.notification-item-content {
    flex: 1;
    min-width: 0;
}

.notification-item-title {
    font-size: 22px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 8px;
    line-height: 1.5;
}

.notification-item-message {
    font-size: 18px;
    color: #6b7280;
    margin-bottom: 10px;
    line-height: 1.6;
}

.notification-item-time {
    font-size: 15px;
    color: #9ca3af;
    display: flex;
    align-items: center;
    gap: 6px;
}

/* ===== Ø²Ø± Ø­Ø°Ù Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ===== */
.notification-item-delete {
    flex-shrink: 0;
    width: 34px;
    height: 34px;
    border: none;
    background: rgba(239, 68, 68, 0.1);
    border-radius: 8px;
    color: #ef4444;
    cursor: pointer;
    opacity: 0;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.notification-item-card:hover .notification-item-delete {
    opacity: 1;
}

.notification-item-delete:hover {
    background: rgba(239, 68, 68, 0.2);
    transform: scale(1.1);
}

/* ===== Toast Notifications ===== */
.notifications-toast-container {
    position: fixed;
    top: 90px;
    left: 20px;
    z-index: 100000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 420px;
    pointer-events: none;
}

.notification-toast-card {
    background: white;
    border-radius: 14px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    padding: 16px;
    transform: translateX(-120%);
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    opacity: 0;
    pointer-events: all;
    border-right: 4px solid #3b82f6;
    max-width: 420px;
}

.notification-toast-card.visible {
    transform: translateX(0);
    opacity: 1;
}

/* ===== Ø£ÙˆÙ„ÙˆÙŠØ§Øª Toast ===== */
.notification-toast-card.priority-critical {
    border-right-color: #ef4444;
    background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
}

.notification-toast-card.priority-high {
    border-right-color: #f59e0b;
    background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
}

.notification-toast-card.priority-medium {
    border-right-color: #3b82f6;
}

.notification-toast-card.priority-low {
    border-right-color: #10b981;
}

/* ===== Ù…Ø­ØªÙˆÙ‰ Toast ===== */
.notification-toast-content {
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.notification-toast-icon {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.9);
    font-size: 20px;
}

.notification-toast-body {
    flex: 1;
    min-width: 0;
}

.notification-toast-title {
    font-size: 15px;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 4px;
}

.notification-toast-message {
    font-size: 13px;
    color: #6b7280;
    line-height: 1.5;
}

.notification-toast-close {
    flex-shrink: 0;
    width: 28px;
    height: 28px;
    border: none;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 6px;
    color: #9ca3af;
    cursor: pointer;
    transition: all 0.2s;
}

.notification-toast-close:hover {
    background: rgba(0, 0, 0, 0.1);
    color: #6b7280;
}

/* ===== Scrollbar ===== */
.notifications-modal-body::-webkit-scrollbar {
    width: 8px;
}

.notifications-modal-body::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.notifications-modal-body::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 10px;
}

.notifications-modal-body::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5568d3, #6a3e8a);
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
    .notification-bell-btn {
        width: 38px;
        height: 38px;
    }
    
    .notifications-center-modal {
        width: 95%;
        max-height: 90vh;
    }
    
    .notifications-modal-header {
        padding: 20px;
    }
    
    .notifications-modal-title {
        font-size: 18px;
    }
    
    .notifications-toast-container {
        left: 10px;
        right: 10px;
        max-width: calc(100% - 20px);
    }
    
    .notification-toast-card {
        max-width: 100%;
    }
}

/* ===== ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¶Ø§Ø±Ø¨ ===== */
.notification-bell-btn,
.notifications-modal-overlay,
.notifications-center-modal,
.notifications-toast-container {
    font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
    </style>
    
    
    <script src="products-fixes.js"></script>


    
    <!-- ==========================================
         ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 - Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙØµÙŠÙ„ÙŠØ©
         ========================================== -->
    <script>
/* ===================================
   ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 - Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙØµÙŠÙ„ÙŠØ©
   Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø©: Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„ ÙˆÙ…Ù†ØªØ¬
   =================================== */

(function() {
    'use strict';
    
    if (window.NotificationsSystemV4) {
        console.warn('âš ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4 Ù…Ø­Ù…Ù‘Ù„ Ø¨Ø§Ù„ÙØ¹Ù„');
        return;
    }
    
    console.log('ğŸ”” ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 - Ø§Ù„ØªÙØµÙŠÙ„ÙŠ...');

    // ==================== NotificationEngine ====================
    class NotificationEngineV4 {
        constructor() {
            this.checkInterval = 5 * 60 * 1000; // 5 Ø¯Ù‚Ø§Ø¦Ù‚
            this.isRunning = false;
            this.lastCheck = null;
            this.intervalId = null;
        }
        
        start() {
            if (this.isRunning) return;
            
            this.isRunning = true;
            console.log('ğŸ”” Ø¨Ø¯Ø¡ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4');
            
            this.performCheck();
            
            this.intervalId = setInterval(() => {
                this.performCheck();
            }, this.checkInterval);
        }
        
        stop() {
            if (this.intervalId) {
                clearInterval(this.intervalId);
                this.intervalId = null;
            }
            this.isRunning = false;
            console.log('ğŸ”• Ø¥ÙŠÙ‚Ø§Ù Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4');
        }
        
        async performCheck() {
            console.log('ğŸ” ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙØµÙŠÙ„ÙŠ...');
            
            const notifications = [];
            
            try {
                const stockNotifs = await this.checkInventory();
                notifications.push(...stockNotifs);
                
                const debtNotifs = await this.checkDebts();
                notifications.push(...debtNotifs);
                
                this.lastCheck = new Date();
                
                if (notifications.length > 0) {
                    await this.processNotifications(notifications);
                }
                
                console.log(`âœ… Ø§Ù„ÙØ­Øµ: ${notifications.length} Ø¥Ø´Ø¹Ø§Ø± ØªÙØµÙŠÙ„ÙŠ`);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙØ­Øµ:', error);
            }
            
            return notifications;
        }
        
        async checkInventory() {
            const notifications = [];
            
            if (!window.dataSdk) return notifications;
            
            try {
                const products = await window.dataSdk.query({ type: 'product' });
                
                if (!products || products.length === 0) return notifications;
                
                // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©: ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ…ÙŠØ© == Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
                const lowStock = products.filter(p => {
                    const stock = p.stock_quantity || 0;
                    const minStock = p.min_stock_quantity || 10;
                    return stock === minStock && stock > 0;
                });

                // Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø©: Ø§Ù„ÙƒÙ…ÙŠØ© = 0
                const outOfStock = products.filter(p => {
                    return (p.stock_quantity || 0) === 0;
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ù…Ù†ØªØ¬ Ù†Ø§ÙØ°
                outOfStock.forEach(product => {
                    notifications.push({
                        id: `out-stock-${product.id}-${Date.now()}`,
                        type: 'out_of_stock',
                        priority: 'critical',
                        title: `Ù†ÙØ° Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${product.name}`,
                        message: `Ø§Ù„Ù…Ù†ØªØ¬ "${product.name}" Ù†ÙØ¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªÙ…Ø§Ù…Ø§Ù‹`,
                        icon: 'fa-times-circle',
                        color: '#ef4444',
                        timestamp: new Date().toISOString(),
                        data: {
                            product: product,
                            productId: product.id,
                            productName: product.name,
                            stock: 0
                        }
                    });
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ù…Ù†ØªØ¬ Ù…Ù†Ø®ÙØ¶
                lowStock.forEach(product => {
                    const remaining = product.stock_quantity || 0;
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø£ÙƒØ«Ø± Ù…Ù† Ø®Ø§ØµÙŠØ©
                    const productName = product.name || product.product_name || product.title || product.label || 'Ù…Ù†ØªØ¬ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…';
                    notifications.push({
                        id: `low-stock-${product.id}-${Date.now()}`,
                        type: 'low_stock',
                        priority: 'high',
                        title: `Ù…Ù†Ø®ÙØ¶: ${productName}`,
                        message: `Ø§Ù„Ù…Ù†ØªØ¬ "${productName}" - Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remaining} ÙˆØ­Ø¯Ø© ÙÙ‚Ø·`,
                        icon: 'fa-exclamation-triangle',
                        color: '#f59e0b',
                        timestamp: new Date().toISOString(),
                        data: {
                            product: product,
                            productId: product.id,
                            productName: productName,
                            stock: remaining,
                            minStock: product.min_stock_quantity || 10
                        }
                    });
                });
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù…Ù„Ø®Øµ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© (Ø¥Ø¶Ø§ÙÙŠ)
                if (outOfStock.length > 0) {
                    notifications.push({
                        id: `summary-out-stock-${Date.now()}`,
                        type: 'out_of_stock_summary',
                        priority: 'critical',
                        title: `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø©`,
                        message: `${outOfStock.length} Ù…Ù†ØªØ¬ Ù†ÙØ¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†`,
                        icon: 'fa-warehouse',
                        color: '#ef4444',
                        timestamp: new Date().toISOString(),
                        data: {
                            count: outOfStock.length,
                            products: outOfStock
                        }
                    });
                }
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù…Ù„Ø®Øµ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© (Ø¥Ø¶Ø§ÙÙŠ)
                if (lowStock.length > 0) {
                    notifications.push({
                        id: `summary-low-stock-${Date.now()}`,
                        type: 'low_stock_summary',
                        priority: 'high',
                        title: `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©`,
                        message: `${lowStock.length} Ù…Ù†ØªØ¬ Ù‚Ø§Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙØ§Ø°`,
                        icon: 'fa-chart-line',
                        color: '#f59e0b',
                        timestamp: new Date().toISOString(),
                        data: {
                            count: lowStock.length,
                            products: lowStock
                        }
                    });
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', error);
            }
            
            return notifications;
        }
        
        async checkDebts() {
            const notifications = [];
            
            if (!window.dataSdk) return notifications;
            
            try {
                const debts = await window.dataSdk.query({ type: 'debt' });
                
                if (!debts || debts.length === 0) return notifications;
                
                const now = new Date();
                
                // Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
                const overdue = debts.filter(d => {
                    if (d.status === 'paid') return false;
                    const dueDate = new Date(d.due_date);
                    return dueDate < now;
                });
                
                // Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© (Ø®Ù„Ø§Ù„ 3 Ø£ÙŠØ§Ù…)
                const upcoming = debts.filter(d => {
                    if (d.status === 'paid') return false;
                    const dueDate = new Date(d.due_date);
                    const threeDays = new Date();
                    threeDays.setDate(threeDays.getDate() + 3);
                    return dueDate >= now && dueDate <= threeDays;
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ø¯ÙŠÙ† Ù…ØªØ£Ø®Ø±
                overdue.forEach(debt => {
                    const amount = this.formatCurrency(debt.remaining_amount || 0);
                    const customerName = debt.customer_name || 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    const daysPast = Math.floor((now - new Date(debt.due_date)) / (1000 * 60 * 60 * 24));
                    
                    notifications.push({
                        id: `overdue-${debt.id}-${Date.now()}`,
                        type: 'overdue_debt',
                        priority: daysPast > 30 ? 'critical' : 'high',
                        title: `Ø¯ÙŠÙ† Ù…ØªØ£Ø®Ø±: ${customerName}`,
                        message: `Ø§Ù„Ù…Ø¨Ù„Øº: ${amount} - Ù…ØªØ£Ø®Ø± ${daysPast} ÙŠÙˆÙ…`,
                        icon: 'fa-exclamation-circle',
                        color: '#ef4444',
                        timestamp: new Date().toISOString(),
                        data: {
                            debt: debt,
                            debtId: debt.id,
                            customerId: debt.customer_id,
                            customerName: customerName,
                            amount: debt.remaining_amount,
                            daysPast: daysPast,
                            dueDate: debt.due_date
                        }
                    });
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ø¯ÙŠÙ† Ù‚Ø±ÙŠØ¨
                upcoming.forEach(debt => {
                    const amount = this.formatCurrency(debt.remaining_amount || 0);
                    const customerName = debt.customer_name || 'Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    const dueDate = new Date(debt.due_date);
                    const daysLeft = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));
                    
                    notifications.push({
                        id: `upcoming-${debt.id}-${Date.now()}`,
                        type: 'upcoming_debt',
                        priority: 'medium',
                        title: `Ø¯ÙŠÙ† Ù‚Ø±ÙŠØ¨: ${customerName}`,
                        message: `Ø§Ù„Ù…Ø¨Ù„Øº: ${amount} - ÙŠØ³ØªØ­Ù‚ Ø®Ù„Ø§Ù„ ${daysLeft} ÙŠÙˆÙ…`,
                        icon: 'fa-clock',
                        color: '#f59e0b',
                        timestamp: new Date().toISOString(),
                        data: {
                            debt: debt,
                            debtId: debt.id,
                            customerId: debt.customer_id,
                            customerName: customerName,
                            amount: debt.remaining_amount,
                            daysLeft: daysLeft,
                            dueDate: debt.due_date
                        }
                    });
                });
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù…Ù„Ø®Øµ Ù„Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© (Ø¥Ø¶Ø§ÙÙŠ)
                if (overdue.length > 0) {
                    const total = overdue.reduce((sum, d) => sum + (d.remaining_amount || 0), 0);
                    notifications.push({
                        id: `summary-overdue-${Date.now()}`,
                        type: 'overdue_debts_summary',
                        priority: 'critical',
                        title: `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©`,
                        message: `${overdue.length} Ø¯ÙŠÙ† Ù…ØªØ£Ø®Ø± - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${this.formatCurrency(total)}`,
                        icon: 'fa-money-bill-wave',
                        color: '#ef4444',
                        timestamp: new Date().toISOString(),
                        data: {
                            count: overdue.length,
                            totalAmount: total,
                            debts: overdue
                        }
                    });
                }
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù…Ù„Ø®Øµ Ù„Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© (Ø¥Ø¶Ø§ÙÙŠ)
                if (upcoming.length > 0) {
                    const total = upcoming.reduce((sum, d) => sum + (d.remaining_amount || 0), 0);
                    notifications.push({
                        id: `summary-upcoming-${Date.now()}`,
                        type: 'upcoming_debts_summary',
                        priority: 'medium',
                        title: `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙŠÙˆÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©`,
                        message: `${upcoming.length} Ø¯ÙŠÙ† - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${this.formatCurrency(total)}`,
                        icon: 'fa-calendar-alt',
                        color: '#f59e0b',
                        timestamp: new Date().toISOString(),
                        data: {
                            count: upcoming.length,
                            totalAmount: total,
                            debts: upcoming
                        }
                    });
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø¯ÙŠÙˆÙ†:', error);
            }
            
            return notifications;
        }
        
        async processNotifications(notifications) {
            // Ø¹Ø±Ø¶ Toast ÙÙ‚Ø· Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù„Ø®ØµØ©
            const summaryNotifs = notifications.filter(n => 
                n.type.includes('_summary')
            );
            
            for (const notif of summaryNotifs) {
                window.NotificationsSystemV4.ui.showToast(notif);
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ± (Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ÙˆØ§Ù„Ù…Ù„Ø®ØµØ©)
            for (const notif of notifications) {
                window.NotificationsSystemV4.manager.add(notif);
            }
        }
        
        formatCurrency(amount) {
            return new Intl.NumberFormat('ar-IQ', {
                style: 'decimal',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount) + ' Ø¯.Ø¹';
        }
    }

    // ==================== NotificationManager ====================
    class NotificationManagerV4 {
        constructor() {
            this.notifications = [];
            this.unreadCount = 0;
        }
        
        add(notif) {
            const exists = this.notifications.some(n => n.id === notif.id);
            if (exists) return;
            
            this.notifications.unshift(notif);
            this.unreadCount++;
            this.updateBadge();
            this.playSound();
        }
        
        markAsRead(id) {
            const notif = this.notifications.find(n => n.id === id);
            if (notif && !notif.read) {
                notif.read = true;
                notif.readAt = new Date().toISOString();
                this.unreadCount = Math.max(0, this.unreadCount - 1);
                this.updateBadge();
            }
        }
        
        markAllAsRead() {
            this.notifications.forEach(n => {
                if (!n.read) {
                    n.read = true;
                    n.readAt = new Date().toISOString();
                }
            });
            this.unreadCount = 0;
            this.updateBadge();
            window.NotificationsSystemV4.ui.renderModal();
        }
        
        delete(id) {
            const index = this.notifications.findIndex(n => n.id === id);
            if (index !== -1) {
                const notif = this.notifications[index];
                if (!notif.read) {
                    this.unreadCount--;
                }
                this.notifications.splice(index, 1);
                this.updateBadge();
            }
        }
        
        clearAll() {
            this.notifications = [];
            this.unreadCount = 0;
            this.updateBadge();
            window.NotificationsSystemV4.ui.renderModal();
        }
        
        getAll() {
            return this.notifications;
        }
        
        updateBadge() {
            const badge = document.getElementById('notificationsBadgeV4');
            if (badge) {
                if (this.unreadCount > 0) {
                    badge.textContent = this.unreadCount > 99 ? '99+' : this.unreadCount;
                    badge.classList.add('visible');
                } else {
                    badge.classList.remove('visible');
                }
            }
        }
        
        playSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.frequency.value = 800;
                osc.type = 'sine';
                
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                
                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.5);
            } catch (error) {
                console.warn('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
            }
        }
    }

    // ==================== NotificationUI ====================
    class NotificationUIV4 {
        constructor() {
            this.modalOverlay = null;
            this.modal = null;
            this.toastContainer = null;
            this.initUI();
        }
        
        initUI() {
            this.addBellButton();
            this.createModal();
            this.createToastContainer();
        }
        
        addBellButton() {
            const topActions = document.querySelector('.top-actions');
            
            if (!topActions) {
                console.error('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ .top-actions');
                return;
            }
            
            const bellBtn = document.createElement('button');
            bellBtn.className = 'notification-bell-btn';
            bellBtn.id = 'notificationsBellBtnV4';
            bellBtn.innerHTML = `
                <i class="fas fa-bell"></i>
                <span class="notification-count-badge" id="notificationsBadgeV4">0</span>
            `;
            
            bellBtn.addEventListener('click', () => {
                this.toggleModal();
            });
            
            const themeToggle = topActions.querySelector('.theme-toggle');
            if (themeToggle) {
                topActions.insertBefore(bellBtn, themeToggle);
            } else {
                topActions.appendChild(bellBtn);
            }
            
            console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4');
        }
        
        createModal() {
            this.modalOverlay = document.createElement('div');
            this.modalOverlay.className = 'notifications-modal-overlay';
            this.modalOverlay.id = 'notificationsOverlayV4';
            this.modalOverlay.addEventListener('click', () => {
                this.closeModal();
            });
            document.body.appendChild(this.modalOverlay);
            
            this.modal = document.createElement('div');
            this.modal.className = 'notifications-center-modal';
            this.modal.id = 'notificationsModalV4';
            this.modal.innerHTML = `
                <div class="notifications-modal-header">
                    <h3 class="notifications-modal-title">
                        <i class="fas fa-bell"></i>
                        Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                    </h3>
                    <div class="notifications-modal-actions">
                        <button class="notifications-modal-action-btn" id="markAllReadBtnV4" title="ØªØ¹Ù„ÙŠÙ… Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡">
                            <i class="fas fa-check-double"></i>
                        </button>
                        <button class="notifications-modal-action-btn" id="clearAllBtnV4" title="Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="notifications-modal-action-btn" id="closeModalBtnV4" title="Ø¥ØºÙ„Ø§Ù‚">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="notifications-modal-body" id="notificationsBodyV4">
                    <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            `;
            
            document.body.appendChild(this.modal);
            
            document.getElementById('markAllReadBtnV4').addEventListener('click', () => {
                window.NotificationsSystemV4.manager.markAllAsRead();
            });
            
            document.getElementById('clearAllBtnV4').addEventListener('click', () => {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŸ')) {
                    window.NotificationsSystemV4.manager.clearAll();
                }
            });
            
            document.getElementById('closeModalBtnV4').addEventListener('click', () => {
                this.closeModal();
            });
            
            console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4');
        }
        
        createToastContainer() {
            this.toastContainer = document.createElement('div');
            this.toastContainer.className = 'notifications-toast-container';
            this.toastContainer.id = 'toastsContainerV4';
            document.body.appendChild(this.toastContainer);
        }
        
        toggleModal() {
            const isActive = this.modal.classList.contains('active');
            
            if (isActive) {
                this.closeModal();
            } else {
                this.openModal();
            }
        }
        
        openModal() {
            this.renderModal();
            this.modalOverlay.classList.add('active');
            this.modal.classList.add('active');
        }
        
        closeModal() {
            this.modalOverlay.classList.remove('active');
            this.modal.classList.remove('active');
        }
        
        renderModal() {
            const body = document.getElementById('notificationsBodyV4');
            if (!body) return;
            
            const notifications = window.NotificationsSystemV4.manager.getAll();
            
            if (notifications.length === 0) {
                body.innerHTML = `
                    <div class="notifications-empty-state">
                        <i class="fas fa-bell-slash"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
                    </div>
                `;
                return;
            }
            
            body.innerHTML = notifications.map(n => this.createItemHTML(n)).join('');
        }
        
        createItemHTML(notif) {
            const timeAgo = this.getTimeAgo(notif.timestamp);
            const readClass = notif.read ? 'read' : 'unread';
            
            return `
                <div class="notification-item-card ${readClass}" 
                     data-notif-id="${notif.id}"
                     onclick="window.NotificationsSystemV4.ui.handleItemClick('${notif.id}')">
                    <div class="notification-item-icon" style="color: ${notif.color}">
                        <i class="fas ${notif.icon}"></i>
                    </div>
                    <div class="notification-item-content">
                        <div class="notification-item-title">${notif.title}</div>
                        <div class="notification-item-message">${notif.message}</div>
                        <div class="notification-item-time">
                            <i class="fas fa-clock"></i> ${timeAgo}
                        </div>
                    </div>
                    <button class="notification-item-delete" 
                            onclick="event.stopPropagation(); window.NotificationsSystemV4.manager.delete('${notif.id}'); window.NotificationsSystemV4.ui.renderModal();">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }
        
        handleItemClick(id) {
            const notif = window.NotificationsSystemV4.manager.notifications.find(n => n.id === id);
            if (!notif) return;
            
            window.NotificationsSystemV4.manager.markAsRead(id);
            
            // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            switch (notif.type) {
                case 'out_of_stock':
                case 'low_stock':
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù…Ù†ØªØ¬ Ù…Ø­Ø¯Ø¯
                    this.navigateToProduct(notif.data.productId);
                    break;
                    
                case 'out_of_stock_summary':
                case 'low_stock_summary':
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    this.navigateToInventory();
                    break;
                    
                case 'overdue_debt':
                case 'upcoming_debt':
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø­Ø¯Ø¯
                    this.navigateToCustomer(notif.data.customerId || notif.data.debtId);
                    break;
                    
                case 'overdue_debts_summary':
                case 'upcoming_debts_summary':
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†
                    this.navigateToDebts();
                    break;
            }
            
            this.closeModal();
        }
        
        navigateToProduct(productId) {
            console.log('ğŸ¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ù†ØªØ¬:', productId);
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            if (typeof showPage === 'function') {
                showPage('inventory');
            }
            
            // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù…Ù†ØªØ¬
            setTimeout(() => {
                const productElement = document.querySelector(`[data-product-id="${productId}"]`);
                if (productElement) {
                    productElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    productElement.style.backgroundColor = '#fef3c7';
                    setTimeout(() => {
                        productElement.style.backgroundColor = '';
                    }, 2000);
                }
            }, 500);
        }
        
        navigateToCustomer(customerId) {
            console.log('ğŸ¯ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¹Ù…ÙŠÙ„:', customerId);
            
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙŠÙˆÙ†
            if (typeof showPage === 'function') {
                showPage('debts');
            }
            
            // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„
            setTimeout(() => {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø¯ÙŠÙ† ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                const debtRow = document.querySelector(`[data-debt-id="${customerId}"], [data-customer-id="${customerId}"]`);
                if (debtRow) {
                    debtRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    debtRow.style.backgroundColor = '#fef3c7';
                    setTimeout(() => {
                        debtRow.style.backgroundColor = '';
                    }, 2000);
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ data attributeØŒ Ù†Ø­Ø§ÙˆÙ„ ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙŠÙ†
                    const viewButton = document.querySelector(`button[onclick*="${customerId}"]`);
                    if (viewButton) {
                        viewButton.click();
                    }
                }
            }, 500);
        }
        
        navigateToInventory() {
            if (typeof showPage === 'function') {
                showPage('inventory');
            }
        }
        
        navigateToDebts() {
            if (typeof showPage === 'function') {
                showPage('debts');
            }
        }
        
        showToast(notif) {
            const toast = document.createElement('div');
            toast.className = `notification-toast-card priority-${notif.priority}`;
            toast.innerHTML = `
                <div class="notification-toast-content">
                    <div class="notification-toast-icon" style="color: ${notif.color}">
                        <i class="fas ${notif.icon}"></i>
                    </div>
                    <div class="notification-toast-body">
                        <div class="notification-toast-title">${notif.title}</div>
                        <div class="notification-toast-message">${notif.message}</div>
                    </div>
                    <button class="notification-toast-close" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            this.toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('visible');
            }, 100);
            
            const duration = this.getToastDuration(notif.priority);
            setTimeout(() => {
                toast.classList.remove('visible');
                setTimeout(() => {
                    toast.remove();
                }, 400);
            }, duration);
        }
        
        getToastDuration(priority) {
            switch (priority) {
                case 'critical': return 10000;
                case 'high': return 7000;
                case 'medium': return 5000;
                default: return 4000;
            }
        }
        
        getTimeAgo(timestamp) {
            const now = new Date();
            const then = new Date(timestamp);
            const diffMs = now - then;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'Ø§Ù„Ø¢Ù†';
            if (diffMins < 60) return `Ù…Ù†Ø° ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `Ù…Ù†Ø° ${diffHours} Ø³Ø§Ø¹Ø©`;
            
            const diffDays = Math.floor(diffHours / 24);
            if (diffDays < 7) return `Ù…Ù†Ø° ${diffDays} ÙŠÙˆÙ…`;
            
            return then.toLocaleDateString('ar-IQ');
        }
    }

    // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ====================
    
    function initSystemV4() {
        console.log('ğŸ”” ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 Ø§Ù„ØªÙØµÙŠÙ„ÙŠ...');
        
        try {
            window.NotificationsSystemV4 = {
                engine: new NotificationEngineV4(),
                manager: new NotificationManagerV4(),
                ui: new NotificationUIV4()
            };
            
            setTimeout(() => {
                window.NotificationsSystemV4.engine.start();
            }, 3000);
            
            console.log('âœ… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø¬Ø§Ù‡Ø²');
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSystemV4);
    } else {
        initSystemV4();
    }
    
    // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
    
    window.testNotificationsV4 = function() {
        console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4 Ø§Ù„ØªÙØµÙŠÙ„ÙŠ...');
        
        // Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†ØªØ¬ Ù…Ø­Ø¯Ø¯ Ù†Ø§ÙØ°
        window.NotificationsSystemV4.manager.add({
            id: 'test-product-1',
            type: 'out_of_stock',
            priority: 'critical',
            title: 'Ù†ÙØ° Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ÙƒÙˆÙ„Ø§',
            message: 'Ø§Ù„Ù…Ù†ØªØ¬ "ÙƒÙˆÙ„Ø§" Ù†ÙØ¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªÙ…Ø§Ù…Ø§Ù‹',
            icon: 'fa-times-circle',
            color: '#ef4444',
            timestamp: new Date().toISOString(),
            data: { productId: '123', productName: 'ÙƒÙˆÙ„Ø§' }
        });
        
        // Ø¥Ø´Ø¹Ø§Ø± Ø¯ÙŠÙ† Ù…Ø­Ø¯Ø¯ Ù…ØªØ£Ø®Ø±
        window.NotificationsSystemV4.manager.add({
            id: 'test-debt-1',
            type: 'overdue_debt',
            priority: 'high',
            title: 'Ø¯ÙŠÙ† Ù…ØªØ£Ø®Ø±: Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
            message: 'Ø§Ù„Ù…Ø¨Ù„Øº: 500,000 Ø¯.Ø¹ - Ù…ØªØ£Ø®Ø± 15 ÙŠÙˆÙ…',
            icon: 'fa-exclamation-circle',
            color: '#ef4444',
            timestamp: new Date().toISOString(),
            data: { customerId: '456', customerName: 'Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ', amount: 500000 }
        });
        
        window.NotificationsSystemV4.ui.renderModal();
        console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©');
    };
    
    window.recheckNotificationsV4 = async function() {
        if (window.NotificationsSystemV4 && window.NotificationsSystemV4.engine) {
            await window.NotificationsSystemV4.engine.performCheck();
        }
    };
    
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª v4.0 Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
})();
    </script>
 </body>
</html>